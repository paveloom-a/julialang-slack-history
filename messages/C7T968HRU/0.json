{"cursor": 2, "messages": [{"client_msg_id":"a29ec5e8-9f60-4b3a-8816-1b3459a38570","type":"message","text":"so if you sum over the interval with that, you get zero change over the whole interval for some delta t &gt; 0","user":"U69BL50BF","ts":"1609538822.110000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8Nse","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so if you sum over the interval with that, you get zero change over the whole interval for some delta t > 0"}]}]}]},{"client_msg_id":"5de16dcb-90e2-48da-8ddd-c57e4a6b4675","type":"message","text":"what's going on is that it can \"work\" at a lower tolerance, but since your model doesn't have a well-defined solution it does some wonky stuff.","user":"U69BL50BF","ts":"1609538854.110500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2J/HZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what's going on is that it can \"work\" at a lower tolerance, but since your model doesn't have a well-defined solution it does some wonky stuff."}]}]}]},{"type":"message","subtype":"bot_message","text":"&gt; [slack] &lt;chrisrackauckas&gt; what's going on is that it can \"work\" at a lower tolerance, but since your model doesn't have a well-defined solution it does some wonky stuff.  I appreciate your help. But with this comment you simply disregarded the entire theory of population balances. What I am solving is an extremely simple case of particle aggregation. if my initial condition was 1 everywhere, then the problem has an analytical solution.","ts":"1609539001.110600","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"&gt; [slack] &lt;chrisrackauckas&gt; what's going on is that it can \"work\" at a lower tolerance, but since your model doesn't have a well-defined solution it does some wonky stuff.\n\nI appreciate your help. But with this comment you simply disregarded the entire theory of population balances. What I am solving is an extremely simple case of particle aggregation. if my initial condition was 1 everywhere, then the problem has an analytical solution.","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))","ts":"1609539147.112000","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"this is what decides the derivative of solution component at the first time step. M and L are both non-zero initially","ts":"1609539186.112800","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"this is what decides the derivative of solution component at the first time step. M and L are both non-zero initially","verbatim":false}}]},{"client_msg_id":"3e3f788c-c28a-489d-b789-67af3f6c012e","type":"message","text":"No, that comment is just calculus nothing more. If you have that line of code in there, then you're saying is:\n\nif for any delta t, p(dt) derivative is ever small, then it's zero.\n\nSo choose dt small enough such that it's true for every component. It's trivial you can do that, right? so now choose N s.t. N*dt walks to the end. Therefore the solution is constant zero","user":"U69BL50BF","ts":"1609539191.113000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Uaq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"No, that comment is just calculus nothing more. If you have that line of code in there, then you're saying is:\n\nif for any delta t, p(dt) derivative is ever small, then it's zero.\n\nSo choose dt small enough such that it's true for every component. It's trivial you can do that, right? so now choose N s.t. N*dt walks to the end. Therefore the solution is constant zero"}]}]}]},{"client_msg_id":"54fd0f67-8357-4691-b37a-e36154d4f32d","type":"message","text":"That's why I'm saying it doesn't have an actual solution at that point because that line of code makes it non-convergent to any non-zero solution just because of how calculus works.","user":"U69BL50BF","ts":"1609539231.113900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/om","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That's why I'm saying it doesn't have an actual solution at that point because that line of code makes it non-convergent to any non-zero solution just because of how calculus works."}]}]}]},{"client_msg_id":"3df68460-6f74-4b63-b1a2-e768afa94d64","type":"message","text":"That's an issue it would only have starting at all zeros of course","user":"U69BL50BF","ts":"1609539250.114200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0mnP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That's an issue it would only have starting at all zeros of course"}]}]}]},{"client_msg_id":"6ae68ce8-a0a9-4ab2-9c80-381f645c0d02","type":"message","text":"My guess is that your model isn't what you wrote down, which is the issue","user":"U69BL50BF","ts":"1609539291.114600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TzZHp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"My guess is that your model isn't what you wrote down, which is the issue"}]}]}]},{"type":"message","subtype":"bot_message","text":"okay. I will look into it. Thanks for your help.","ts":"1609539334.114700","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"okay. I will look into it. Thanks for your help.","verbatim":false}}]},{"client_msg_id":"3533dde0-2a83-4d27-a6fb-1e1321e60c9c","type":"message","text":"in a step of `1e-16` you can see:","user":"U69BL50BF","ts":"1609539429.115000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ylzs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"in a step of "},{"type":"text","text":"1e-16","style":{"code":true}},{"type":"text","text":" you can see:"}]}]}]},{"client_msg_id":"d6d63330-6c88-4914-ae74-3b3b682681a5","type":"message","text":"```t = 1.0551296000000007e-16\nt = 2.1430272000000015e-16\nt = 5.898240000000005e-16\nt = 6.422695384871799e-16\nt = 6.553600000000005e-16\nt = 6.553600000000005e-16\nfindall((x-&gt;begin\n            #= D:\\OneDrive\\Computer\\Desktop\\test.jl:73 =#\n            x &lt; 0\n        end), u) = [2, 3, 5, 7, 9, 12, 15, 18, 21, 24, 27, 30]```","user":"U69BL50BF","ts":"1609539431.115300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=gEk","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"t = 1.0551296000000007e-16\nt = 2.1430272000000015e-16\nt = 5.898240000000005e-16\nt = 6.422695384871799e-16\nt = 6.553600000000005e-16\nt = 6.553600000000005e-16\nfindall((x->begin\n            #= D:\\OneDrive\\Computer\\Desktop\\test.jl:73 =#\n            x < 0\n        end), u) = [2, 3, 5, 7, 9, 12, 15, 18, 21, 24, 27, 30]"}]}]}]},{"client_msg_id":"d501bcfc-50dc-4494-aa8d-a1aaab2e1d35","type":"message","text":"you have 12 negative values, so the derivative has terms that go negative when values are zero","user":"U69BL50BF","ts":"1609539454.115700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9IH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you have 12 negative values, so the derivative has terms that go negative when values are zero"}]}]}]},{"client_msg_id":"3b8f6940-a63c-4a90-94d3-f4694c39a6d6","type":"message","text":"that's when removing that portion that forces zeroing","user":"U69BL50BF","ts":"1609539471.116200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eRsbn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's when removing that portion that forces zeroing"}]}]}]},{"client_msg_id":"dabc02b0-42fa-499c-9504-c5d3c54a5dd6","type":"message","text":"which means that either the solution is purely zero or has negative components, which I assume isn't what you'd expect from the model","user":"U69BL50BF","ts":"1609539498.116900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M6T7p","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"which means that either the solution is purely zero or has negative components, which I assume isn't what you'd expect from the model"}]}]}]},{"client_msg_id":"79808f83-cf2e-4b43-8057-0c63b187dcb2","type":"message","text":"so I think you must have a sign error somewhere.","user":"U69BL50BF","ts":"1609539505.117200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lXf=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so I think you must have a sign error somewhere."}]}]}]},{"client_msg_id":"983553de-45c7-44be-9c50-1e5b1347fbf8","type":"message","text":"I would suggest taking a random vector in MATLAB and then copying it over to Julia, evaluating the `f` function in both languages with that same vector, and see if what they output is the same","user":"U69BL50BF","ts":"1609539540.118000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"++5r6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I would suggest taking a random vector in MATLAB and then copying it over to Julia, evaluating the "},{"type":"text","text":"f","style":{"code":true}},{"type":"text","text":" function in both languages with that same vector, and see if what they output is the same"}]}]}]},{"client_msg_id":"9fa52f2a-40ed-4977-972c-a4910b488d70","type":"message","text":"my guess is that they are not the same.","user":"U69BL50BF","ts":"1609539546.118200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qEw0S","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"my guess is that they are not the same."}]}]}]},{"client_msg_id":"1e9303a3-ef8b-4185-a259-b462f60cfb62","type":"message","text":"```guess_vector = ...\ndu = similar(p_i)\nnew_odefcn!(du,p_i,nothing,0.0)\ndu```","user":"U69BL50BF","ts":"1609539579.118500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9Z39","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"guess_vector = ...\ndu = similar(p_i)\nnew_odefcn!(du,p_i,nothing,0.0)\ndu"}]}]}]},{"client_msg_id":"53c931fa-d2ab-4e3f-aebc-7bf470a86ebc","type":"message","text":"that's how you'd do the check (since it's mutating)","user":"U69BL50BF","ts":"1609539586.118800","team":"T68168MUP","edited":{"user":"U69BL50BF","ts":"1609539593.000000"},"blocks":[{"type":"rich_text","block_id":"qm5dP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's how you'd do the check (since it's mutating)"}]}]}]},{"client_msg_id":"429e35cb-0e00-4a2b-90a3-f9b7c7212580","type":"message","text":"enforcing non-negativity is done via the `isoutofdomain` argument like","user":"U69BL50BF","ts":"1609539617.119300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bm8wV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"enforcing non-negativity is done via the "},{"type":"text","text":"isoutofdomain","style":{"code":true}},{"type":"text","text":" argument like"}]}]}]},{"client_msg_id":"a4830656-c177-4a87-82ae-f2a4a77aeec7","type":"message","text":"```isoutofdomain(u,t,integrator) = any(x-&gt;x&lt;0,u)\nsol = solve(prob,Tsit5(),isoutofdomain=isoutofdomain)```","user":"U69BL50BF","ts":"1609539635.119900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EDMx","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"isoutofdomain(u,t,integrator) = any(x->x<0,u)\nsol = solve(prob,Tsit5(),isoutofdomain=isoutofdomain)"}]}]}]},{"client_msg_id":"83bf4397-35b8-49e7-b7df-a4f817975167","type":"message","text":"but until the model is fixed what it's going to tell you is that the true solution to your ODE has a negative component.","user":"U69BL50BF","ts":"1609539651.120300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iAu8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but until the model is fixed what it's going to tell you is that the true solution to your ODE has a negative component."}]}]}]},{"client_msg_id":"4ede27d0-e43a-401d-92a7-d4983c198799","type":"message","text":"and lastly","user":"U69BL50BF","ts":"1609539679.120600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2L3J","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and lastly"}]}]}]},{"client_msg_id":"89465110-e447-4b9a-bb60-e1912f3c6371","type":"message","text":"```const temp = zeros(10000)\n\nfunction new_odefcn!(dpdt,p,whatsthis,t)\n   n  = 10000\n   n = convert(Int64,n)\n   nk = 700\n   nk = convert(Int64,nk)\n   k1 = 0.6\n   k2 = 26000\n   alpha = 9000\n   m = 6\n   l = 6\n   a = 1\n   b = 2\n   c_Zr = 0.0144\n   c_B  = 0.0163\n   Na = 6.02214e23\n   invna = 1/Na\n   all_i = 1:n\n\n   @inbounds for i = 1:nk\n       for j = i:n\n           if j == i\n               if i == 1\n                   for ii = 1:n\n                       temp[ii] = all_i[ii]*p[ii]\n                   end\n                   total_p1 = sum(temp)\n                   M = c_Zr - (total_p1*m)\n                   L = c_B - (total_p1*l)\n                   if total_p1 &gt; 0\n                       k1 = k1*alpha*total_p1\n                   end\n                   dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))\n               end\n               dpdt[j] = dpdt[j] - (k2*p[i]*sum(@view(p[i:n-i])))\n           elseif (j&lt;(i+i)) &amp;&amp; (j!=i)\n               dpdt[j] = dpdt[j] - (k2*p[i]*p[j])\n           elseif j &gt;= (i+i)\n               if j+i &lt;= n\n                   dpdt[j] = dpdt[j] - (k2*p[i]*(p[j] - p[j-i]))\n               elseif j+i &gt; n\n                   dpdt[j] = dpdt[j] + (k2*p[i]*p[j-i])\n               end\n           end\n       end\n   end\nend```","user":"U69BL50BF","ts":"1609539681.121000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6G4","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"const temp = zeros(10000)\n\nfunction new_odefcn!(dpdt,p,whatsthis,t)\n   n  = 10000\n   n = convert(Int64,n)\n   nk = 700\n   nk = convert(Int64,nk)\n   k1 = 0.6\n   k2 = 26000\n   alpha = 9000\n   m = 6\n   l = 6\n   a = 1\n   b = 2\n   c_Zr = 0.0144\n   c_B  = 0.0163\n   Na = 6.02214e23\n   invna = 1/Na\n   all_i = 1:n\n\n   @inbounds for i = 1:nk\n       for j = i:n\n           if j == i\n               if i == 1\n                   for ii = 1:n\n                       temp[ii] = all_i[ii]*p[ii]\n                   end\n                   total_p1 = sum(temp)\n                   M = c_Zr - (total_p1*m)\n                   L = c_B - (total_p1*l)\n                   if total_p1 > 0\n                       k1 = k1*alpha*total_p1\n                   end\n                   dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))\n               end\n               dpdt[j] = dpdt[j] - (k2*p[i]*sum(@view(p[i:n-i])))\n           elseif (j<(i+i)) && (j!=i)\n               dpdt[j] = dpdt[j] - (k2*p[i]*p[j])\n           elseif j >= (i+i)\n               if j+i <= n\n                   dpdt[j] = dpdt[j] - (k2*p[i]*(p[j] - p[j-i]))\n               elseif j+i > n\n                   dpdt[j] = dpdt[j] + (k2*p[i]*p[j-i])\n               end\n           end\n       end\n   end\nend"}]}]}]},{"client_msg_id":"7035f5c9-7083-4f1c-9216-37ff7d018206","type":"message","text":"that's a faster version of your model, but of course it's going to have the same issues. But that `@view` is something to think about, the reuse of the temporary is a good idea, and put `@inbounds` on only after debugging.","user":"U69BL50BF","ts":"1609539719.121800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"H3K","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's a faster version of your model, but of course it's going to have the same issues. But that "},{"type":"text","text":"@view","style":{"code":true}},{"type":"text","text":" is something to think about, the reuse of the temporary is a good idea, and put "},{"type":"text","text":"@inbounds","style":{"code":true}},{"type":"text","text":" on only after debugging."}]}]}]},{"client_msg_id":"022d05a1-1bf5-4db8-8199-740ef309eb92","type":"message","text":"@anish-dighe that should be enough to figure out what's going on in comparison to MATLAB, but let me know if you need anything more.","user":"U69BL50BF","ts":"1609539765.122500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"x0x","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"@anish-dighe that should be enough to figure out what's going on in comparison to MATLAB, but let me know if you need anything more."}]}]}]},{"type":"message","subtype":"bot_message","text":"thanks a lot for your help. I will look into it now.","ts":"1609539784.122600","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"thanks a lot for your help. I will look into it now.","verbatim":false}}]},{"client_msg_id":"fe371983-7e96-44fb-a897-5f96468a74e8","type":"message","text":"I am new to Julia and going through the DifferentialEquations.jl Tutorial (01-ode_introduction.ipynb). How can ODEProblem know only from f if u is modifed inplace or not?","user":"URPFQPSEQ","ts":"1609543232.125300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fIIM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I am new to Julia and going through the DifferentialEquations.jl Tutorial (01-ode_introduction.ipynb). How can ODEProblem know only from f if u is modifed inplace or not?"}]}]}],"thread_ts":"1609543232.125300","reply_count":1,"reply_users_count":1,"latest_reply":"1609543583.126500","reply_users":["URPFQPSEQ"],"subscribed":false},{"client_msg_id":"23f3ab78-cae6-4adb-b7ed-ad298b6125e8","type":"message","text":"<@ULZQ4DCSU> I think it's an issue in DataFrames","user":"U69BL50BF","ts":"1609544219.127200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dB+=l","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"ULZQ4DCSU"},{"type":"text","text":" I think it's an issue in DataFrames"}]}]}]},{"client_msg_id":"da19c41f-57fe-4ad9-afa6-7d106c7ebd50","type":"message","text":"I'm going to have to upstream that","user":"U69BL50BF","ts":"1609544227.127500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wcf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm going to have to upstream that"}]}]}]},{"client_msg_id":"cb9499f2-452a-4ead-9d3d-d9273533a23e","type":"message","text":"K thanks","user":"ULZQ4DCSU","ts":"1609544263.127700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cAP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"K thanks"}]}]}]},{"client_msg_id":"092d1ffb-032b-4fb4-afad-2ddd628f4514","type":"message","text":"was the issue with labelledarrays fixed?","user":"ULZQ4DCSU","ts":"1609544316.128000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"E8L","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"was the issue with labelledarrays fixed?"}]}]}]},{"client_msg_id":"d3ac0d6f-4a66-4a68-bd2d-4d406f965112","type":"message","text":"<https://github.com/SciML/DifferentialEquations.jl/issues/694>","user":"ULZQ4DCSU","ts":"1609544317.128200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+uJU","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/SciML/DifferentialEquations.jl/issues/694"}]}]}]},{"client_msg_id":"43a03e6f-fa0a-4584-9a20-f0bf54f49e64","type":"message","text":"you wanted me to remind you in dec.","user":"ULZQ4DCSU","ts":"1609544329.128400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kCFa6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you wanted me to remind you in dec."}]}]}]},{"client_msg_id":"a0ae46ce-8129-4e77-a755-9759510cd468","type":"message","text":"That was the callback time and not a labelled arrays issue?","user":"U69BL50BF","ts":"1609544455.128800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eSA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That was the callback time and not a labelled arrays issue?"}]}]}]},{"client_msg_id":"67c56b8d-797d-41ad-a577-3f3d4dc5b19d","type":"message","text":"oh wait that","user":"U69BL50BF","ts":"1609544480.129000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7bl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh wait that"}]}]}]},{"client_msg_id":"8fa88cf5-1fe7-4f0e-b8f2-c6db5a9bd765","type":"message","text":"we haven't gotten around to that.","user":"U69BL50BF","ts":"1609544484.129300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SZx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"we haven't gotten around to that."}]}]}]},{"client_msg_id":"0194ccc0-f1d0-41c8-9e25-b0b3cd5964b1","type":"message","text":"that's a Sundials issue not a LabelledArrays issue","user":"U69BL50BF","ts":"1609544553.129700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1Uwb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's a Sundials issue not a LabelledArrays issue"}]}]}]},{"type":"message","text":"On another note, I'm getting a discrepancy from my Julia implementation of some MATLAB code that seems like it could be related to callbacks.\n\nThe first image is of Julia, and the 2nd is from MATLAB.  There are callbacks implemented at t=0 and t=1 at the dip.","files":[{"id":"F01HVPCAF34","created":1609545361,"timestamp":1609545361,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"ULZQ4DCSU","editable":false,"size":10357,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01HVPCAF34/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01HVPCAF34/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01HVPCAF34-66a15ef061/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01HVPCAF34-66a15ef061/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01HVPCAF34-66a15ef061/image_360.png","thumb_360_w":158,"thumb_360_h":337,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01HVPCAF34-66a15ef061/image_160.png","original_w":158,"original_h":337,"thumb_tiny":"AwAwABazBK8l1LG2Nq9OKs4GapWv/H9cf571dByTTAQjApKc3Sm0gKtr/wAf1x/nvV2qVr/x/T/571doARulNpzdKbQBUtTi+uM1d3D1qpbKy3k7EEA9Ce9WxgZ560AISDSU4nim0Af/2Q==","permalink":"https://julialang.slack.com/files/ULZQ4DCSU/F01HVPCAF34/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01HVPCAF34-2a12768dc9","is_starred":false,"has_rich_preview":false},{"id":"F01HP0HHU3G","created":1609545388,"timestamp":1609545388,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"ULZQ4DCSU","editable":false,"size":28886,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01HP0HHU3G/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01HP0HHU3G/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01HP0HHU3G-c1ccb60e3f/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01HP0HHU3G-c1ccb60e3f/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01HP0HHU3G-c1ccb60e3f/image_360.png","thumb_360_w":360,"thumb_360_h":159,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01HP0HHU3G-c1ccb60e3f/image_480.png","thumb_480_w":480,"thumb_480_h":212,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01HP0HHU3G-c1ccb60e3f/image_160.png","original_w":577,"original_h":255,"thumb_tiny":"AwAVADDSAOc54x0oJApe1NPQ0ALuFAYGmfSlXqKAF3CndRSbRS4wKAE7UcUUUAGB6UmPpS0UAFFFFAH/2Q==","permalink":"https://julialang.slack.com/files/ULZQ4DCSU/F01HP0HHU3G/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01HP0HHU3G-d42bd62ae9","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"5fAi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"On another note, I'm getting a discrepancy from my Julia implementation of some MATLAB code that seems like it could be related to callbacks.\n\nThe first image is of Julia, and the 2nd is from MATLAB.  There are callbacks implemented at t=0 and t=1 at the dip."}]}]}],"user":"ULZQ4DCSU","ts":"1609545459.132000"},{"client_msg_id":"dbaa48eb-db4d-41b7-94ce-b2ef62f2a904","type":"message","text":"So, it's not smooth and doesn't reach the same nadir or nadir time.","user":"ULZQ4DCSU","ts":"1609545518.133300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VwK0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So, it's not smooth and doesn't reach the same nadir or nadir time."}]}]}]},{"client_msg_id":"bbe59533-79b4-4d59-867f-196a248b61e3","type":"message","text":"Could this be related to callbacks?  I tried `set_proposed_dt!(i_EC, 1e-6)` , but there was no difference.","user":"ULZQ4DCSU","ts":"1609545579.133900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eUX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Could this be related to callbacks?  I tried "},{"type":"text","text":"set_proposed_dt!(i_EC, 1e-6)","style":{"code":true}},{"type":"text","text":" , but there was no difference."}]}]}]},{"client_msg_id":"2e11a58a-3fde-4e72-803c-beb876fc2330","type":"message","text":"The MATLAB implementation looped and appendded the solving in ~1 sec increments, so I was going to test that route, but the `DataFrames`  issue is making that more difficult.","user":"ULZQ4DCSU","ts":"1609545646.135000","team":"T68168MUP","edited":{"user":"ULZQ4DCSU","ts":"1609545665.000000"},"blocks":[{"type":"rich_text","block_id":"Hvr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The MATLAB implementation looped and appendded the solving in ~1 sec increments, so I was going to test that route, but the "},{"type":"text","text":"DataFrames","style":{"code":true}},{"type":"text","text":"  issue is making that more difficult."}]}]}]},{"client_msg_id":"a9e41d37-7c43-44aa-a4ca-04aed96d1743","type":"message","text":"are you saving the full solution with interpolation?","user":"U69BL50BF","ts":"1609546081.135400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6y9UX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"are you saving the full solution with interpolation?"}]}]}]},{"client_msg_id":"4b19b8d8-4d93-4a6b-b400-e01608d0b40e","type":"message","text":"seems like it could just be due to the saved points and linear interpolating","user":"U69BL50BF","ts":"1609546092.135700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VqX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"seems like it could just be due to the saved points and linear interpolating"}]}]}]},{"client_msg_id":"95f29ac5-7c93-4b78-b8af-7845f4837454","type":"message","text":"Have you done this with all of the save defaults?","user":"U69BL50BF","ts":"1609546122.136000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8YK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Have you done this with all of the save defaults?"}]}]}]},{"client_msg_id":"e78ed26c-7952-474d-9b92-185e45959899","type":"message","text":"yeah, I used the saving defaults.","user":"ULZQ4DCSU","ts":"1609546136.136200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"C4ty","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, I used the saving defaults."}]}]}]},{"client_msg_id":"463d201c-e6d1-42a9-9fba-627a505710af","type":"message","text":"It's causing larger discrepancies downstream in the solution.","user":"ULZQ4DCSU","ts":"1609546154.136600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Rax0W","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It's causing larger discrepancies downstream in the solution."}]}]}]},{"type":"message","text":"","files":[{"id":"F01HF0UEGA3","created":1609546230,"timestamp":1609546230,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"ULZQ4DCSU","editable":false,"size":121382,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01HF0UEGA3/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01HF0UEGA3/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01HF0UEGA3-9248655719/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01HF0UEGA3-9248655719/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01HF0UEGA3-9248655719/image_360.png","thumb_360_w":327,"thumb_360_h":360,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01HF0UEGA3-9248655719/image_480.png","thumb_480_w":436,"thumb_480_h":480,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01HF0UEGA3-9248655719/image_160.png","original_w":578,"original_h":637,"thumb_tiny":"AwAwACvSB9eKQrznc350MeKYDwKAJBwMZzSnkU1VwTTqAEAwOpP1paKKAEIyKTaQeKcKKAEAwe2KWiigAooooAQnkCkQ5HNKRkU3oAMZx3oAfSCheO360UALRSflRQB//9k=","permalink":"https://julialang.slack.com/files/ULZQ4DCSU/F01HF0UEGA3/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01HF0UEGA3-ff25c1b707","is_starred":false,"has_rich_preview":false}],"upload":false,"user":"ULZQ4DCSU","display_as_bot":false,"ts":"1609546232.136700"},{"client_msg_id":"c073063a-302b-43ab-901a-50a3a7562168","type":"message","text":"top right panel isn't going below baseline to around where the red mark is.","user":"ULZQ4DCSU","ts":"1609546254.137300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+4v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"top right panel isn't going below baseline to around where the red mark is."}]}]}]},{"client_msg_id":"d6de5ac5-70b1-4168-9719-97acd7da0111","type":"message","text":"both are ran at really low tolerance with a dense solution?","user":"U69BL50BF","ts":"1609546484.137600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ql0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"both are ran at really low tolerance with a dense solution?"}]}]}]},{"client_msg_id":"a52ec52d-6154-44a3-ab01-31d76f62d181","type":"message","text":"MATLAB's run with the 1e-3 and 1e-6 and Julia 1e-12.","user":"ULZQ4DCSU","ts":"1609546555.138100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"H1H","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"MATLAB's run with the 1e-3 and 1e-6 and Julia 1e-12."}]}]}]},{"type":"message","subtype":"bot_message","text":"&gt; [slack] &lt;chrisrackauckas&gt; My guess is that your model isn't what you wrote down, which is the issue  I checked my work, MATLAB code, Julia code, and some literature. Everything is alright, except the fact that Julia does not solve the problem. Thanks for your help. I will follow Julia as it progresses but right now I am sticking to MATLAB. Again, thanks for your help. @ChrisRackauckas","ts":"1609548193.138200","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"&gt; [slack] &lt;chrisrackauckas&gt; My guess is that your model isn't what you wrote down, which is the issue\n\nI checked my work, MATLAB code, Julia code, and some literature. Everything is alright, except the fact that Julia does not solve the problem. Thanks for your help. I will follow Julia as it progresses but right now I am sticking to MATLAB. Again, thanks for your help. @ChrisRackauckas","verbatim":false}}]},{"client_msg_id":"f3f58811-4db1-45c7-b289-8417ff405bfe","type":"message","text":"<@ULZQ4DCSU> <https://github.com/SciML/DifferentialEquations.jl/issues/712>","user":"U69BL50BF","ts":"1609548227.138400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ch5Sn","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"ULZQ4DCSU"},{"type":"text","text":" "},{"type":"link","url":"https://github.com/SciML/DifferentialEquations.jl/issues/712"}]}]}]},{"client_msg_id":"9b85f945-f5fb-456a-ac16-34d54a83cbbd","type":"message","text":"@Anish-Dighe if the ODE is well-defined and you have the same ODE in both it will give the same answer","user":"U69BL50BF","ts":"1609548254.138900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MdyP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"@Anish-Dighe if the ODE is well-defined and you have the same ODE in both it will give the same answer"}]}]}]},{"client_msg_id":"7a618021-7c2d-4b1c-a02f-546dd6e10aa2","type":"message","text":"<@ULZQ4DCSU> what's your solve syntax?","user":"U69BL50BF","ts":"1609548267.139300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"omdOD","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"ULZQ4DCSU"},{"type":"text","text":" what's your solve syntax?"}]}]}]},{"client_msg_id":"46441a41-646d-42a6-bd20-93d310330b8f","type":"message","text":"@Anish-Dighe can you show me what vector you tested the vector field on? The code you're showing provably has no non-negative solution so I'd be surprised if MATLAB doesn't just exit","user":"U69BL50BF","ts":"1609548481.140000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2/U","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"@Anish-Dighe can you show me what vector you tested the vector field on? The code you're showing provably has no non-negative solution so I'd be surprised if MATLAB doesn't just exit"}]}]}]},{"client_msg_id":"7136a847-9fc9-48d5-845b-f620034b7486","type":"message","text":"```sol = solve(prob, CVODE_BDF(), reltol=1e-12, abstol=1e-12, callback=cbs, dtmax=1e-4)```","user":"ULZQ4DCSU","ts":"1609548533.140300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MvL","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"sol = solve(prob, CVODE_BDF(), reltol=1e-12, abstol=1e-12, callback=cbs, dtmax=1e-4)"}]}]}]},{"client_msg_id":"749b7df3-669e-4452-8b27-b386468a1e4e","type":"message","text":"tried without and without the dtmax","user":"ULZQ4DCSU","ts":"1609548539.140600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VjaI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"tried without and without the dtmax"}]}]}]},{"client_msg_id":"c36739c1-295d-46f4-a050-dca119b142f2","type":"message","text":"that has save_positions=(true,true) in the callbacks?","user":"U69BL50BF","ts":"1609548562.141000","team":"T68168MUP","edited":{"user":"U69BL50BF","ts":"1609548575.000000"},"blocks":[{"type":"rich_text","block_id":"M4z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that has save_positions=(true,true) in the callbacks?"}]}]}]},{"client_msg_id":"1cdea17d-6ff1-4b63-a654-854d14cdc51e","type":"message","text":"<@ULZQ4DCSU> did you try putting the MATLAB code to 1e-12 tolerances?","user":"U69BL50BF","ts":"1609548621.141500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Uqww","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"ULZQ4DCSU"},{"type":"text","text":" did you try putting the MATLAB code to 1e-12 tolerances?"}]}]}]},{"client_msg_id":"a740c997-efb2-45c2-8a30-d5877207b187","type":"message","text":"I didn't specify save_positions in the callbacks.  Is that the default, or should I add that?","user":"ULZQ4DCSU","ts":"1609549438.142600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xx3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I didn't specify save_positions in the callbacks.  Is that the default, or should I add that?"}]}]}]},{"client_msg_id":"8e2198ec-9bbe-49af-badb-5d19ed1a92ec","type":"message","text":"I did try 1e-12 IIRC, and it didn't change the MATLAB plot.","user":"ULZQ4DCSU","ts":"1609549524.143800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"P0W+n","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I did try 1e-12 IIRC, and it didn't change the MATLAB plot."}]}]}]},{"client_msg_id":"cc6e59ba-a2db-4b67-bc3a-2bd2ce04f828","type":"message","text":"&gt; I didn't specify save_positions in the callbacks. Is that the default, or should I add that?\n(true,true) should be the default","user":"U69BL50BF","ts":"1609549677.144200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BR3","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"I didn't specify save_positions in the callbacks. Is that the default, or should I add that?"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"(true,true) should be the default"}]}]}]},{"client_msg_id":"24168229-67db-4ec1-b0e0-59ee1d00fc00","type":"message","text":"&gt; I did try 1e-12 IIRC, and it didn't change the MATLAB plot.\nAt all? That's odd...","user":"U69BL50BF","ts":"1609549754.144600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Xe=","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"I did try 1e-12 IIRC, and it didn't change the MATLAB plot."}]},{"type":"rich_text_section","elements":[{"type":"text","text":"At all? That's odd..."}]}]}]},{"client_msg_id":"ca13bd9c-80d8-4327-9ed1-5288353a98fb","type":"message","text":"yeah so save positions should be fine","user":"U69BL50BF","ts":"1609549767.144800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"L3D","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah so save positions should be fine"}]}]}]},{"client_msg_id":"fcb75264-bef3-4b93-abad-633e9c64aed4","type":"message","text":"how was the event handling done on the MATLAB side?","user":"U69BL50BF","ts":"1609549774.145100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"L/3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"how was the event handling done on the MATLAB side?"}]}]}]},{"client_msg_id":"7a9cc96f-3d86-4155-a615-b6e76fb36fa7","type":"message","text":"I can't see any details on the plot so it's a bit hard to read","user":"U69BL50BF","ts":"1609549832.145500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9Xx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I can't see any details on the plot so it's a bit hard to read"}]}]}]},{"client_msg_id":"12b77aba-1b95-4d2f-9cc1-1c2f31739557","type":"message","text":"but at what point in the 1e-12s do you see a divergence of more than 1e-10 and in what variable?","user":"U69BL50BF","ts":"1609549849.146000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Umv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but at what point in the 1e-12s do you see a divergence of more than 1e-10 and in what variable?"}]}]}]},{"client_msg_id":"5333111d-b8cb-4931-87b3-60711376876d","type":"message","text":"before or after the event?","user":"U69BL50BF","ts":"1609549855.146200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"X94","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"before or after the event?"}]}]}]},{"client_msg_id":"47727daf-014c-42c8-bca2-cbe9355aa301","type":"message","text":"my guess is that it's related to the event handling because it looks too sharp","user":"U69BL50BF","ts":"1609549896.146600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fUgD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"my guess is that it's related to the event handling because it looks too sharp"}]}]}]},{"client_msg_id":"869f0764-42bd-4ab4-ab94-efb5d01e5b8c","type":"message","text":"did you cross check it with KenCarp4 or Rodas5?","user":"U69BL50BF","ts":"1609549904.146900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Lb=Q2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"did you cross check it with KenCarp4 or Rodas5?"}]}]}]},{"client_msg_id":"be5ef24d-ad98-4658-8b4b-633374d06504","type":"message","text":"do you happen to change `t` in the event?","user":"U69BL50BF","ts":"1609549953.147100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8sa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"do you happen to change "},{"type":"text","text":"t","style":{"code":true}},{"type":"text","text":" in the event?"}]}]}]},{"client_msg_id":"70142958-491e-4778-afc5-ecaec7c49247","type":"message","text":"From the MATLAB side, they used for loops to avoid discontinuity issues, and appended the solutions.","user":"ULZQ4DCSU","ts":"1609550004.148200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XSJa9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"From the MATLAB side, they used for loops to avoid discontinuity issues, and appended the solutions."}]}]}]},{"client_msg_id":"8cee3db7-1f01-43f8-ae9a-09cf121e5000","type":"message","text":"So they solved over 1 sec tspans.","user":"ULZQ4DCSU","ts":"1609550027.148800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"heZ28","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So they solved over 1 sec tspans."}]}]}]},{"client_msg_id":"a37f93c0-bcb9-4e12-a35f-11de5fd50e96","type":"message","text":"and you used DiscreteCallback firing at 1 seconds?","user":"U69BL50BF","ts":"1609550045.149200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"drh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and you used DiscreteCallback firing at 1 seconds?"}]}]}]},{"client_msg_id":"de6ef4b7-0140-49b5-8737-50fcb31fb92e","type":"message","text":"No, I just used callbacks at events, not necessarily every 1 sec.","user":"ULZQ4DCSU","ts":"1609550109.150100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aHShF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"No, I just used callbacks at events, not necessarily every 1 sec."}]}]}]},{"client_msg_id":"2d342cfe-0496-4c01-9392-3dcd5817a844","type":"message","text":"The system is very stiff.  I don't think it runs with KenCarp4 or Rodas5.","user":"ULZQ4DCSU","ts":"1609550168.151200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"g9tH0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The system is very stiff.  I don't think it runs with KenCarp4 or Rodas5."}]}]}]},{"client_msg_id":"bece4f4e-1a67-42aa-a778-636a4aab419b","type":"message","text":"I don't modify t in the event.","user":"ULZQ4DCSU","ts":"1609550196.151900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NGS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't modify t in the event."}]}]}]},{"client_msg_id":"08db98f9-ac24-4885-a9a9-ec9e03dab1b9","type":"message","text":"That doesn't make sense. CVODE_BDF isn't generally A-stable while the others are, so you'd see the reverse if it was stiffness.","user":"U69BL50BF","ts":"1609550206.152200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ywict","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That doesn't make sense. CVODE_BDF isn't generally A-stable while the others are, so you'd see the reverse if it was stiffness."}]}]}]},{"client_msg_id":"a3950702-bcdb-4707-aa8d-8f30f75afddf","type":"message","text":"&gt; No, I just used callbacks at events, not necessarily every 1 sec.\nWhat do you mean by that?","user":"U69BL50BF","ts":"1609550216.152500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qztf","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"No, I just used callbacks at events, not necessarily every 1 sec."}]},{"type":"rich_text_section","elements":[{"type":"text","text":"What do you mean by that?"}]}]}]},{"client_msg_id":"2ab4b9ea-1e73-4896-b9c5-e8327f000684","type":"message","text":"How come they do an event every 1 second but you do one every ? seconds?","user":"U69BL50BF","ts":"1609550228.152900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Rbw4J","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How come they do an event every 1 second but you do one every ? seconds?"}]}]}]},{"client_msg_id":"e1796dae-6306-44e1-9a37-bbdaff194344","type":"message","text":"I'll try KenCarp4 and Rodas5 then.","user":"ULZQ4DCSU","ts":"1609550278.153700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"C4GJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'll try KenCarp4 and Rodas5 then."}]}]}]},{"client_msg_id":"f2013244-1839-4ea8-bb2c-8d60feeb05a0","type":"message","text":"I wasn't trying to copy the MATLAB implementation, since it was inefficient.","user":"ULZQ4DCSU","ts":"1609550310.154500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kyWH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I wasn't trying to copy the MATLAB implementation, since it was inefficient."}]}]}]},{"client_msg_id":"dbdcbf23-17a4-4971-bd1f-120287a16396","type":"message","text":"There are blood flow and electrical simulation events that I have callbacks for.","user":"ULZQ4DCSU","ts":"1609550338.155600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mUT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"There are blood flow and electrical simulation events that I have callbacks for."}]}]}]},{"client_msg_id":"2ca4f5e5-c3c8-417c-ad61-dfa848537c85","type":"message","text":"changing the integrator most likely won't change the value by that much unless there's a real issue in your model though. So I would just do it as a diagnostic","user":"U69BL50BF","ts":"1609550342.155800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QUi3Y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"changing the integrator most likely won't change the value by that much unless there's a real issue in your model though. So I would just do it as a diagnostic"}]}]}]},{"client_msg_id":"c7c4ae5f-45be-41b4-91aa-f5b825b1d7cd","type":"message","text":"What do you mean by changing the integrator?","user":"ULZQ4DCSU","ts":"1609550446.156700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jsvG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What do you mean by changing the integrator?"}]}]}]},{"client_msg_id":"efa3991d-3b6a-4d1d-ad16-d8d93d1fbf44","type":"message","text":"the solving algorithm","user":"U69BL50BF","ts":"1609550458.156900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RNWCg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the solving algorithm"}]}]}]},{"client_msg_id":"8454ca08-fe8c-44e0-bcf1-1f11861732b6","type":"message","text":"BTW is there a reason why your axis is shifted?","user":"U69BL50BF","ts":"1609550543.157800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kzTQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"BTW is there a reason why your axis is shifted?"}]}]}]},{"client_msg_id":"789365ce-72b3-404a-85d7-253188c2d982","type":"message","text":"What do you mean by shifted?  In the figure with 4 subplots?","user":"ULZQ4DCSU","ts":"1609550707.158400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Pkq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What do you mean by shifted?  In the figure with 4 subplots?"}]}]}]},{"client_msg_id":"c5447465-3482-4a36-855c-f04518d01fae","type":"message","text":"you show dipping at t=0 vs t=1","user":"U69BL50BF","ts":"1609550725.158600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fcidT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you show dipping at t=0 vs t=1"}]}]}]},{"client_msg_id":"3aa54c9e-3749-497f-b9d0-6b2a52592409","type":"message","text":"but yeah the two have a distinctly different characteristic","user":"U69BL50BF","ts":"1609550800.158900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fLh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but yeah the two have a distinctly different characteristic"}]}]}]},{"client_msg_id":"ebc43ba1-3cd4-4f08-84b5-662275d2ee9b","type":"message","text":"when you do the event the derivative on that term should still be almost zero at the time of the event. Is that the case? You can grab the value at the event and evaluate `f` to check it. If that's non-zero that's your hint as to what the issue is.","user":"U69BL50BF","ts":"1609550856.160100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"p4hkI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"when you do the event the derivative on that term should still be almost zero at the time of the event. Is that the case? You can grab the value at the event and evaluate "},{"type":"text","text":"f","style":{"code":true}},{"type":"text","text":" to check it. If that's non-zero that's your hint as to what the issue is."}]}]}]},{"client_msg_id":"0e571f45-d5f1-42a7-b454-a93bf105a7f5","type":"message","text":"@Anish-Dighe I realized what your issue was and why you were confused","user":"U69BL50BF","ts":"1609552307.160400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QFX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"@Anish-Dighe I realized what your issue was and why you were confused"}]}]}]},{"client_msg_id":"6f850c2d-a900-440f-9ecd-fb16b8ad9f24","type":"message","text":"the issue comes down to the difference between Julia and MATLAB passing semantics","user":"U69BL50BF","ts":"1609552320.160900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"H+Vow","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the issue comes down to the difference between Julia and MATLAB passing semantics"}]}]}]},{"client_msg_id":"376230f8-99a0-41a8-8b5c-a2623f67316e","type":"message","text":"in MATLAB you have pass by value and in Julia you have pass by reference (the standard C, C++, Java, etc. behavior)","user":"U69BL50BF","ts":"1609552348.161400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"khKv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"in MATLAB you have pass by value and in Julia you have pass by reference (the standard C, C++, Java, etc. behavior)"}]}]}]},{"client_msg_id":"9b32c351-149d-4cb3-917a-7215664d6df0","type":"message","text":"what this means is that if you change `p` in your ODE function, you aren't just changing `p` in your ODE function, you're also changing it in the ODE itself","user":"U69BL50BF","ts":"1609552387.162000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fGjN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what this means is that if you change "},{"type":"text","text":"p","style":{"code":true}},{"type":"text","text":" in your ODE function, you aren't just changing "},{"type":"text","text":"p","style":{"code":true}},{"type":"text","text":" in your ODE function, you're also changing it in the ODE itself"}]}]}]},{"client_msg_id":"5eccf9dd-26fb-4619-b953-4af5ef7598c8","type":"message","text":"which is why it's so weird and can cause some odd behaviors (same is true of course in any C++ or Fortran solver)","user":"U69BL50BF","ts":"1609552406.162600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jhp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"which is why it's so weird and can cause some odd behaviors (same is true of course in any C++ or Fortran solver)"}]}]}]},{"client_msg_id":"4028730a-6660-4a15-8574-53ba307d52ea","type":"message","text":"MATLAB's pass by value \"accidentally\" (?) shielded you from changing the internal vector of the solver","user":"U69BL50BF","ts":"1609552433.163200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OxOCm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"MATLAB's pass by value \"accidentally\" (?) shielded you from changing the internal vector of the solver"}]}]}]},{"client_msg_id":"139b7e03-0277-4740-ac7a-2be748d67b73","type":"message","text":"If you want to mimic MATLAB's behavior here, then what you'd want to do is zero the values in a separate array","user":"U69BL50BF","ts":"1609552507.163800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ONu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you want to mimic MATLAB's behavior here, then what you'd want to do is zero the values in a separate array"}]}]}]},{"client_msg_id":"0912c196-c298-41c0-b29b-1a3f6253d787","type":"message","text":"```using Plots\nusing DifferentialEquations\n\nconst temp = zeros(10000)\nconst p = zeros(10000)\nfunction new_odefcn!(dpdt,_p,whatsthis,t)\n   n  = 10000\n   nk = 700\n   k1 = 0.6\n   k2 = 26000\n   alpha = 9000\n   m = 6\n   l = 6\n   a = 1\n   b = 2\n   c_Zr = 0.0144\n   c_B  = 0.0163\n   Na = 6.02214e23\n   invna = 1/Na\n   all_i = 1:n\n   p .= ifelse.(_p .&lt; invna,0.0,_p)\n\n   @inbounds for i = 1:nk\n       for j = i:n\n           if j == i\n               if i == 1\n                   for ii = 1:n\n                       temp[ii] = all_i[ii]*p[ii]\n                   end\n                   total_p1 = sum(temp)\n                   M = c_Zr - (total_p1*m)\n                   L = c_B - (total_p1*l)\n                   if total_p1 &gt; 0\n                       k1 = k1*alpha*total_p1\n                   end\n                   dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))\n               end\n               dpdt[j] = dpdt[j] - (k2*p[i]*sum(@view(p[i:n-i])))\n           elseif (j&lt;(i+i)) &amp;&amp; (j!=i)\n               dpdt[j] = dpdt[j] - (k2*p[i]*p[j])\n           elseif j &gt;= (i+i)\n               if j+i &lt;= n\n                   dpdt[j] = dpdt[j] - (k2*p[i]*(p[j] - p[j-i]))\n               elseif j+i &gt; n\n                   dpdt[j] = dpdt[j] + (k2*p[i]*p[j-i])\n               end\n           end\n       end\n   end\nend\n\nisoutofdomain(u,t,integrator) = any(x-&gt;x&lt;0,u)\np_i     = zeros(10000)\ntspan = (0.0, 2500.0)\nprob = ODEProblem(new_odefcn!,p_i,tspan)\n@time sol = solve(prob,Tsit5(),abstol=1e-8)\nplot(sol,vars=(1))```","user":"U69BL50BF","ts":"1609552522.164200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OEZO3","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using Plots\nusing DifferentialEquations\n\nconst temp = zeros(10000)\nconst p = zeros(10000)\nfunction new_odefcn!(dpdt,_p,whatsthis,t)\n   n  = 10000\n   nk = 700\n   k1 = 0.6\n   k2 = 26000\n   alpha = 9000\n   m = 6\n   l = 6\n   a = 1\n   b = 2\n   c_Zr = 0.0144\n   c_B  = 0.0163\n   Na = 6.02214e23\n   invna = 1/Na\n   all_i = 1:n\n   p .= ifelse.(_p .< invna,0.0,_p)\n\n   @inbounds for i = 1:nk\n       for j = i:n\n           if j == i\n               if i == 1\n                   for ii = 1:n\n                       temp[ii] = all_i[ii]*p[ii]\n                   end\n                   total_p1 = sum(temp)\n                   M = c_Zr - (total_p1*m)\n                   L = c_B - (total_p1*l)\n                   if total_p1 > 0\n                       k1 = k1*alpha*total_p1\n                   end\n                   dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))\n               end\n               dpdt[j] = dpdt[j] - (k2*p[i]*sum(@view(p[i:n-i])))\n           elseif (j<(i+i)) && (j!=i)\n               dpdt[j] = dpdt[j] - (k2*p[i]*p[j])\n           elseif j >= (i+i)\n               if j+i <= n\n                   dpdt[j] = dpdt[j] - (k2*p[i]*(p[j] - p[j-i]))\n               elseif j+i > n\n                   dpdt[j] = dpdt[j] + (k2*p[i]*p[j-i])\n               end\n           end\n       end\n   end\nend\n\nisoutofdomain(u,t,integrator) = any(x->x<0,u)\np_i     = zeros(10000)\ntspan = (0.0, 2500.0)\nprob = ODEProblem(new_odefcn!,p_i,tspan)\n@time sol = solve(prob,Tsit5(),abstol=1e-8)\nplot(sol,vars=(1))"}]}]}]},{"client_msg_id":"eae15b86-83ca-4a06-b9bc-cb9a1807297b","type":"message","text":"Note that","user":"U69BL50BF","ts":"1609552531.164400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Iss","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Note that"}]}]}]},{"client_msg_id":"e6de1b60-42e7-4bde-a83e-d112b011969a","type":"message","text":"```p .= ifelse.(_p .&lt; invna,0.0,_p)```","user":"U69BL50BF","ts":"1609552533.164700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"g3bx5","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"p .= ifelse.(_p .< invna,0.0,_p)"}]}]}]},{"client_msg_id":"a6c0b55f-33f1-4b0b-a7b2-021361fd40cc","type":"message","text":"is just a shorthand for","user":"U69BL50BF","ts":"1609552538.164900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"f2q0u","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is just a shorthand for"}]}]}]},{"client_msg_id":"619d16be-0a70-457c-80e5-fcba2c4f3210","type":"message","text":"```   for jj = 1:n\n      if _p[jj] &lt; invna\n         p[jj] = 0.0\n     else\n         p[jj] = _p[jj]\n     end\n   end```","user":"U69BL50BF","ts":"1609552547.165200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b8nU","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"   for jj = 1:n\n      if _p[jj] < invna\n         p[jj] = 0.0\n     else\n         p[jj] = _p[jj]\n     end\n   end"}]}]}]},{"client_msg_id":"662e9d6f-1ac8-4888-8e53-f38b2910f596","type":"message","text":"In general you should probably broadcast a few more expressions to make it more legible, but it's not a performance optimization so it makes little difference.","user":"U69BL50BF","ts":"1609552567.165700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kgbo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"In general you should probably broadcast a few more expressions to make it more legible, but it's not a performance optimization so it makes little difference."}]}]}]}]}