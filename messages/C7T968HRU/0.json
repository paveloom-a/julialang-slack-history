{"cursor": 1, "messages": [{"client_msg_id":"ee2b1597-ce38-4b18-b6cd-908226b2b237","type":"message","text":"<https://diffeqflux.sciml.ai/dev/examples/exogenous_input/> that's an exogenous signal example","user":"U69BL50BF","ts":"1608737631.026700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8k+63","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://diffeqflux.sciml.ai/dev/examples/exogenous_input/"},{"type":"text","text":" that's an exogenous signal example"}]}]}]},{"client_msg_id":"72b7f6ad-ce23-4d04-b844-f81576dba318","type":"message","text":"Cool, thanks! Really cool stuff, thanks for all of your hard work!","user":"U01H36BUDJB","ts":"1608738150.027000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Yd/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Cool, thanks! Really cool stuff, thanks for all of your hard work!"}]}]}]},{"client_msg_id":"7d1a8089-5a44-4616-8350-c03ba6416c3d","type":"message","text":"Is there some pre-implemented method to get a smoothed local interpolation of noisy data? I was thinking of something like Savitzky-Golay or kernelized regression, but I need a local interpolation with smooth transitions.","user":"U019PPN3H6J","ts":"1608739596.034700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Td1QI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there some pre-implemented method to get a smoothed local interpolation of noisy data? I was thinking of something like Savitzky-Golay or kernelized regression, but I need a local interpolation with smooth transitions."}]}]}],"thread_ts":"1608739596.034700","reply_count":2,"reply_users_count":2,"latest_reply":"1608740478.035000","reply_users":["UJ7DVTVQ8","U019PPN3H6J"],"subscribed":false},{"client_msg_id":"73fdf27e-e6c1-4967-956a-3e914713e3f6","type":"message","text":"Hi, I have a callback similar to `PresetTimeCallback`  and `tstops` prlong the endpoint value I set in `tspan` . Where is it possible to set back the endpoint value of tspan ?","user":"UBP7GU04T","ts":"1608848043.037700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5SC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi, I have a callback similar to "},{"type":"text","text":"PresetTimeCallback","style":{"code":true}},{"type":"text","text":"  and "},{"type":"text","text":"tstops","style":{"code":true}},{"type":"text","text":" prlong the endpoint value I set in "},{"type":"text","text":"tspan","style":{"code":true}},{"type":"text","text":" . Where is it possible to set back the endpoint value of tspan ?"}]}]}]},{"client_msg_id":"3c1d8f93-31b4-4409-b4f7-b6c404454b0c","type":"message","text":"I have an SDE on a Lie group, written\n```dx = L dw\ng(t + dt) = g(t) \\circ \\exp(\\sum_{i=1}^d E_i dx_i)\ng(0) = e```\nwhere `x` is in the Lie algebra, `\\exp` is the group exponential map, `E_i` is some orthogonal basis in the Lie algebra, `d` is the dimension, `\\circ` is group composition,  `e` is the identity element, and `dw` is a wiener process. Can this SDE be solved with the DifferentialEquations ecosystem? I have a custom Euler-Maruyama solver right now but would like to generalize.","user":"UHDQQ4GN6","ts":"1608975490.041800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qqc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have an SDE on a Lie group, written\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"dx = L dw\ng(t + dt) = g(t) \\circ \\exp(\\sum_{i=1}^d E_i dx_i)\ng(0) = e"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"where "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" is in the Lie algebra, "},{"type":"text","text":"\\exp","style":{"code":true}},{"type":"text","text":" is the group exponential map, "},{"type":"text","text":"E_i","style":{"code":true}},{"type":"text","text":" is some orthogonal basis in the Lie algebra, "},{"type":"text","text":"d","style":{"code":true}},{"type":"text","text":" is the dimension, "},{"type":"text","text":"\\circ","style":{"code":true}},{"type":"text","text":" is group composition,  "},{"type":"text","text":"e","style":{"code":true}},{"type":"text","text":" is the identity element, and "},{"type":"text","text":"dw","style":{"code":true}},{"type":"text","text":" is a wiener process. Can this SDE be solved with the DifferentialEquations ecosystem? I have a custom Euler-Maruyama solver right now but would like to generalize."}]}]}]},{"client_msg_id":"dbc66431-a571-4455-85f4-2e69c4a789cd","type":"message","text":"there are exponential integrators for SDEs","user":"U69BL50BF","ts":"1608989817.042000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kJAdD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"there are exponential integrators for SDEs"}]}]}]},{"client_msg_id":"7824d659-12e9-4fb6-8ae1-9e217a464c7b","type":"message","text":"we haven't implemented them yet :shrug:","user":"U69BL50BF","ts":"1608989824.042300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wO=U","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"we haven't implemented them yet "},{"type":"emoji","name":"shrug"}]}]}]},{"client_msg_id":"65fc51e7-23d7-4fba-96b6-db591608638f","type":"message","text":"<@U69BL50BF> Have you or your colleagues thought about the relationship between (and apparent advantages of) UDEs and traditional data assimilation techniques, i.e. via Kalman filters or something similar? Of course UDEs are far more powerful and expressive, but this might be a useful comparison to make in order to convince scientists/practitioners in the modeling world who might be skeptical of directly modifying their numerical models.","user":"U01H36BUDJB","ts":"1609159054.045000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sXM","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U69BL50BF"},{"type":"text","text":" Have you or your colleagues thought about the relationship between (and apparent advantages of) UDEs and traditional data assimilation techniques, i.e. via Kalman filters or something similar? Of course UDEs are far more powerful and expressive, but this might be a useful comparison to make in order to convince scientists/practitioners in the modeling world who might be skeptical of directly modifying their numerical models."}]}]}]},{"client_msg_id":"135b0995-431e-421a-8e14-9cfdc01bdfb0","type":"message","text":"<@U01H36BUDJB> we're working on it","user":"U69BL50BF","ts":"1609164569.045500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yoRT3","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U01H36BUDJB"},{"type":"text","text":" we're working on it"}]}]}]},{"client_msg_id":"a5ef6fe3-6547-4e6c-aa1b-a0c7727c8bdb","type":"message","text":"I actually have an NSF grant with Youssef Marzouk on space weather prediction which is incorporating SciML into data assimilation, and the magnetic navigation project is doing it too","user":"U69BL50BF","ts":"1609164652.047400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3Xz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I actually have an NSF grant with Youssef Marzouk on space weather prediction which is incorporating SciML into data assimilation, and the magnetic navigation project is doing it too"}]}]}]},{"client_msg_id":"fbd469d0-085d-4f66-9e65-0c0b7843fb35","type":"message","text":"So some papers on that are due to come out in 2021","user":"U69BL50BF","ts":"1609164667.047900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ETgB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So some papers on that are due to come out in 2021"}]}]}]},{"client_msg_id":"41c45cf7-5e46-4f4b-b6b4-ea1085b17560","type":"message","text":"New to DiffEqPhysics, I failed with a trivial example. See this issue: <https://github.com/SciML/DiffEqPhysics.jl/issues/60>","user":"UDHCV0BHD","ts":"1609250417.049600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kQ4E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"New to DiffEqPhysics, I failed with a trivial example. See this issue: "},{"type":"link","url":"https://github.com/SciML/DiffEqPhysics.jl/issues/60"}]}]}]},{"client_msg_id":"bb30daa1-d1f6-47ac-88ef-3e8f33d8c6cf","type":"message","text":"Should calculating the determinant of a (small, real) matrix using MTK be something that works for arbitrary matrices? Or should it fall to the user to check that the function MTK generates does not involve division by zero for their particular matrix?","user":"UQEDP1Q5V","ts":"1609295390.051500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Am7N","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Should calculating the determinant of a (small, real) matrix using MTK be something that works for arbitrary matrices? Or should it fall to the user to check that the function MTK generates does not involve division by zero for their particular matrix?"}]}]}]},{"client_msg_id":"a716da32-ef8c-4dc5-9f4a-99f17b6e13dc","type":"message","text":"hmm, in general stable determinant calculations are hard","user":"U69BL50BF","ts":"1609295640.051800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kLGd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hmm, in general stable determinant calculations are hard"}]}]}]},{"client_msg_id":"6a231918-7849-4e65-bf00-6805bd88f1f7","type":"message","text":"<@U6788D83U> is there a way we should overload det?","user":"U69BL50BF","ts":"1609295667.052100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"btoz","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U6788D83U"},{"type":"text","text":" is there a way we should overload det?"}]}]}]},{"client_msg_id":"0ec7890e-53b6-48c3-aae8-4699afdde9f4","type":"message","text":"We already have it\n```julia&gt; using ModelingToolkit, LinearAlgebra\n\njulia&gt; @variables A[1:4, 1:4];\n\njulia&gt; det(A)\n((((1 * A₁ˏ₁) * (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * ((A₃ˏ₃ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₃)) - (((A₃ˏ₂ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₂)) / (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * (A₂ˏ₃ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₃))))) * (((A₄ˏ₄ - ((A₄ˏ₁ / A₁ˏ₁) * A₁ˏ₄)) - (((A₄ˏ₂ - ((A₄ˏ₁ / A₁ˏ₁) * A₁ˏ₂)) / (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * (A₂ˏ₄ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₄)))) - ((((A₄ˏ₃ - ((A₄ˏ₁ / A₁ˏ₁) * A₁ˏ₃)) - (((A₄ˏ₂ - ((A₄ˏ₁ / A₁ˏ₁) * A₁ˏ₂)) / (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * (A₂ˏ₃ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₃)))) / ((A₃ˏ₃ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₃)) - (((A₃ˏ₂ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₂)) / (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * (A₂ˏ₃ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₃))))) * ((A₃ˏ₄ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₄)) - (((A₃ˏ₂ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₂)) / (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * (A₂ˏ₄ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₄))))))) * 1```","user":"U6788D83U","ts":"1609300998.053200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"p=5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We already have it\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> using ModelingToolkit, LinearAlgebra\n\njulia> @variables A[1:4, 1:4];\n\njulia> det(A)\n((((1 * A₁ˏ₁) * (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * ((A₃ˏ₃ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₃)) - (((A₃ˏ₂ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₂)) / (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * (A₂ˏ₃ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₃))))) * (((A₄ˏ₄ - ((A₄ˏ₁ / A₁ˏ₁) * A₁ˏ₄)) - (((A₄ˏ₂ - ((A₄ˏ₁ / A₁ˏ₁) * A₁ˏ₂)) / (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * (A₂ˏ₄ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₄)))) - ((((A₄ˏ₃ - ((A₄ˏ₁ / A₁ˏ₁) * A₁ˏ₃)) - (((A₄ˏ₂ - ((A₄ˏ₁ / A₁ˏ₁) * A₁ˏ₂)) / (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * (A₂ˏ₃ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₃)))) / ((A₃ˏ₃ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₃)) - (((A₃ˏ₂ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₂)) / (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * (A₂ˏ₃ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₃))))) * ((A₃ˏ₄ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₄)) - (((A₃ˏ₂ - ((A₃ˏ₁ / A₁ˏ₁) * A₁ˏ₂)) / (A₂ˏ₂ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₂))) * (A₂ˏ₄ - ((A₂ˏ₁ / A₁ˏ₁) * A₁ˏ₄))))))) * 1"}]}]}]},{"client_msg_id":"f7c32468-fe2e-40da-9723-3d9cb61b89c2","type":"message","text":"`det` just uses LU","user":"U6788D83U","ts":"1609301054.054100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QHatr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"det","style":{"code":true}},{"type":"text","text":" just uses LU"}]}]}]},{"client_msg_id":"2ea5c849-bb4e-4c70-8c51-f5a6d86953c6","type":"message","text":"Also, since my LU PR, we have pretty nice capabilities like\n```julia&gt; simplify.(A \\ A[:, 1])\n4-element Vector{Num}:\n 1\n 0\n 0\n 0```","user":"U6788D83U","ts":"1609301105.054900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Do=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also, since my LU PR, we have pretty nice capabilities like\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> simplify.(A \\ A[:, 1])\n4-element Vector{Num}:\n 1\n 0\n 0\n 0"}]}]}]},{"client_msg_id":"2b2fcde9-8286-4fa7-b81f-19751b5d940c","type":"message","text":"What I meant, is that the divisions in your expression can cause `NaN` for certain matrices.\n```using ModelingToolkit\nusing LinearAlgebra\n@variables X[1:2,1:2]\n\nd = det(X);\n_det = eval(build_function(d,X))\n\nX_test1 = [1.0 0.0; 0.0 1.0]\ndet(X_test1)\n_det(X_test1)\n\nX_test2 = zeros(2,2)\ndet(X_test2)\n_det(X_test2)\n\nX_test3 = [0.0 1.0; 1.0 0.0]\ndet(X_test3)\n_det(X_test3)```\nI personally understand why tracing  `det` and `lu` causes this, but am just wondering if a user should expect this behavior?","user":"UQEDP1Q5V","ts":"1609313436.059400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Evyg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What I meant, is that the divisions in your expression can cause "},{"type":"text","text":"NaN","style":{"code":true}},{"type":"text","text":" for certain matrices.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using ModelingToolkit\nusing LinearAlgebra\n@variables X[1:2,1:2]\n\nd = det(X);\n_det = eval(build_function(d,X))\n\nX_test1 = [1.0 0.0; 0.0 1.0]\ndet(X_test1)\n_det(X_test1)\n\nX_test2 = zeros(2,2)\ndet(X_test2)\n_det(X_test2)\n\nX_test3 = [0.0 1.0; 1.0 0.0]\ndet(X_test3)\n_det(X_test3)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"I personally understand why tracing  "},{"type":"text","text":"det","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"lu","style":{"code":true}},{"type":"text","text":" causes this, but am just wondering if a user should expect this behavior?"}]}]}]},{"client_msg_id":"06FAE29F-5889-441E-93C7-9A1175E8174A","type":"message","text":"That’s not solvable. There’s no value information in symbols","user":"U6788D83U","ts":"1609314456.060200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"O9Z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That’s not solvable. There’s no value information in symbols"}]}]}]},{"client_msg_id":"A0344DC2-1B62-4CCC-AD61-E682C84C163F","type":"message","text":"If you want O(N^3) computation time of det instead of O(N!) you need value information.","user":"U6788D83U","ts":"1609314515.061400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BeEK3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you want O(N^3) computation time of det instead of O(N!) you need value information."}]}]}]},{"client_msg_id":"7A4F09F2-0B30-4F7F-91DB-105AD1DB4BF0","type":"message","text":"There are better ways for evaluating det for small matrices than just unroll the expression. You can specialize on size and use StaticArrays.","user":"U6788D83U","ts":"1609314783.063300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lBbmJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"There are better ways for evaluating det for small matrices than just unroll the expression. You can specialize on size and use StaticArrays."}]}]}]},{"client_msg_id":"6c76d22b-73c3-4ce1-92f1-dcc2c9fb9544","type":"message","text":"I understand it is not solvable in an efficient way, but I just found it a bit disconcerting `det` can silently evaluate to `NaN` . (And also I have weird use cases where I need the unrolled expression)","user":"UQEDP1Q5V","ts":"1609315381.066000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VeM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I understand it is not solvable in an efficient way, but I just found it a bit disconcerting "},{"type":"text","text":"det","style":{"code":true}},{"type":"text","text":" can silently evaluate to "},{"type":"text","text":"NaN","style":{"code":true}},{"type":"text","text":" . (And also I have weird use cases where I need the unrolled expression)"}]}]}]},{"client_msg_id":"5f57a004-637e-479c-883e-319264d225c7","type":"message","text":"Maybe we could have\n```det(A; cofactor=true) ...```\nby default.","user":"U6788D83U","ts":"1609315459.066800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LFuqd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe we could have\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"det(A; cofactor=true) ..."}]},{"type":"rich_text_section","elements":[{"type":"text","text":"by default."}]}]}]},{"client_msg_id":"bf4944bf-17da-4049-a40c-e5d9825d5f8d","type":"message","text":"det by cofactor expansion won’t give NaN, but that’s probably not usable for anything larger than 4 x 4","user":"U6788D83U","ts":"1609315509.067500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Kczva","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"det by cofactor expansion won’t give NaN, but that’s probably not usable for anything larger than 4 x 4"}]}]}]},{"client_msg_id":"950440f4-675d-4527-be31-4d38a1f8cf6d","type":"message","text":"<https://github.com/SciML/ModelingToolkit.jl/pull/707>\n<@UQEDP1Q5V>","user":"U6788D83U","ts":"1609318337.068100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NCUR9","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/SciML/ModelingToolkit.jl/pull/707"},{"type":"text","text":"\n"},{"type":"user","user_id":"UQEDP1Q5V"}]}]}]},{"type":"message","subtype":"channel_join","ts":"1609333513.068400","user":"U01HYEN2ES0","text":"<@U01HYEN2ES0> has joined the channel","inviter":"UEP056STX"},{"client_msg_id":"9fa762e5-91a3-41ae-9e01-3552b0ad97f3","type":"message","text":"<@U69BL50BF> just confirming that the answer is no since I can't find one, but there isn't a preferred paper to cite for ModelingToolkit is there?","user":"U013L06JN15","ts":"1609334792.069000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BTw","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U69BL50BF"},{"type":"text","text":" just confirming that the answer is no since I can't find one, but there isn't a preferred paper to cite for ModelingToolkit is there?"}]}]}]},{"client_msg_id":"12da64d6-2def-4c43-b8f7-24a91f641c2d","type":"message","text":"<@U013L06JN15> there is none right now. Looking to get it out in March.","user":"U69BL50BF","ts":"1609335881.069400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rh+s","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U013L06JN15"},{"type":"text","text":" there is none right now. Looking to get it out in March."}]}]}]},{"client_msg_id":"63cdd9c0-1719-49a3-a7c6-5de1afec5e31","type":"message","text":"For now, cite DifferentialEquations","user":"U69BL50BF","ts":"1609335887.069700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"D=Oag","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For now, cite DifferentialEquations"}]}]}],"thread_ts":"1609335887.069700","reply_count":1,"reply_users_count":1,"latest_reply":"1609337375.069800","reply_users":["U013L06JN15"],"subscribed":false},{"client_msg_id":"18096c5c-a98f-4212-890a-ba0345ac1487","type":"message","text":"Is there some classic papers or standard references that stablished the technique implemented in the differentiable optimal control utilities in DiffEqFlux? Apart from the ones included in the `CITATION.bib` file.","user":"U6P4UPP9D","ts":"1609349515.073000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"J+eK6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there some classic papers or standard references that stablished the technique implemented in the differentiable optimal control utilities in DiffEqFlux? Apart from the ones included in the "},{"type":"text","text":"CITATION.bib","style":{"code":true}},{"type":"text","text":" file."}]}]}]},{"client_msg_id":"2f36afcd-ba76-4c7a-91a4-990eba87dc1e","type":"message","text":"The UDE paper references a neural optimal control paper you can dig up","user":"U69BL50BF","ts":"1609349582.073600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FB/jo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The UDE paper references a neural optimal control paper you can dig up"}]}]}]},{"client_msg_id":"b0d051f8-d2a1-4d79-a5eb-15b3830496e2","type":"message","text":"in general it's called the \"Direct method\" for optimal control","user":"U69BL50BF","ts":"1609349592.073900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LiV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"in general it's called the \"Direct method\" for optimal control"}]}]}]},{"client_msg_id":"48848696-76c2-4ef4-85d5-879ef9102850","type":"message","text":"So IIUC, is it correct to say that the use of AD, reverse integration or NLP solvers after integration are different implementations and tradeoffs of the same Direct method?","user":"U6P4UPP9D","ts":"1609350164.075900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2brFx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So IIUC, is it correct to say that the use of AD, reverse integration or NLP solvers after integration are different implementations and tradeoffs of the same Direct method?"}]}]}]},{"client_msg_id":"3738ef41-0be3-4b96-892f-ca57c67c3228","type":"message","text":"no","user":"U69BL50BF","ts":"1609350409.076200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QdW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"no"}]}]}]},{"client_msg_id":"9c633c8e-8dd4-426b-9509-62d81bc2736b","type":"message","text":"reverse integration is reversible computing AD, like NiLang.jl, applied in the continuous case","user":"U69BL50BF","ts":"1609350438.076900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6hQHH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"reverse integration is reversible computing AD, like NiLang.jl, applied in the continuous case"}]}]}]},{"client_msg_id":"fed96cf1-a8c9-498a-838b-ea3a16cd40a3","type":"message","text":"using NLP solvers of ODE integrators and differentiating through them in order to solve optimal control problems is the classic Direct method","user":"U69BL50BF","ts":"1609350472.077600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MHL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"using NLP solvers of ODE integrators and differentiating through them in order to solve optimal control problems is the classic Direct method"}]}]}]},{"client_msg_id":"5467ca6f-90c3-48d4-aff7-d9794fb2ab6b","type":"message","text":"those are two different concepts","user":"U69BL50BF","ts":"1609350492.077800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SFL8I","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"those are two different concepts"}]}]}]},{"client_msg_id":"f93f3ef0-897e-426f-b5c1-dfe662ae1672","type":"message","text":"and generally for optimal control you don't want to use reverse integration (which is why DiffEqFlux usually doesn't default to it)","user":"U69BL50BF","ts":"1609350512.078300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JaJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and generally for optimal control you don't want to use reverse integration (which is why DiffEqFlux usually doesn't default to it)"}]}]}]},{"client_msg_id":"0d159c53-ee63-4eed-9940-73c3d436e538","type":"message","text":"Yeah, I saw the ANODE paper that highlights the problem of doing that. I need to dig more on this, DiffEqFlux works nicely on my control problems and I wanted to cite correctly the origin of the idea, thanks for the pointers!","user":"U6P4UPP9D","ts":"1609352095.082100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TimF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, I saw the ANODE paper that highlights the problem of doing that. I need to dig more on this, DiffEqFlux works nicely on my control problems and I wanted to cite correctly the origin of the idea, thanks for the pointers!"}]}]}]},{"client_msg_id":"bcaa1fbb-bd94-43ec-a90a-3e955ad569c1","type":"message","text":"I have a very long discrete problem (300k steps) which takes a long time to compute. So the parameter training on top of it (via sciml_train, similar to what is done <https://diffeqflux.sciml.ai/stable/examples/optimization_ode/#Copy-Paste-Code-1|here>, just having a discrete problem instead of ODE problem) is very slow. I wonder if there are ways to inform faster parameter search by solving the problem only on the first X steps? Is this already implemented somehow?","user":"U01HTAK9DNG","ts":"1609410087.085600","team":"T68168MUP","edited":{"user":"U01HTAK9DNG","ts":"1609410099.000000"},"blocks":[{"type":"rich_text","block_id":"7Gl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have a very long discrete problem (300k steps) which takes a long time to compute. So the parameter training on top of it (via sciml_train, similar to what is done "},{"type":"link","url":"https://diffeqflux.sciml.ai/stable/examples/optimization_ode/#Copy-Paste-Code-1","text":"here"},{"type":"text","text":", just having a discrete problem instead of ODE problem) is very slow. I wonder if there are ways to inform faster parameter search by solving the problem only on the first X steps? Is this already implemented somehow?"}]}]}]},{"client_msg_id":"37b80e27-ba6b-44c2-a253-fda30e6f7e25","type":"message","text":"you can `remake` to have a shorter `tspan`","user":"U69BL50BF","ts":"1609420468.086100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nb4y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can "},{"type":"text","text":"remake","style":{"code":true}},{"type":"text","text":" to have a shorter "},{"type":"text","text":"tspan","style":{"code":true}}]}]}]},{"client_msg_id":"0cdd745d-749d-471f-b5c6-62561582bb19","type":"message","text":"<@U6A936746> the bridge :disappointed:","user":"U69BL50BF","ts":"1609420832.086300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DRj","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U6A936746"},{"type":"text","text":" the bridge "},{"type":"emoji","name":"disappointed"}]}]}]},{"client_msg_id":"a31a8b2c-1ccc-458f-8efe-c5701a1146ed","type":"message","text":"Should be back any second now","user":"U6A936746","ts":"1609420898.086500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8YrZ8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Should be back any second now"}]}]}]},{"client_msg_id":"70bc5005-0492-4833-be4d-acf919d8bda4","type":"message","text":":pray:","user":"U69BL50BF","ts":"1609421095.086700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DjA3k","elements":[{"type":"rich_text_section","elements":[{"type":"emoji","name":"pray"}]}]}]},{"type":"message","subtype":"thread_broadcast","text":"But this means that I will also optimise on the shorter time span. Isn't it possible to do something like intelligent search pruning a-la <https://ml.informatik.uni-freiburg.de/papers/15-IJCAI-Extrapolation_of_Learning_Curves.pdf>?","user":"U01HTAK9DNG","ts":"1609441976.086800","thread_ts":"1609420468.086100","root":{"client_msg_id":"37b80e27-ba6b-44c2-a253-fda30e6f7e25","type":"message","text":"you can `remake` to have a shorter `tspan`","user":"U69BL50BF","ts":"1609420468.086100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nb4y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can "},{"type":"text","text":"remake","style":{"code":true}},{"type":"text","text":" to have a shorter "},{"type":"text","text":"tspan","style":{"code":true}}]}]}],"thread_ts":"1609420468.086100","reply_count":1,"reply_users_count":1,"latest_reply":"1609441976.086800","reply_users":["U01HTAK9DNG"],"subscribed":false},"blocks":[{"type":"rich_text","block_id":"wkk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But this means that I will also optimise on the shorter time span. Isn't it possible to do something like intelligent search pruning a-la "},{"type":"link","url":"https://ml.informatik.uni-freiburg.de/papers/15-IJCAI-Extrapolation_of_Learning_Curves.pdf"},{"type":"text","text":"?"}]}]}],"client_msg_id":"ddcee4ed-2bcf-4e56-b7ec-67e81c45ecf1"},{"type":"message","text":"I'm trying to convert my `sol` to a dataframe, but my `u0` is a 33-element vector, which seems to cause my df to be 33xtime, instead of the timex33 like in the I/O docs.  Any idea why?  I want to append some solutions from different tspans, so I want time to be on the rows like the example.","files":[{"id":"F01HVKWFD50","created":1609530328,"timestamp":1609530328,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"ULZQ4DCSU","editable":false,"size":46288,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01HVKWFD50/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01HVKWFD50/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01HVKWFD50-7202b5a354/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01HVKWFD50-7202b5a354/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01HVKWFD50-7202b5a354/image_360.png","thumb_360_w":360,"thumb_360_h":230,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01HVKWFD50-7202b5a354/image_480.png","thumb_480_w":480,"thumb_480_h":306,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01HVKWFD50-7202b5a354/image_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01HVKWFD50-7202b5a354/image_720.png","thumb_720_w":720,"thumb_720_h":459,"original_w":729,"original_h":465,"thumb_tiny":"AwAeADCsOlKRUWaM0xEnFHFJR3oAWkPSikNAxCBSUv5UlAD6U03PtRkelAhx60hpNw9KCR6UDP/Z","permalink":"https://julialang.slack.com/files/ULZQ4DCSU/F01HVKWFD50/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01HVKWFD50-4d67dd9b33","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"552+H","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm trying to convert my "},{"type":"text","text":"sol","style":{"code":true}},{"type":"text","text":" to a dataframe, but my "},{"type":"text","text":"u0","style":{"code":true}},{"type":"text","text":" is a 33-element vector, which seems to cause my df to be 33xtime, instead of the timex33 like in the I/O docs.  Any idea why?  I want to append some solutions from different tspans, so I want time to be on the rows like the example."}]}]}],"user":"ULZQ4DCSU","display_as_bot":false,"ts":"1609530449.093200"},{"client_msg_id":"3f9edea9-cfc7-4fab-8fa1-e2eef354788c","type":"message","text":"your screenshot looks right?","user":"U69BL50BF","ts":"1609530541.093700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ai7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"your screenshot looks right?"}]}]}]},{"client_msg_id":"bc1dbc8a-5f35-4a47-8acb-8a8caf809380","type":"message","text":"It's supposed to be timestamp, value 1, etc. across columns though.  But, it's almost transposing.","user":"ULZQ4DCSU","ts":"1609530835.094400","team":"T68168MUP","edited":{"user":"ULZQ4DCSU","ts":"1609530877.000000"},"blocks":[{"type":"rich_text","block_id":"+fLg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It's supposed to be timestamp, value 1, etc. across columns though.  But, it's almost transposing."}]}]}]},{"client_msg_id":"b96ab273-d638-4cff-88f3-8c7b7da4a19d","type":"message","text":"wait that's not the time steps? So `x1` is not the timeseries of the first variable?","user":"U69BL50BF","ts":"1609531479.095000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kJE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"wait that's not the time steps? So "},{"type":"text","text":"x1","style":{"code":true}},{"type":"text","text":" is not the timeseries of the first variable?"}]}]}]},{"client_msg_id":"0471aeb9-1fc1-4ea5-b998-a6deb6e2ca04","type":"message","text":"no x1, etc. are each time step","user":"ULZQ4DCSU","ts":"1609531611.095400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"udP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"no x1, etc. are each time step"}]}]}]},{"client_msg_id":"031c1dd9-79f3-4a52-b2ab-0fe366521005","type":"message","text":"33 rows are for each variable","user":"ULZQ4DCSU","ts":"1609531622.095700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7BTP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"33 rows are for each variable"}]}]}]},{"client_msg_id":"ca7cadb6-5a05-4c7e-9cea-199329a79213","type":"message","text":"oh yes that's wrong then","user":"U69BL50BF","ts":"1609531854.095900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"L4H","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh yes that's wrong then"}]}]}]},{"client_msg_id":"13c852f7-533a-4db3-ae4e-f6a86ab71dc2","type":"message","text":"what version of DiffEqBase?","user":"U69BL50BF","ts":"1609531861.096200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rNg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what version of DiffEqBase?"}]}]}]},{"client_msg_id":"35b52884-be50-4c3a-80cb-868ba0ffee3d","type":"message","text":"v6.48.2","user":"ULZQ4DCSU","ts":"1609532006.096500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"m6FUx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"v6.48.2"}]}]}]},{"client_msg_id":"52da76fc-aad8-416c-851e-6a1a5a29b19d","type":"message","text":"can you update to 6.53?","user":"U69BL50BF","ts":"1609532107.096700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zRq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"can you update to 6.53?"}]}]}]},{"type":"message","subtype":"bot_message","text":"@ChrisRackauckas Thanks a lot. That seemed to work. However, the code seems to take extremely high time to show the results. MATLAB solves the same ODE problem withing 35 seconds using the exact values I have listed in my code. Am I doing anything wrong? I had bench-marked Julia for large scale arithmetic against MATLAB, and I found Julia to be exponentially faster. That does not seem to be the case when I try to solve this problem. Am I missing anything?","ts":"1609535263.096800","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"@ChrisRackauckas Thanks a lot. That seemed to work. However, the code seems to take extremely high time to show the results. MATLAB solves the same ODE problem withing 35 seconds using the exact values I have listed in my code. Am I doing anything wrong? I had bench-marked Julia for large scale arithmetic against MATLAB, and I found Julia to be exponentially faster. That does not seem to be the case when I try to solve this problem. Am I missing anything?","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"By extremely high, I mean I waited for 2 hours and ran out of patience. Because MATLAB solved it for me in a very short time.","ts":"1609535307.096900","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"By extremely high, I mean I waited for 2 hours and ran out of patience. Because MATLAB solved it for me in a very short time.","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"So I don't even know if Julia solved any portion of the problem or not. I just interrupted the process and closed Atom.","ts":"1609535352.097000","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"So I don't even know if Julia solved any portion of the problem or not. I just interrupted the process and closed Atom.","verbatim":false}}]},{"client_msg_id":"2bafd32b-f67f-4193-a316-c67f16c8eb25","type":"message","text":"Chris, it's doing the same thing in the updated version.  The example from the docs works fine though, or if I replace my `u0`  with `rand(2,2)`.","user":"ULZQ4DCSU","ts":"1609535858.098200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"O/zR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Chris, it's doing the same thing in the updated version.  The example from the docs works fine though, or if I replace my "},{"type":"text","text":"u0","style":{"code":true}},{"type":"text","text":"  with "},{"type":"text","text":"rand(2,2)","style":{"code":true}},{"type":"text","text":"."}]}]}]},{"client_msg_id":"bb704a22-f6f0-4d68-8b15-34c1a23cb29e","type":"message","text":"so it has something do with my `u0`  being a `Vector` .","user":"ULZQ4DCSU","ts":"1609535895.098700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aSSB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so it has something do with my "},{"type":"text","text":"u0","style":{"code":true}},{"type":"text","text":"  being a "},{"type":"text","text":"Vector","style":{"code":true}},{"type":"text","text":" ."}]}]}]},{"type":"message","subtype":"bot_message","text":"@Anish-Dighe what's your current code? And what ODE solver are you using in MATLAB?","ts":"1609535907.098800","username":"[gitter] <ChrisRackauckas>","icons":{"image_48":"https://s3-us-west-2.amazonaws.com/slack-files2/bot_icons/2017-10-18/257963008226_48.png"},"bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"@Anish-Dighe what's your current code? And what ODE solver are you using in MATLAB?","verbatim":false}}]},{"client_msg_id":"02994dde-f81b-40d0-86fc-95a3f5329189","type":"message","text":"<@ULZQ4DCSU> can you make a small example of it?","user":"U69BL50BF","ts":"1609536139.099100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gXH3A","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"ULZQ4DCSU"},{"type":"text","text":" can you make a small example of it?"}]}]}]},{"client_msg_id":"1b9533f9-8f46-41b4-8fb6-c890f719d988","type":"message","text":"What kind of u0 are you using?","user":"U69BL50BF","ts":"1609536144.099300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"76pD3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What kind of u0 are you using?"}]}]}]},{"client_msg_id":"6ffdfc68-5cb8-4aff-be52-2f48178990cf","type":"message","text":"Vector of floats","user":"ULZQ4DCSU","ts":"1609536170.099600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"W3As","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Vector of floats"}]}]}]},{"client_msg_id":"0ed320c1-0b19-4285-934e-9616bedac402","type":"message","text":"```using DifferentialEquations\nusing DataFrames\n\ntest = (du,u,p,t) -&gt; du .= 1.01u\nu0  =   [7.9717478717769090e+000,\n        1.5105962705116731e+001]\n#prob = ODEProblem(test, rand(2,2), (-6.,100.))\nprob = ODEProblem(test, u0, (-6.,100.))\nsol = solve(prob)\ndf = DataFrame(sol)```","user":"ULZQ4DCSU","ts":"1609536327.099900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"q3hl9","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using DifferentialEquations\nusing DataFrames\n\ntest = (du,u,p,t) -> du .= 1.01u\nu0  =   [7.9717478717769090e+000,\n        1.5105962705116731e+001]\n#prob = ODEProblem(test, rand(2,2), (-6.,100.))\nprob = ODEProblem(test, u0, (-6.,100.))\nsol = solve(prob)\ndf = DataFrame(sol)"}]}]}]},{"type":"message","subtype":"bot_message","text":"using Plots using DifferentialEquations  function new_odefcn!(dpdt,p,whatsthis,t)      n  = 10000     n = convert(Int64,n)     nk = 700     nk = convert(Int64,nk)     k1 = 0.6     k2 = 26000     alpha = 9000     m = 6     l = 6     a = 1     b = 2     c_Zr = 0.0144     c_B  = 0.0163     Na = 6.02214e23     invna = 1/Na     all_i = 1:n     for jj = 1:n         if p[jj] &lt; invna             p[jj] = 0.0         end     end     temp = zeros(1,n)     #dpdt = zeros(1,n)      for i = 1:nk                  for j = i:n                          if j == i                    if i == 1                      for ii = 1:n                         temp[ii] = all_i[ii]*p[ii]                     end                      total_p1 = sum(temp)                     M = c_Zr - (total_p1*m)                     L = c_B - (total_p1*l)                      if total_p1 &gt; 0                         k1 = k1*alpha*total_p1                     end                      dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))                  end                  dpdt[j] = dpdt[j] - (k2*p[i]*sum(p[i:n-i]))              elseif (j&lt;(i+i)) &amp;&amp; (j!=i)                  dpdt[j] = dpdt[j] - (k2*p[i]*p[j])              elseif j &gt;= (i+i)                  if j+i &lt;= n                      dpdt[j] = dpdt[j] - (k2*p[i]*(p[j] - p[j-i]))                  elseif j+i &gt; n                      dpdt[j] = dpdt[j] + (k2*p[i]*p[j-i])                  end              end         end     end end p_i     = zeros(1,10000) tspan = (0.0, 2500.0) prob = ODEProblem(new_odefcn!,p_i,tspan) sol = solve(prob) plot(sol,vars=(1))","ts":"1609536329.100000","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"using Plots\nusing DifferentialEquations\n\nfunction new_odefcn!(dpdt,p,whatsthis,t)\n\n    n  = 10000\n    n = convert(Int64,n)\n    nk = 700\n    nk = convert(Int64,nk)\n    k1 = 0.6\n    k2 = 26000\n    alpha = 9000\n    m = 6\n    l = 6\n    a = 1\n    b = 2\n    c_Zr = 0.0144\n    c_B  = 0.0163\n    Na = 6.02214e23\n    invna = 1/Na\n    all_i = 1:n\n    for jj = 1:n\n        if p[jj] &lt; invna\n            p[jj] = 0.0\n        end\n    end\n    temp = zeros(1,n)\n    #dpdt = zeros(1,n)\n\n    for i = 1:nk\n\n       \n        for j = i:n\n            \n            if j == i\n\n\n\n                if i == 1\n\n                    for ii = 1:n\n                        temp[ii] = all_i[ii]*p[ii]\n                    end\n\n                    total_p1 = sum(temp)\n                    M = c_Zr - (total_p1*m)\n                    L = c_B - (total_p1*l)\n\n                    if total_p1 &gt; 0\n                        k1 = k1*alpha*total_p1\n                    end\n\n                    dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))\n\n                end\n\n                dpdt[j] = dpdt[j] - (k2*p[i]*sum(p[i:n-i]))\n\n            elseif (j&lt;(i+i)) &amp;&amp; (j!=i)\n\n                dpdt[j] = dpdt[j] - (k2*p[i]*p[j])\n\n            elseif j &gt;= (i+i)\n\n                if j+i &lt;= n\n\n                    dpdt[j] = dpdt[j] - (k2*p[i]*(p[j] - p[j-i]))\n\n                elseif j+i &gt; n\n\n                    dpdt[j] = dpdt[j] + (k2*p[i]*p[j-i])\n\n                end\n\n            end\n        end\n    end\nend\np_i     = zeros(1,10000)\ntspan = (0.0, 2500.0)\nprob = ODEProblem(new_odefcn!,p_i,tspan)\nsol = solve(prob)\nplot(sol,vars=(1))","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"@ChrisRackauckas I just pasted my entire code here. I there any better way to paste the code? Or is this fine? I am using ODE45 of MATLAB, with default values of tolerances and the constraint of non-negative values for all solution components ","ts":"1609536423.100100","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"@ChrisRackauckas I just pasted my entire code here. I there any better way to paste the code? Or is this fine? I am using ODE45 of MATLAB, with default values of tolerances and the constraint of non-negative values for all solution components ","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"@ChrisRackauckas I may miss your messages, but please do know that I am sincerely appreciate your help.","ts":"1609536544.100200","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"@ChrisRackauckas I may miss your messages, but please do know that I am sincerely appreciate your help.","verbatim":false}}]},{"client_msg_id":"84671cd5-00c9-4256-abd2-80d0481e800b","type":"message","text":"It looks like you're creating all your parameters inside the ode function at every solve step.","user":"U011V2YN59N","ts":"1609536761.101000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"msf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It looks like you're creating all your parameters inside the ode function at every solve step."}]}]}]},{"client_msg_id":"0cdf04ff-e107-4460-9eb7-6a66e9c2ffee","type":"message","text":"The \"whatsthis\" argument that you wrote is where your parameters go.","user":"U011V2YN59N","ts":"1609536773.101300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0o09","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The \"whatsthis\" argument that you wrote is where your parameters go."}]}]}]},{"client_msg_id":"f5fb429d-6629-4c69-982e-03a483acd3af","type":"message","text":"in `new_odefncn!(..)`","user":"U011V2YN59N","ts":"1609536789.101700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nl0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"in "},{"type":"text","text":"new_odefncn!(..)","style":{"code":true}}]}]}]},{"client_msg_id":"bbf9a8a8-b4a6-48ec-8be2-aa239ae60952","type":"message","text":"I haven't really looked at the loop but it looks like there are probably optimizations you could do there too.","user":"U011V2YN59N","ts":"1609536835.102500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nGlYA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I haven't really looked at the loop but it looks like there are probably optimizations you could do there too."}]}]}]},{"client_msg_id":"3f8c826a-835f-450d-90be-8d824798eab6","type":"message","text":"```   for jj = 1:n\n       if p[jj] &lt; invna\n           p[jj] = 0.0\n       end\n   end```\nisn't correct to do in Julia or MATLAB","user":"U69BL50BF","ts":"1609536881.103700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YiTN","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"   for jj = 1:n\n       if p[jj] < invna\n           p[jj] = 0.0\n       end\n   end"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"isn't correct to do in Julia or MATLAB"}]}]}]},{"type":"message","subtype":"bot_message","text":"tried to run the code with commenting out that portion. Doesn't work either. MATLAB requires more time when that portion is commented out, but it does solve the problem in few minutes. @ChrisRackauckas ","ts":"1609537005.103900","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"tried to run the code with commenting out that portion. Doesn't work either. MATLAB requires more time when that portion is commented out, but it does solve the problem in few minutes. @ChrisRackauckas ","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"I meant running the code in Julia doesn't work.","ts":"1609537044.104000","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"I meant running the code in Julia doesn't work.","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"&gt; [slack] &lt;Peter J&gt; I haven't really looked at the loop but it looks like there are probably optimizations you could do there too.  I have a version of the same code using matrix calculation. However, the matrix becomes unevenly sparse as the values of n and nk increase. Does not help in improving the performance.","ts":"1609537244.104100","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"&gt; [slack] &lt;Peter J&gt; I haven't really looked at the loop but it looks like there are probably optimizations you could do there too.\n\nI have a version of the same code using matrix calculation. However, the matrix becomes unevenly sparse as the values of n and nk increase. Does not help in improving the performance.","verbatim":false}}]},{"client_msg_id":"6719e49c-458d-4544-b15c-b2f24df58647","type":"message","text":"I","user":"U69BL50BF","ts":"1609537320.104300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CVq0X","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I"}]}]}]},{"client_msg_id":"495e85c3-2d38-4941-9d9e-56a6d958d796","type":"message","text":"I'm not saying that's the full soluiton","user":"U69BL50BF","ts":"1609537329.104600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+W/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm not saying that's the full soluiton"}]}]}]},{"client_msg_id":"5fd52d53-c06c-4152-9c51-19be74701002","type":"message","text":"but if you did that in MATLAB as well as Julia, it's incorrect","user":"U69BL50BF","ts":"1609537364.105100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Mvf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but if you did that in MATLAB as well as Julia, it's incorrect"}]}]}]},{"type":"message","subtype":"bot_message","text":"I understand. It is an approximation we have developed for the problem we are trying to solve.","ts":"1609537463.105200","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"I understand. It is an approximation we have developed for the problem we are trying to solve.","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"I am not claiming that it is correct.","ts":"1609537507.105300","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"I am not claiming that it is correct.","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"At this point I am only trying to get a solution. I can focus on correcting the code after that","ts":"1609537701.105400","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"At this point I am only trying to get a solution. I can focus on correcting the code after that","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"@Anish-Dighe looking at the solve, dt-&gt;0","ts":"1609537997.105500","username":"[gitter] <ChrisRackauckas>","icons":{"image_48":"https://s3-us-west-2.amazonaws.com/slack-files2/bot_icons/2017-10-18/257963008226_48.png"},"bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"@Anish-Dighe looking at the solve, dt-&gt;0","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"are you sure you translated it correctly?","ts":"1609538007.105600","username":"[gitter] <ChrisRackauckas>","icons":{"image_48":"https://s3-us-west-2.amazonaws.com/slack-files2/bot_icons/2017-10-18/257963008226_48.png"},"bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"are you sure you translated it correctly?","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"As in, did you check on a random vector that you get the same derivative?","ts":"1609538019.105700","username":"[gitter] <ChrisRackauckas>","icons":{"image_48":"https://s3-us-west-2.amazonaws.com/slack-files2/bot_icons/2017-10-18/257963008226_48.png"},"bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"As in, did you check on a random vector that you get the same derivative?","verbatim":false}}]},{"client_msg_id":"08f129cc-f5b1-48fb-8a1a-57d6acf738a3","type":"message","text":"Most of the values stay pure zero so it doesn't look right","user":"U69BL50BF","ts":"1609538133.106100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ox1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Most of the values stay pure zero so it doesn't look right"}]}]}]},{"type":"message","subtype":"bot_message","text":"&gt; are you sure you translated it correctly?  I have the equations written on a paper. Used that to code it in to Julia. Did not translate from MATLAB line by line.","ts":"1609538150.106200","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"&gt; are you sure you translated it correctly?\n\nI have the equations written on a paper. Used that to code it in to Julia. Did not translate from MATLAB line by line.","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"function dpdt = new_odefcn(t,p,n,nkernel,k1,k2,alpha,a,b,m,l,M0,L0) all_i = 1:n; all_i = all_i'; dpdt  = zeros(n,1); Na    = 6.02214e23; invna = 1/Na; log_p = p &lt; invna; p(log_p,:) = 0; for i = 1:nkernel          for j = i:n                  if j == i                          if i == 1                                  total_p1  = sum(all_i.*p);                 M         = M0 - (total_p1*m);                 L         = L0 - (total_p1*l);                                  if total_p1 &gt; 0                     k1        = k1*alpha*total_p1;                 end                                  dpdt(j,1) = dpdt(j,1) + (k1*(M^a)*(L^b));                              end                          dpdt(j,1) = dpdt(j,1) - (k2*p(i,1)*sum(p(i:n-i,1)));                       elseif (j &lt; (i + i)) &amp;&amp; (j ~= i)                          dpdt(j,1) = dpdt(j,1) - (k2*p(i,1)*p(j,1));                      elseif j &gt;= (i + i)                          if j + i &lt;= n                                  dpdt(j,1) = dpdt(j,1) - (k2*p(i,1)*(p(j,1) - p(j-i,1)));                              elseif j + i &gt; n                                  dpdt(j,1) = dpdt(j,1) + (k2*p(i,1)*p(j-i,1));                                          end                      end     end end   end","ts":"1609538228.106300","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"function dpdt = new_odefcn(t,p,n,nkernel,k1,k2,alpha,a,b,m,l,M0,L0)\nall_i = 1:n;\nall_i = all_i';\ndpdt  = zeros(n,1);\nNa    = 6.02214e23;\ninvna = 1/Na;\nlog_p = p &lt; invna;\np(log_p,:) = 0;\nfor i = 1:nkernel\n    \n    for j = i:n\n        \n        if j == i\n            \n            if i == 1\n                \n                total_p1  = sum(all_i.*p);\n                M         = M0 - (total_p1*m);\n                L         = L0 - (total_p1*l);\n                \n                if total_p1 &gt; 0\n                    k1        = k1*alpha*total_p1;\n                end\n                \n                dpdt(j,1) = dpdt(j,1) + (k1*(M^a)*(L^b));\n                \n            end\n            \n            dpdt(j,1) = dpdt(j,1) - (k2*p(i,1)*sum(p(i:n-i,1)));\n\n            \n        elseif (j &lt; (i + i)) &amp;&amp; (j ~= i)\n            \n            dpdt(j,1) = dpdt(j,1) - (k2*p(i,1)*p(j,1));\n            \n        elseif j &gt;= (i + i)\n            \n            if j + i &lt;= n\n                \n                dpdt(j,1) = dpdt(j,1) - (k2*p(i,1)*(p(j,1) - p(j-i,1)));\n                \n            elseif j + i &gt; n\n                \n                dpdt(j,1) = dpdt(j,1) + (k2*p(i,1)*p(j-i,1));                \n            \n            end\n            \n        end\n    end\nend\n\n\nend","verbatim":false}}]},{"client_msg_id":"bd228af9-6284-4099-8bf5-cd9a5ea511df","type":"message","text":"&gt; the constraint of non-negative values for all solution components","user":"U69BL50BF","ts":"1609538260.106600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ev+yt","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"the constraint of non-negative values for all solution components"}]}]}]},{"client_msg_id":"827c3c47-73e0-414a-9fd6-bfb856bb6a60","type":"message","text":"how did you do that in MATLAB?","user":"U69BL50BF","ts":"1609538265.106800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8nE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"how did you do that in MATLAB?"}]}]}]},{"type":"message","subtype":"bot_message","text":"using the odeset: <https://www.mathworks.com/help/matlab/ref/odeset.html>","ts":"1609538301.106900","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","attachments":[{"title":"Create or modify options structure for ODE and PDE solvers - MATLAB odeset","title_link":"https://www.mathworks.com/help/matlab/ref/odeset.html","text":"This MATLAB function creates an options structure that you can pass as an argument to ODE and PDE solvers.","fallback":"Create or modify options structure for ODE and PDE solvers - MATLAB odeset","from_url":"https://www.mathworks.com/help/matlab/ref/odeset.html","service_icon":"https://www.mathworks.com/favicon.ico","service_name":"mathworks.com","id":1,"original_url":"https://www.mathworks.com/help/matlab/ref/odeset.html"}],"blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"using the odeset: <https://www.mathworks.com/help/matlab/ref/odeset.html>","verbatim":false}}],"edited":{"user":"B795XHD0X","ts":"1609538303.000000"}},{"client_msg_id":"9fbe62bd-ae37-4330-868c-59a808e7fff4","type":"message","text":"and that is why you did\n\n```   for jj = 1:n\n       if p[jj] &lt; invna\n           p[jj] = 0.0\n       end\n   end```\n?","user":"U69BL50BF","ts":"1609538367.107300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CYo9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and that is why you did\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"   for jj = 1:n\n       if p[jj] < invna\n           p[jj] = 0.0\n       end\n   end"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"?"}]}]}]},{"type":"message","subtype":"bot_message","text":"Not really. This code is calculating number of particles forming based on rate constants k1 and k2. The concentration of particles is in moles. Concentration multiplied by avogadro's constant, yields the approximate number of particles. Hence we are not interested in any concentration value which is less than 1/Na. That would mean that the number of particles is less than 1, which we are not interested in.","ts":"1609538625.107400","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"Not really. This code is calculating number of particles forming based on rate constants k1 and k2. The concentration of particles is in moles. Concentration multiplied by avogadro's constant, yields the approximate number of particles. Hence we are not interested in any concentration value which is less than 1/Na. That would mean that the number of particles is less than 1, which we are not interested in.","verbatim":false}}]},{"client_msg_id":"fe71cccd-84e7-41a3-a0af-73d7a9978ae4","type":"message","text":"what you've defined isn't an ODE so it doesn't necessarily have a unique solution which is why I have to ask","user":"U69BL50BF","ts":"1609538664.107900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yOhQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what you've defined isn't an ODE so it doesn't necessarily have a unique solution which is why I have to ask"}]}]}]},{"type":"message","subtype":"bot_message","text":"&gt; [slack] &lt;chrisrackauckas&gt; what you've defined isn't an ODE so it doesn't necessarily have a unique solution which is why I have to ask  Why do you say that it isn't an ODE?","ts":"1609538754.108500","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"&gt; [slack] &lt;chrisrackauckas&gt; what you've defined isn't an ODE so it doesn't necessarily have a unique solution which is why I have to ask\n\nWhy do you say that it isn't an ODE?","verbatim":false}}]},{"client_msg_id":"1fc0f54c-99db-49fe-afd5-52968e6663b4","type":"message","text":"If that's what you want, the only correct solution is constant 0","user":"U69BL50BF","ts":"1609538756.108600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lWR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If that's what you want, the only correct solution is constant 0"}]}]}]},{"client_msg_id":"b0c084aa-b722-40c6-85d4-72b5f4faea07","type":"message","text":"because your initial condition starts with all at 0","user":"U69BL50BF","ts":"1609538772.108900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oisB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"because your initial condition starts with all at 0"}]}]}]},{"type":"message","subtype":"bot_message","text":"I have tried solving the problem by commenting out that portion.","ts":"1609538784.109100","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"I have tried solving the problem by commenting out that portion.","verbatim":false}}]},{"client_msg_id":"2a478949-75ff-45bc-9528-d66a7ec90381","type":"message","text":"which means that for any sufficiently small delta t you're defining the change as 0","user":"U69BL50BF","ts":"1609538803.109500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"F4Ha","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"which means that for any sufficiently small delta t you're defining the change as 0"}]}]}]},{"client_msg_id":"a29ec5e8-9f60-4b3a-8816-1b3459a38570","type":"message","text":"so if you sum over the interval with that, you get zero change over the whole interval for some delta t &gt; 0","user":"U69BL50BF","ts":"1609538822.110000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8Nse","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so if you sum over the interval with that, you get zero change over the whole interval for some delta t > 0"}]}]}]},{"client_msg_id":"5de16dcb-90e2-48da-8ddd-c57e4a6b4675","type":"message","text":"what's going on is that it can \"work\" at a lower tolerance, but since your model doesn't have a well-defined solution it does some wonky stuff.","user":"U69BL50BF","ts":"1609538854.110500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2J/HZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what's going on is that it can \"work\" at a lower tolerance, but since your model doesn't have a well-defined solution it does some wonky stuff."}]}]}]},{"type":"message","subtype":"bot_message","text":"&gt; [slack] &lt;chrisrackauckas&gt; what's going on is that it can \"work\" at a lower tolerance, but since your model doesn't have a well-defined solution it does some wonky stuff.  I appreciate your help. But with this comment you simply disregarded the entire theory of population balances. What I am solving is an extremely simple case of particle aggregation. if my initial condition was 1 everywhere, then the problem has an analytical solution.","ts":"1609539001.110600","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"&gt; [slack] &lt;chrisrackauckas&gt; what's going on is that it can \"work\" at a lower tolerance, but since your model doesn't have a well-defined solution it does some wonky stuff.\n\nI appreciate your help. But with this comment you simply disregarded the entire theory of population balances. What I am solving is an extremely simple case of particle aggregation. if my initial condition was 1 everywhere, then the problem has an analytical solution.","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))","ts":"1609539147.112000","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))","verbatim":false}}]},{"type":"message","subtype":"bot_message","text":"this is what decides the derivative of solution component at the first time step. M and L are both non-zero initially","ts":"1609539186.112800","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"this is what decides the derivative of solution component at the first time step. M and L are both non-zero initially","verbatim":false}}]},{"client_msg_id":"3e3f788c-c28a-489d-b789-67af3f6c012e","type":"message","text":"No, that comment is just calculus nothing more. If you have that line of code in there, then you're saying is:\n\nif for any delta t, p(dt) derivative is ever small, then it's zero.\n\nSo choose dt small enough such that it's true for every component. It's trivial you can do that, right? so now choose N s.t. N*dt walks to the end. Therefore the solution is constant zero","user":"U69BL50BF","ts":"1609539191.113000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Uaq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"No, that comment is just calculus nothing more. If you have that line of code in there, then you're saying is:\n\nif for any delta t, p(dt) derivative is ever small, then it's zero.\n\nSo choose dt small enough such that it's true for every component. It's trivial you can do that, right? so now choose N s.t. N*dt walks to the end. Therefore the solution is constant zero"}]}]}]},{"client_msg_id":"54fd0f67-8357-4691-b37a-e36154d4f32d","type":"message","text":"That's why I'm saying it doesn't have an actual solution at that point because that line of code makes it non-convergent to any non-zero solution just because of how calculus works.","user":"U69BL50BF","ts":"1609539231.113900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/om","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That's why I'm saying it doesn't have an actual solution at that point because that line of code makes it non-convergent to any non-zero solution just because of how calculus works."}]}]}]},{"client_msg_id":"3df68460-6f74-4b63-b1a2-e768afa94d64","type":"message","text":"That's an issue it would only have starting at all zeros of course","user":"U69BL50BF","ts":"1609539250.114200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0mnP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That's an issue it would only have starting at all zeros of course"}]}]}]},{"client_msg_id":"6ae68ce8-a0a9-4ab2-9c80-381f645c0d02","type":"message","text":"My guess is that your model isn't what you wrote down, which is the issue","user":"U69BL50BF","ts":"1609539291.114600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TzZHp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"My guess is that your model isn't what you wrote down, which is the issue"}]}]}]},{"type":"message","subtype":"bot_message","text":"okay. I will look into it. Thanks for your help.","ts":"1609539334.114700","username":"[gitter] <Anish-Dighe>","bot_id":"B795XHD0X","blocks":[{"type":"section","block_id":"matterbridge_bvmt0lcg27id0g40lji0","text":{"type":"mrkdwn","text":"okay. I will look into it. Thanks for your help.","verbatim":false}}]},{"client_msg_id":"3533dde0-2a83-4d27-a6fb-1e1321e60c9c","type":"message","text":"in a step of `1e-16` you can see:","user":"U69BL50BF","ts":"1609539429.115000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ylzs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"in a step of "},{"type":"text","text":"1e-16","style":{"code":true}},{"type":"text","text":" you can see:"}]}]}]},{"client_msg_id":"d6d63330-6c88-4914-ae74-3b3b682681a5","type":"message","text":"```t = 1.0551296000000007e-16\nt = 2.1430272000000015e-16\nt = 5.898240000000005e-16\nt = 6.422695384871799e-16\nt = 6.553600000000005e-16\nt = 6.553600000000005e-16\nfindall((x-&gt;begin\n            #= D:\\OneDrive\\Computer\\Desktop\\test.jl:73 =#\n            x &lt; 0\n        end), u) = [2, 3, 5, 7, 9, 12, 15, 18, 21, 24, 27, 30]```","user":"U69BL50BF","ts":"1609539431.115300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=gEk","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"t = 1.0551296000000007e-16\nt = 2.1430272000000015e-16\nt = 5.898240000000005e-16\nt = 6.422695384871799e-16\nt = 6.553600000000005e-16\nt = 6.553600000000005e-16\nfindall((x->begin\n            #= D:\\OneDrive\\Computer\\Desktop\\test.jl:73 =#\n            x < 0\n        end), u) = [2, 3, 5, 7, 9, 12, 15, 18, 21, 24, 27, 30]"}]}]}]},{"client_msg_id":"d501bcfc-50dc-4494-aa8d-a1aaab2e1d35","type":"message","text":"you have 12 negative values, so the derivative has terms that go negative when values are zero","user":"U69BL50BF","ts":"1609539454.115700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9IH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you have 12 negative values, so the derivative has terms that go negative when values are zero"}]}]}]},{"client_msg_id":"3b8f6940-a63c-4a90-94d3-f4694c39a6d6","type":"message","text":"that's when removing that portion that forces zeroing","user":"U69BL50BF","ts":"1609539471.116200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eRsbn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's when removing that portion that forces zeroing"}]}]}]},{"client_msg_id":"dabc02b0-42fa-499c-9504-c5d3c54a5dd6","type":"message","text":"which means that either the solution is purely zero or has negative components, which I assume isn't what you'd expect from the model","user":"U69BL50BF","ts":"1609539498.116900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M6T7p","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"which means that either the solution is purely zero or has negative components, which I assume isn't what you'd expect from the model"}]}]}]},{"client_msg_id":"79808f83-cf2e-4b43-8057-0c63b187dcb2","type":"message","text":"so I think you must have a sign error somewhere.","user":"U69BL50BF","ts":"1609539505.117200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lXf=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so I think you must have a sign error somewhere."}]}]}]},{"client_msg_id":"983553de-45c7-44be-9c50-1e5b1347fbf8","type":"message","text":"I would suggest taking a random vector in MATLAB and then copying it over to Julia, evaluating the `f` function in both languages with that same vector, and see if what they output is the same","user":"U69BL50BF","ts":"1609539540.118000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"++5r6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I would suggest taking a random vector in MATLAB and then copying it over to Julia, evaluating the "},{"type":"text","text":"f","style":{"code":true}},{"type":"text","text":" function in both languages with that same vector, and see if what they output is the same"}]}]}]},{"client_msg_id":"9fa52f2a-40ed-4977-972c-a4910b488d70","type":"message","text":"my guess is that they are not the same.","user":"U69BL50BF","ts":"1609539546.118200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qEw0S","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"my guess is that they are not the same."}]}]}]},{"client_msg_id":"1e9303a3-ef8b-4185-a259-b462f60cfb62","type":"message","text":"```guess_vector = ...\ndu = similar(p_i)\nnew_odefcn!(du,p_i,nothing,0.0)\ndu```","user":"U69BL50BF","ts":"1609539579.118500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9Z39","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"guess_vector = ...\ndu = similar(p_i)\nnew_odefcn!(du,p_i,nothing,0.0)\ndu"}]}]}]},{"client_msg_id":"53c931fa-d2ab-4e3f-aebc-7bf470a86ebc","type":"message","text":"that's how you'd do the check (since it's mutating)","user":"U69BL50BF","ts":"1609539586.118800","team":"T68168MUP","edited":{"user":"U69BL50BF","ts":"1609539593.000000"},"blocks":[{"type":"rich_text","block_id":"qm5dP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's how you'd do the check (since it's mutating)"}]}]}]},{"client_msg_id":"429e35cb-0e00-4a2b-90a3-f9b7c7212580","type":"message","text":"enforcing non-negativity is done via the `isoutofdomain` argument like","user":"U69BL50BF","ts":"1609539617.119300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bm8wV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"enforcing non-negativity is done via the "},{"type":"text","text":"isoutofdomain","style":{"code":true}},{"type":"text","text":" argument like"}]}]}]},{"client_msg_id":"a4830656-c177-4a87-82ae-f2a4a77aeec7","type":"message","text":"```isoutofdomain(u,t,integrator) = any(x-&gt;x&lt;0,u)\nsol = solve(prob,Tsit5(),isoutofdomain=isoutofdomain)```","user":"U69BL50BF","ts":"1609539635.119900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EDMx","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"isoutofdomain(u,t,integrator) = any(x->x<0,u)\nsol = solve(prob,Tsit5(),isoutofdomain=isoutofdomain)"}]}]}]},{"client_msg_id":"83bf4397-35b8-49e7-b7df-a4f817975167","type":"message","text":"but until the model is fixed what it's going to tell you is that the true solution to your ODE has a negative component.","user":"U69BL50BF","ts":"1609539651.120300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iAu8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but until the model is fixed what it's going to tell you is that the true solution to your ODE has a negative component."}]}]}]},{"client_msg_id":"4ede27d0-e43a-401d-92a7-d4983c198799","type":"message","text":"and lastly","user":"U69BL50BF","ts":"1609539679.120600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2L3J","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and lastly"}]}]}]},{"client_msg_id":"89465110-e447-4b9a-bb60-e1912f3c6371","type":"message","text":"```const temp = zeros(10000)\n\nfunction new_odefcn!(dpdt,p,whatsthis,t)\n   n  = 10000\n   n = convert(Int64,n)\n   nk = 700\n   nk = convert(Int64,nk)\n   k1 = 0.6\n   k2 = 26000\n   alpha = 9000\n   m = 6\n   l = 6\n   a = 1\n   b = 2\n   c_Zr = 0.0144\n   c_B  = 0.0163\n   Na = 6.02214e23\n   invna = 1/Na\n   all_i = 1:n\n\n   @inbounds for i = 1:nk\n       for j = i:n\n           if j == i\n               if i == 1\n                   for ii = 1:n\n                       temp[ii] = all_i[ii]*p[ii]\n                   end\n                   total_p1 = sum(temp)\n                   M = c_Zr - (total_p1*m)\n                   L = c_B - (total_p1*l)\n                   if total_p1 &gt; 0\n                       k1 = k1*alpha*total_p1\n                   end\n                   dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))\n               end\n               dpdt[j] = dpdt[j] - (k2*p[i]*sum(@view(p[i:n-i])))\n           elseif (j&lt;(i+i)) &amp;&amp; (j!=i)\n               dpdt[j] = dpdt[j] - (k2*p[i]*p[j])\n           elseif j &gt;= (i+i)\n               if j+i &lt;= n\n                   dpdt[j] = dpdt[j] - (k2*p[i]*(p[j] - p[j-i]))\n               elseif j+i &gt; n\n                   dpdt[j] = dpdt[j] + (k2*p[i]*p[j-i])\n               end\n           end\n       end\n   end\nend```","user":"U69BL50BF","ts":"1609539681.121000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6G4","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"const temp = zeros(10000)\n\nfunction new_odefcn!(dpdt,p,whatsthis,t)\n   n  = 10000\n   n = convert(Int64,n)\n   nk = 700\n   nk = convert(Int64,nk)\n   k1 = 0.6\n   k2 = 26000\n   alpha = 9000\n   m = 6\n   l = 6\n   a = 1\n   b = 2\n   c_Zr = 0.0144\n   c_B  = 0.0163\n   Na = 6.02214e23\n   invna = 1/Na\n   all_i = 1:n\n\n   @inbounds for i = 1:nk\n       for j = i:n\n           if j == i\n               if i == 1\n                   for ii = 1:n\n                       temp[ii] = all_i[ii]*p[ii]\n                   end\n                   total_p1 = sum(temp)\n                   M = c_Zr - (total_p1*m)\n                   L = c_B - (total_p1*l)\n                   if total_p1 > 0\n                       k1 = k1*alpha*total_p1\n                   end\n                   dpdt[j] = dpdt[j] + (k1*(M^a)*(L^b))\n               end\n               dpdt[j] = dpdt[j] - (k2*p[i]*sum(@view(p[i:n-i])))\n           elseif (j<(i+i)) && (j!=i)\n               dpdt[j] = dpdt[j] - (k2*p[i]*p[j])\n           elseif j >= (i+i)\n               if j+i <= n\n                   dpdt[j] = dpdt[j] - (k2*p[i]*(p[j] - p[j-i]))\n               elseif j+i > n\n                   dpdt[j] = dpdt[j] + (k2*p[i]*p[j-i])\n               end\n           end\n       end\n   end\nend"}]}]}]},{"client_msg_id":"7035f5c9-7083-4f1c-9216-37ff7d018206","type":"message","text":"that's a faster version of your model, but of course it's going to have the same issues. But that `@view` is something to think about, the reuse of the temporary is a good idea, and put `@inbounds` on only after debugging.","user":"U69BL50BF","ts":"1609539719.121800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"H3K","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's a faster version of your model, but of course it's going to have the same issues. But that "},{"type":"text","text":"@view","style":{"code":true}},{"type":"text","text":" is something to think about, the reuse of the temporary is a good idea, and put "},{"type":"text","text":"@inbounds","style":{"code":true}},{"type":"text","text":" on only after debugging."}]}]}]},{"client_msg_id":"022d05a1-1bf5-4db8-8199-740ef309eb92","type":"message","text":"@anish-dighe that should be enough to figure out what's going on in comparison to MATLAB, but let me know if you need anything more.","user":"U69BL50BF","ts":"1609539765.122500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"x0x","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"@anish-dighe that should be enough to figure out what's going on in comparison to MATLAB, but let me know if you need anything more."}]}]}]}]}