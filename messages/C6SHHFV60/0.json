{"cursor": 0, "messages": [{"client_msg_id":"7d31a952-bbae-412b-bc7a-fd7814a22885","type":"message","text":"does anyone know if there are tricks / issues with the number of BLAS threads on ARM ? We have a server where a given function seems to use one thread for blas operations, when the same code uses multiple threads on an intel architecture","user":"U82RE6STE","ts":"1610365728.017000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"osH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"does anyone know if there are tricks / issues with the number of BLAS threads on ARM ? We have a server where a given function seems to use one thread for blas operations, when the same code uses multiple threads on an intel architecture"}]}]}]},{"client_msg_id":"186d3fd6-cc79-4ba2-b51e-b88587ab2fe2","type":"message","text":"This will be up to BLAS’s internal threading decision-making","user":"U66GD0880","ts":"1610391933.017400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"z6/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This will be up to BLAS’s internal threading decision-making"}]}]}]},{"client_msg_id":"3d11531e-a842-487f-8ff7-cf386eae263e","type":"message","text":"I’m assuming you’re using OpenBLAS","user":"U66GD0880","ts":"1610391950.017600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yrilG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m assuming you’re using OpenBLAS"}]}]}]},{"client_msg_id":"bd0e9ccc-8973-4cc4-b2af-e8501fcf56a3","type":"message","text":"for e.g. `gemm` the threading/no threading calculation is basically this:","user":"U66GD0880","ts":"1610392016.018200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LuYz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"for e.g. "},{"type":"text","text":"gemm","style":{"code":true}},{"type":"text","text":" the threading/no threading calculation is basically this:"}]}]}]},{"client_msg_id":"61adff2f-70c0-4c1c-83a4-4e870147c80c","type":"message","text":"<https://github.com/xianyi/OpenBLAS/blob/f6e4cf2f9dac6f90b36f49659d883767d63791f5/interface/gemm.c#L423-L427>","user":"U66GD0880","ts":"1610392017.018400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SYlOs","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/xianyi/OpenBLAS/blob/f6e4cf2f9dac6f90b36f49659d883767d63791f5/interface/gemm.c#L423-L427"}]}]}]},{"client_msg_id":"69a60a5f-defa-43dc-9536-a5c3e74b76ff","type":"message","text":"`MNK` should be the same across platforms, but `GEMM_MULTITHREAD_THRESHOLD` will change from system to system","user":"U66GD0880","ts":"1610392041.018900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"v4TE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"MNK","style":{"code":true}},{"type":"text","text":" should be the same across platforms, but "},{"type":"text","text":"GEMM_MULTITHREAD_THRESHOLD","style":{"code":true}},{"type":"text","text":" will change from system to system"}]}]}]},{"client_msg_id":"9e7a0db8-d16f-4ff5-8287-c659bc3af22b","type":"message","text":"Sadly, there’s not an easy way to figure out what the threshold has been baked into the library as","user":"U66GD0880","ts":"1610392253.019500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3U8Cs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Sadly, there’s not an easy way to figure out what the threshold has been baked into the library as"}]}]}]},{"client_msg_id":"d7e71315-fe30-44ab-96c5-2e863550d061","type":"message","text":"you’d need to look at some cmake status files while building OpenBLAS to see what value its bootstrapping program decided upon","user":"U66GD0880","ts":"1610392276.020000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xzC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you’d need to look at some cmake status files while building OpenBLAS to see what value its bootstrapping program decided upon"}]}]}]},{"client_msg_id":"3907c4fb-103e-400c-93c5-dcc0fd2a463c","type":"message","text":"it’s possible that it’s not tuned correctly","user":"U66GD0880","ts":"1610392283.020300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FLU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it’s possible that it’s not tuned correctly"}]}]}]},{"client_msg_id":"bc5fe243-aa6c-4029-9d1c-61f4ea97e46a","type":"message","text":"if you’d like to chase this down, I can help guide you :slightly_smiling_face:","user":"U66GD0880","ts":"1610392284.020500","team":"T68168MUP","edited":{"user":"U66GD0880","ts":"1610392291.000000"},"blocks":[{"type":"rich_text","block_id":"lEE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if you’d like to chase this down, I can help guide you "},{"type":"emoji","name":"slightly_smiling_face"}]}]}]},{"client_msg_id":"d6992dad-3b61-4588-be6e-bf18f2ac17ed","type":"message","text":"thanks! I asked to gain access to the arm server, will update here whenever I can investigate what is going on","user":"U82RE6STE","ts":"1610394544.021500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"P+p","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks! I asked to gain access to the arm server, will update here whenever I can investigate what is going on"}]}]}],"reactions":[{"name":"+1","users":["U66GD0880"],"count":1}]},{"client_msg_id":"f0300397-91d2-40c6-800b-7ad8ed8eaf8c","type":"message","text":"OK I finally have access to an ARM machine for some fun. On my AMD, Int is Int64, and BlasInt is Int64, but using Julia 1.5 for ARM, the 64 bits (there is no 32 anyway), Int is Int64, but BlasInt is Int32, is that expected?","user":"U82RE6STE","ts":"1611842533.002000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"G8p=q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"OK I finally have access to an ARM machine for some fun. On my AMD, Int is Int64, and BlasInt is Int64, but using Julia 1.5 for ARM, the 64 bits (there is no 32 anyway), Int is Int64, but BlasInt is Int32, is that expected?"}]}]}]},{"client_msg_id":"e5bbe0ad-26ac-475d-bf23-c33dc72a4c88","type":"message","text":"This led to being able to create a vector with size &gt; max(Int32), but getting an error when calling norm on it","user":"U82RE6STE","ts":"1611842649.002800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aeQf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This led to being able to create a vector with size > max(Int32), but getting an error when calling norm on it"}]}]}]},{"client_msg_id":"82bee45a-9d35-4668-8869-cd2add2c1c5a","type":"message","text":"I'll post an issue if this is indeed not expected, just didn't want to spam if this is just a misunderstanding on my end","user":"U82RE6STE","ts":"1611842766.003400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"phf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'll post an issue if this is indeed not expected, just didn't want to spam if this is just a misunderstanding on my end"}]}]}],"thread_ts":"1611842766.003400","reply_count":1,"reply_users_count":1,"latest_reply":"1611843172.003500","reply_users":["U82RE6STE"],"subscribed":false},{"client_msg_id":"27638d05-c85c-4942-8082-d56e3692f836","type":"message","text":"Maybe this is the right channel for Apple M1 questions? I’m getting stack traces which are short-to-missing, is this a known problem?\n```julia&gt; sqrt(-1)\nERROR: DomainError with -1.0:\nsqrt will only return a complex result if called with a complex argument. Try sqrt(Complex(x)).\nStacktrace:\n [1] throw_complex_domainerror(f::Symbol, x::Float64)\n   @ Base.Math ./math.jl:33\n\njulia&gt; Matrix{Int}([1 2; 3 4.5])\nERROR: InexactError: Int64(4.5)```\nThis is on master, but I don’t have an intel computer here to compare.","user":"UD0NS8PDF","ts":"1615490972.002300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"43E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe this is the right channel for Apple M1 questions? I’m getting stack traces which are short-to-missing, is this a known problem?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> sqrt(-1)\nERROR: DomainError with -1.0:\nsqrt will only return a complex result if called with a complex argument. Try sqrt(Complex(x)).\nStacktrace:\n [1] throw_complex_domainerror(f::Symbol, x::Float64)\n   @ Base.Math ./math.jl:33\n\njulia> Matrix{Int}([1 2; 3 4.5])\nERROR: InexactError: Int64(4.5)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"This is on master, but I don’t have an intel computer here to compare."}]}]}]},{"client_msg_id":"252be770-c8c4-4489-9cb2-d574b45d4683","type":"message","text":"I believe this is the “unwinding from JIT frames doesn’t work” checkbox in the aarch64 Darwin tracking issue","user":"U66GD0880","ts":"1615491720.003000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fzCH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I believe this is the “unwinding from JIT frames doesn’t work” checkbox in the aarch64 Darwin tracking issue"}]}]}]},{"client_msg_id":"339dabe9-cf91-4317-9223-742d05a52aa8","type":"message","text":"<https://github.com/JuliaLang/julia/issues/36617#issue-655127468>","user":"U66GD0880","ts":"1615491721.003200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YkxE","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/JuliaLang/julia/issues/36617#issue-655127468"}]}]}]},{"client_msg_id":"97966006-ce57-4985-8f34-3b0700e29dd6","type":"message","text":"I suggest opening an issue.  A comparable `master` build on x86_64 darwin gives the proper, full backtrace","user":"U66GD0880","ts":"1615491803.003900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xMKc/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I suggest opening an issue.  A comparable "},{"type":"text","text":"master","style":{"code":true}},{"type":"text","text":" build on x86_64 darwin gives the proper, full backtrace"}]}]}]},{"client_msg_id":"e823d8ec-def3-4e52-bddd-6e3d9ddae0a5","type":"message","text":"Great, thanks for checking. I made an issue, <https://github.com/JuliaLang/julia/issues/39986>","user":"UD0NS8PDF","ts":"1615492889.004200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NfJlf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Great, thanks for checking. I made an issue, "},{"type":"link","url":"https://github.com/JuliaLang/julia/issues/39986"}]}]}]},{"client_msg_id":"385a0a53-b77f-4f05-80ad-e76d6e688a6f","type":"message","text":"I have another weird thing: ForwardDiff seems super-slow, at the REPL, not the first run but every time:\n```julia&gt; @time ForwardDiff.gradient(x -&gt; sum(x*x), rand(2,2));\n  0.486069 seconds (4.17 M allocations: 220.887 MiB, 7.33% gc time, 99.86% compilation time)\n\njulia&gt; @time Zygote.gradient(x -&gt; sum(x*x), rand(2,2));\n  0.013145 seconds (33.95 k allocations: 1.881 MiB, 99.69% compilation time)\n\n# but @btime is still fast:\n\njulia&gt; @btime ForwardDiff.gradient(x -&gt; sum(x*x), $(rand(2,2)));\n  317.021 ns (9 allocations: 1.02 KiB)\n\njulia&gt; @btime Zygote.gradient(x -&gt; sum(x*x), $(rand(2,2)));\n  546.319 ns (20 allocations: 1.02 KiB)```\nSimilar numbers with default terminal and iterm.","user":"UD0NS8PDF","ts":"1615506671.005500","team":"T68168MUP","edited":{"user":"UD0NS8PDF","ts":"1615506694.000000"},"blocks":[{"type":"rich_text","block_id":"3FI=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have another weird thing: ForwardDiff seems super-slow, at the REPL, not the first run but every time:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @time ForwardDiff.gradient(x -> sum(x*x), rand(2,2));\n  0.486069 seconds (4.17 M allocations: 220.887 MiB, 7.33% gc time, 99.86% compilation time)\n\njulia> @time Zygote.gradient(x -> sum(x*x), rand(2,2));\n  0.013145 seconds (33.95 k allocations: 1.881 MiB, 99.69% compilation time)\n\n# but @btime is still fast:\n\njulia> @btime ForwardDiff.gradient(x -> sum(x*x), $(rand(2,2)));\n  317.021 ns (9 allocations: 1.02 KiB)\n\njulia> @btime Zygote.gradient(x -> sum(x*x), $(rand(2,2)));\n  546.319 ns (20 allocations: 1.02 KiB)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Similar numbers with default terminal and iterm."}]}]}]},{"client_msg_id":"a076a98d-b954-473d-8b9e-736616bda841","type":"message","text":"Is there that much compilation time every time?","user":"U67BJLYCS","ts":"1615506992.006100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rzhk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there that much compilation time every time?"}]}]}]},{"client_msg_id":"67e6bdba-67af-4f84-8778-2e0fee091b03","type":"message","text":"The closure `x-&gt;x*x`","user":"U67BJLYCS","ts":"1615507014.006700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"THc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The closure "},{"type":"text","text":"x->x*x","style":{"code":true}}]}]}]},{"client_msg_id":"266ad4ad-3a6b-45ed-9a10-03cc5a1fdcd0","type":"message","text":"Could trigger recompilation","user":"U67BJLYCS","ts":"1615507033.007100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CuuRx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Could trigger recompilation"}]}]}]},{"client_msg_id":"f9aaad99-03a9-4948-9f85-9e26a64d63d5","type":"message","text":"That must be what’s happening, simpler example (again the Nth run):\n```julia&gt; @time ForwardDiff.gradient(x -&gt; sum(x), rand(2,2));\n  0.173343 seconds (1.56 M allocations: 89.737 MiB, 6.64% gc time, 99.46% compilation time)\n\njulia&gt; @time ForwardDiff.gradient(sum, rand(2,2));\n  0.000008 seconds (9 allocations: 912 bytes)```","user":"UD0NS8PDF","ts":"1615507873.007800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tUVei","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That must be what’s happening, simpler example (again the Nth run):\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @time ForwardDiff.gradient(x -> sum(x), rand(2,2));\n  0.173343 seconds (1.56 M allocations: 89.737 MiB, 6.64% gc time, 99.46% compilation time)\n\njulia> @time ForwardDiff.gradient(sum, rand(2,2));\n  0.000008 seconds (9 allocations: 912 bytes)"}]}]}]}]}