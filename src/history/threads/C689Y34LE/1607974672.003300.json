[{"client_msg_id":"a04f7484-ae4e-4d7b-96df-3508a7bd15b9","type":"message","text":"Hey, what’s the status of sparse operations using `CUDA.jl` ? In particular, is there any way to efficiently evaluate a kronecker product of a dense CuArray and sparse CuArray?","user":"UPM0H43C7","ts":"1607974672.003300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"W2u","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hey, what’s the status of sparse operations using "},{"type":"text","text":"CUDA.jl","style":{"code":true}},{"type":"text","text":" ? In particular, is there any way to efficiently evaluate a kronecker product of a dense CuArray and sparse CuArray?"}]}]}],"thread_ts":"1607974672.003300","reply_count":34,"reply_users_count":6,"latest_reply":"1608088028.019800","reply_users":["U68A3ASP9","UPM0H43C7","UDGT4PM41","U6A0PD8CR","U67BJLYCS","UH9KWTTD3"],"subscribed":false},{"client_msg_id":"54b0c126-322e-4e4e-a78d-2522f322724a","type":"message","text":"nothing beyond what CUSPARSE has to offer, and even then it's not always wrappers conveniently. but the C API is always available, so if you need something you can try that and maybe create a PR to expose the functionality :-)","user":"U68A3ASP9","ts":"1607976522.004000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"S3f","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"nothing beyond what CUSPARSE has to offer, and even then it's not always wrappers conveniently. but the C API is always available, so if you need something you can try that and maybe create a PR to expose the functionality :-)"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"8d644dd7-e43b-4b09-a8ff-8edfa6f8fcfa","type":"message","text":"I’m an absolute dunce when it comes to C. I tried checking if there’s an implementation in nVidia’s CUSPARSE for a kronecker product of a dense array and a sparse array, but can’t find it :disappointed:","user":"UPM0H43C7","ts":"1607976774.004600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lgNaw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m an absolute dunce when it comes to C. I tried checking if there’s an implementation in nVidia’s CUSPARSE for a kronecker product of a dense array and a sparse array, but can’t find it "},{"type":"emoji","name":"disappointed"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"1b2f4a2c-71d4-4132-9486-139ee954a716","type":"message","text":"doesn't look like CUSPARSE implements Kronecker products. and for now we also don't support writing kernels with sparse matrices","user":"U68A3ASP9","ts":"1607976900.004800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tcW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"doesn't look like CUSPARSE implements Kronecker products. and for now we also don't support writing kernels with sparse matrices"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"15b2a17c-9d62-4fe4-8e07-d4e455aabf4f","type":"message","text":"hm there's <https://docs.cupy.dev/en/stable/reference/generated/cupyx.scipy.sparse.kron.html#cupyx.scipy.sparse.kron> though","user":"U68A3ASP9","ts":"1607976930.005000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OOwSv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hm there's "},{"type":"link","url":"https://docs.cupy.dev/en/stable/reference/generated/cupyx.scipy.sparse.kron.html#cupyx.scipy.sparse.kron"},{"type":"text","text":" though"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"6740fe5b-b7be-4cd3-b4ee-e1c1dfb5ca9e","type":"message","text":"I saw that. Looks like both matrices are sparse.","user":"UPM0H43C7","ts":"1607976976.005200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ozx/1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I saw that. Looks like both matrices are sparse."}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"8f469df2-66bf-4e33-ac6c-75916f0af3ba","type":"message","text":"you can always create a sparse matrix from a dense one without much trouble, right?","user":"U68A3ASP9","ts":"1607977088.005400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wZOg5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can always create a sparse matrix from a dense one without much trouble, right?"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"79d51633-8615-4f8c-9be2-b39a5eb4db3c","type":"message","text":"so you could use/port <https://github.com/cupy/cupy/blob/392572d50f79b5cb565c633cc2f142c6a3da458d/cupyx/scipy/sparse/construct.py#L496-L545>","user":"U68A3ASP9","ts":"1607977094.005600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ANS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so you could use/port "},{"type":"link","url":"https://github.com/cupy/cupy/blob/392572d50f79b5cb565c633cc2f142c6a3da458d/cupyx/scipy/sparse/construct.py#L496-L545"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"78a08a6a-546c-4052-ba1e-85569bcb404e","type":"message","text":"My particular case is pretty silly, I want to avoid converting a matrix to a 3D array to do a matmul, and I was thinking of using the kronecker product identity vec(A*B) = (B^T \\otimes I) A","user":"UPM0H43C7","ts":"1607977152.005800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=jc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"My particular case is pretty silly, I want to avoid converting a matrix to a 3D array to do a matmul, and I was thinking of using the kronecker product identity vec(A*B) = (B^T \\otimes I) A"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"dc4c284f-26ff-44f0-8254-4a5f2c1f45db","type":"message","text":"B^T \\otimes I  repeats B at offset locations which would be easy to create from a vectorized B and easily computed indices. Idk, maybe it’s overkill","user":"UPM0H43C7","ts":"1607977353.006000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nlZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"B^T \\otimes I  repeats B at offset locations which would be easy to create from a vectorized B and easily computed indices. Idk, maybe it’s overkill"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"type":"message","subtype":"thread_broadcast","text":"What would it take to be able to write kernels on sparse matrices?","user":"UDGT4PM41","ts":"1608059346.012300","thread_ts":"1607974672.003300","root":{"client_msg_id":"a04f7484-ae4e-4d7b-96df-3508a7bd15b9","type":"message","text":"Hey, what’s the status of sparse operations using `CUDA.jl` ? In particular, is there any way to efficiently evaluate a kronecker product of a dense CuArray and sparse CuArray?","user":"UPM0H43C7","ts":"1607974672.003300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"W2u","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hey, what’s the status of sparse operations using "},{"type":"text","text":"CUDA.jl","style":{"code":true}},{"type":"text","text":" ? In particular, is there any way to efficiently evaluate a kronecker product of a dense CuArray and sparse CuArray?"}]}]}],"thread_ts":"1607974672.003300","reply_count":34,"reply_users_count":6,"latest_reply":"1608088028.019800","reply_users":["U68A3ASP9","UPM0H43C7","UDGT4PM41","U6A0PD8CR","U67BJLYCS","UH9KWTTD3"],"subscribed":false},"blocks":[{"type":"rich_text","block_id":"OPd=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What would it take to be able to write kernels on sparse matrices?"}]}]}],"client_msg_id":"ebd29528-6442-486b-a11a-c68d038bfab8"},{"client_msg_id":"e0f98f54-1ac8-4407-9a48-67a7abec78e8","type":"message","text":"A bitstype representation for sparse matrices would be sufficient, probably (like `CuDeviceArray`).","user":"U6A0PD8CR","ts":"1608060304.012600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2QKc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"A bitstype representation for sparse matrices would be sufficient, probably (like "},{"type":"text","text":"CuDeviceArray","style":{"code":true}},{"type":"text","text":")."}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"0582b016-1c8c-4a12-b4c4-5c5f85b6e18a","type":"message","text":"basically something like <https://github.com/JuliaLang/julia/blob/c28611ff91b4d2486358e5ff37ccf72032099e93/stdlib/SparseArrays/src/sparsematrix.jl#L19-L34> but then with CuDeviceArrays.","user":"U68A3ASP9","ts":"1608060981.012800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Fde+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"basically something like "},{"type":"link","url":"https://github.com/JuliaLang/julia/blob/c28611ff91b4d2486358e5ff37ccf72032099e93/stdlib/SparseArrays/src/sparsematrix.jl#L19-L34"},{"type":"text","text":" but then with CuDeviceArrays."}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"58ea2a8c-40f7-4505-bcaf-c459811db6fa","type":"message","text":"Thanks I'll take a look","user":"UDGT4PM41","ts":"1608061215.013000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Gc/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks I'll take a look"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"4d4cba29-1187-4754-8a4b-0c0ccfc8cdb3","type":"message","text":"So once that's working with CUDA.jl, what has to happen to do sparse kernels with KA?  Define some dispatches or the dsl/compiler  needs changes? I'm interested in things like sparse convolutions","user":"UDGT4PM41","ts":"1608061925.013200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lu3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So once that's working with CUDA.jl, what has to happen to do sparse kernels with KA?  Define some dispatches or the dsl/compiler  needs changes? I'm interested in things like sparse convolutions"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"f3dfa3d4-378e-4353-91e5-a7404218e970","type":"message","text":"I guess you can't just use KA, since then you'll densely iterate the sparse array device-side? I'm not familiar with how sparse algorithms are actually implemented though, so I might be off here.","user":"U68A3ASP9","ts":"1608062045.013400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gwNZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I guess you can't just use KA, since then you'll densely iterate the sparse array device-side? I'm not familiar with how sparse algorithms are actually implemented though, so I might be off here."}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"ff13d0d5-c6e9-4283-a9a7-ef8986c64d6c","type":"message","text":"Yes wouldn't want to do dense iteration. <@U67BJLYCS> any idea ?","user":"UDGT4PM41","ts":"1608062137.013600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"l/G2v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes wouldn't want to do dense iteration. "},{"type":"user","user_id":"U67BJLYCS"},{"type":"text","text":" any idea ?"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"4253a8f2-6054-4297-ae5a-5c16a069ef70","type":"message","text":"<@UH9KWTTD3> related to our chat","user":"UDGT4PM41","ts":"1608062183.013800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"p/X","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UH9KWTTD3"},{"type":"text","text":" related to our chat"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"14c6b649-482f-42e7-9c8e-b097adb7623f","type":"message","text":"Yeah that's a good point, we'd have to override quite a lot of methods to make this work efficiently. Some amount of iteration will be necessary, of course (that's the nature of sparse array representations).","user":"U6A0PD8CR","ts":"1608062467.014000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sDs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah that's a good point, we'd have to override quite a lot of methods to make this work efficiently. Some amount of iteration will be necessary, of course (that's the nature of sparse array representations)."}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"9a14e96b-ca0c-41dd-8600-1b93b2105286","type":"message","text":"<@U6A0PD8CR> any pointers on where to start looking in KA?","user":"UDGT4PM41","ts":"1608062601.014200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6TKz","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U6A0PD8CR"},{"type":"text","text":" any pointers on where to start looking in KA?"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"7ba78645-604f-41dd-906e-98496790eb26","type":"message","text":"Nope, I'm not an sparse array or KA expert :slightly_smiling_face:","user":"U6A0PD8CR","ts":"1608062643.014400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1Cn7I","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Nope, I'm not an sparse array or KA expert "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"ce9032fa-1394-462d-9d14-275f7494e1a5","type":"message","text":"Np :)","user":"UDGT4PM41","ts":"1608062839.014700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"A0QFD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Np :)"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"ce542e5d-57ac-41f4-b9c9-ff21004b6413","type":"message","text":"For KA you just need to define an appropriate iteration space","user":"U67BJLYCS","ts":"1608063047.014900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4/i","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For KA you just need to define an appropriate iteration space"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"d15c01bc-1641-4d1b-92b2-a62632e9e6bf","type":"message","text":"most sparse formats have a dense component","user":"U67BJLYCS","ts":"1608063056.015100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uwcT=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"most sparse formats have a dense component"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"f1e95be4-e13b-4b88-995a-db2929f0414c","type":"message","text":"So here <https://github.com/JuliaGPU/KernelAbstractions.jl/blob/20e3bb651426d7124ab2e44ca2b41d47880f9f17/src/nditeration.jl|https://github.com/JuliaGPU/KernelAbstractions.jl/blob/20e3bb651426d7124ab2e44ca2b41d47880f9f17/src/nditeration.jl> ?","user":"UDGT4PM41","ts":"1608063263.015400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rMN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So here "},{"type":"link","url":"https://github.com/JuliaGPU/KernelAbstractions.jl/blob/20e3bb651426d7124ab2e44ca2b41d47880f9f17/src/nditeration.jl","text":"https://github.com/JuliaGPU/KernelAbstractions.jl/blob/20e3bb651426d7124ab2e44ca2b41d47880f9f17/src/nditeration.jl"},{"type":"text","text":" ?"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"7de21e7e-bb55-4301-8348-7a1e23e75fab","type":"message","text":"You can just pass an appropriate `ndrange`","user":"U67BJLYCS","ts":"1608063698.015600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kJLG=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You can just pass an appropriate "},{"type":"text","text":"ndrange","style":{"code":true}}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"d5224ced-6e71-4e96-90b7-ee37dbce8827","type":"message","text":"and then map from a `dense` index to a `sparse`","user":"U67BJLYCS","ts":"1608063717.015800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UVwbS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and then map from a "},{"type":"text","text":"dense","style":{"code":true}},{"type":"text","text":" index to a "},{"type":"text","text":"sparse","style":{"code":true}}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"4b57bfd5-669b-4ba3-ad34-77403a75148f","type":"message","text":"Perfect, thanks !","user":"UDGT4PM41","ts":"1608064321.016000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=bU//","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Perfect, thanks !"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"ce51f0fc-d35b-493c-a288-c8df143aabac","type":"message","text":"<@UDGT4PM41> not sure which chat haha","user":"UH9KWTTD3","ts":"1608064337.016200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M5r7D","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UDGT4PM41"},{"type":"text","text":" not sure which chat haha"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"9735ec98-c0e6-499b-8b66-274c57bb73f5","type":"message","text":"But if someone wanted to make sparse operations work nicely with CUDA/KA/etc., then I won’t complain :smile:","user":"UH9KWTTD3","ts":"1608064393.016400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ylve","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But if someone wanted to make sparse operations work nicely with CUDA/KA/etc., then I won’t complain "},{"type":"emoji","name":"smile"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"ee301eed-4dd6-4663-9772-c80df9b69b7b","type":"message","text":"The delta vision stuff","user":"UDGT4PM41","ts":"1608064417.016600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GEI2X","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The delta vision stuff"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"35fa16e8-82ca-411f-a32a-65d17597c28a","type":"message","text":"I'll pm you though","user":"UDGT4PM41","ts":"1608064423.016800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nDsa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'll pm you though"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7","reactions":[{"name":"+1::skin-tone-5","users":["UH9KWTTD3"],"count":1}]},{"client_msg_id":"18b2ee4c-3926-49f6-97ac-ab49dabac917","type":"message","text":"I'm not sure it's going to be as simple as iterating any of the dense components of the sparse array; they are coupled.","user":"U68A3ASP9","ts":"1608064763.017100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vA+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm not sure it's going to be as simple as iterating any of the dense components of the sparse array; they are coupled."}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"6b069ed0-54a5-47cd-9cfb-5c0d58e96dce","type":"message","text":"I'll have to check out some of the literature, which I needed to do eventually anyway","user":"UDGT4PM41","ts":"1608087981.019500","team":"T68168MUP","edited":{"user":"UDGT4PM41","ts":"1608088003.000000"},"blocks":[{"type":"rich_text","block_id":"YYg19","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'll have to check out some of the literature, which I needed to do eventually anyway"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"},{"client_msg_id":"bbe49ec7-c978-4434-91af-26f5399c4a2a","type":"message","text":"I was hoping to get it done automagically though","user":"UDGT4PM41","ts":"1608088028.019800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JRL00","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I was hoping to get it done automagically though"}]}]}],"thread_ts":"1607974672.003300","parent_user_id":"UPM0H43C7"}]