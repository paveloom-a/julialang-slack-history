[{"client_msg_id":"6aa1b114-9864-4e8b-a699-b58223a75456","type":"message","text":"<@UMZQBQU67> should probably confirm in case I butchered the explanation.","user":"UEP056STX","ts":"1608131422.256500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"suc","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UMZQBQU67"},{"type":"text","text":" should probably confirm in case I butchered the explanation."}]}]}],"thread_ts":"1608131422.256500","reply_count":39,"reply_users_count":2,"latest_reply":"1608141462.278700","reply_users":["UEP056STX","UMZQBQU67"],"subscribed":false},{"client_msg_id":"90db50f0-a554-425e-b5bc-0072c5a57151","type":"message","text":"I wonder if it makes sense to set `collecting = false` in a separate `if` statement: <https://github.com/CliMA/Oceananigans.jl/blob/81db22f4a26396142e8cd5b5a4c50c75790c1d50/src/OutputWriters/windowed_time_average.jl#L179-L187>","user":"UEP056STX","ts":"1608131471.256700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pDk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I wonder if it makes sense to set "},{"type":"text","text":"collecting = false","style":{"code":true}},{"type":"text","text":" in a separate "},{"type":"text","text":"if","style":{"code":true}},{"type":"text","text":" statement: "},{"type":"link","url":"https://github.com/CliMA/Oceananigans.jl/blob/81db22f4a26396142e8cd5b5a4c50c75790c1d50/src/OutputWriters/windowed_time_average.jl#L179-L187"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"ee850ae2-4a21-4ee9-adfd-ef0c31661d2d","type":"message","text":"So that `collecting` can be set to `true` then `false` in one call","user":"UEP056STX","ts":"1608131504.256900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"S2eT4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So that "},{"type":"text","text":"collecting","style":{"code":true}},{"type":"text","text":" can be set to "},{"type":"text","text":"true","style":{"code":true}},{"type":"text","text":" then "},{"type":"text","text":"false","style":{"code":true}},{"type":"text","text":" in one call"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"3099b36a-d7d1-4a8b-958b-d0677e2490a3","type":"message","text":"Not sure if that makes sense though.","user":"UEP056STX","ts":"1608131509.257100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7sa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Not sure if that makes sense though."}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"cae71443-fefd-40f2-8a2b-d4e652028b5e","type":"message","text":"A better warning might be something like\n```your time averaging interval/window is too short for time averaging to do it's job```","user":"UEP056STX","ts":"1608131524.257300","team":"T68168MUP","edited":{"user":"UEP056STX","ts":"1608131541.000000"},"blocks":[{"type":"rich_text","block_id":"4wD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"A better warning might be something like\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"your time averaging interval/window is too short for time averaging to do it's job"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"1dc827ee-5955-4a9f-8235-c6136a11e7e9","type":"message","text":"I think we’re seeing a genuine bug here --- we don’t want to change the code in a way that hides it","user":"UMZQBQU67","ts":"1608139338.266400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XmOo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think we’re seeing a genuine bug here --- we don’t want to change the code in a way that hides it"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"df4cc666-8a30-4387-bf8d-8ad77eaeb4da","type":"message","text":"the important bit is\n\n```wta.schedule.previous_interval_stop_time = model.clock.time - rem(model.clock.time, wta.schedule.interval)```","user":"UMZQBQU67","ts":"1608139367.266700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SNX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the important bit is\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"wta.schedule.previous_interval_stop_time = model.clock.time - rem(model.clock.time, wta.schedule.interval)"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"dab44e18-c6ba-4ab9-906a-3aa95d0635bd","type":"message","text":"and if this fragment isn’t running, then its good that we get a warning","user":"UMZQBQU67","ts":"1608139378.266900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mes","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and if this fragment isn’t running, then its good that we get a warning"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"4e67869c-427e-4508-a3ba-70b2ea366c79","type":"message","text":"but i think you’re right that the warning maybe shoudl say something different","user":"UMZQBQU67","ts":"1608139384.267100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JQs=j","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but i think you’re right that the warning maybe shoudl say something different"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"665b508a-58a2-45d5-a2af-8c98ba9adfb3","type":"message","text":"we can use differnet logic here perhaps","user":"UMZQBQU67","ts":"1608139492.267900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aiDs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"we can use differnet logic here perhaps"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"2d16826e-48da-44e2-bf78-e07c73b576da","type":"message","text":"less convoluted logic","user":"UMZQBQU67","ts":"1608139503.268100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Mmo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"less convoluted logic"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"d3bb262d-e63c-4030-ac5d-21876c39ed91","type":"message","text":"where we reset the averaging when the quantity of interest is outpout","user":"UMZQBQU67","ts":"1608139510.268300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PpXE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"where we reset the averaging when the quantity of interest is outpout"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"6702017f-697f-4de5-8ba9-2b074000a19a","type":"message","text":"the problem with that is we need to implemented twice (for JLD2 and NetCDF independently)","user":"UMZQBQU67","ts":"1608139818.268500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HW4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the problem with that is we need to implemented twice (for JLD2 and NetCDF independently)"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"e10b9b00-4942-4961-a41b-3f9ca04bdf9e","type":"message","text":"wait that’s not true. We could actually set `collecting=false` here:\n\n<https://github.com/CliMA/Oceananigans.jl/blob/81db22f4a26396142e8cd5b5a4c50c75790c1d50/src/OutputWriters/windowed_time_average.jl#L199-L202>\n\nrather than throwing a warning, and reinitialize the next time-interval too. Would this make sense?","user":"UMZQBQU67","ts":"1608140388.272100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WVz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"wait that’s not true. We could actually set "},{"type":"text","text":"collecting=false","style":{"code":true}},{"type":"text","text":" here:\n\n"},{"type":"link","url":"https://github.com/CliMA/Oceananigans.jl/blob/81db22f4a26396142e8cd5b5a4c50c75790c1d50/src/OutputWriters/windowed_time_average.jl#L199-L202"},{"type":"text","text":"\n\nrather than throwing a warning, and reinitialize the next time-interval too. Would this make sense?"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"a029477f-eb44-4fce-b4ff-6a06fe3406b6","type":"message","text":"Ah I think that makes sense, then there's no need for a warning since the time average will always be correct?","user":"UEP056STX","ts":"1608140436.272900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"i02cS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah I think that makes sense, then there's no need for a warning since the time average will always be correct?"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"102f92c8-7d6e-47a5-93b7-f1422660496e","type":"message","text":"I think what it means is that the collection of a time-average always ceases when you ask for the result.","user":"UMZQBQU67","ts":"1608140491.273700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gzH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think what it means is that the collection of a time-average always ceases when you ask for the result."}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"fcabcb74-c8c3-4212-91b9-6de653d34ea8","type":"message","text":"I think if we were being careful / documenting everything we would also somehow save / output the averaging window associated with each instance","user":"UMZQBQU67","ts":"1608140520.273900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TfGE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think if we were being careful / documenting everything we would also somehow save / output the averaging window associated with each instance"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"fdb2c21b-7f7e-4c24-a1b5-f62e7487b14f","type":"message","text":"then correctness can be verified posteriori","user":"UMZQBQU67","ts":"1608140526.274100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LcXS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"then correctness can be verified posteriori"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"739d33ef-25d6-4090-946c-667949dd7c83","type":"message","text":"Ah so like for each time average, there's metadata telling you how many iterations are included in that time average (and over which times it covers)?","user":"UEP056STX","ts":"1608140586.274400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"V2jZ8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah so like for each time average, there's metadata telling you how many iterations are included in that time average (and over which times it covers)?"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"a5558cd5-7f51-49d2-b3a4-452ae21886e9","type":"message","text":"something like that yeah","user":"UMZQBQU67","ts":"1608140803.274700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sHYxm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"something like that yeah"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"74182d18-d799-4943-a000-b584019eaea4","type":"message","text":"is that possible?","user":"UMZQBQU67","ts":"1608140817.274900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b653","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is that possible?"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"8811d95d-3864-4efe-883f-df30c9bf8e70","type":"message","text":"Don't see why not. Might have to add extra properties to `WindowedTimeAverage` or `AveragedTimeInterval` but then should be easy to output to disk for each time average.","user":"UEP056STX","ts":"1608140885.275100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ka8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Don't see why not. Might have to add extra properties to "},{"type":"text","text":"WindowedTimeAverage","style":{"code":true}},{"type":"text","text":" or "},{"type":"text","text":"AveragedTimeInterval","style":{"code":true}},{"type":"text","text":" but then should be easy to output to disk for each time average."}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"2682d057-9460-4e2a-80f4-a5454191774e","type":"message","text":"I guess they should keep track of how many `iterations` they include (incremented every time the result is accumulated) and the start/end times for the time average (taken from `model.clock.time`).","user":"UEP056STX","ts":"1608140929.275300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7kiUR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I guess they should keep track of how many "},{"type":"text","text":"iterations","style":{"code":true}},{"type":"text","text":" they include (incremented every time the result is accumulated) and the start/end times for the time average (taken from "},{"type":"text","text":"model.clock.time","style":{"code":true}},{"type":"text","text":")."}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"4c21c480-83e8-4518-a7e9-844f0e48eda7","type":"message","text":"Question is whether it's an in-demand feature.","user":"UEP056STX","ts":"1608140947.275500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lbZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Question is whether it's an in-demand feature."}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"f1eae0ab-b834-4e36-b6ba-8c9fd406738f","type":"message","text":"yeah i think adding to the interval makes sense, since its already keeping track of the state through `schedule.collecting` and `schedule.previous_interval_stop_time`","user":"UMZQBQU67","ts":"1608140963.275700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MhWon","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah i think adding to the interval makes sense, since its already keeping track of the state through "},{"type":"text","text":"schedule.collecting","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"schedule.previous_interval_stop_time","style":{"code":true}}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"7242d6fa-1c2b-4b70-a50e-78be4ce334c9","type":"message","text":"&gt;  Question is whether it’s an in-demand feature.\nThat might only affect _who_ implements it :stuck_out_tongue:","user":"UMZQBQU67","ts":"1608140993.275900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tKU","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":" Question is whether it’s an in-demand feature."}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nThat might only affect "},{"type":"text","text":"who","style":{"italic":true}},{"type":"text","text":" implements it "},{"type":"emoji","name":"stuck_out_tongue"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"365767cd-c459-4d88-937f-58feed30da3f","type":"message","text":"Lol right. I don't need to verify the correctness of time averages right now.","user":"UEP056STX","ts":"1608141032.276100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LBz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Lol right. I don't need to verify the correctness of time averages right now."}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"297db13f-2ec6-470f-9d91-755bd281bd38","type":"message","text":"actually its already setup because we already have `window_start_iteration` and `window_start_time`","user":"UMZQBQU67","ts":"1608141032.276300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cp0b","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"actually its already setup because we already have "},{"type":"text","text":"window_start_iteration","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"window_start_time","style":{"code":true}}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"a9d51c4d-9088-4dde-a9d6-3adbaaef2ddc","type":"message","text":"so we can just use those when output is asked for to compute it","user":"UMZQBQU67","ts":"1608141045.276500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Fcp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so we can just use those when output is asked for to compute it"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"112e5480-dca7-4572-8b0f-2107674f1c85","type":"message","text":"Could be useful for larger more expensive (mesoscale?) simulations.","user":"UEP056STX","ts":"1608141055.276700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EyC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Could be useful for larger more expensive (mesoscale?) simulations."}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"64a00f00-c585-4c57-94e1-21328655b99d","type":"message","text":"we could also ensure correctness by aligning time-step with both the start of a window and the end of the window","user":"UMZQBQU67","ts":"1608141079.276900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xz111","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"we could also ensure correctness by aligning time-step with both the start of a window and the end of the window"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"d84d166e-b3a6-4826-baed-675c4ee213dd","type":"message","text":"and then i guess if we know its correct (its tested) we dont have to output anything","user":"UMZQBQU67","ts":"1608141134.277100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hdSM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and then i guess if we know its correct (its tested) we dont have to output anything"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"c19a93e7-d36f-4750-a762-27f161a2752f","type":"message","text":"Ah I saw the utility as debugging in case time averaged output is weird","user":"UEP056STX","ts":"1608141188.277300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PeSg7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah I saw the utility as debugging in case time averaged output is weird"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"76cf3c6b-8870-4399-aa9f-ed2685e43926","type":"message","text":"Like if statistics get noisier/worse then you might check the metadata output to see if the number of iterations per time average has decreased","user":"UEP056STX","ts":"1608141229.277500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kQ4C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Like if statistics get noisier/worse then you might check the metadata output to see if the number of iterations per time average has decreased"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"4e18d271-c29f-4839-a276-24e462d233c2","type":"message","text":"But this only seems useful in a small number of cases","user":"UEP056STX","ts":"1608141314.277700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1cfP3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But this only seems useful in a small number of cases"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"302ca93d-c0ba-4cbd-9627-cb66f65892b8","type":"message","text":"I agree with aligning time steps with the start and end of a window","user":"UEP056STX","ts":"1608141325.277900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"A4U","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I agree with aligning time steps with the start and end of a window"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"ef1daa3d-6a68-4902-9dc1-3dc44e6945ce","type":"message","text":"Then it's the user's job to ensure their time averages are long enough (intervals spaced far enough and windows large enough) to make sense.","user":"UEP056STX","ts":"1608141353.278100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QaB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Then it's the user's job to ensure their time averages are long enough (intervals spaced far enough and windows large enough) to make sense."}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"b346454a-d986-4777-8d84-7bc572ef0e27","type":"message","text":"&gt;  Like if statistics get noisier/worse then you might check the metadata output to see if the number of iterations per time average has decreased\nThat does seem pretty useful","user":"UMZQBQU67","ts":"1608141435.278300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Dbs/","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":" Like if statistics get noisier/worse then you might check the metadata output to see if the number of iterations per time average has decreased"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nThat does seem pretty useful"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"2f61a0ff-4418-408c-8f36-980b911a6ce4","type":"message","text":"esp since the time average mixed discrete specification (eg `stride`) with continuous (`window`)","user":"UMZQBQU67","ts":"1608141457.278500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+=Rdg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"esp since the time average mixed discrete specification (eg "},{"type":"text","text":"stride","style":{"code":true}},{"type":"text","text":") with continuous ("},{"type":"text","text":"window","style":{"code":true}},{"type":"text","text":")"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"},{"client_msg_id":"23f34f2f-4323-4822-b57c-5b9be5f43559","type":"message","text":"mixes*","user":"UMZQBQU67","ts":"1608141462.278700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tetTU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"mixes*"}]}]}],"thread_ts":"1608131422.256500","parent_user_id":"UEP056STX"}]