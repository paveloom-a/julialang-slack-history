[{"client_msg_id":"24d42679-410c-4fdb-a559-25dfdff94129","type":"message","text":"Hi all-\n\nI have noticed that Turing takes about twice as long to load and precompile than Plots.jl. I was wondering whether there are any optimizations that could be used to speed this up?","user":"UH08DT0JU","ts":"1608816492.181200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aOHe","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi all-\n\nI have noticed that Turing takes about twice as long to load and precompile than Plots.jl. I was wondering whether there are any optimizations that could be used to speed this up?"}]}]}],"thread_ts":"1608816492.181200","reply_count":20,"reply_users_count":5,"latest_reply":"1608901860.195600","reply_users":["UC0SY9JFP","UH08DT0JU","U85JBUGGP","U01BTNDCUBX","U01ARRMLM7E"],"subscribed":false},{"client_msg_id":"05B233F4-8666-4577-8A71-559542C1914E","type":"message","text":"Hm, if we would drop the support of DynamicHMC and have a lighter dependency than Optim for MLE &amp; MAP we could probably drop Require.","user":"UC0SY9JFP","ts":"1608822217.183400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"E1vz9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hm, if we would drop the support of DynamicHMC and have a lighter dependency than Optim for MLE & MAP we could probably drop Require."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"4bf4918f-340f-46f2-ba7d-1ac11fd058a0","type":"message","text":"Yeah. That could help. Now that AdvancedHMC is mature, DynamicHMC is not necessary. Perhaps additional improvements could be achieved by housing each of the samplers outside of Turing and call the samplers that are necessary for a given project. Is that possible or desirable?","user":"UH08DT0JU","ts":"1608823332.183600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FUzA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah. That could help. Now that AdvancedHMC is mature, DynamicHMC is not necessary. Perhaps additional improvements could be achieved by housing each of the samplers outside of Turing and call the samplers that are necessary for a given project. Is that possible or desirable?"}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"9ec09391-34be-47dd-80be-3014d688c837","type":"message","text":"try Julia 1.6, much faster loading time","user":"U85JBUGGP","ts":"1608824877.183800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pyo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"try Julia 1.6, much faster loading time"}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"dd7d26ef-dadf-4a64-8594-c59a150efa15","type":"message","text":"8x faster iirc","user":"U85JBUGGP","ts":"1608824887.184000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GS8dX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"8x faster iirc"}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"f264f1ca-9416-46a3-9f4e-66e356f209de","type":"message","text":"Julia 1.5.3\n\n```@time using Plots\n  6.639685 seconds (12.61 M allocations: 797.037 MiB, 4.42% gc time)```\n```@time using Turing\n 16.071072 seconds (40.04 M allocations: 2.060 GiB, 4.11% gc time)```\nNightly\n\n```@time using Plots\n  2.841848 seconds (5.80 M allocations: 429.191 MiB, 5.07% gc time, 25.36% compilation time)```\n```@time using Turing\n  9.306305 seconds (16.28 M allocations: 988.606 MiB, 3.80% gc time, 54.65% compilation time)```\n","user":"UH08DT0JU","ts":"1608835131.184500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hisSA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Julia 1.5.3\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@time using Plots\n  6.639685 seconds (12.61 M allocations: 797.037 MiB, 4.42% gc time)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@time using Turing\n 16.071072 seconds (40.04 M allocations: 2.060 GiB, 4.11% gc time)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nNightly\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@time using Plots\n  2.841848 seconds (5.80 M allocations: 429.191 MiB, 5.07% gc time, 25.36% compilation time)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@time using Turing\n  9.306305 seconds (16.28 M allocations: 988.606 MiB, 3.80% gc time, 54.65% compilation time)"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"dcec19be-d935-4727-a057-863dc6f8228f","type":"message","text":"Yeah. It has improved, but Turing is still quite a bit slower than plots.","user":"UH08DT0JU","ts":"1608835171.184700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oX5uu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah. It has improved, but Turing is still quite a bit slower than plots."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"1d67ef51-2b19-4472-a644-c187cdba2864","type":"message","text":"It is also very slow to run the first model. Here are typical timings from the coin flip example:\n\n1.5.3\n```       @time chain = sample(coinflip(data), HMC(ϵ, τ), iterations)\nSampling 100%|██████████████████████████████████████████| Time: 0:00:06\n 12.296129 seconds (47.79 M allocations: 2.156 GiB, 6.50% gc time)```\nNightly\n```      @time chain = sample(coinflip(data), HMC(ϵ, τ), iterations)\nSampling 100%|██████████████████████████████████████████| Time: 0:00:07\n 19.290085 seconds (81.76 M allocations: 4.377 GiB, 6.03% gc time, 93.85% compilation time)```\nThe second run only takes about 1 second. In addition, it takes approximately 8 seconds for the chain to print.","user":"UH08DT0JU","ts":"1608836444.184900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b4hI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It is also very slow to run the first model. Here are typical timings from the coin flip example:\n\n1.5.3\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"       @time chain = sample(coinflip(data), HMC(ϵ, τ), iterations)\nSampling 100%|██████████████████████████████████████████| Time: 0:00:06\n 12.296129 seconds (47.79 M allocations: 2.156 GiB, 6.50% gc time)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nNightly\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"      @time chain = sample(coinflip(data), HMC(ϵ, τ), iterations)\nSampling 100%|██████████████████████████████████████████| Time: 0:00:07\n 19.290085 seconds (81.76 M allocations: 4.377 GiB, 6.03% gc time, 93.85% compilation time)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"The second run only takes about 1 second. In addition, it takes approximately 8 seconds for the chain to print."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"B32DF49E-66FD-4F4C-921A-5631D1BC095E","type":"message","text":"I’ve been wondering similar stuff before but solved it by leaving Julia running, then Julia is blazingly fast","user":"U01BTNDCUBX","ts":"1608838395.187100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5=TJ7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’ve been wondering similar stuff before but solved it by leaving Julia running, then Julia is blazingly fast"}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"4448cefd-d482-44ad-9bc7-5816cd43d5f2","type":"message","text":"I follow that advice when possible but its not really a solution in all cases. The session needs to be restarted when structs are modified or when you switch to a different project (otherwise collisions may happen or a global variable might be used in a function without your knowledge).  The latency is problematic for a set of tutorials I am making for my colleagues. Each lesson is a model written  in a separate notebook. It takes over a minute just to compile the code for Turing, MCMCChains and Plots. Its difficult to convince people to adopt Turing and Julia when compilation is so slow. Even if you can stay in the same session for a long time, it still would be nice to cut down on load and compilation times if feasible.","user":"UH08DT0JU","ts":"1608840798.188700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VbVoL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I follow that advice when possible but its not really a solution in all cases. The session needs to be restarted when structs are modified or when you switch to a different project (otherwise collisions may happen or a global variable might be used in a function without your knowledge).  The latency is problematic for a set of tutorials I am making for my colleagues. Each lesson is a model written  in a separate notebook. It takes over a minute just to compile the code for Turing, MCMCChains and Plots. Its difficult to convince people to adopt Turing and Julia when compilation is so slow. Even if you can stay in the same session for a long time, it still would be nice to cut down on load and compilation times if feasible."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"0B631F12-6838-43C7-B3F8-3A50E0798A40","type":"message","text":"Ah, you seem to know very well what you’re doing :slightly_smiling_face: Nevermind then","user":"U01BTNDCUBX","ts":"1608841016.190900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"413KM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah, you seem to know very well what you’re doing "},{"type":"emoji","name":"slightly_smiling_face"},{"type":"text","text":" Nevermind then"}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"d5e13e0d-42a9-4ff1-8714-9826bf5c8bf9","type":"message","text":"in 1.5 at least, `julia -e \"using Turing\"` still takes 22s _after_ precompilation (compared to `julia -e \"1\"` which takes only 0.2s)","user":"U01ARRMLM7E","ts":"1608841208.191100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=tg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"in 1.5 at least, `julia -e \"using Turing\"` still takes 22s "},{"type":"text","text":"after","style":{"italic":true}},{"type":"text","text":" precompilation (compared to "},{"type":"text","text":"julia -e \"1\"","style":{"code":true}},{"type":"text","text":" which takes only 0.2s)"}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"e6a90f7c-b8f7-4dc5-9f34-6f2bba2ac692","type":"message","text":"Thanks. I'll look into that as a stopgap solution. I suspect there is a tradeoff between compilation and run time.","user":"UH08DT0JU","ts":"1608841352.191300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YVlM+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks. I'll look into that as a stopgap solution. I suspect there is a tradeoff between compilation and run time."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"02e02261-c6a5-498a-8932-6009a21d512f","type":"message","text":"<@UC0SY9JFP>, would it be worth opening an issue? If so, I can open one up.","user":"UH08DT0JU","ts":"1608844570.191500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5KBGl","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UC0SY9JFP"},{"type":"text","text":", would it be worth opening an issue? If so, I can open one up."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"62e12b90-48bd-44be-a9c3-a8062fbe326e","type":"message","text":"Have you considered using PackageCompiler to compile Turing into the system image?","user":"U85JBUGGP","ts":"1608858164.191700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QqDQV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Have you considered using PackageCompiler to compile Turing into the system image?"}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU","reactions":[{"name":"+1","users":["UH08DT0JU"],"count":1}]},{"client_msg_id":"77674235-bdd4-46a6-b474-46685272f8fc","type":"message","text":"This should give you much faster times.","user":"U85JBUGGP","ts":"1608858186.191900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"v6Nb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This should give you much faster times."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"9772e4ce-e706-4d05-b3cd-d3a094aae1d5","type":"message","text":"We had a docker image with Turing built into Julia a while ago. Maybe <@UCRDHV7PB> knows if this is still there.","user":"U85JBUGGP","ts":"1608858228.192100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UYDv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We had a docker image with Turing built into Julia a while ago. Maybe "},{"type":"user","user_id":"UCRDHV7PB"},{"type":"text","text":" knows if this is still there."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"98f58b32-fd8b-4d1e-a4fa-950881835e60","type":"message","text":"If you are not developing Turing and you are using it frequently, there is no reason not to build it into the sysimage.","user":"U85JBUGGP","ts":"1608858287.192300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=ZEt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you are not developing Turing and you are using it frequently, there is no reason not to build it into the sysimage."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"e4432e9e-9005-46cd-8a74-2540fc167362","type":"message","text":"Thanks Mohamed. When I tried it roughly one year ago, it was very buggy and unstable. However, it is worth revisiting since it has been actively developed in the meantime.","user":"UH08DT0JU","ts":"1608884841.192800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VTP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks Mohamed. When I tried it roughly one year ago, it was very buggy and unstable. However, it is worth revisiting since it has been actively developed in the meantime."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"0BCC6E7F-47D7-4845-B6F3-2D77266ED3EA","type":"message","text":"We are aware that we need to get rid of Require, so I don’t think you need to open an issue.","user":"UC0SY9JFP","ts":"1608901825.194600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JYo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We are aware that we need to get rid of Require, so I don’t think you need to open an issue."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"},{"client_msg_id":"71CEED0D-191C-4E80-A491-8D4A710924D3","type":"message","text":"But feel free to open an issue on the general topic, that is the loading time.","user":"UC0SY9JFP","ts":"1608901860.195600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eSPQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But feel free to open an issue on the general topic, that is the loading time."}]}]}],"thread_ts":"1608816492.181200","parent_user_id":"UH08DT0JU"}]