[{"client_msg_id":"7166c777-8bf1-482f-bd50-522f55334d6b","type":"message","text":"I feel like this should give me `Float32`, but I guess something is getting promoted along the way?\n```julia&gt; typeof(logpdf(MvNormal(Float32.(rand(4)), Float32(0.2)), Float32.(rand(4))))\nFloat64```","user":"U695B1S2X","ts":"1608670623.111800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pu/V","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I feel like this should give me "},{"type":"text","text":"Float32","style":{"code":true}},{"type":"text","text":", but I guess something is getting promoted along the way?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> typeof(logpdf(MvNormal(Float32.(rand(4)), Float32(0.2)), Float32.(rand(4))))\nFloat64"}]}]}],"thread_ts":"1608670623.111800","reply_count":17,"reply_users_count":5,"latest_reply":"1608677947.123700","reply_users":["U7HAYKY9X","U0179G7FG4F","U6N6VQE30","U695B1S2X","U6A936746"],"subscribed":false},{"client_msg_id":"0a858d6a-274e-42b8-ba8f-4e5f9043d402","type":"message","text":"It's probably the call to rand","user":"U7HAYKY9X","ts":"1608670952.112000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mD0g","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It's probably the call to rand"}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"2db28651-1715-4e4f-8ba0-874dedb3c4ed","type":"message","text":"note, `rand(Float32,4)` both works and is probably faster.","user":"U0179G7FG4F","ts":"1608670977.112200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"A8Buz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"note, "},{"type":"text","text":"rand(Float32,4)","style":{"code":true}},{"type":"text","text":" both works and is probably faster."}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"1ad2f32e-38f4-44b9-b0b3-8d363f4ce20f","type":"message","text":"There's many reasons things can get converted to float64, try @code_typed on logpdf","user":"U6N6VQE30","ts":"1608671140.112400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Z5AW=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"There's many reasons things can get converted to float64, try @code_typed on logpdf"}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"537f883c-155b-45f0-aff3-55b8890c9236","type":"message","text":"&gt; It's probably the call to rand\n&gt; note, rand(Float32,4) both works and is probably faster\nThat's true, but besides the point. Regardless, `logpdf` should probably return a `Float32` if that's what it's given.\n\n&gt; There's many reasons things can get converted to float64, try @code_typed on logpdf\nThanks, yeah, that's what I'll look into next.","user":"U695B1S2X","ts":"1608671853.112600","team":"T68168MUP","edited":{"user":"U695B1S2X","ts":"1608672092.000000"},"blocks":[{"type":"rich_text","block_id":"e2zuA","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"It's probably the call to rand"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n"}]},{"type":"rich_text_quote","elements":[{"type":"text","text":"note, rand(Float32,4) both works and is probably faster"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"That's true, but besides the point. Regardless, "},{"type":"text","text":"logpdf","style":{"code":true}},{"type":"text","text":" should probably return a "},{"type":"text","text":"Float32","style":{"code":true}},{"type":"text","text":" if that's what it's given.\n\n"}]},{"type":"rich_text_quote","elements":[{"type":"text","text":"There's many reasons things can get converted to float64, try @code_typed on logpdf"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks, yeah, that's what I'll look into next."}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"0a03dbfa-dc7c-4ffa-b394-11dbdfbf15c4","type":"message","text":":julia-cthulhu:  tells me it is:\n<https://github.com/JuliaStats/Distributions.jl/blob/d6de7214e6d84df77d1eb3ec7a98d23862d1232d/src/multivariate/mvnormal.jl#L99>","user":"U6A936746","ts":"1608672416.113000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KuHhH","elements":[{"type":"rich_text_section","elements":[{"type":"emoji","name":"julia-cthulhu"},{"type":"text","text":"  tells me it is:\n"},{"type":"link","url":"https://github.com/JuliaStats/Distributions.jl/blob/d6de7214e6d84df77d1eb3ec7a98d23862d1232d/src/multivariate/mvnormal.jl#L99"}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"4ad2cfe8-91b3-4939-9794-79c90d9feca8","type":"message","text":"Which should be an easy fix.\nJust delete the call too `Float64` and let promotion work it out.\nlog2π is a `Irational` this is exactly what it is for","user":"U6A936746","ts":"1608672576.113300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qYA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Which should be an easy fix.\nJust delete the call too "},{"type":"text","text":"Float64","style":{"code":true}},{"type":"text","text":" and let promotion work it out.\nlog2π is a "},{"type":"text","text":"Irational","style":{"code":true}},{"type":"text","text":" this is exactly what it is for"}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"5009c907-be04-4e6a-892d-7235cd657d20","type":"message","text":"Cthulu is the best","user":"U6A936746","ts":"1608672676.113500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WEWW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Cthulu is the best"}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"73757310-3fe5-41cd-b2c6-96debf027340","type":"message","text":"was this code from an old Julia where that was needed?","user":"U0179G7FG4F","ts":"1608672695.113700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"a+IJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"was this code from an old Julia where that was needed?"}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"2308786d-2c8a-4346-9a5f-5f5b186a7c27","type":"message","text":"It is ancient beyond belief\nIt is from this PR which was written for Julia 0.2.\n<https://github.com/JuliaStats/Distributions.jl/pull/104/files#diff-b662709b31f60de62ce62570c14b10f7034e4ac8f559a35384a182d28af29d1eR50>","user":"U6A936746","ts":"1608673072.113900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"i8UC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It is ancient beyond belief\nIt is from this PR which was written for Julia 0.2.\n"},{"type":"link","url":"https://github.com/JuliaStats/Distributions.jl/pull/104/files#diff-b662709b31f60de62ce62570c14b10f7034e4ac8f559a35384a182d28af29d1eR50"}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X","reactions":[{"name":"100","users":["U0179G7FG4F"],"count":1}]},{"client_msg_id":"4dc6adf1-ee4e-4991-974f-50cf09dbe405","type":"message","text":"Thanks, I'll give it a shot.","user":"U695B1S2X","ts":"1608673226.114200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KzVZ+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks, I'll give it a shot."}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"96025a4c-921c-404c-879a-3425b5980a7a","type":"message","text":"Nope, that doesn't resolve it either.","user":"U695B1S2X","ts":"1608675890.114700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8ZhcS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Nope, that doesn't resolve it either."}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"9f3b6252-408e-4abe-9f5d-e91989a6415a","type":"message","text":"Ah it is because `*(::Int, ::Irational)::Float64` which seems like a poor choice.\nActual fix (confirmed locally)\n```mvnormal_c0(g::AbstractMvNormal) = -(length(g) * convert(eltype(g), log2π) + logdetcov(g))/2```","user":"U6A936746","ts":"1608676231.114900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4oN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah it is because "},{"type":"text","text":"*(::Int, ::Irational)::Float64","style":{"code":true}},{"type":"text","text":" which seems like a poor choice.\nActual fix (confirmed locally)\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"mvnormal_c0(g::AbstractMvNormal) = -(length(g) * convert(eltype(g), log2π) + logdetcov(g))/2"}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X","reactions":[{"name":"+1","users":["U695B1S2X"],"count":1}]},{"client_msg_id":"2e0c345b-3ddf-4a86-82fd-005fea266c15","type":"message","text":"This goes back to the problem of us not having a good symbolic framework. Ideally, we would have a type for integer (and/or rational) multiples of irrationals so precision conversions would happen later, but that starts edging us towards having a computer algebra system in base, which there has (probably correctly) been aversion to","user":"U0179G7FG4F","ts":"1608676389.115600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ozxXx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This goes back to the problem of us not having a good symbolic framework. Ideally, we would have a type for integer (and/or rational) multiples of irrationals so precision conversions would happen later, but that starts edging us towards having a computer algebra system in base, which there has (probably correctly) been aversion to"}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X","reactions":[{"name":"heavy_check_mark","users":["U6A936746"],"count":1}]},{"client_msg_id":"18512075-45e6-432b-a9e2-abf94c2b9961","type":"message","text":"the other solution here would be `mvnormal_c0(g::AbstractMvNormal) = -muladd(length(g), log2π, logdetcov(g))/2`","user":"U0179G7FG4F","ts":"1608676631.117200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7lIHm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the other solution here would be "},{"type":"text","text":"mvnormal_c0(g::AbstractMvNormal) = -muladd(length(g), log2π, logdetcov(g))/2","style":{"code":true}}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X","reactions":[{"name":"heart_eyes","users":["U6A936746"],"count":1}]},{"client_msg_id":"f92b6b2d-2c2a-471c-8c6d-c37ef445b352","type":"message","text":"It wouldn’t really need a symbolics in base.\nIt can be implemented with thunks.\n<https://en.wikipedia.org/wiki/Thunk>\nI am surprise that `Irational`s are not already implemented with a function under the hood that is called to get their values.","user":"U6A936746","ts":"1608677264.122000","team":"T68168MUP","attachments":[{"title":"Thunk","title_link":"https://en.wikipedia.org/wiki/Thunk","from_url":"https://en.wikipedia.org/wiki/Thunk","author_name":"Wikipedia","author_link":"https://en.wikipedia.org/","text":"In computer programming, a thunk is a subroutine used to inject an additional calculation into another subroutine. Thunks are primarily used to delay a calculation until its result is needed, or to insert operations at the beginning or end of the other subroutine. They have many other applications in compiler code generation and modular programming.\nThe term originated as a humorous, incorrect, past participle of \"think\". That is, a \"thunk value\" becomes available after its calculation routine is thought through, or executed.","fallback":"wikipedia: Thunk","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/wikipedia.png","id":1,"original_url":"https://en.wikipedia.org/wiki/Thunk"}],"blocks":[{"type":"rich_text","block_id":"4U1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It wouldn’t really need a symbolics in base.\nIt can be implemented with thunks.\n"},{"type":"link","url":"https://en.wikipedia.org/wiki/Thunk"},{"type":"text","text":"\nI am surprise that "},{"type":"text","text":"Irational","style":{"code":true}},{"type":"text","text":"s are not already implemented with a function under the hood that is called to get their values."}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"47535ee1-eb9c-45ba-a5d8-ee124f08cf7c","type":"message","text":"changing the behavior would still be type piracy then, right?","user":"U0179G7FG4F","ts":"1608677728.123500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JJ+4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"changing the behavior would still be type piracy then, right?"}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"},{"client_msg_id":"a5eaec04-91d0-477e-bca0-a59b22f0156b","type":"message","text":"Yeah, definately.","user":"U6A936746","ts":"1608677947.123700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yzWz2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, definately."}]}]}],"thread_ts":"1608670623.111800","parent_user_id":"U695B1S2X"}]