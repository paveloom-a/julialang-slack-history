[{"client_msg_id":"21594fa0-5aef-4764-b8ed-4eb84db558d0","type":"message","text":"I’m looping over a bunch of `unsafe_wrap(Array,Ptr{UInt8}(pointer(A)),sizeof(A))` where A is some large `Array{Float32,N}` . However, I repeatedly kill my session after a few iterations, could it be that `unsafe_wrap` somehow triggers memory issues?","user":"UHZUXBR2P","ts":"1608218915.364700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"htN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m looping over a bunch of "},{"type":"text","text":"unsafe_wrap(Array,Ptr{UInt8}(pointer(A)),sizeof(A))","style":{"code":true}},{"type":"text","text":" where A is some large "},{"type":"text","text":"Array{Float32,N}","style":{"code":true}},{"type":"text","text":" . However, I repeatedly kill my session after a few iterations, could it be that "},{"type":"text","text":"unsafe_wrap","style":{"code":true}},{"type":"text","text":" somehow triggers memory issues?"}]}]}],"thread_ts":"1608218915.364700","reply_count":21,"reply_users_count":4,"latest_reply":"1608220961.369900","reply_users":["USU9FRPEU","UHZUXBR2P","U66SGEWAC","U01DD7Z0D89"],"subscribed":false},{"client_msg_id":"02629b62-9e5c-4cbe-94c1-2733b20ac672","type":"message","text":"You mean... that it is possibly... unsafe?","user":"USU9FRPEU","ts":"1608218951.364900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GJdez","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You mean... that it is possibly... unsafe?"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P","reactions":[{"name":"badum-tss-rimshot","users":["U01DD7Z0D89"],"count":1}]},{"client_msg_id":"831db3cb-3e9a-4482-8952-6b22d1ce5123","type":"message","text":"Yes, exactly :joy: But how can I reinterpret the bytes in an array as UInt8 in a safe way?","user":"UHZUXBR2P","ts":"1608218992.365200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/SnzP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, exactly "},{"type":"emoji","name":"joy"},{"type":"text","text":" But how can I reinterpret the bytes in an array as UInt8 in a safe way?"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"a213d121-18fe-49d6-a110-17c1073ef496","type":"message","text":"Use `reinterpret` ?","user":"USU9FRPEU","ts":"1608219008.365400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gov","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Use "},{"type":"text","text":"reinterpret","style":{"code":true}},{"type":"text","text":" ?"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"177cc8e1-79d0-4c49-901f-2ca89a381c6a","type":"message","text":"Not sure if that works... will check back in later","user":"USU9FRPEU","ts":"1608219029.365600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CvM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Not sure if that works... will check back in later"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"52064591-11cd-4526-9b67-7212f5ca301f","type":"message","text":"```julia&gt; A = rand(Float32,1000,1000);\n\njulia&gt; A8 = reinterpret.(UInt8,A)\nERROR: bitcast: argument size does not match size of target type```\nNope","user":"UHZUXBR2P","ts":"1608219055.365800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6DaM","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> A = rand(Float32,1000,1000);\n\njulia> A8 = reinterpret.(UInt8,A)\nERROR: bitcast: argument size does not match size of target type"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Nope"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"c4eab0f6-9c48-4b76-b419-f6c1b08b98d7","type":"message","text":"```reinterpret(UInt8,A)```\n","user":"U66SGEWAC","ts":"1608219084.366000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qFl1","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"reinterpret(UInt8,A)"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P","reactions":[{"name":"juliaspinner","users":["USU9FRPEU"],"count":1}]},{"client_msg_id":"7cc45c8c-494e-438f-b2dc-f21cdfe5366d","type":"message","text":"```A8 = vec(reinterpret(UInt8,A))\n4000000-element reshape(reinterpret(UInt8, ::Array{Float32,2}), 4000000) with eltype UInt8```\nThen I get a funny type that’s not suitable for further use in other functions …","user":"UHZUXBR2P","ts":"1608219253.366600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GIMb1","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"A8 = vec(reinterpret(UInt8,A))\n4000000-element reshape(reinterpret(UInt8, ::Array{Float32,2}), 4000000) with eltype UInt8"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Then I get a funny type that’s not suitable for further use in other functions …"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"d7f78375-3aee-4990-b7e9-d737e62100db","type":"message","text":"Sure, I can probably just copy that, but ideally I’d like to avoid copying the data around.","user":"UHZUXBR2P","ts":"1608219288.366800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gUCcg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Sure, I can probably just copy that, but ideally I’d like to avoid copying the data around."}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"f1bd00f5-4850-4cc8-b38a-beef2c4b9c22","type":"message","text":"What do you want in the end?","user":"USU9FRPEU","ts":"1608219318.367000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+ZfMv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What do you want in the end?"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"21a9379b-3005-4ea3-b4f3-226e587e4c14","type":"message","text":"`Vector{UInt8}`","user":"UHZUXBR2P","ts":"1608219361.367200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ph7ES","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Vector{UInt8}","style":{"code":true}}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"a2775567-952c-4547-abee-e47693b2683d","type":"message","text":"of what dimensions?","user":"USU9FRPEU","ts":"1608219427.367400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5FyS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"of what dimensions?"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"011e9d85-c30a-45eb-8c76-df9991126d8f","type":"message","text":"just unravelled whatever the input array `A` was. So `sizeof(A)`","user":"UHZUXBR2P","ts":"1608219477.367600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HbUgW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"just unravelled whatever the input array "},{"type":"text","text":"A","style":{"code":true}},{"type":"text","text":" was. So "},{"type":"text","text":"sizeof(A)","style":{"code":true}}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"f3215cc7-8f5e-4837-916d-5d88f7462e06","type":"message","text":"To reduce the nesting of types you can do\n```A8 = reinterpret(UInt8, vec(A))```","user":"U01DD7Z0D89","ts":"1608219482.367800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LWrfi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"To reduce the nesting of types you can do\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"A8 = reinterpret(UInt8, vec(A))"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"7b9ea084-cf5a-4b8b-841c-9ebfe9832a74","type":"message","text":"```julia&gt; typeof(A8)\nBase.ReinterpretArray{UInt8,1,Float32,Array{Float32,1}}```","user":"U01DD7Z0D89","ts":"1608219507.368000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=d6q","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> typeof(A8)\nBase.ReinterpretArray{UInt8,1,Float32,Array{Float32,1}}"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"28c4e77e-e7d3-469d-be92-ddf8f1f5ff90","type":"message","text":"Still a lazy wrapper, but it should be able to do whatever a `Vector{UInt8}` can do","user":"U01DD7Z0D89","ts":"1608219535.368200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RLJh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Still a lazy wrapper, but it should be able to do whatever a "},{"type":"text","text":"Vector{UInt8}","style":{"code":true}},{"type":"text","text":" can do"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"ba5e1ddc-9a3e-411f-8779-c688d26c18eb","type":"message","text":"```transcode(ZstdCompressorL10,A8)\nERROR: MethodError: no method matching transcode(::ZstdCompressor, ::Base.ReinterpretArray{UInt8,1,Float32,Array{Float32,1}})```\nNot a defined type for `transcode` either …","user":"UHZUXBR2P","ts":"1608219579.368400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"i6vU","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"transcode(ZstdCompressorL10,A8)\nERROR: MethodError: no method matching transcode(::ZstdCompressor, ::Base.ReinterpretArray{UInt8,1,Float32,Array{Float32,1}})"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Not a defined type for "},{"type":"text","text":"transcode","style":{"code":true}},{"type":"text","text":" either …"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"81c9dc76-9b89-46e9-a207-13679868e16a","type":"message","text":"I’ll go with `copy(reinterpret(UInt8,vec(A)))` for now… Thanks!","user":"UHZUXBR2P","ts":"1608219858.368600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KSUI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’ll go with "},{"type":"text","text":"copy(reinterpret(UInt8,vec(A)))","style":{"code":true}},{"type":"text","text":" for now… Thanks!"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"a3c864ad-9c76-4c55-b7cf-2e0e374bb7ae","type":"message","text":"Would be interesting to figure out why `unsafe_wrap` fails though. My guess is that you're accessing the wrapped array after its contents has been garbage collected because the original reference disappeared.","user":"U01DD7Z0D89","ts":"1608220731.369300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aMKo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Would be interesting to figure out why "},{"type":"text","text":"unsafe_wrap","style":{"code":true}},{"type":"text","text":" fails though. My guess is that you're accessing the wrapped array after its contents has been garbage collected because the original reference disappeared."}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"def70cfe-2940-43fd-9c2e-ee8711cc89a8","type":"message","text":"Did you try the following?\n```unsafe_wrap(Array,Ptr{UInt8}(pointer(A)),sizeof(A); own=true)```","user":"U01DD7Z0D89","ts":"1608220806.369500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LVAzp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Did you try the following?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"unsafe_wrap(Array,Ptr{UInt8}(pointer(A)),sizeof(A); own=true)"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"3cfb85f0-df9d-41cb-b860-fa4f38cd8b8c","type":"message","text":"Yeah, that doesn’t crash, but stalls for some reason?","user":"UHZUXBR2P","ts":"1608220826.369700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kabr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, that doesn’t crash, but stalls for some reason?"}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"ca5c9875-7c74-4850-a24d-bdf25de77325","type":"message","text":"Huh, that's weird. I'm afraid I'm out of my depth here. Glad you at least found something that works.","user":"U01DD7Z0D89","ts":"1608220961.369900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"W4c","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Huh, that's weird. I'm afraid I'm out of my depth here. Glad you at least found something that works."}]}]}],"thread_ts":"1608218915.364700","parent_user_id":"UHZUXBR2P","reactions":[{"name":"+1","users":["UHZUXBR2P"],"count":1}]}]