[{"client_msg_id":"492b9b90-781c-4fb8-a801-8462fed2c7c5","type":"message","text":"Can someone explain what `@inline` does in terms of compiler optimizations? I have a function very simple:\n```function get_transmission(t) \n    y1 = 0.02414 \n    y2 = 0.04025 \n    x1 = 0 \n    x2 = 157 \n    m = (y2 - y1) / (x2 - x1)\n    if t &lt; 157\n        return m*t + y1\n    else \n        return y2\n    end\nend```\nand this function is run many many times in a ODE solver i.e.\n```function aModel!(du, u, params, t)\n   val = get_transmission(t) \n   # continue solving ODE \nend\nsolve(aModel!, ...) ```\nNow, am I right in thinking that I should annotate this function with `@inline`?","user":"U6Z8377N2","ts":"1608058717.197000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0wyl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Can someone explain what "},{"type":"text","text":"@inline","style":{"code":true}},{"type":"text","text":" does in terms of compiler optimizations? I have a function very simple:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function get_transmission(t) \n    y1 = 0.02414 \n    y2 = 0.04025 \n    x1 = 0 \n    x2 = 157 \n    m = (y2 - y1) / (x2 - x1)\n    if t < 157\n        return m*t + y1\n    else \n        return y2\n    end\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"and this function is run many many times in a ODE solver i.e.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function aModel!(du, u, params, t)\n   val = get_transmission(t) \n   # continue solving ODE \nend\nsolve(aModel!, ...) "}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Now, am I right in thinking that I should annotate this function with "},{"type":"text","text":"@inline","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1608058717.197000","reply_count":11,"reply_users_count":4,"latest_reply":"1608061637.200600","reply_users":["U0179G7FG4F","U6Z8377N2","U7HAYKY9X","U6740K1SP"],"subscribed":false},{"client_msg_id":"cd219728-62ef-4bbe-a7b0-a0804a1e9f21","type":"message","text":"In general, the compiler is pretty good at figuring out when to inline on it's own. I would only use `@inline` if you have reason to believe the compiler isn't inlining something it should.","user":"U0179G7FG4F","ts":"1608058875.197100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iuDw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"In general, the compiler is pretty good at figuring out when to inline on it's own. I would only use "},{"type":"text","text":"@inline","style":{"code":true}},{"type":"text","text":" if you have reason to believe the compiler isn't inlining something it should."}]}]}],"thread_ts":"1608058717.197000","parent_user_id":"U6Z8377N2","reactions":[{"name":"correct_answer","users":["U6740K1SP"],"count":1}]},{"client_msg_id":"9a1a9ddd-1099-4f21-ab22-95fce026c345","type":"message","text":"But what does inlining actually do? Does it basically copy and paste the function body in to the calling function to prevent a function call?","user":"U6Z8377N2","ts":"1608058967.197300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eD11Y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But what does inlining actually do? Does it basically copy and paste the function body in to the calling function to prevent a function call?"}]}]}],"thread_ts":"1608058717.197000","parent_user_id":"U6Z8377N2","reactions":[{"name":"+1","users":["U0179G7FG4F"],"count":1}]},{"client_msg_id":"2479f3c7-bab6-4b69-b3aa-52732d659f13","type":"message","text":"Why is it important to know when to inline and when not to?","user":"U6Z8377N2","ts":"1608058970.197500","team":"T68168MUP","edited":{"user":"U6Z8377N2","ts":"1608058988.000000"},"blocks":[{"type":"rich_text","block_id":"IpSnx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Why is it important to know when to inline and when not to?"}]}]}],"thread_ts":"1608058717.197000","parent_user_id":"U6Z8377N2"},{"client_msg_id":"50061dbd-af55-4e60-b9d7-a9c42860bb1b","type":"message","text":"function calls take time. Thus for simple functions, inlining can make things several times faster. For more expensive functions, it's no effect to negative","user":"U0179G7FG4F","ts":"1608059060.197900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6cV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"function calls take time. Thus for simple functions, inlining can make things several times faster. For more expensive functions, it's no effect to negative"}]}]}],"thread_ts":"1608058717.197000","parent_user_id":"U6Z8377N2"},{"client_msg_id":"dc1e07ae-d901-4e40-89ba-a8a12cf96ba5","type":"message","text":"since copy pasting increases compile times and makes the cpu load more code which takes time and memory","user":"U0179G7FG4F","ts":"1608059095.198100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NiS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"since copy pasting increases compile times and makes the cpu load more code which takes time and memory"}]}]}],"thread_ts":"1608058717.197000","parent_user_id":"U6Z8377N2"},{"client_msg_id":"2d7a0782-9b2f-4b86-801e-616695cbc91a","type":"message","text":"benchmarking function call times in julia is kind of difficult though because julia is really good at inlining. That's one of the main cases in which Julia is faster than C. C semantics make inlining much harder.","user":"U0179G7FG4F","ts":"1608059189.198300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"e/w","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"benchmarking function call times in julia is kind of difficult though because julia is really good at inlining. That's one of the main cases in which Julia is faster than C. C semantics make inlining much harder."}]}]}],"thread_ts":"1608058717.197000","parent_user_id":"U6Z8377N2"},{"client_msg_id":"689021f1-b47a-4650-8744-e08e865fcfc6","type":"message","text":"Another important aspect of inclining is that if A I'd inlined in B, A and B can be optimized together such that some of the computations in A or B may be simplified","user":"U7HAYKY9X","ts":"1608060264.198500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GrDSK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Another important aspect of inclining is that if A I'd inlined in B, A and B can be optimized together such that some of the computations in A or B may be simplified"}]}]}],"thread_ts":"1608058717.197000","parent_user_id":"U6Z8377N2","reactions":[{"name":"+1","users":["U0179G7FG4F","U8D9768Q6","U6740K1SP","U7THT3TM3"],"count":4}]},{"client_msg_id":"5a660f56-d428-44c7-bdb1-bf58d5149ac1","type":"message","text":"Note that `get_transmission` as you’ve written it is “small enough” that julia automatically inlines it in most situations","user":"U6740K1SP","ts":"1608061541.199600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"q1RM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Note that "},{"type":"text","text":"get_transmission","style":{"code":true}},{"type":"text","text":" as you’ve written it is “small enough” that julia automatically inlines it in most situations"}]}]}],"thread_ts":"1608058717.197000","parent_user_id":"U6Z8377N2"},{"client_msg_id":"06a0b6bb-fd70-426c-a962-3276b8019c84","type":"message","text":"Which means that, for example:\n```julia&gt; g() = get_transmission(123)\ng (generic function with 1 method)\n\njulia&gt; @code_typed g()\nCodeInfo(\n1 ─     return 0.036761210191082805\n) =&gt; Float64```","user":"U6740K1SP","ts":"1608061558.200000","team":"T68168MUP","edited":{"user":"U6740K1SP","ts":"1608061577.000000"},"blocks":[{"type":"rich_text","block_id":"lQg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Which means that, for example:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> g() = get_transmission(123)\ng (generic function with 1 method)\n\njulia> @code_typed g()\nCodeInfo(\n1 ─     return 0.036761210191082805\n) => Float64"}]}]}],"thread_ts":"1608058717.197000","parent_user_id":"U6Z8377N2"},{"client_msg_id":"9f3b0e11-405a-457f-a5f2-733b8ac96359","type":"message","text":"That is, it can perform constant propagation and simply hard-code the answer","user":"U6740K1SP","ts":"1608061613.200400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wl=1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That is, it can perform constant propagation and simply hard-code the answer"}]}]}],"thread_ts":"1608058717.197000","parent_user_id":"U6Z8377N2"},{"client_msg_id":"463bab80-a015-4fed-a64e-f17ef454bf1d","type":"message","text":"since the argument was a constant","user":"U6740K1SP","ts":"1608061637.200600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"e48yn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"since the argument was a constant"}]}]}],"thread_ts":"1608058717.197000","parent_user_id":"U6Z8377N2"}]