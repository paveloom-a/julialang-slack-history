[{"client_msg_id":"264a6b57-6bd4-4533-b998-9965c303e9d7","type":"message","text":"Going for the straightforward `g = gradient(model-&gt;gradient(x-&gt;loss(model, x), x) |&gt; sum, model)` leads to an `Mutating arrays is not supported` error","user":"UBGQUAG8K","ts":"1615833260.146400","team":"T68168MUP","edited":{"user":"UBGQUAG8K","ts":"1615833345.000000"},"blocks":[{"type":"rich_text","block_id":"=zd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Going for the straightforward "},{"type":"text","text":"g = gradient(model->gradient(x->loss(model, x), x) |> sum, model)","style":{"code":true}},{"type":"text","text":" leads to an "},{"type":"text","text":"Mutating arrays is not supported","style":{"code":true}},{"type":"text","text":" error"}]}]}],"thread_ts":"1615833260.146400","reply_count":7,"reply_users_count":2,"latest_reply":"1615837053.148200","reply_users":["U6YRZ18GZ","UBGQUAG8K"],"is_locked":false,"subscribed":false},{"client_msg_id":"5dbbf6f0-bd59-4006-92b8-7a442431e9aa","type":"message","text":"You need to ensure that the pullbacks do not contain mutations, which unfortunately logitcrossentropy does. I have to rewrite it such that it does not.","user":"U6YRZ18GZ","ts":"1615835786.147000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"y1YI/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You need to ensure that the pullbacks do not contain mutations, which unfortunately logitcrossentropy does. I have to rewrite it such that it does not."}]}]}],"thread_ts":"1615833260.146400","parent_user_id":"UBGQUAG8K"},{"client_msg_id":"d84055dd-6c93-4247-a374-9a1ee3f466ff","type":"message","text":"It is tricky to make it work. You need to ensure that all gradients are differentiable.","user":"U6YRZ18GZ","ts":"1615835854.147200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bh1yC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It is tricky to make it work. You need to ensure that all gradients are differentiable."}]}]}],"thread_ts":"1615833260.146400","parent_user_id":"UBGQUAG8K"},{"client_msg_id":"df38e6df-cf7a-4d06-9e03-c811603b2a96","type":"message","text":"I guess that your problem will be line 62 of <https://github.com/FluxML/NNlib.jl/blob/master/src/softmax.jl> which dispatches to mutating version.","user":"U6YRZ18GZ","ts":"1615835969.147400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7P/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I guess that your problem will be line 62 of "},{"type":"link","url":"https://github.com/FluxML/NNlib.jl/blob/master/src/softmax.jl"},{"type":"text","text":" which dispatches to mutating version."}]}]}],"thread_ts":"1615833260.146400","parent_user_id":"UBGQUAG8K"},{"client_msg_id":"f6bcbe09-ece0-4020-a8e2-7395838baef9","type":"message","text":"oh thanks for the feedback. so actually i was losing my own loss function, but i dont think it was mutating in any way (also just the gradient worked)","user":"UBGQUAG8K","ts":"1615836909.147600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TrKsK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh thanks for the feedback. so actually i was losing my own loss function, but i dont think it was mutating in any way (also just the gradient worked)"}]}]}],"thread_ts":"1615833260.146400","parent_user_id":"UBGQUAG8K"},{"client_msg_id":"5405d4bf-feed-47da-a55d-243da195a4c2","type":"message","text":"but its good to know that it should work","user":"UBGQUAG8K","ts":"1615836985.147800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bGo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but its good to know that it should work"}]}]}],"thread_ts":"1615833260.146400","parent_user_id":"UBGQUAG8K"},{"client_msg_id":"1a07022a-bc5a-4303-805a-f3d79d0a1aca","type":"message","text":"When I was debugging second order gradient, I went literatlly function by function and checking that gradients are possible. Many functions in NNlib are unfortunately written to not support second order gradients, as they have efficient implementation, which clashes","user":"U6YRZ18GZ","ts":"1615837016.148000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xlmAa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"When I was debugging second order gradient, I went literatlly function by function and checking that gradients are possible. Many functions in NNlib are unfortunately written to not support second order gradients, as they have efficient implementation, which clashes"}]}]}],"thread_ts":"1615833260.146400","parent_user_id":"UBGQUAG8K"},{"client_msg_id":"13e2f389-3047-47cc-8756-4ddd70ae3144","type":"message","text":"But it works, I can assure you, just really test your model piece by piece (in the sense of building blocks).","user":"U6YRZ18GZ","ts":"1615837053.148200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KQ0E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But it works, I can assure you, just really test your model piece by piece (in the sense of building blocks)."}]}]}],"thread_ts":"1615833260.146400","parent_user_id":"UBGQUAG8K"}]