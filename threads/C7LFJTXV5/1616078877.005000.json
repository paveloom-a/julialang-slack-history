[{"type":"message","text":"Getting this error when I try to remove weights below some certain threshold.","files":[{"id":"F01RHFU1TQW","created":1616078785,"timestamp":1616078785,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"U01FTFACYJ0","editable":false,"size":34595,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01RHFU1TQW/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01RHFU1TQW/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01RHFU1TQW-41049cb3c4/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01RHFU1TQW-41049cb3c4/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01RHFU1TQW-41049cb3c4/image_360.png","thumb_360_w":360,"thumb_360_h":31,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01RHFU1TQW-41049cb3c4/image_480.png","thumb_480_w":480,"thumb_480_h":42,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01RHFU1TQW-41049cb3c4/image_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01RHFU1TQW-41049cb3c4/image_720.png","thumb_720_w":720,"thumb_720_h":63,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01RHFU1TQW-41049cb3c4/image_800.png","thumb_800_w":800,"thumb_800_h":70,"thumb_960":"https://files.slack.com/files-tmb/T68168MUP-F01RHFU1TQW-41049cb3c4/image_960.png","thumb_960_w":960,"thumb_960_h":84,"thumb_1024":"https://files.slack.com/files-tmb/T68168MUP-F01RHFU1TQW-41049cb3c4/image_1024.png","thumb_1024_w":1024,"thumb_1024_h":90,"original_w":1589,"original_h":139,"thumb_tiny":"AwAEADClRSCloGJSUUUCCiiigD//2Q==","permalink":"https://julialang.slack.com/files/U01FTFACYJ0/F01RHFU1TQW/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01RHFU1TQW-4df4efc334","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"otf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Getting this error when I try to remove weights below some certain threshold."}]}]}],"user":"U01FTFACYJ0","display_as_bot":false,"ts":"1616078877.005000","thread_ts":"1616078877.005000","reply_count":14,"reply_users_count":3,"latest_reply":"1616091444.008600","reply_users":["U01FTFACYJ0","UC4QQPG4A","U68A3ASP9"],"subscribed":false},{"type":"message","text":"the problem is in line 56, how can I resolve ?","files":[{"id":"F01RQFX4BB5","created":1616078905,"timestamp":1616078905,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"U01FTFACYJ0","editable":false,"size":40938,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01RQFX4BB5/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01RQFX4BB5/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01RQFX4BB5-e327929597/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01RQFX4BB5-e327929597/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01RQFX4BB5-e327929597/image_360.png","thumb_360_w":360,"thumb_360_h":111,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01RQFX4BB5-e327929597/image_480.png","thumb_480_w":480,"thumb_480_h":148,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01RQFX4BB5-e327929597/image_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01RQFX4BB5-e327929597/image_720.png","thumb_720_w":720,"thumb_720_h":221,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01RQFX4BB5-e327929597/image_800.png","thumb_800_w":800,"thumb_800_h":246,"original_w":862,"original_h":265,"thumb_tiny":"AwAOADCj3p3HtTe9GaAHHH0pv4ikooAKKKKAP//Z","permalink":"https://julialang.slack.com/files/U01FTFACYJ0/F01RQFX4BB5/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01RQFX4BB5-519b405bcc","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"2ID4w","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the problem is in line 56, how can I resolve ?"}]}]}],"user":"U01FTFACYJ0","display_as_bot":false,"ts":"1616078918.005300","thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"client_msg_id":"0bca74a3-1a6f-4721-9405-a0972ab4a304","type":"message","text":"This is usually because an intermediate is not on the gpu. <@U68A3ASP9> do you think this case can be handled in CUDA?","user":"UC4QQPG4A","ts":"1616080011.005700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ri=7z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is usually because an intermediate is not on the gpu. "},{"type":"user","user_id":"U68A3ASP9"},{"type":"text","text":" do you think this case can be handled in CUDA?"}]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"client_msg_id":"5d4755db-7a28-4716-a4ff-c0b0f4a24985","type":"message","text":"yes but I am not sure how to do that","user":"U01FTFACYJ0","ts":"1616080295.005900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"AfGr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yes but I am not sure how to do that"}]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"client_msg_id":"2a2b852b-bc7b-4657-a1fd-9b43b294dc5d","type":"message","text":"the view's indices should be uploaded when the view is created: <https://github.com/JuliaGPU/CUDA.jl/blob/e3d9720f5527613637c01af0f42940cec8987164/src/array.jl#L407>","user":"U68A3ASP9","ts":"1616080508.006100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3GPw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the view's indices should be uploaded when the view is created: "},{"type":"link","url":"https://github.com/JuliaGPU/CUDA.jl/blob/e3d9720f5527613637c01af0f42940cec8987164/src/array.jl#L407"}]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"client_msg_id":"645f8ff0-4cd1-444d-9edc-ed6232b9b80d","type":"message","text":"sorry but I am not very proficient with julia, can you be more clear please ?","user":"U01FTFACYJ0","ts":"1616080634.006300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QLcn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"sorry but I am not very proficient with julia, can you be more clear please ?"}]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"client_msg_id":"2c191abf-0ddb-4083-99aa-31a0c04dee9b","type":"message","text":"<@UC4QQPG4A> e.g.\n```julia\njulia&gt; a = CUDA.rand(2,2)\n2×2 CuArray{Float32, 2}:\n 0.142323  0.696472\n 0.625525  0.706091\n\njulia&gt; dump(view(a, [CartesianIndex(1,1)]))\nSubArray{Float32, 1, CuArray{Float32, 2}, Tuple{CuArray{CartesianIndex{2}, 1}}, false}\n  parent: CuArray{Float32, 2}\n    baseptr: CuPtr{Nothing} CuPtr{Nothing}(0x0000000302000200)\n    offset: Int64 0\n    dims: Tuple{Int64, Int64}\n      1: Int64 2\n      2: Int64 2\n    state: CUDA.ArrayState CUDA.ARRAY_MANAGED\n    ctx: CuContext\n      handle: Ptr{Nothing} @0x0000000002944d30\n  indices: Tuple{CuArray{CartesianIndex{2}, 1}}\n    1: CuArray{CartesianIndex{2}, 1}\n      baseptr: CuPtr{Nothing} CuPtr{Nothing}(0x0000000302000400)\n      offset: Int64 0\n      dims: Tuple{Int64}\n        1: Int64 1\n      state: CUDA.ArrayState CUDA.ARRAY_MANAGED\n      ctx: CuContext\n        handle: Ptr{Nothing} @0x0000000002944d30\n  offset1: Int64 0\n  stride1: Int64 0```\nno Array in there, so is Flux constructing a SubArray directly?","user":"U68A3ASP9","ts":"1616080702.006500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pZ+","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UC4QQPG4A"},{"type":"text","text":" e.g.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia\njulia> a = CUDA.rand(2,2)\n2×2 CuArray{Float32, 2}:\n 0.142323  0.696472\n 0.625525  0.706091\n\njulia> dump(view(a, [CartesianIndex(1,1)]))\nSubArray{Float32, 1, CuArray{Float32, 2}, Tuple{CuArray{CartesianIndex{2}, 1}}, false}\n  parent: CuArray{Float32, 2}\n    baseptr: CuPtr{Nothing} CuPtr{Nothing}(0x0000000302000200)\n    offset: Int64 0\n    dims: Tuple{Int64, Int64}\n      1: Int64 2\n      2: Int64 2\n    state: CUDA.ArrayState CUDA.ARRAY_MANAGED\n    ctx: CuContext\n      handle: Ptr{Nothing} @0x0000000002944d30\n  indices: Tuple{CuArray{CartesianIndex{2}, 1}}\n    1: CuArray{CartesianIndex{2}, 1}\n      baseptr: CuPtr{Nothing} CuPtr{Nothing}(0x0000000302000400)\n      offset: Int64 0\n      dims: Tuple{Int64}\n        1: Int64 1\n      state: CUDA.ArrayState CUDA.ARRAY_MANAGED\n      ctx: CuContext\n        handle: Ptr{Nothing} @0x0000000002944d30\n  offset1: Int64 0\n  stride1: Int64 0"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"no Array in there, so is Flux constructing a SubArray directly?"}]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"client_msg_id":"9c732dfd-3c17-4ab5-8280-4ac969ccd5a3","type":"message","text":"Adapt.jl (i.e. `cu`) also works properly:\n```julia\njulia&gt; a = rand(2,2)\n2×2 Matrix{Float64}:\n 0.574043  0.292029\n 0.25167   0.513833\n\njulia&gt; dump(cu(view(a, [CartesianIndex(1,1)])))\nSubArray{Float64, 1, CuArray{Float32, 2}, Tuple{CuArray{CartesianIndex{2}, 1}}, false}\n  parent: CuArray{Float32, 2}\n    baseptr: CuPtr{Nothing} CuPtr{Nothing}(0x0000000302000200)\n    offset: Int64 0\n    dims: Tuple{Int64, Int64}\n      1: Int64 2\n      2: Int64 2\n    state: CUDA.ArrayState CUDA.ARRAY_MANAGED\n    ctx: CuContext\n      handle: Ptr{Nothing} @0x0000000002944d30\n  indices: Tuple{CuArray{CartesianIndex{2}, 1}}\n    1: CuArray{CartesianIndex{2}, 1}\n      baseptr: CuPtr{Nothing} CuPtr{Nothing}(0x0000000302000400)\n      offset: Int64 0\n      dims: Tuple{Int64}\n        1: Int64 1\n      state: CUDA.ArrayState CUDA.ARRAY_MANAGED\n      ctx: CuContext\n        handle: Ptr{Nothing} @0x0000000002944d30\n  offset1: Int64 0\n  stride1: Int64 0```\nso I fail to see where this `SubArray{CuArray, Array}` came from","user":"U68A3ASP9","ts":"1616080745.006700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7wUHr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Adapt.jl (i.e. "},{"type":"text","text":"cu","style":{"code":true}},{"type":"text","text":") also works properly:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia\njulia> a = rand(2,2)\n2×2 Matrix{Float64}:\n 0.574043  0.292029\n 0.25167   0.513833\n\njulia> dump(cu(view(a, [CartesianIndex(1,1)])))\nSubArray{Float64, 1, CuArray{Float32, 2}, Tuple{CuArray{CartesianIndex{2}, 1}}, false}\n  parent: CuArray{Float32, 2}\n    baseptr: CuPtr{Nothing} CuPtr{Nothing}(0x0000000302000200)\n    offset: Int64 0\n    dims: Tuple{Int64, Int64}\n      1: Int64 2\n      2: Int64 2\n    state: CUDA.ArrayState CUDA.ARRAY_MANAGED\n    ctx: CuContext\n      handle: Ptr{Nothing} @0x0000000002944d30\n  indices: Tuple{CuArray{CartesianIndex{2}, 1}}\n    1: CuArray{CartesianIndex{2}, 1}\n      baseptr: CuPtr{Nothing} CuPtr{Nothing}(0x0000000302000400)\n      offset: Int64 0\n      dims: Tuple{Int64}\n        1: Int64 1\n      state: CUDA.ArrayState CUDA.ARRAY_MANAGED\n      ctx: CuContext\n        handle: Ptr{Nothing} @0x0000000002944d30\n  offset1: Int64 0\n  stride1: Int64 0"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"so I fail to see where this "},{"type":"text","text":"SubArray{CuArray, Array}","style":{"code":true}},{"type":"text","text":" came from"}]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"client_msg_id":"7749818f-430c-46b7-99fa-e0640161d6e4","type":"message","text":"Simpler case that I think this is hitting is\n```julia&gt; r = rand(Float32, 3,3) |&gt; cu\n3×3 CuArray{Float32,2}:\n 0.693362   0.715953  0.940764\n 0.0584831  0.932286  0.782409\n 0.138806   0.522476  0.879568\n\njulia&gt; r[r .&lt; 0.5] .= 0.f0\nERROR: GPU compilation of kernel broadcast_kernel(CUDA.CuKernelContext, SubArray{Float32,1,CuDeviceArray{Float32,2,1},Tuple{Array{\nCartesianIndex{2},1}},false}, Base.Broadcast.Broadcasted{Nothing,Tuple{Base.OneTo{Int64}},typeof(identity),Tuple{Float32}}, Int64)\n failed\nKernelError: passing and using non-bitstype argument\n\nArgument 3 to your kernel function is of type SubArray{Float32,1,CuDeviceArray{Float32,2,1},Tuple{Array{CartesianIndex{2},1}},fals\ne}, which is not isbits:\n  .indices is of type Tuple{Array{CartesianIndex{2},1}} which is not isbits.\n    .1 is of type Array{CartesianIndex{2},1} which is not isbits.```\n","user":"UC4QQPG4A","ts":"1616080965.006900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Re3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Simpler case that I think this is hitting is\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> r = rand(Float32, 3,3) |> cu\n3×3 CuArray{Float32,2}:\n 0.693362   0.715953  0.940764\n 0.0584831  0.932286  0.782409\n 0.138806   0.522476  0.879568\n\njulia> r[r .< 0.5] .= 0.f0\nERROR: GPU compilation of kernel broadcast_kernel(CUDA.CuKernelContext, SubArray{Float32,1,CuDeviceArray{Float32,2,1},Tuple{Array{\nCartesianIndex{2},1}},false}, Base.Broadcast.Broadcasted{Nothing,Tuple{Base.OneTo{Int64}},typeof(identity),Tuple{Float32}}, Int64)\n failed\nKernelError: passing and using non-bitstype argument\n\nArgument 3 to your kernel function is of type SubArray{Float32,1,CuDeviceArray{Float32,2,1},Tuple{Array{CartesianIndex{2},1}},fals\ne}, which is not isbits:\n  .indices is of type Tuple{Array{CartesianIndex{2},1}} which is not isbits.\n    .1 is of type Array{CartesianIndex{2},1} which is not isbits."}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"client_msg_id":"c9faef32-5e1b-48c4-b43b-f586bc021d03","type":"message","text":"Just masking works fine by itself\n```julia&gt; r .&lt; 0.5\n3×3 CuArray{Bool,2}:\n 0  0  0\n 1  0  0\n 1  0  0```\n","user":"UC4QQPG4A","ts":"1616080991.007100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ujS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Just masking works fine by itself\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> r .< 0.5\n3×3 CuArray{Bool,2}:\n 0  0  0\n 1  0  0\n 1  0  0"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"client_msg_id":"d8272219-040d-4f72-98f0-05e42cab43c8","type":"message","text":"works on CUDA.jl#master, so this is fixed already","user":"U68A3ASP9","ts":"1616081012.007300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iGS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"works on CUDA.jl#master, so this is fixed already"}]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0","reactions":[{"name":"party_parrot","users":["UC4QQPG4A"],"count":1},{"name":"heart","users":["UC4QQPG4A"],"count":1}]},{"client_msg_id":"51fb9664-983f-4714-aee5-6a730f84ebb3","type":"message","text":"Nice!","user":"UC4QQPG4A","ts":"1616081109.007500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1hwUh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Nice!"}]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"client_msg_id":"06917fa6-7fa4-4996-bf09-82ffb19cdfb6","type":"message","text":"got it","user":"U01FTFACYJ0","ts":"1616081636.007900","team":"T68168MUP","edited":{"user":"U01FTFACYJ0","ts":"1616082121.000000"},"blocks":[{"type":"rich_text","block_id":"pbDdn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"got it"}]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"type":"message","text":"I fixed the problem using cu() , but now delete!() doenst work, it does not have effect on the model params, in fact when I print these params they should all be equal to zero but they are not.","files":[{"id":"F01RRFP19T4","created":1616091409,"timestamp":1616091409,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"U01FTFACYJ0","editable":false,"size":50790,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01RRFP19T4/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01RRFP19T4/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01RRFP19T4-89cbbb574c/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01RRFP19T4-89cbbb574c/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01RRFP19T4-89cbbb574c/image_360.png","thumb_360_w":360,"thumb_360_h":125,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01RRFP19T4-89cbbb574c/image_480.png","thumb_480_w":480,"thumb_480_h":166,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01RRFP19T4-89cbbb574c/image_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01RRFP19T4-89cbbb574c/image_720.png","thumb_720_w":720,"thumb_720_h":249,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01RRFP19T4-89cbbb574c/image_800.png","thumb_800_w":800,"thumb_800_h":277,"original_w":921,"original_h":319,"thumb_tiny":"AwAQADCj3p1NoNADjj1pvHqaSigBePWkoooA/9k=","permalink":"https://julialang.slack.com/files/U01FTFACYJ0/F01RRFP19T4/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01RRFP19T4-a1fa4fa7c4","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"Wiyiu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I fixed the problem using cu() , but now delete!() doenst work, it does not have effect on the model params, in fact when I print these params they should all be equal to zero but they are not."}]}]}],"user":"U01FTFACYJ0","display_as_bot":false,"ts":"1616091426.008200","thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"},{"client_msg_id":"e52258d7-8e5c-43c8-bae3-af48089ad628","type":"message","text":"the same code on cpu worked well","user":"U01FTFACYJ0","ts":"1616091444.008600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vyA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the same code on cpu worked well"}]}]}],"thread_ts":"1616078877.005000","parent_user_id":"U01FTFACYJ0"}]