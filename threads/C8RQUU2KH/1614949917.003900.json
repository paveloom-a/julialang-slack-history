[{"client_msg_id":"2e8fca0d-4250-4a19-8285-2fe41ff36519","type":"message","text":"I have some CairoMakie plots saved as pdf on CI. This worked fine a month a go. But re-running the same job now gives an error: It wants ImageMagick to be added manually.\n\nAfter adding ImageMagick I get …","user":"U836PQXSN","ts":"1614949917.003900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"832za","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have some CairoMakie plots saved as pdf on CI. This worked fine a month a go. But re-running the same job now gives an error: It wants ImageMagick to be added manually.\n\nAfter adding ImageMagick I get …"}]}]}],"thread_ts":"1614949917.003900","reply_count":17,"reply_users_count":4,"latest_reply":"1614954072.010200","reply_users":["U836PQXSN","U66SGEWAC","UK1BNFHFV","UC8821DPY"],"subscribed":false},{"client_msg_id":"242e5cee-c13e-4845-ac82-dd7c085b3d6c","type":"message","text":"``` Warning: Mapping to the storage type failed; perhaps your data had out-of-range values?\n537│ Try `map(clamp01nan, img)` to clamp values to a valid range.\n538└ @ ImageMagick ~/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:180\n539Errors encountered while save FileIO.File{FileIO.DataFormat{:PDF},String}(\"/builds/drechsel-grau-greimel/InequalityDebtEmpirics/plots/irf-hpi.pdf\").\n540All errors:\n541===========================================\n542ImageMagick writer error: neither save nor fileio_save is defined\n543  due to MethodError(ImageMagick.mapIM, (AbstractPlotting.Combined{AbstractPlotting.poly,Tuple{Array{Array{GeometryBasics.Point{2,Float32},1},1}}},), 0x0000000000006e9f)\n544  Will try next loader.\n545===========================================\n546ArgumentError: Argument does not support conversion to pdf.\n547===========================================\n548Fatal error:\n549ERROR: LoadError: LoadError: ImageMagick writer error: neither save nor fileio_save is defined\n550  due to MethodError(ImageMagick.mapIM, (AbstractPlotting.Combined{AbstractPlotting.poly,Tuple{Array{Array{GeometryBasics.Point{2,Float32},1},1}}},), 0x0000000000006e9f)\n551  Will try next loader.\n552(::ImageMagick.var\"#42#43\"{typeof(identity)})(::AbstractPlotting.Combined{AbstractPlotting.poly,Tuple{Array{Array{GeometryBasics.Point{2,Float32},1},1}}}) at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:178\n553iterate at ./generator.jl:47 [inlined]\n554collect(::Base.Generator{AbstractPlotting.Scene,ImageMagick.var\"#42#43\"{typeof(identity)}}) at ./array.jl:686\n555map(::Function, ::AbstractPlotting.Scene) at ./abstractarray.jl:2188\n556image2wand(::Any, ::typeof(identity), ::Nothing, ::Bool; kwargs::Base.Iterators.Pairs{Union{},Union{},Tuple{},NamedTuple{(),Tuple{}}}) at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:178\n557image2wand at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:176 [inlined]\n558#save_#39 at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:163 [inlined]\n559save_ at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:163 [inlined] (repeats 2 times)\n560save(::FileIO.File{var\"#s21\",Name} where Name where var\"#s21\"&lt;:FileIO.DataFormat, ::Any; key_args::Base.Iterators.Pairs{Union{},Union{},Tuple{},NamedTuple{(),Tuple{}}}) at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:127\n561save(::FileIO.File{var\"#s21\",Name} where Name where var\"#s21\"&lt;:FileIO.DataFormat, ::Any) at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:127```","user":"U836PQXSN","ts":"1614949932.004000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7AmE","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":" Warning: Mapping to the storage type failed; perhaps your data had out-of-range values?\n537│ Try `map(clamp01nan, img)` to clamp values to a valid range.\n538└ @ ImageMagick ~/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:180\n539Errors encountered while save FileIO.File{FileIO.DataFormat{:PDF},String}(\"/builds/drechsel-grau-greimel/InequalityDebtEmpirics/plots/irf-hpi.pdf\").\n540All errors:\n541===========================================\n542ImageMagick writer error: neither save nor fileio_save is defined\n543  due to MethodError(ImageMagick.mapIM, (AbstractPlotting.Combined{AbstractPlotting.poly,Tuple{Array{Array{GeometryBasics.Point{2,Float32},1},1}}},), 0x0000000000006e9f)\n544  Will try next loader.\n545===========================================\n546ArgumentError: Argument does not support conversion to pdf.\n547===========================================\n548Fatal error:\n549ERROR: LoadError: LoadError: ImageMagick writer error: neither save nor fileio_save is defined\n550  due to MethodError(ImageMagick.mapIM, (AbstractPlotting.Combined{AbstractPlotting.poly,Tuple{Array{Array{GeometryBasics.Point{2,Float32},1},1}}},), 0x0000000000006e9f)\n551  Will try next loader.\n552(::ImageMagick.var\"#42#43\"{typeof(identity)})(::AbstractPlotting.Combined{AbstractPlotting.poly,Tuple{Array{Array{GeometryBasics.Point{2,Float32},1},1}}}) at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:178\n553iterate at ./generator.jl:47 [inlined]\n554collect(::Base.Generator{AbstractPlotting.Scene,ImageMagick.var\"#42#43\"{typeof(identity)}}) at ./array.jl:686\n555map(::Function, ::AbstractPlotting.Scene) at ./abstractarray.jl:2188\n556image2wand(::Any, ::typeof(identity), ::Nothing, ::Bool; kwargs::Base.Iterators.Pairs{Union{},Union{},Tuple{},NamedTuple{(),Tuple{}}}) at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:178\n557image2wand at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:176 [inlined]\n558#save_#39 at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:163 [inlined]\n559save_ at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:163 [inlined] (repeats 2 times)\n560save(::FileIO.File{var\"#s21\",Name} where Name where var\"#s21\"<:FileIO.DataFormat, ::Any; key_args::Base.Iterators.Pairs{Union{},Union{},Tuple{},NamedTuple{(),Tuple{}}}) at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:127\n561save(::FileIO.File{var\"#s21\",Name} where Name where var\"#s21\"<:FileIO.DataFormat, ::Any) at /root/.julia/packages/ImageMagick/mNZBN/src/ImageMagick.jl:127"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"3f121242-acb5-4d9f-a93f-7df5dbcb8124","type":"message","text":"It works fine locally. I’ve pinned AbstractPlotting to 0.14.","user":"U836PQXSN","ts":"1614949959.004200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xNx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It works fine locally. I’ve pinned AbstractPlotting to 0.14."}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"fa586139-e00b-487d-9d71-d8d262b36444","type":"message","text":"Any ideas what’s going wrong?","user":"U836PQXSN","ts":"1614949978.004400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ekya","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Any ideas what’s going wrong?"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"36dc7d8b-c002-46a4-a920-ea0c0a7e2bdb","type":"message","text":"You need to pin FileIO to 1.5 ...","user":"U66SGEWAC","ts":"1614949992.004600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TgoH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You need to pin FileIO to 1.5 ..."}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"eec4d7d0-8474-49a2-a71c-f9019549199d","type":"message","text":"I think we're seeing FileIO related failures currently, because of the 1.6 update","user":"UK1BNFHFV","ts":"1614949993.004800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XM+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think we're seeing FileIO related failures currently, because of the 1.6 update"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"196caef0-6265-4dca-af7f-910e5a3bbf92","type":"message","text":"what went on there actually?","user":"UK1BNFHFV","ts":"1614950008.005000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nKa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what went on there actually?"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"69b34751-756c-40d6-9cc8-3db73bc17c6e","type":"message","text":"if it was tagged non-breaking","user":"UK1BNFHFV","ts":"1614950016.005200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DfUJY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if it was tagged non-breaking"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"e4b252ed-8a97-41c1-9be9-542b29d6c810","type":"message","text":"thanks! I’ll try that","user":"U836PQXSN","ts":"1614950017.005400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YNYWM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks! I’ll try that"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"2224b89e-6549-4336-9fc5-6ad549321a88","type":"message","text":"<@UC8821DPY> did an amazing rewrite and cleaned up lots of terrible tech debt :smile: It was supposed to be non breaking, but I guess there are a few packages using internal FileIO interfaces, which is getting shaken out now... May also simply be related to not having enough test coverage","user":"U66SGEWAC","ts":"1614950079.005600","team":"T68168MUP","edited":{"user":"U66SGEWAC","ts":"1614950181.000000"},"blocks":[{"type":"rich_text","block_id":"rRAj","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UC8821DPY"},{"type":"text","text":" did an amazing rewrite and cleaned up lots of terrible tech debt "},{"type":"emoji","name":"smile"},{"type":"text","text":" It was supposed to be non breaking, but I guess there are a few packages using internal FileIO interfaces, which is getting shaken out now... May also simply be related to not having enough test coverage"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"54c86738-d666-493b-822e-703561043965","type":"message","text":"the initial Makie failure was due to removing shader extensions from FileIO, since they weren't really used in GLMakie..But I forgot that they were actually used in one location where it was totally unecessary and purely historical :smile:","user":"U66SGEWAC","ts":"1614950157.005800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7Wo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the initial Makie failure was due to removing shader extensions from FileIO, since they weren't really used in GLMakie..But I forgot that they were actually used in one location where it was totally unecessary and purely historical "},{"type":"emoji","name":"smile"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"cf869386-9eda-4794-ad5c-a455af700dc4","type":"message","text":"<@U66SGEWAC> is too kind, and he's borne much of the brunt of the upgrade. Clearly this was pretty borked. This probably should have been 2.0, except that people also complain about the `[compat]` bounds churn.","user":"UC8821DPY","ts":"1614950202.006100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"a+B","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U66SGEWAC"},{"type":"text","text":" is too kind, and he's borne much of the brunt of the upgrade. Clearly this was pretty borked. This probably should have been 2.0, except that people also complain about the "},{"type":"text","text":"[compat]","style":{"code":true}},{"type":"text","text":" bounds churn."}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"a247d70c-92c9-4ae9-90d1-3d0743ddd2aa","type":"message","text":"I'm looking at CairoMakie now unless you already have it under control, <@U66SGEWAC>?","user":"UC8821DPY","ts":"1614950233.006300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Cj=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm looking at CairoMakie now unless you already have it under control, "},{"type":"user","user_id":"U66SGEWAC"},{"type":"text","text":"?"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"6a754179-6c86-432a-897c-cea7de199de9","type":"message","text":"I may only get to it tonight","user":"U66SGEWAC","ts":"1614950264.006500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"23tw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I may only get to it tonight"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"bbcd1f18-e974-4205-9b50-b425511ccb17","type":"message","text":"Oh, it looks like the issue is that something is bounding ImageIO to 0.4.x","user":"UC8821DPY","ts":"1614950331.006700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cU8D","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh, it looks like the issue is that something is bounding ImageIO to 0.4.x"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"1f6e89cb-bb77-41a1-912f-c0c03ca21149","type":"message","text":"It's AbstractPlotting. Version bump coming.","user":"UC8821DPY","ts":"1614950491.006900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uoF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It's AbstractPlotting. Version bump coming."}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"aaf54e64-0ff0-45df-8b32-58c61ec64ba3","type":"message","text":"...wait, but I'm confused about why ImageIO 0.4 *isn't* working. It will take a bit longer while I invesitgate.","user":"UC8821DPY","ts":"1614950774.007100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YH7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"...wait, but I'm confused about why ImageIO 0.4 "},{"type":"text","text":"isn't","style":{"bold":true}},{"type":"text","text":" working. It will take a bit longer while I invesitgate."}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN"},{"client_msg_id":"7aefb786-b3f9-455b-a2e1-5be18641399b","type":"message","text":"xref <https://github.com/JuliaPlots/Makie.jl/issues/864>","user":"UC8821DPY","ts":"1614954072.010200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7sIM8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"xref "},{"type":"link","url":"https://github.com/JuliaPlots/Makie.jl/issues/864"}]}]}],"thread_ts":"1614949917.003900","parent_user_id":"U836PQXSN","reactions":[{"name":"heart","users":["U836PQXSN"],"count":1}]}]