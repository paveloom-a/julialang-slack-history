[{"client_msg_id":"46521256-2466-4a7f-aa2b-80fd3ae8c92a","type":"message","text":"Is there an \"official\" way of generating precompile statements from the unit tests of a package `X`?\nI've tried to run\n```julia --project --trace-compile=precompile.jl -e 'using Pkg; Pkg.test()'```\nbut the resulting `precompile.jl` is only ~80 lines, and doesn't include any statement related to `X`.\nI have several test-specific dependencies, thus the \"naive\"\n```julia --project --trace-compile=precompile.jl test/runtests.jl```\ndoesn't work unless I manually add all those dependencies in my current environment (which kind of defeats the purpose of test-specific deps).","user":"UCT7E536E","ts":"1610122826.129000","team":"T68168MUP","edited":{"user":"UCT7E536E","ts":"1610122841.000000"},"blocks":[{"type":"rich_text","block_id":"VQh7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there an \"official\" way of generating precompile statements from the unit tests of a package "},{"type":"text","text":"X","style":{"code":true}},{"type":"text","text":"?\nI've tried to run\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia --project --trace-compile=precompile.jl -e 'using Pkg; Pkg.test()'"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"but the resulting "},{"type":"text","text":"precompile.jl","style":{"code":true}},{"type":"text","text":" is only ~80 lines, and doesn't include any statement related to "},{"type":"text","text":"X","style":{"code":true}},{"type":"text","text":".\nI have several test-specific dependencies, thus the \"naive\"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia --project --trace-compile=precompile.jl test/runtests.jl"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"doesn't work unless I manually add all those dependencies in my current environment (which kind of defeats the purpose of test-specific deps)."}]}]}],"thread_ts":"1610122826.129000","reply_count":3,"reply_users_count":2,"latest_reply":"1610144994.134100","reply_users":["UCT7E536E","U6A936746"],"subscribed":false},{"client_msg_id":"1a2a94fc-a600-4bac-b5df-179171674b59","type":"message","text":"One alternative would be to put test-specific deps in a `test/Project.toml` , and then run\n```julia --project=test --trace-compile=precompile.jl test/runtests.jl```\nIt just wasn't clear from the <https://julialang.github.io/Pkg.jl/v1/creating-packages/#Test-specific-dependencies-in-Julia-1.2-and-above|Pkg docs>\n&gt;  Note that Pkg will add the tested package itself implictly.\nwhether `X` should be included in `test/Project.toml`; doing so yielded me the error `ERROR: can not merge projects` when running `Pkg.test(\"X\")`.","user":"UCT7E536E","ts":"1610123035.129300","team":"T68168MUP","edited":{"user":"UCT7E536E","ts":"1610123466.000000"},"blocks":[{"type":"rich_text","block_id":"oes","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"One alternative would be to put test-specific deps in a "},{"type":"text","text":"test/Project.toml","style":{"code":true}},{"type":"text","text":" , and then run\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia --project=test --trace-compile=precompile.jl test/runtests.jl"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"It just wasn't clear from the "},{"type":"link","url":"https://julialang.github.io/Pkg.jl/v1/creating-packages/#Test-specific-dependencies-in-Julia-1.2-and-above","text":"Pkg docs"},{"type":"text","text":"\n"}]},{"type":"rich_text_quote","elements":[{"type":"text","text":" Note that Pkg will add the tested package itself implictly."}]},{"type":"rich_text_section","elements":[{"type":"text","text":"whether `X` should be included in `test/Project.toml`; doing so yielded me the error "},{"type":"text","text":"ERROR: can not merge projects","style":{"code":true}},{"type":"text","text":" when running "},{"type":"text","text":"Pkg.test(\"X\")","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1610122826.129000","parent_user_id":"UCT7E536E"},{"client_msg_id":"0e2980b7-41eb-4ad0-8d0b-c8a474003bb1","type":"message","text":"There is a way to pass arguments to the Julia instance started by `Pkg.test`\nBut I don't recall what it is","user":"U6A936746","ts":"1610135683.130900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b6X","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"There is a way to pass arguments to the Julia instance started by "},{"type":"text","text":"Pkg.test\n","style":{"code":true}},{"type":"text","text":"But I don't recall what it is"}]}]}],"thread_ts":"1610122826.129000","parent_user_id":"UCT7E536E"},{"client_msg_id":"D73F1152-FD74-4C0E-9A35-56B130D21463","type":"message","text":"So the idea would be to pass a `trace-compile`-like argument via `Pkg.test`?","user":"UCT7E536E","ts":"1610144994.134100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"B9pM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So the idea would be to pass a "},{"type":"text","text":"trace-compile","style":{"code":true}},{"type":"text","text":"-like argument via "},{"type":"text","text":"Pkg.test","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1610122826.129000","parent_user_id":"UCT7E536E"}]