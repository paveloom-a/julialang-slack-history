[{"client_msg_id":"7b8f1be8-1992-4d99-8126-12310216c83e","type":"message","text":"As an MPI noob I thought there would be some profiler tools out (kinda like `cuprof` and Nvidia Nsight) there but they seem to be mostly proprietary (e.g. TotalView, Arm MAP) and probably overkill for our use case since we're not running with thousands of ranks _yet_.","user":"UEP056STX","ts":"1615740089.028600","team":"T68168MUP","edited":{"user":"UEP056STX","ts":"1615740132.000000"},"blocks":[{"type":"rich_text","block_id":"MnJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"As an MPI noob I thought there would be some profiler tools out (kinda like "},{"type":"text","text":"cuprof","style":{"code":true}},{"type":"text","text":" and Nvidia Nsight) there but they seem to be mostly proprietary (e.g. TotalView, Arm MAP) and probably overkill for our use case since we're not running with thousands of ranks "},{"type":"text","text":"yet","style":{"italic":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1615740089.028600","reply_count":23,"reply_users_count":4,"latest_reply":"1616434314.003900","reply_users":["U68P09RFZ","UEP056STX","U01FBLBCP7S","U67BJLYCS"],"subscribed":false,"reactions":[{"name":"+1","users":["UGU761DU2"],"count":1}]},{"client_msg_id":"B4319B2D-103A-46E9-B3F4-6C4BDFC3154D","type":"message","text":"Nsight has MPI support, and it should work with the master branch of MPI.jl","user":"U68P09RFZ","ts":"1615746832.034900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oTBtZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Nsight has MPI support, and it should work with the master branch of MPI.jl"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"EF4BCF02-650D-4756-9AAD-B76B8EA5E9D1","type":"message","text":"I haven’t tried it, but would be very interested to hear if and how it works","user":"U68P09RFZ","ts":"1615746886.036300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Kn8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I haven’t tried it, but would be very interested to hear if and how it works"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"f87eeae5-be57-4b34-80c4-2be8707a4ac3","type":"message","text":"Ah that's pretty neat!","user":"UEP056STX","ts":"1615749382.036500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tne","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah that's pretty neat!"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"115137cf-d906-46c9-926b-cb0a27516879","type":"message","text":"Maybe we should add CUDA-aware MPI support first, then we can just profile with Nsight.","user":"UEP056STX","ts":"1615749412.036700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DniF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe we should add CUDA-aware MPI support first, then we can just profile with Nsight."}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"ead705ad-2184-4016-96cc-df39c5f54877","type":"message","text":"Should be easy™, just haven't tested it out with `CuArray`s yet.","user":"UEP056STX","ts":"1615749422.036900","team":"T68168MUP","edited":{"user":"UEP056STX","ts":"1615750432.000000"},"blocks":[{"type":"rich_text","block_id":"HPO=n","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Should be easy™, just haven't tested it out with "},{"type":"text","text":"CuArray","style":{"code":true}},{"type":"text","text":"s yet."}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"AA9EA235-1273-4114-947B-AA3DF675585D","type":"message","text":"You should be able to use it for plain CPU jobs as well","user":"U68P09RFZ","ts":"1615760336.038600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"s7q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You should be able to use it for plain CPU jobs as well"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"648840EE-F7B9-449A-B5F7-A8C1773C83F3","type":"message","text":"(Again, haven’t tried it though)","user":"U68P09RFZ","ts":"1615760350.039100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"z97L","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(Again, haven’t tried it though)"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"f45241b4-4ee7-4f19-ba66-497e59311fcb","type":"message","text":"Definitely worth a shot, could be a profiler for everything!","user":"UEP056STX","ts":"1615818030.039800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"z9k4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Definitely worth a shot, could be a profiler for everything!"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"770cb36f-b6fd-4b7c-96c9-a0d9c97bdce9","type":"message","text":"<@U68P09RFZ> just wanted to make sure that I understood what you are suggesting.  You are saying that we should be able to use Nsight to look at profiling of gpus or cpus, in serial or in parallel?  If so I definitely need to learn how to use Nsight.  Unfortunately, it doesn't like the gpu on my desktop so will probably have to go elsewhere to play around with this.","user":"U01FBLBCP7S","ts":"1616416645.001000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mndz","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U68P09RFZ"},{"type":"text","text":" just wanted to make sure that I understood what you are suggesting.  You are saying that we should be able to use Nsight to look at profiling of gpus or cpus, in serial or in parallel?  If so I definitely need to learn how to use Nsight.  Unfortunately, it doesn't like the gpu on my desktop so will probably have to go elsewhere to play around with this."}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"2e82a506-c4ce-462a-bea7-f182f60b2fcf","type":"message","text":"it is an instrumenting profiler","user":"U68P09RFZ","ts":"1616427818.001200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9XTUL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it is an instrumenting profiler"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"edbf7d7f-df49-416a-aeb9-c9df57dcacda","type":"message","text":"so you will need to instrument your code","user":"U68P09RFZ","ts":"1616427828.001400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"In/d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so you will need to instrument your code"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"c11db319-9d0a-4af8-9fa5-5b481a248d80","type":"message","text":"CUDA operations are already instrumented","user":"U68P09RFZ","ts":"1616427910.001600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nij","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"CUDA operations are already instrumented"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"47de0da4-f6b2-4fde-806c-ba9ab68f0f38","type":"message","text":"and if you use the most recent release of MPI.jl, it will automatically handle the instrumentation of MPI calls","user":"U68P09RFZ","ts":"1616427927.001800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Zv/pL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and if you use the most recent release of MPI.jl, it will automatically handle the instrumentation of MPI calls"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"1c71d595-d582-4eb4-92d6-758dbedba5b8","type":"message","text":"see here: <https://discourse.julialang.org/t/how-to-profile-julia-mpi-code/57136/4?u=simonbyrne>","user":"U68P09RFZ","ts":"1616428003.002000","team":"T68168MUP","attachments":[{"service_name":"JuliaLang","title":"How to profile Julia MPI code?","title_link":"https://discourse.julialang.org/t/how-to-profile-julia-mpi-code/57136/4?u=simonbyrne","text":"Thanks to @lyonsquark, v0.17 of MPI.jl (which I just tagged) should now support MPI profilers which use LD_PRELOAD hooks. I believe he has tested it with Darshan. I haven’t tried it, but I believe you should also be able to use NVIDIA Nsight Systems to profile MPI even if you’re not using CUDA: just specify --trace=mpi option (you will also need to specify the MPI implementation via the --mpi-impl option). I’d be keen to hear how people get on with various MPI profilers: if you do have problem...","fallback":"JuliaLang: How to profile Julia MPI code?","thumb_url":"https://aws1.discourse-cdn.com/business5/uploads/julialang/original/2X/1/12829a7ba92b924d4ce81099cbf99785bee9b405.png","ts":1615823751,"from_url":"https://discourse.julialang.org/t/how-to-profile-julia-mpi-code/57136/4?u=simonbyrne","thumb_width":408,"thumb_height":263,"service_icon":"https://aws1.discourse-cdn.com/business5/uploads/julialang/optimized/2X/6/6ca888e296f59ca2a599807f7d5edd489e3d1829_2_180x180.png","id":1,"original_url":"https://discourse.julialang.org/t/how-to-profile-julia-mpi-code/57136/4?u=simonbyrne"}],"blocks":[{"type":"rich_text","block_id":"NP5W","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"see here: "},{"type":"link","url":"https://discourse.julialang.org/t/how-to-profile-julia-mpi-code/57136/4?u=simonbyrne"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"1781a0b9-28e6-4bef-80e3-1044aeed5599","type":"message","text":"Thanks <@U68P09RFZ> for sharing this, it is greatly appreciated.  I will discuss this with <@UEP056STX> and we will give this a try!","user":"U01FBLBCP7S","ts":"1616428800.002300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DfXex","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks "},{"type":"user","user_id":"U68P09RFZ"},{"type":"text","text":" for sharing this, it is greatly appreciated.  I will discuss this with "},{"type":"user","user_id":"UEP056STX"},{"type":"text","text":" and we will give this a try!"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"cce0db93-6e1c-44b5-996a-222f9301f298","type":"message","text":"I think Valentin had some code that would let you add your own instrumentation as well","user":"U68P09RFZ","ts":"1616429135.002500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ZBC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think Valentin had some code that would let you add your own instrumentation as well"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"6438d8b6-c10b-473c-8ffc-45b04615dd40","type":"message","text":"Thanks for the additional information.  <@U67BJLYCS>, not sure if you will find this but do you have code to add your own instrumentation?  If so maybe we could chat sometime?","user":"U01FBLBCP7S","ts":"1616431800.002700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BXW3n","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks for the additional information.  "},{"type":"user","user_id":"U67BJLYCS"},{"type":"text","text":", not sure if you will find this but do you have code to add your own instrumentation?  If so maybe we could chat sometime?"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"640f0bea-0bf0-41b5-9020-8c74864e3845","type":"message","text":"I have use NVTX for custom annotations before","user":"U67BJLYCS","ts":"1616432373.002900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kR6K","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have use NVTX for custom annotations before"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"bc6c214c-5485-4eb3-b6b0-235c22ec6012","type":"message","text":"Thanks <@U67BJLYCS> for the quick reply.  I have not used NVTX before but if you have any suggestions, of where to start, I'd be very curious to hear them.  If not I'll just try and work through the docs and see if I can figure it out","user":"U01FBLBCP7S","ts":"1616433416.003100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Thcy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks "},{"type":"user","user_id":"U67BJLYCS"},{"type":"text","text":" for the quick reply.  I have not used NVTX before but if you have any suggestions, of where to start, I'd be very curious to hear them.  If not I'll just try and work through the docs and see if I can figure it out"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"6d516261-4f3c-417c-8361-863d78d634b5","type":"message","text":"There is documentation about it in CUDA jl","user":"U67BJLYCS","ts":"1616434271.003300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cOO9b","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"There is documentation about it in CUDA jl"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"87b6dfcc-cc25-40cd-89f4-6fb2d0e23f7b","type":"message","text":"It let's you setup identifiers","user":"U67BJLYCS","ts":"1616434282.003500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LXyLu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It let's you setup identifiers"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"e676a793-30b0-47a5-aa7d-92a15b8a61f5","type":"message","text":"So you can say: this is loop iteration n","user":"U67BJLYCS","ts":"1616434300.003700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"p+O","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So you can say: this is loop iteration n"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"},{"client_msg_id":"209d18b8-5d7f-4dc1-9994-692c6806780d","type":"message","text":"And all the kernel launches that happened","user":"U67BJLYCS","ts":"1616434314.003900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7a7Y8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And all the kernel launches that happened"}]}]}],"thread_ts":"1615740089.028600","parent_user_id":"UEP056STX"}]