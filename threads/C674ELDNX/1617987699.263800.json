[{"client_msg_id":"f3a42d32-dfdb-4085-b0ba-a8e52cc540bb","type":"message","text":"I'm having issues using Clang_jll's clang/clang++ in a build. For an invocation like `CC=/workspace/destdir/tools/clang CXX=/workspace/destdir/tools/clang++ cmake ..`, I get the following (in thread)","user":"U6A0PD8CR","ts":"1617987699.263800","team":"T68168MUP","edited":{"user":"U6A0PD8CR","ts":"1617987736.000000"},"blocks":[{"type":"rich_text","block_id":"8Fxjw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm having issues using Clang_jll's clang/clang++ in a build. For an invocation like "},{"type":"text","text":"CC=/workspace/destdir/tools/clang CXX=/workspace/destdir/tools/clang++ cmake ..","style":{"code":true}},{"type":"text","text":", I get the following (in thread)"}]}]}],"thread_ts":"1617987699.263800","reply_count":17,"reply_users_count":3,"latest_reply":"1618004007.272500","reply_users":["U6A0PD8CR","UDB26738Q","U6N6VQE30"],"is_locked":false,"subscribed":false},{"client_msg_id":"38452665-7b61-419f-8e58-db98cda8c92b","type":"message","text":"```-- Check for working C compiler: /workspace/destdir/tools/clang - broken\nCMake Error at /usr/share/cmake/Modules/CMakeTestCCompiler.cmake:60 (message):\n  The C compiler\n\n    \"/workspace/destdir/tools/clang\"\n\n  is not able to compile a simple test program.\n\n  It fails with the following output:\n\n    Change Dir: /workspace/srcdir/llvm-project-rocm-4.1.0/build/CMakeFiles/CMakeTmp\n\n    Run Build Command(s):/usr/bin/make cmTC_6cfa3/fast &amp;&amp; /usr/bin/make  -f CMakeFiles/cmTC_6cfa3.dir/build.make CMakeFiles/cmTC_6cfa3.dir/build\n    make[1]: Entering directory '/workspace/srcdir/llvm-project-rocm-4.1.0/build/CMakeFiles/CMakeTmp'\n    Building C object CMakeFiles/cmTC_6cfa3.dir/testCCompiler.c.o\n    /workspace/destdir/tools/clang    -o CMakeFiles/cmTC_6cfa3.dir/testCCompiler.c.o   -c /workspace/srcdir/llvm-project-rocm-4.1.0/build/CMakeFiles/CMakeTmp/testCCompiler.c\n    Linking C executable cmTC_6cfa3\n    /usr/bin/cmake -E cmake_link_script CMakeFiles/cmTC_6cfa3.dir/link.txt --verbose=1\n    /workspace/destdir/tools/clang      CMakeFiles/cmTC_6cfa3.dir/testCCompiler.c.o  -o cmTC_6cfa3\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find Scrt1.o: No such file or directory\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find crti.o: No such file or directory\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find crtbeginS.o: No such file or directory\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find -lgcc\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find -lgcc_s\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find -lgcc\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find -lgcc_s\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find crtendS.o: No such file or directory\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find crtn.o: No such file or directory\n    clang-11: error: linker command failed with exit code 1 (use -v to see invocation)\n    make[1]: *** [CMakeFiles/cmTC_6cfa3.dir/build.make:107: cmTC_6cfa3] Error 1\n    make[1]: Leaving directory '/workspace/srcdir/llvm-project-rocm-4.1.0/build/CMakeFiles/CMakeTmp'\n    make: *** [Makefile:141: cmTC_6cfa3/fast] Error 2```","user":"U6A0PD8CR","ts":"1617987744.264000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OAv8","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"-- Check for working C compiler: /workspace/destdir/tools/clang - broken\nCMake Error at /usr/share/cmake/Modules/CMakeTestCCompiler.cmake:60 (message):\n  The C compiler\n\n    \"/workspace/destdir/tools/clang\"\n\n  is not able to compile a simple test program.\n\n  It fails with the following output:\n\n    Change Dir: /workspace/srcdir/llvm-project-rocm-4.1.0/build/CMakeFiles/CMakeTmp\n\n    Run Build Command(s):/usr/bin/make cmTC_6cfa3/fast && /usr/bin/make  -f CMakeFiles/cmTC_6cfa3.dir/build.make CMakeFiles/cmTC_6cfa3.dir/build\n    make[1]: Entering directory '/workspace/srcdir/llvm-project-rocm-4.1.0/build/CMakeFiles/CMakeTmp'\n    Building C object CMakeFiles/cmTC_6cfa3.dir/testCCompiler.c.o\n    /workspace/destdir/tools/clang    -o CMakeFiles/cmTC_6cfa3.dir/testCCompiler.c.o   -c /workspace/srcdir/llvm-project-rocm-4.1.0/build/CMakeFiles/CMakeTmp/testCCompiler.c\n    Linking C executable cmTC_6cfa3\n    /usr/bin/cmake -E cmake_link_script CMakeFiles/cmTC_6cfa3.dir/link.txt --verbose=1\n    /workspace/destdir/tools/clang      CMakeFiles/cmTC_6cfa3.dir/testCCompiler.c.o  -o cmTC_6cfa3\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find Scrt1.o: No such file or directory\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find crti.o: No such file or directory\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find crtbeginS.o: No such file or directory\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find -lgcc\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find -lgcc_s\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find -lgcc\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find -lgcc_s\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find crtendS.o: No such file or directory\n    /opt/x86_64-linux-musl/bin/x86_64-linux-musl-ld: cannot find crtn.o: No such file or directory\n    clang-11: error: linker command failed with exit code 1 (use -v to see invocation)\n    make[1]: *** [CMakeFiles/cmTC_6cfa3.dir/build.make:107: cmTC_6cfa3] Error 1\n    make[1]: Leaving directory '/workspace/srcdir/llvm-project-rocm-4.1.0/build/CMakeFiles/CMakeTmp'\n    make: *** [Makefile:141: cmTC_6cfa3/fast] Error 2"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"940d3eb1-791a-4edc-882b-df6ace174bcf","type":"message","text":"wh.... why are you using `Clang_jll` to build instead of the default `clang` compiler? :thinking_face:","user":"UDB26738Q","ts":"1617987845.264200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LaekB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"wh.... why are you using "},{"type":"text","text":"Clang_jll","style":{"code":true}},{"type":"text","text":" to build instead of the default "},{"type":"text","text":"clang","style":{"code":true}},{"type":"text","text":" compiler? "},{"type":"emoji","name":"thinking_face"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"13f3225c-41f9-4121-b16a-195e448f8e3a","type":"message","text":"Too old :slightly_smiling_face:","user":"U6A0PD8CR","ts":"1617987862.264400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QFs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Too old "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"2d82bace-53c0-4cc6-af21-5a694c1d7586","type":"message","text":"Or at least the libstdc++ is too old","user":"U6A0PD8CR","ts":"1617987893.264600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JF6S","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Or at least the libstdc++ is too old"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"9e03b72a-c746-428e-875d-3dbdeeb38261","type":"message","text":"is llvm 11 too old?  :flushed:","user":"UDB26738Q","ts":"1617987918.264800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"F/VR4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is llvm 11 too old?  "},{"type":"emoji","name":"flushed"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"e46ab0e9-69e4-430d-bb28-8520f07882bb","type":"message","text":"libstdc++ is for gcc","user":"UDB26738Q","ts":"1617987938.265000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/1iaR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"libstdc++ is for gcc"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"cd34330c-b361-4d47-b904-3ee6fe0039af","type":"message","text":"With system clang:\n```CMake Error at cmake/modules/CheckCompilerVersion.cmake:119 (message):\n  libstdc++ version should be at least 5.1 because LLVM will soon use new C++\n  features which your toolchain version doesn't support.  You can temporarily\n  opt out using LLVM_TEMPORARILY_ALLOW_OLD_TOOLCHAIN, but very soon your\n  toolchain won't be supported.\nCall Stack (most recent call first):\n  cmake/config-ix.cmake:14 (include)\n  CMakeLists.txt:675 (include)```","user":"U6A0PD8CR","ts":"1617987996.265200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sb0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"With system clang:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"CMake Error at cmake/modules/CheckCompilerVersion.cmake:119 (message):\n  libstdc++ version should be at least 5.1 because LLVM will soon use new C++\n  features which your toolchain version doesn't support.  You can temporarily\n  opt out using LLVM_TEMPORARILY_ALLOW_OLD_TOOLCHAIN, but very soon your\n  toolchain won't be supported.\nCall Stack (most recent call first):\n  cmake/config-ix.cmake:14 (include)\n  CMakeLists.txt:675 (include)"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"b29395aa-ddee-49f4-a099-32a4ac5bd804","type":"message","text":"also, if you really want to use `Clang_jll` that would need to be a `HostBuildDependency`","user":"UDB26738Q","ts":"1617988006.265400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FAn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"also, if you really want to use "},{"type":"text","text":"Clang_jll","style":{"code":true}},{"type":"text","text":" that would need to be a "},{"type":"text","text":"HostBuildDependency","style":{"code":true}}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"f16eee49-fc8e-47f9-a5e2-01b7b0ddca7d","type":"message","text":"I'm trying to build an LLVM fork","user":"U6A0PD8CR","ts":"1617988030.265600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"I8wn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm trying to build an LLVM fork"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"7da4c38c-6083-4d14-8086-88a0f5a187d6","type":"message","text":"(For all the ROCm crap which relies on it)","user":"U6A0PD8CR","ts":"1617988046.265800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"q57im","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(For all the ROCm crap which relies on it)"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR","reactions":[{"name":"100","users":["U6N6VQE30"],"count":1}]},{"client_msg_id":"6bd6514b-54eb-4076-a14c-5543086d2cdf","type":"message","text":"you can use a different gcc version with `build_tarballs(.... ; preferred_gcc_version=v\"5\")`","user":"UDB26738Q","ts":"1617988069.266000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KJI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can use a different gcc version with "},{"type":"text","text":"build_tarballs(.... ; preferred_gcc_version=v\"5\")","style":{"code":true}}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"09f6bdae-a1ae-4f49-ae59-b731d739db40","type":"message","text":"Ahhh, thanks!","user":"U6A0PD8CR","ts":"1617988078.266200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1=o","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ahhh, thanks!"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"cc41992a-cb9b-4d18-ba3e-ac78734e68bb","type":"message","text":"so maybe gcc is needed for bootstrap?","user":"UDB26738Q","ts":"1617988107.266400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LQLs0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so maybe gcc is needed for bootstrap?"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"1ca1cf4a-b32b-42b8-9cbe-7cdd854d7ad1","type":"message","text":"we build julia's llvm with gcc 7: <https://github.com/JuliaPackaging/Yggdrasil/blob/a6630dcd0fb762b774e9966536289fe0a99d9d3f/L/LLVM/LLVM_full%4011.0.1/build_tarballs.jl#L6>","user":"UDB26738Q","ts":"1617988177.266600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Dj6Eq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"we build julia's llvm with gcc 7: "},{"type":"link","url":"https://github.com/JuliaPackaging/Yggdrasil/blob/a6630dcd0fb762b774e9966536289fe0a99d9d3f/L/LLVM/LLVM_full%4011.0.1/build_tarballs.jl#L6"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"4cda245b-0e23-42ea-956a-bace025a7789","type":"message","text":"Ok, I started a build with 8, so let's see what happens","user":"U6A0PD8CR","ts":"1617988194.266800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jkboA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ok, I started a build with 8, so let's see what happens"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"69a8775d-fbb6-4f66-88b9-060bd0ac745d","type":"message","text":"same for llvmbootstrap (the compiler used inside BinaryBuilder): <https://github.com/JuliaPackaging/Yggdrasil/blob/a6630dcd0fb762b774e9966536289fe0a99d9d3f/0_RootFS/LLVMBootstrap%4011/build_tarballs.jl#L13>","user":"UDB26738Q","ts":"1617988222.267000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/CX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"same for llvmbootstrap (the compiler used inside BinaryBuilder): "},{"type":"link","url":"https://github.com/JuliaPackaging/Yggdrasil/blob/a6630dcd0fb762b774e9966536289fe0a99d9d3f/0_RootFS/LLVMBootstrap%4011/build_tarballs.jl#L13"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"},{"client_msg_id":"75386e89-9615-4677-b7c2-10c6bb0739ff","type":"message","text":":popcorn:","user":"U6N6VQE30","ts":"1618004007.272500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pBdz","elements":[{"type":"rich_text_section","elements":[{"type":"emoji","name":"popcorn"}]}]}],"thread_ts":"1617987699.263800","parent_user_id":"U6A0PD8CR"}]