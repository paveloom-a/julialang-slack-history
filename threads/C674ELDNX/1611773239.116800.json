[{"client_msg_id":"a253bba0-692a-4fe6-a889-fd2b65c23a7e","type":"message","text":"So the 7z gzip support only supports single-threaded compression. Would it make sense to use something like `pigz` instead?","user":"U679T6QF7","ts":"1611773239.116800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ejCk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So the 7z gzip support only supports single-threaded compression. Would it make sense to use something like "},{"type":"text","text":"pigz","style":{"code":true}},{"type":"text","text":" instead?"}]}]}],"thread_ts":"1611773239.116800","reply_count":21,"reply_users_count":2,"latest_reply":"1611787758.137400","reply_users":["UDB26738Q","U679T6QF7"],"subscribed":false},{"client_msg_id":"2fc53510-bc1e-476b-9323-a19aa885497b","type":"message","text":"you're building compiler shards, aren't you?","user":"UDB26738Q","ts":"1611773319.116900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+g91B","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you're building compiler shards, aren't you?"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"127ba462-486a-4e14-969b-e93718d37aaf","type":"message","text":"Yes, good guess","user":"U679T6QF7","ts":"1611773436.117100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fX7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, good guess"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"734778a2-23cc-49e4-a0de-5c619795c141","type":"message","text":"now you understand <https://github.com/JuliaPackaging/Yggdrasil/pull/2415#issuecomment-762525807>? :stuck_out_tongue:","user":"UDB26738Q","ts":"1611773451.117300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9yz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"now you understand "},{"type":"link","url":"https://github.com/JuliaPackaging/Yggdrasil/pull/2415#issuecomment-762525807"},{"type":"text","text":"? "},{"type":"emoji","name":"stuck_out_tongue"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"7ab92bbd-5360-484a-bf9b-97ad5ff5d2d4","type":"message","text":"I didn't realize it was mostly compression time...","user":"U679T6QF7","ts":"1611773490.117500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DeQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I didn't realize it was mostly compression time..."}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"b2dbef37-f610-4ca5-8fdd-5a35ff1f37e3","type":"message","text":"honestly, I think packing time got much worse since we moved to `Tar.jl`","user":"UDB26738Q","ts":"1611773511.117700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"o4KF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"honestly, I think packing time got much worse since we moved to "},{"type":"text","text":"Tar.jl","style":{"code":true}}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"db96924d-3c9d-447a-ae73-ced11cbb9db9","type":"message","text":"but yeah, parallel compression might help, provided that `Tar.jl` is happy with it","user":"UDB26738Q","ts":"1611773587.117900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pxI4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but yeah, parallel compression might help, provided that "},{"type":"text","text":"Tar.jl","style":{"code":true}},{"type":"text","text":" is happy with it"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"09cb8525-2c18-414a-9f4a-a6df764424ea","type":"message","text":"however I think we just use stuff in Pkg/Base","user":"UDB26738Q","ts":"1611773746.118100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iFI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"however I think we just use stuff in Pkg/Base"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"ba462a5a-989d-49c5-b10a-b847b47519a8","type":"message","text":"It does seem to be: <https://github.com/JuliaLang/Pkg.jl/blob/76402b8974aba76f4412e59bee2e4bc6be1b7860/src/PlatformEngines.jl#L387>","user":"U679T6QF7","ts":"1611773840.118300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XF6c3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It does seem to be: "},{"type":"link","url":"https://github.com/JuliaLang/Pkg.jl/blob/76402b8974aba76f4412e59bee2e4bc6be1b7860/src/PlatformEngines.jl#L387"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"023dbee9-a88c-4c1e-b591-39572398ca29","type":"message","text":"Ugh, 23 minutes to build GCCBootstrap, over 1 hour to compress it...","user":"U679T6QF7","ts":"1611774641.124900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hs5o","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ugh, 23 minutes to build GCCBootstrap, over 1 hour to compress it..."}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"9eabfa91-7869-4394-8df9-ff309d29525e","type":"message","text":"sounds about right :smile:","user":"UDB26738Q","ts":"1611774658.125100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RqgE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"sounds about right "},{"type":"emoji","name":"smile"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"2d097777-41c7-4a29-835b-0bd9f21a27f0","type":"message","text":"Preliminary testing with `pigz` is very promising","user":"U679T6QF7","ts":"1611782078.134200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uje","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Preliminary testing with "},{"type":"text","text":"pigz","style":{"code":true}},{"type":"text","text":" is very promising"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7","reactions":[{"name":"rocket","users":["UDB26738Q"],"count":1}]},{"client_msg_id":"2a26cd5e-b004-447f-9bda-c909444eeab6","type":"message","text":"Compressed an uncompressed GCCBootstrap directory in 32 seconds. Waiting on 7z numbers (was on a 32 core machine)","user":"U679T6QF7","ts":"1611782273.134400","team":"T68168MUP","edited":{"user":"U679T6QF7","ts":"1611782470.000000"},"blocks":[{"type":"rich_text","block_id":"E6Xcs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Compressed an uncompressed GCCBootstrap directory in 32 seconds. Waiting on 7z numbers (was on a 32 core machine)"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"f45dedcb-8fb0-4b2e-9814-ca7c066fc857","type":"message","text":":wat:","user":"UDB26738Q","ts":"1611782299.134700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pEb","elements":[{"type":"rich_text_section","elements":[{"type":"emoji","name":"wat"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"2d7576b0-c5a5-4077-bcb8-67675025c08b","type":"message","text":"96% of the compression of 7zip -mx9. There's one higher compression mode I can try yet but it's stated to be slower","user":"U679T6QF7","ts":"1611782425.134900","team":"T68168MUP","edited":{"user":"U679T6QF7","ts":"1611782432.000000"},"blocks":[{"type":"rich_text","block_id":"cOugp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"96% of the compression of 7zip -mx9. There's one higher compression mode I can try yet but it's stated to be slower"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"cd58b59f-5396-4db4-9bc5-b1d510e106e1","type":"message","text":"Unless you have 128 threads, 1 hour -&gt; 32 seconds doesn't seem to be only due to multiple threads","user":"UDB26738Q","ts":"1611782445.135200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=JOB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Unless you have 128 threads, 1 hour -> 32 seconds doesn't seem to be only due to multiple threads"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"0151314d-7d73-4135-8631-a79bd5f3df9f","type":"message","text":"I'm using cmdline `tar` in my testing: (I cleaned this up so there may be minor mistakes):\n```tar xvf GCCBootstrap.v11.0.0-iains.aarch64-apple-darwin20.tar.gz\ntime (tar cvf - . | pigz -9 &gt; /tmp/pigz-test.tar.gz)\ntime (tar cvf - . | 7za a -si -tgzip -mx9 /tmp/7z-test.tar.gz)```","user":"U679T6QF7","ts":"1611782764.135500","team":"T68168MUP","edited":{"user":"U679T6QF7","ts":"1611782796.000000"},"blocks":[{"type":"rich_text","block_id":"djz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm using cmdline "},{"type":"text","text":"tar","style":{"code":true}},{"type":"text","text":" in my testing: (I cleaned this up so there may be minor mistakes):\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"tar xvf GCCBootstrap.v11.0.0-iains.aarch64-apple-darwin20.tar.gz\ntime (tar cvf - . | pigz -9 > /tmp/pigz-test.tar.gz)\ntime (tar cvf - . | 7za a -si -tgzip -mx9 /tmp/7z-test.tar.gz)"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"c3eff8d2-a740-4e1e-84ac-818b29095851","type":"message","text":"Oh, ok. Yeah, we had decent performance with command line tar, Tar.jl killed it","user":"UDB26738Q","ts":"1611782962.135900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"AtZ0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh, ok. Yeah, we had decent performance with command line tar, Tar.jl killed it"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"36c918bf-2323-4cd2-bcfd-bec4f0e7ee95","type":"message","text":"Command line `tar` with `7z` still seems quite slow (I killed it around the 15 minute mark)","user":"U679T6QF7","ts":"1611783131.136100","team":"T68168MUP","edited":{"user":"U679T6QF7","ts":"1611783309.000000"},"blocks":[{"type":"rich_text","block_id":"fXr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Command line "},{"type":"text","text":"tar","style":{"code":true}},{"type":"text","text":" with "},{"type":"text","text":"7z","style":{"code":true}},{"type":"text","text":" still seems quite slow (I killed it around the 15 minute mark)"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"3518b13a-7e6e-4930-bc58-53fa1f6dab49","type":"message","text":"Oh wow, `zstd` can do it in 4 seconds when outputting `.zstd` :rocket:","user":"U679T6QF7","ts":"1611785755.136900","team":"T68168MUP","edited":{"user":"U679T6QF7","ts":"1611786462.000000"},"blocks":[{"type":"rich_text","block_id":"FG4J","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh wow, "},{"type":"text","text":"zstd","style":{"code":true}},{"type":"text","text":" can do it in 4 seconds when outputting "},{"type":"text","text":".zstd","style":{"code":true}},{"type":"text","text":" "},{"type":"emoji","name":"rocket"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"6001157d-12f6-44cf-9538-c0b8ddb3c843","type":"message","text":"That's just at compression level 3 (the default) and the resulting archive is smaller than `7z`","user":"U679T6QF7","ts":"1611785892.137100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9gO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That's just at compression level 3 (the default) and the resulting archive is smaller than "},{"type":"text","text":"7z","style":{"code":true}}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"},{"client_msg_id":"2117ecf2-1766-4769-81a5-f7a4f51503da","type":"message","text":"That's very interesting. We have a problem with the tarballs: files in github releases can't be larger than 2 GB. cuda artifact already broke that limit, Tim had to remove some extra stuff (removing extra stuff is a good thing in any case, in my opinion), so we were thinking about using zstd instead. In principle it should work, Pkg is already able to deal with tarballs compressed with zstd, we'd only need to tell BinaryBuilder to use that, but we're in control of that","user":"UDB26738Q","ts":"1611787758.137400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RbV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That's very interesting. We have a problem with the tarballs: files in github releases can't be larger than 2 GB. cuda artifact already broke that limit, Tim had to remove some extra stuff (removing extra stuff is a good thing in any case, in my opinion), so we were thinking about using zstd instead. In principle it should work, Pkg is already able to deal with tarballs compressed with zstd, we'd only need to tell BinaryBuilder to use that, but we're in control of that"}]}]}],"thread_ts":"1611773239.116800","parent_user_id":"U679T6QF7"}]