[{"client_msg_id":"c57c14fa-0957-48b1-a650-ee109c2cf326","type":"message","text":"I am slightly confused by the `dont_dlopen` flag now: I think at some point I added it to our `LibraryProduct`s because the auditor would refuse them otherwise. But at julia-runtime in the jll the library was loaded fine. Now it seems `dont_dlopen` also affects the resulting `_jll` and the library is not loaded anymore which causes another jll that depends on it to fail to load as this one doesn't have `dont_dlopen`.\nI get the following error (the corresponding version is yanked now):\n```julia&gt; using polymake_jll\njulia&gt; using libpolymake_julia_jll\nERROR: InitError: could not load library \"/software/julia/depots/julia-153/artifacts/eb5cd45d7e62284ad0eaba0329c8319989a22c4d/lib/libpolymake_julia.so\"\nlibpolymake.so.4.3: cannot open shared object file: No such file or directory```\n`libpolymake_julia_jll` depends on `polymake_jll` (which provides `libpolymake.so` but with `dont_dlopen`)\ndlopen'ing that library manually with the full path (`polymake_jll.libpolymake_path`) does work fine though.\nAny suggestions?","user":"U01CH05FTMM","ts":"1613398298.444700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M4XkS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I am slightly confused by the "},{"type":"text","text":"dont_dlopen","style":{"code":true}},{"type":"text","text":" flag now: I think at some point I added it to our `LibraryProduct`s because the auditor would refuse them otherwise. But at julia-runtime in the jll the library was loaded fine. Now it seems "},{"type":"text","text":"dont_dlopen","style":{"code":true}},{"type":"text","text":" also affects the resulting "},{"type":"text","text":"_jll","style":{"code":true}},{"type":"text","text":" and the library is not loaded anymore which causes another jll that depends on it to fail to load as this one doesn't have "},{"type":"text","text":"dont_dlopen","style":{"code":true}},{"type":"text","text":".\nI get the following error (the corresponding version is yanked now):\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> using polymake_jll\njulia> using libpolymake_julia_jll\nERROR: InitError: could not load library \"/software/julia/depots/julia-153/artifacts/eb5cd45d7e62284ad0eaba0329c8319989a22c4d/lib/libpolymake_julia.so\"\nlibpolymake.so.4.3: cannot open shared object file: No such file or directory"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"libpolymake_julia_jll","style":{"code":true}},{"type":"text","text":" depends on "},{"type":"text","text":"polymake_jll","style":{"code":true}},{"type":"text","text":" (which provides "},{"type":"text","text":"libpolymake.so","style":{"code":true}},{"type":"text","text":" but with "},{"type":"text","text":"dont_dlopen","style":{"code":true}},{"type":"text","text":")\ndlopen'ing that library manually with the full path ("},{"type":"text","text":"polymake_jll.libpolymake_path","style":{"code":true}},{"type":"text","text":") does work fine though.\nAny suggestions?"}]}]}],"thread_ts":"1613398298.444700","reply_count":13,"reply_users_count":2,"latest_reply":"1613399507.447200","reply_users":["UDB26738Q","U01CH05FTMM"],"subscribed":false},{"client_msg_id":"adf45f8d-e17a-48b5-88fc-c3a6151c057e","type":"message","text":"oh yeah, `dont_dlopen` now actually does what it says: it doesn't dlopen a library <https://github.com/JuliaPackaging/JLLWrappers.jl/pull/24>","user":"UDB26738Q","ts":"1613398378.444800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LLbx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh yeah, "},{"type":"text","text":"dont_dlopen","style":{"code":true}},{"type":"text","text":" now actually does what it says: it doesn't dlopen a library "},{"type":"link","url":"https://github.com/JuliaPackaging/JLLWrappers.jl/pull/24"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"ec997740-fd17-414d-8106-62254b8239fc","type":"message","text":"I thought that was referring to the auditor instead of the jll","user":"U01CH05FTMM","ts":"1613398439.445000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lFG3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I thought that was referring to the auditor instead of the jll"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"a97aadae-8a8f-4864-8eca-a1ec3e08a9d6","type":"message","text":"it was meant to refer to the JLL as well, but it was actually never implemented by mistake","user":"UDB26738Q","ts":"1613398466.445200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rXr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it was meant to refer to the JLL as well, but it was actually never implemented by mistake"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"4bd2bf3b-9f2f-4907-8e87-3cc45f5e4308","type":"message","text":"and there is no LD_LIBRARY_PATH set that would make the dependent package find the other library?","user":"U01CH05FTMM","ts":"1613398486.445400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MKI9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and there is no LD_LIBRARY_PATH set that would make the dependent package find the other library?"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"98ee257e-8b96-4bea-8694-139bd7f51de1","type":"message","text":"isn't there? :thinking_face:","user":"UDB26738Q","ts":"1613398516.445600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"u4bo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"isn't there? "},{"type":"emoji","name":"thinking_face"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"3369aeec-38e7-4fe2-8410-73976c926c7d","type":"message","text":"it doesn't seem so","user":"U01CH05FTMM","ts":"1613398552.445800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"G1n","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it doesn't seem so"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"a9edb100-6ebf-4c34-b890-9d04eab81108","type":"message","text":"that seems to be within the same if as the `dlopen`:\n```            if $(dlopen_flags) !== nothing\n                global $(handle_name) = dlopen($(path_name), $(dlopen_flags))\n                push!(LIBPATH_list, dirname($(path_name)))\n            end```","user":"U01CH05FTMM","ts":"1613398762.446000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"l/3Nj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that seems to be within the same if as the "},{"type":"text","text":"dlopen","style":{"code":true}},{"type":"text","text":":\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"            if $(dlopen_flags) !== nothing\n                global $(handle_name) = dlopen($(path_name), $(dlopen_flags))\n                push!(LIBPATH_list, dirname($(path_name)))\n            end"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"77091526-ca15-4bcf-9872-15f44614d57c","type":"message","text":"```julia&gt; using polymake_jll\n\njulia&gt; polymake_jll.LIBPATH\nBase.RefValue{String}(\"/home/mose/repo/julia/usr/bin/../lib:/home/mose/.julia/artifacts/ee2892b9cdffb5afb5438dcf7706c5be495abaae/lib:/home/mose/.julia/artifacts/f2662cbb8a75e1b8f1d05e87781a8ca83702f5ed/lib:/home/mose/.julia/artifacts/473dc2ed3d46252c87733b7fdca3da64c6f9f917/lib:/home/mose/.julia/artifacts/c91b35452c8fa91e8ac43993a2bc8fb4f78476bb/lib:/home/mose/.julia/artifacts/93d795500c7b63f53b10478c17435f32e7a3c443/lib:/home/mose/.julia/artifacts/b801935f313061d64e28d8a28c39cdc24f139920/lib:/home/mose/.julia/artifacts/502dc6101ca029abe687e905f3f5f75b2bdd5254/lib:/home/mose/.julia/artifacts/06ceadfe6189348f596024106c6a86d1d0ae2273/lib:/home/mose/.julia/artifacts/adae6b9e6ad8b51d5dbfdb27d0cbe200e68e6d42/lib:/home/mose/.julia/artifacts/9960e060b732618174ffd95804d6635833f99513/lib:/home/mose/.julia/artifacts/06e6732c6f448b09033916da99c20057a0d7d395/lib:/home/mose/.julia/artifacts/038aa16d78d66cc3b7237b851f19e7629c5f4e66/lib:/home/mose/.julia/artifacts/73247ee194631a1a0100b72573cea7adadb6d3bd/lib:/home/mose/.julia/artifacts/5b321ad6e8dd5eb22df8c950c9d59c6a43fcdee6/lib:/home/mose/.julia/artifacts/c2e908f420af909af6125716f044b1f7635ee267/lib:/home/mose/repo/julia/usr/bin/../lib/julia:/home/mose/repo/julia/usr/bin/../lib\")```","user":"UDB26738Q","ts":"1613398894.446200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/lryK","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> using polymake_jll\n\njulia> polymake_jll.LIBPATH\nBase.RefValue{String}(\"/home/mose/repo/julia/usr/bin/../lib:/home/mose/.julia/artifacts/ee2892b9cdffb5afb5438dcf7706c5be495abaae/lib:/home/mose/.julia/artifacts/f2662cbb8a75e1b8f1d05e87781a8ca83702f5ed/lib:/home/mose/.julia/artifacts/473dc2ed3d46252c87733b7fdca3da64c6f9f917/lib:/home/mose/.julia/artifacts/c91b35452c8fa91e8ac43993a2bc8fb4f78476bb/lib:/home/mose/.julia/artifacts/93d795500c7b63f53b10478c17435f32e7a3c443/lib:/home/mose/.julia/artifacts/b801935f313061d64e28d8a28c39cdc24f139920/lib:/home/mose/.julia/artifacts/502dc6101ca029abe687e905f3f5f75b2bdd5254/lib:/home/mose/.julia/artifacts/06ceadfe6189348f596024106c6a86d1d0ae2273/lib:/home/mose/.julia/artifacts/adae6b9e6ad8b51d5dbfdb27d0cbe200e68e6d42/lib:/home/mose/.julia/artifacts/9960e060b732618174ffd95804d6635833f99513/lib:/home/mose/.julia/artifacts/06e6732c6f448b09033916da99c20057a0d7d395/lib:/home/mose/.julia/artifacts/038aa16d78d66cc3b7237b851f19e7629c5f4e66/lib:/home/mose/.julia/artifacts/73247ee194631a1a0100b72573cea7adadb6d3bd/lib:/home/mose/.julia/artifacts/5b321ad6e8dd5eb22df8c950c9d59c6a43fcdee6/lib:/home/mose/.julia/artifacts/c2e908f420af909af6125716f044b1f7635ee267/lib:/home/mose/repo/julia/usr/bin/../lib/julia:/home/mose/repo/julia/usr/bin/../lib\")"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"09679314-f5f1-4452-935e-10a4982994ce","type":"message","text":"with the new (now yanked) version I get:\n```julia&gt; occursin(polymake_jll.artifact_dir,string(polymake_jll.LIBPATH))\nfalse```","user":"U01CH05FTMM","ts":"1613399070.446400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"92X","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"with the new (now yanked) version I get:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> occursin(polymake_jll.artifact_dir,string(polymake_jll.LIBPATH))\nfalse"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"5fc2e212-cc47-4396-b14b-abb910858b42","type":"message","text":"with the old one I get true","user":"U01CH05FTMM","ts":"1613399087.446600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EybqK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"with the old one I get true"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"e660417c-6497-457c-9ab3-816d3b8dd4aa","type":"message","text":"the code above was from the JLLWrappers:\n<https://github.com/JuliaPackaging/JLLWrappers.jl/blob/master/src/products/library_generators.jl#L55>","user":"U01CH05FTMM","ts":"1613399159.446800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tys","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the code above was from the JLLWrappers:\n"},{"type":"link","url":"https://github.com/JuliaPackaging/JLLWrappers.jl/blob/master/src/products/library_generators.jl#L55"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"de25aff1-accc-47e3-b457-6012a46457e6","type":"message","text":"uhm, taking that `push!` out the `if` might make sense :thinking_face:","user":"UDB26738Q","ts":"1613399241.447000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PdXpQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"uhm, taking that "},{"type":"text","text":"push!","style":{"code":true}},{"type":"text","text":" out the "},{"type":"text","text":"if","style":{"code":true}},{"type":"text","text":" might make sense "},{"type":"emoji","name":"thinking_face"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"},{"client_msg_id":"b97d8237-ee4e-4e21-9fa9-9d4259aca385","type":"message","text":"I think so as well, yes","user":"U01CH05FTMM","ts":"1613399507.447200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cM2Za","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think so as well, yes"}]}]}],"thread_ts":"1613398298.444700","parent_user_id":"U01CH05FTMM"}]