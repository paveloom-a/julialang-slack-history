[{"client_msg_id":"497dafa6-5546-442a-a2ef-1fdb7814cc5b","type":"message","text":"Is there a builtin cross-platform solution to fix warnings like\n```┌ Warning: Minimum instruction set detected for bin/rubberband is sandybridge, not x86_64 as desired.\n└ @ BinaryBuilder.Auditor ~/.julia/packages/BinaryBuilder/OMMHj/src/Auditor.jl:269```\nI am guessing I just need to add `-march=x86_64` to the `CXXFLAGS`, but that won't work for other platforms of course.","user":"UM30MT6RF","ts":"1614445520.037700","team":"T68168MUP","edited":{"user":"UM30MT6RF","ts":"1614445547.000000"},"blocks":[{"type":"rich_text","block_id":"fqPl6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a builtin cross-platform solution to fix warnings like\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"┌ Warning: Minimum instruction set detected for bin/rubberband is sandybridge, not x86_64 as desired.\n└ @ BinaryBuilder.Auditor ~/.julia/packages/BinaryBuilder/OMMHj/src/Auditor.jl:269"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"I am guessing I just need to add "},{"type":"text","text":"-march=x86_64","style":{"code":true}},{"type":"text","text":" to the "},{"type":"text","text":"CXXFLAGS","style":{"code":true}},{"type":"text","text":", but that won't work for other platforms of course."}]}]}],"thread_ts":"1614445520.037700","reply_count":31,"reply_users_count":3,"latest_reply":"1614446910.044100","reply_users":["UDB26738Q","UM30MT6RF","U67BJLYCS"],"subscribed":false},{"client_msg_id":"9b60fc75-e877-4cd9-bdb5-d6b0d074b5b5","type":"message","text":"we already force `-march`.  there is usually little to do about those warnings, in most cases the library uses intrinsics without checking whether the CPU actually supports them","user":"UDB26738Q","ts":"1614445618.037900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oTz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"we already force "},{"type":"text","text":"-march","style":{"code":true}},{"type":"text","text":".  there is usually little to do about those warnings, in most cases the library uses intrinsics without checking whether the CPU actually supports them"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"561ae244-a917-4c27-a96a-96d34ad2946f","type":"message","text":"in most cases it's an upstream issue, and they should use cpuid","user":"UDB26738Q","ts":"1614445640.038100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kQr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"in most cases it's an upstream issue, and they should use cpuid"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"d2adedd7-b317-465b-9e32-97445b5e49d1","type":"message","text":"Ah, I see. I was a bit confused about that because I couldb't find them setting march manually anywhere","user":"UM30MT6RF","ts":"1614445671.038300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"303","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah, I see. I was a bit confused about that because I couldb't find them setting march manually anywhere"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"18a3948d-00fd-43b9-9452-26c0f7cfc78e","type":"message","text":"you don't see it in the log, because it's done under the hood by the compiler wrappers: <https://github.com/JuliaPackaging/BinaryBuilderBase.jl/blob/7d3f3d00446a9bc0ed9a804b008d1c1f2e433e9f/src/Platforms.jl#L96>","user":"UDB26738Q","ts":"1614445746.038500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Dim=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you don't see it in the log, because it's done under the hood by the compiler wrappers: "},{"type":"link","url":"https://github.com/JuliaPackaging/BinaryBuilderBase.jl/blob/7d3f3d00446a9bc0ed9a804b008d1c1f2e433e9f/src/Platforms.jl#L96"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"7ca18852-5dca-4c97-99fe-ab6086d2951c","type":"message","text":"and for where the compiler wrappers use that information: <https://github.com/JuliaPackaging/BinaryBuilderBase.jl/blob/7d3f3d00446a9bc0ed9a804b008d1c1f2e433e9f/src/Runner.jl#L336>","user":"UDB26738Q","ts":"1614445807.038700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9W/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and for where the compiler wrappers use that information: "},{"type":"link","url":"https://github.com/JuliaPackaging/BinaryBuilderBase.jl/blob/7d3f3d00446a9bc0ed9a804b008d1c1f2e433e9f/src/Runner.jl#L336"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"279f0b6e-8543-4ae2-bc79-fd5ad929dc82","type":"message","text":"hold on, that line looks wrong","user":"UDB26738Q","ts":"1614445836.038900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Xz40O","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hold on, that line looks wrong"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"a15d3f7f-535a-4530-89eb-7ae7d2e2c388","type":"message","text":"I meant I couldn't find it in the upstream library, but thanks for the reference!","user":"UM30MT6RF","ts":"1614445844.039100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5mo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I meant I couldn't find it in the upstream library, but thanks for the reference!"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"77f24dcc-fd0a-4c04-8085-e23da7e49555","type":"message","text":"Are there obvious things to look for here?","user":"UM30MT6RF","ts":"1614445889.039300","team":"T68168MUP","edited":{"user":"UM30MT6RF","ts":"1614445895.000000"},"blocks":[{"type":"rich_text","block_id":"+o6X","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Are there obvious things to look for here?"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"2433ee05-6ee0-4c37-ac90-ada6354c5cc6","type":"message","text":"in the source code of the upstream package?  they're likely including `immintrin.h`","user":"UDB26738Q","ts":"1614445943.039600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lifD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"in the source code of the upstream package?  they're likely including "},{"type":"text","text":"immintrin.h","style":{"code":true}}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"0c0553d4-ddc3-4f7d-97ea-eea4aa253f13","type":"message","text":"or similar header files","user":"UDB26738Q","ts":"1614445966.039800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2No","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"or similar header files"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"86df3b49-6e7e-48d1-bf5f-a2a290dce738","type":"message","text":"&gt; hold on, that line looks wrong\n<https://github.com/JuliaPackaging/BinaryBuilderBase.jl/pull/118>","user":"UDB26738Q","ts":"1614446196.040000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6sO2h","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"hold on, that line looks wrong"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n"},{"type":"link","url":"https://github.com/JuliaPackaging/BinaryBuilderBase.jl/pull/118"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"e447bdc5-f58e-4f4f-a507-b377acbce5c5","type":"message","text":"Hmm, I can't find anything too obvious, so I think I am just going to leave this as-is for now.","user":"UM30MT6RF","ts":"1614446215.040200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"as5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm, I can't find anything too obvious, so I think I am just going to leave this as-is for now."}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"133221b1-2659-4298-8361-52c965c22ce4","type":"message","text":"Glad to be a :rubberduck:  though","user":"UM30MT6RF","ts":"1614446226.040400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NTN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Glad to be a "},{"type":"emoji","name":"rubberduck"},{"type":"text","text":"  though"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF","reactions":[{"name":"rubberduck","users":["UDB26738Q"],"count":1}]},{"client_msg_id":"bd5e4310-19e3-47f5-8e3e-32719410f814","type":"message","text":":smile:","user":"UM30MT6RF","ts":"1614446231.040600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"d0b","elements":[{"type":"rich_text_section","elements":[{"type":"emoji","name":"smile"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"37f24f1d-5444-483d-9f99-1be6f57fe246","type":"message","text":"link to the code?","user":"UDB26738Q","ts":"1614446252.040900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PBnW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"link to the code?"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"bb3922d8-d093-43c6-a18c-3509bef3fb2b","type":"message","text":"<https://github.com/breakfastquay/rubberband>","user":"UM30MT6RF","ts":"1614446279.041100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1uu","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/breakfastquay/rubberband"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"1dd1403a-4ac1-4422-9113-db7233c8c5fe","type":"message","text":"I can also just make a PR with my recipe if that helps","user":"UM30MT6RF","ts":"1614446303.041300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ITE3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I can also just make a PR with my recipe if that helps"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"4387445e-3ee0-4034-aac9-d70d677433fd","type":"message","text":"```% grep -r intrin\nsrc/pommier/sse_mathfun.h:   the SSE2 intrinsics will be used in place of the MMX intrinsics. Do\nsrc/pommier/sse_mathfun.h:#include &lt;xmmintrin.h&gt;\nsrc/pommier/sse_mathfun.h:# include &lt;emmintrin.h&gt;\nsrc/pommier/sse_mathfun.h:/* the ugly part below: many versions of gcc used to be completely buggy with respect to some intrinsics\nsrc/pommier/sse_mathfun.h:   The movehl_ps is fixed in mingw 3.4.5, but I found out that all the _mm_cmp* intrinsics were completely\nsrc/pommier/sse_mathfun.h:/* evaluation of 4 sines at onces, using only SSE1+MMX intrinsics so\nsrc/pommier/sse_mathfun.h:   Since it is based on SSE intrinsics, it has to be compiled at -O2 to\nsrc/kissfft/kiss_fft.h:# include &lt;xmmintrin.h&gt;```","user":"UDB26738Q","ts":"1614446329.041500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rte","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"% grep -r intrin\nsrc/pommier/sse_mathfun.h:   the SSE2 intrinsics will be used in place of the MMX intrinsics. Do\nsrc/pommier/sse_mathfun.h:#include <xmmintrin.h>\nsrc/pommier/sse_mathfun.h:# include <emmintrin.h>\nsrc/pommier/sse_mathfun.h:/* the ugly part below: many versions of gcc used to be completely buggy with respect to some intrinsics\nsrc/pommier/sse_mathfun.h:   The movehl_ps is fixed in mingw 3.4.5, but I found out that all the _mm_cmp* intrinsics were completely\nsrc/pommier/sse_mathfun.h:/* evaluation of 4 sines at onces, using only SSE1+MMX intrinsics so\nsrc/pommier/sse_mathfun.h:   Since it is based on SSE intrinsics, it has to be compiled at -O2 to\nsrc/kissfft/kiss_fft.h:# include <xmmintrin.h>"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"da6adb46-6164-4c41-a9aa-8b80ef49ab26","type":"message","text":"Ah...","user":"UM30MT6RF","ts":"1614446379.041700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"R4K","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah..."}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"bae5ecaa-9f49-4cad-9084-0e5c512cd409","type":"message","text":"yeah, we usually accept packages with those warnings, it's an upstream issue, if they don't care about building broken libraries/executables, frankly I don't care either","user":"UDB26738Q","ts":"1614446410.041900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RKR29","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, we usually accept packages with those warnings, it's an upstream issue, if they don't care about building broken libraries/executables, frankly I don't care either"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"f441e4d8-a970-4992-bf44-fdbb1db052be","type":"message","text":"we just know who to blame","user":"UDB26738Q","ts":"1614446419.042100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"f5q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"we just know who to blame"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"92e9e250-ab77-4fe3-84bf-56e4c4788be5","type":"message","text":"Yes, those files do indeed look quite ugly. I am assuming they are aware of that, so probably doesn't make much sense to open an issue, right?","user":"UM30MT6RF","ts":"1614446617.042300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pip","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, those files do indeed look quite ugly. I am assuming they are aware of that, so probably doesn't make much sense to open an issue, right?"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"febc7ebc-a9c9-4caa-bed3-9d51144f3e89","type":"message","text":"We also should start doing microarchitecture builds ;)","user":"U67BJLYCS","ts":"1614446670.042500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"r+8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We also should start doing microarchitecture builds ;)"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"b4ab4d3a-e700-40fb-bebe-4594e5ddabb5","type":"message","text":"we're just waiting for enzyme :stuck_out_tongue:","user":"UDB26738Q","ts":"1614446692.042700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qlAR7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"we're just waiting for enzyme "},{"type":"emoji","name":"stuck_out_tongue"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"cf2aac2a-2d75-4430-add2-8f6b32fab51e","type":"message","text":"As if the compile time for LLVM isn't quite bad enough :P","user":"U67BJLYCS","ts":"1614446692.042900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/2Vg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"As if the compile time for LLVM isn't quite bad enough :P"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"bf581925-8dc6-4a4f-a675-67186ab231fc","type":"message","text":"BTW, I'm pretty sure we need to reorganise quite some bits in BinaryBuilderBase though, we still use the old ExtendedPlatform :grimacing:","user":"UDB26738Q","ts":"1614446725.043100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ccj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"BTW, I'm pretty sure we need to reorganise quite some bits in BinaryBuilderBase though, we still use the old ExtendedPlatform "},{"type":"emoji","name":"grimacing"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"44b4701e-1e9d-43be-a642-a21fe93bc7f8","type":"message","text":"Haha","user":"U67BJLYCS","ts":"1614446741.043300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3xh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Haha"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"2895ed81-37e3-4e7f-81d3-93554f796168","type":"message","text":"Enzyme has given up on 1.5","user":"U67BJLYCS","ts":"1614446751.043500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MAet","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Enzyme has given up on 1.5"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"aa3282de-e8e2-41c8-9402-e20145800001","type":"message","text":"I no longer seem it my problem","user":"U67BJLYCS","ts":"1614446761.043700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"K3SXj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I no longer seem it my problem"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"18e86193-1c8f-41e4-b9ae-d7e2d1bb8c57","type":"message","text":"oh no, wait, `ExtendedPlatform` is only in the docstrings!","user":"UDB26738Q","ts":"1614446869.043900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SXIv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh no, wait, "},{"type":"text","text":"ExtendedPlatform","style":{"code":true}},{"type":"text","text":" is only in the docstrings!"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"},{"client_msg_id":"054ba26c-6643-4292-9523-08806b26f882","type":"message","text":"I was reading the documentation a few days ago and saw <https://docs.binarybuilder.org/dev/reference/#BinaryBuilderBase.expand_microarchitectures-Tuple{AbstractPlatform}>, but the code doesn't use them anymore","user":"UDB26738Q","ts":"1614446910.044100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"V1vBZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I was reading the documentation a few days ago and saw "},{"type":"link","url":"https://docs.binarybuilder.org/dev/reference/#BinaryBuilderBase.expand_microarchitectures-Tuple{AbstractPlatform}"},{"type":"text","text":", but the code doesn't use them anymore"}]}]}],"thread_ts":"1614445520.037700","parent_user_id":"UM30MT6RF"}]