[{"client_msg_id":"6616db67-e4a5-4974-bda0-738baa4a70ef","type":"message","text":"what I found so far is that the hash of the source is computed wrong","user":"UDB26738Q","ts":"1615067476.166500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Kh+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what I found so far is that the hash of the source is computed wrong"}]}]}],"thread_ts":"1615067476.166500","reply_count":20,"reply_users_count":2,"latest_reply":"1615072391.173700","reply_users":["UDB26738Q","U8MPCDJAY"],"subscribed":false},{"client_msg_id":"cabeeadc-0799-470f-8a86-0616a8d1eb3e","type":"message","text":"of course this happens _only_ in CI, I'm running the code dozens of times locally, never fails","user":"UDB26738Q","ts":"1615067749.166600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"P3E/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"of course this happens "},{"type":"text","text":"only","style":{"italic":true}},{"type":"text","text":" in CI, I'm running the code dozens of times locally, never fails"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"300c8075-52e6-46f2-98be-ad7c0b53facf","type":"message","text":"oh, cool, the wizard computes it right: <https://dev.azure.com/JuliaPackaging/BinaryBuilder.jl/_build/results?buildId=9454&amp;view=logs&amp;j=54759826-d195-5ca2-1571-21806663cd36&amp;t=9eb882d6-5a34-5e37-1506-d0b4bf16214f&amp;l=234> but then it magically changes :confused:  this is even worse that what I was fearing","user":"UDB26738Q","ts":"1615068128.166800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8hV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh, cool, the wizard computes it right: "},{"type":"link","url":"https://dev.azure.com/JuliaPackaging/BinaryBuilder.jl/_build/results?buildId=9454&view=logs&j=54759826-d195-5ca2-1571-21806663cd36&t=9eb882d6-5a34-5e37-1506-d0b4bf16214f&l=234"},{"type":"text","text":" but then it magically changes "},{"type":"emoji","name":"confused"},{"type":"text","text":"  this is even worse that what I was fearing"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"07923640-65aa-457d-9b61-112c1ff7cc39","type":"message","text":"side note.. just noticed precomp isn’t falling back to the basic printing. You might want to set the CI env var to force that","user":"U8MPCDJAY","ts":"1615068343.167000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XYqV/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"side note.. just noticed precomp isn’t falling back to the basic printing. You might want to set the CI env var to force that"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"127022bf-9250-48f2-ac20-bff0de4a6286","type":"message","text":"<https://dev.azure.com/JuliaPackaging/BinaryBuilder.jl/_build/results?buildId=9454&amp;view=logs&amp;j=54759826-d195-5ca2-1571-21806663cd36&amp;t=9eb882d6-5a34-5e37-1506-d0b4bf16214f&amp;l=17>","user":"U8MPCDJAY","ts":"1615068345.167200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wAYX","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://dev.azure.com/JuliaPackaging/BinaryBuilder.jl/_build/results?buildId=9454&view=logs&j=54759826-d195-5ca2-1571-21806663cd36&t=9eb882d6-5a34-5e37-1506-d0b4bf16214f&l=17"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"d084a2e1-64c9-4783-b6fa-61e7c3873d29","type":"message","text":"set it to anything?","user":"UDB26738Q","ts":"1615068459.167400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CQp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"set it to anything?"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"ad63ff88-42cb-4abc-998d-bc2c1c2a5667","type":"message","text":"yeah I think so","user":"U8MPCDJAY","ts":"1615068474.167600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JHR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah I think so"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"9c6fa9fc-e5a3-42d6-86d1-1fcb253ca3f4","type":"message","text":"<https://github.com/JuliaLang/Pkg.jl/blob/bae808dcc05d6adc42538feb758c195d5aa4c75f/src/Pkg.jl#L37>","user":"U8MPCDJAY","ts":"1615068526.167800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3Lnd","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/JuliaLang/Pkg.jl/blob/bae808dcc05d6adc42538feb758c195d5aa4c75f/src/Pkg.jl#L37"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"d74d1681-e442-442b-9b59-dcccf96008bc","type":"message","text":"good, I did it right: <https://github.com/JuliaPackaging/BinaryBuilder.jl/commit/241b8720a1e1c0de795ddff1e1d9d13ab07eef86> :slightly_smiling_face:","user":"UDB26738Q","ts":"1615068552.168000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LKO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"good, I did it right: "},{"type":"link","url":"https://github.com/JuliaPackaging/BinaryBuilder.jl/commit/241b8720a1e1c0de795ddff1e1d9d13ab07eef86"},{"type":"text","text":" "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"2097e398-cbcb-4b62-9623-6e5676df8299","type":"message","text":"no, wait, I'm looking to the wrong files!","user":"UDB26738Q","ts":"1615068929.168200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hE+pu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"no, wait, I'm looking to the wrong files!"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"eeed2f75-ddff-46cf-9734-67631ef5e25d","type":"message","text":"it's `libfoo_tarball_hash` that is wrong, not the one from the wizard","user":"UDB26738Q","ts":"1615068976.168400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"T0AJV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it's "},{"type":"text","text":"libfoo_tarball_hash","style":{"code":true}},{"type":"text","text":" that is wrong, not the one from the wizard"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"4cef4721-fcc9-4119-b778-f6c0d73eb47b","type":"message","text":"ok, julia computes the hash correctly (same as `sha256sum`), which is relieving (and unsurprising), so the question is why the file has a different hash :confused:","user":"UDB26738Q","ts":"1615069907.168600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"raPS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ok, julia computes the hash correctly (same as "},{"type":"text","text":"sha256sum","style":{"code":true}},{"type":"text","text":"), which is relieving (and unsurprising), so the question is why the file has a different hash "},{"type":"emoji","name":"confused"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"fb5a2c23-4cd4-4ec8-adfd-9f71609bb7d9","type":"message","text":"just a suggestion, but if the file is cloned between the tests, check that the line breaks are what you expect them to be.. the Pkg windows gha checkout was changing the line breaks","user":"U8MPCDJAY","ts":"1615070452.168800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LhP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"just a suggestion, but if the file is cloned between the tests, check that the line breaks are what you expect them to be.. the Pkg windows gha checkout was changing the line breaks"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"3297c0a6-25aa-43d0-a43c-0a16df4499de","type":"message","text":"no, it's a tarball created during the tests: it is then served over HTTP (with `HTTP.jl`) as a remote file to download to the wizard: the wizard computes the hash of the file correctly, but the one of the original file is wrong","user":"UDB26738Q","ts":"1615070560.169000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mUTS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"no, it's a tarball created during the tests: it is then served over HTTP (with "},{"type":"text","text":"HTTP.jl","style":{"code":true}},{"type":"text","text":") as a remote file to download to the wizard: the wizard computes the hash of the file correctly, but the one of the original file is wrong"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"88b37e5f-709e-4ad2-8c68-1cca58f3842b","type":"message","text":"(the file is never written to file, it's all done in memory)","user":"UDB26738Q","ts":"1615070633.169200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iPfy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(the file is never written to file, it's all done in memory)"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"b2850812-527a-4e57-9386-afc19bc3b6a7","type":"message","text":"this is where the file is created and served via HTTP: <https://github.com/JuliaPackaging/BinaryBuilder.jl/blob/937c7af962af6745809eb3edaca201b88f1ddc3e/test/wizard.jl#L48-L57>","user":"UDB26738Q","ts":"1615070670.169400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"J=+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"this is where the file is created and served via HTTP: "},{"type":"link","url":"https://github.com/JuliaPackaging/BinaryBuilder.jl/blob/937c7af962af6745809eb3edaca201b88f1ddc3e/test/wizard.jl#L48-L57"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"4220c389-219b-4faf-88d6-8947b9cd2654","type":"message","text":"but then the file received by the wizard has the right hash","user":"UDB26738Q","ts":"1615070706.169600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"82X/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but then the file received by the wizard has the right hash"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"af82276a-f1ba-4da4-84cf-1d63978daf00","type":"message","text":"uhm, probably we should switch to `Tar` for this, it creates reproducible tarballs","user":"UDB26738Q","ts":"1615071034.169800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4aY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"uhm, probably we should switch to "},{"type":"text","text":"Tar","style":{"code":true}},{"type":"text","text":" for this, it creates reproducible tarballs"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"ed2bb4d4-f5f4-4ab7-b081-2b01a89475cf","type":"message","text":"test passing 9/9 after switching to `Tar.jl` :cry:","user":"UDB26738Q","ts":"1615072144.173300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Thm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"test passing 9/9 after switching to "},{"type":"text","text":"Tar.jl","style":{"code":true}},{"type":"text","text":" "},{"type":"emoji","name":"cry"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"0e842a84-f43f-4ac6-8164-904bf58d6bd1","type":"message","text":"12/12","user":"UDB26738Q","ts":"1615072258.173500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=hUB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"12/12"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"},{"client_msg_id":"ee54c000-fdd1-4c8e-820b-4e047ddd1074","type":"message","text":"15/15 :cry:  (the last job is actually failing, but because of codecov)","user":"UDB26738Q","ts":"1615072391.173700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fNJB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"15/15 "},{"type":"emoji","name":"cry"},{"type":"text","text":"  (the last job is actually failing, but because of codecov)"}]}]}],"thread_ts":"1615067476.166500","parent_user_id":"UDB26738Q"}]