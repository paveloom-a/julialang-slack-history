[{"client_msg_id":"040214f9-9a29-4adf-b98b-f2f0009c65b9","type":"message","text":"libglfw.dylib doesn’t contain any rpath info for libvulkan, so I was thinking to manually inject a rpath after those artifacts have been downloaded.","user":"U6DN7UPJ7","ts":"1611136013.054100","team":"T68168MUP","edited":{"user":"U6DN7UPJ7","ts":"1611136761.000000"},"blocks":[{"type":"rich_text","block_id":"k/6q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"libglfw.dylib doesn’t contain any rpath info for libvulkan, so I was thinking to manually inject a rpath after those artifacts have been downloaded."}]}]}],"thread_ts":"1611136013.054100","reply_count":5,"reply_users_count":2,"latest_reply":"1611201484.003900","reply_users":["U66GD0880","U6DN7UPJ7"],"subscribed":false},{"client_msg_id":"a2baf263-5a85-4670-b52f-675fc9b50044","type":"message","text":"The standard, across all of Yggdrasil, is to have dependencies declared as `@rpath/$(SONAME)`.  So, for instance, `libglfw.dylib`, if it depends on `libvulkan.dylib`, should depend on `@rpath/libvulkan.dylib`.  In most cases, this won’t actually find `libvullkan`on its own, because the RPATH embedded within `libglfw.dylib` will just be something like `@loader_path`, which means “look right next to me”.","user":"U66GD0880","ts":"1611168843.054800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hubMy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The standard, across all of Yggdrasil, is to have dependencies declared as "},{"type":"text","text":"@rpath/$(SONAME)","style":{"code":true}},{"type":"text","text":".  So, for instance, "},{"type":"text","text":"libglfw.dylib","style":{"code":true}},{"type":"text","text":", if it depends on "},{"type":"text","text":"libvulkan.dylib","style":{"code":true}},{"type":"text","text":", should depend on "},{"type":"text","text":"@rpath/libvulkan.dylib","style":{"code":true}},{"type":"text","text":".  In most cases, this won’t actually find `libvullkan`on its own, because the RPATH embedded within "},{"type":"text","text":"libglfw.dylib","style":{"code":true}},{"type":"text","text":" will just be something like "},{"type":"text","text":"@loader_path","style":{"code":true}},{"type":"text","text":", which means “look right next to me”."}]}]}],"thread_ts":"1611136013.054100","parent_user_id":"U6DN7UPJ7"},{"client_msg_id":"9a290e1f-cac5-483c-8c1a-36ebc2b2730a","type":"message","text":"However, since we use JLLs, and each JLL loads its libraries on first use, if the YLIB_ID of `libvulkan.dylib` is `@rpath/libvulkan.dylib`, if it’s already loaded by `dlopen()`, then when you load `libglfw.dylib` and it tries to load the library, it will find it’s already loaded and be satisfied","user":"U66GD0880","ts":"1611168903.055000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"msEX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"However, since we use JLLs, and each JLL loads its libraries on first use, if the YLIB_ID of "},{"type":"text","text":"libvulkan.dylib","style":{"code":true}},{"type":"text","text":" is "},{"type":"text","text":"@rpath/libvulkan.dylib","style":{"code":true}},{"type":"text","text":", if it’s already loaded by "},{"type":"text","text":"dlopen()","style":{"code":true}},{"type":"text","text":", then when you load "},{"type":"text","text":"libglfw.dylib","style":{"code":true}},{"type":"text","text":" and it tries to load the library, it will find it’s already loaded and be satisfied"}]}]}],"thread_ts":"1611136013.054100","parent_user_id":"U6DN7UPJ7"},{"client_msg_id":"41c8ab7d-f1d6-4cdb-857d-8449abf1fe70","type":"message","text":"no need for `DYLD_LIBRARY_PATH`","user":"U66GD0880","ts":"1611168909.055200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xw3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"no need for "},{"type":"text","text":"DYLD_LIBRARY_PATH","style":{"code":true}}]}]}],"thread_ts":"1611136013.054100","parent_user_id":"U6DN7UPJ7"},{"client_msg_id":"e1e020a5-0572-489b-9e08-4fe5d83c9cf5","type":"message","text":"If you’re not just dealing with libraries and are dealing with executables, then yes, you need to use `DYLD_LIBRARY_PATH`","user":"U66GD0880","ts":"1611168924.055400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MN8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you’re not just dealing with libraries and are dealing with executables, then yes, you need to use "},{"type":"text","text":"DYLD_LIBRARY_PATH","style":{"code":true}}]}]}],"thread_ts":"1611136013.054100","parent_user_id":"U6DN7UPJ7"},{"client_msg_id":"1b8083ef-fb5d-46f3-90af-add628c0295c","type":"message","text":"Thanks for the detail explanation! Unfortunately, when building glfw as a shared library, it doesn’t link vulkan, so there is no `@rpath/libvulkan.dylib` embedded. For now, `libvulkan.dylib` is not shipped as an JLL package, so without using `DYLD_LIBRARY_PATH` , `libvulkan.dylib` cannot be directly loaded without using hacks like manually pushing the libvulkan path to `Libdl.DL_LOAD_PATH`.:disappointed:","user":"U6DN7UPJ7","ts":"1611201484.003900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0=0Z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks for the detail explanation! Unfortunately, when building glfw as a shared library, it doesn’t link vulkan, so there is no "},{"type":"text","text":"@rpath/libvulkan.dylib","style":{"code":true}},{"type":"text","text":" embedded. For now, "},{"type":"text","text":"libvulkan.dylib","style":{"code":true}},{"type":"text","text":" is not shipped as an JLL package, so without using "},{"type":"text","text":"DYLD_LIBRARY_PATH","style":{"code":true}},{"type":"text","text":" , "},{"type":"text","text":"libvulkan.dylib","style":{"code":true}},{"type":"text","text":" cannot be directly loaded without using hacks like manually pushing the libvulkan path to "},{"type":"text","text":"Libdl.DL_LOAD_PATH","style":{"code":true}},{"type":"text","text":"."},{"type":"emoji","name":"disappointed"}]}]}],"thread_ts":"1611136013.054100","parent_user_id":"U6DN7UPJ7"}]