[{"client_msg_id":"6a13094f-1c8c-441d-a712-1c04b3de9595","type":"message","text":"I am trying to build <https://github.com/cea-hpc/wi4mpi> with BinaryBuilder.  It depends on OpenMPI, both the C an Fortran libraries.  Unfortunately, it looks like OpenMPI in Yggdrasil disables the Fortran libraries , see <https://github.com/JuliaPackaging/Yggdrasil/blob/6eab6835a55e33efd760852f29b0ba9bfc9bb536/O/OpenMPI/build_tarballs.jl#L14>.  Does anyone happen to know why?","user":"UBJUA1YAV","ts":"1617136686.110000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nL8v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I am trying to build "},{"type":"link","url":"https://github.com/cea-hpc/wi4mpi"},{"type":"text","text":" with BinaryBuilder.  It depends on OpenMPI, both the C an Fortran libraries.  Unfortunately, it looks like OpenMPI in Yggdrasil disables the Fortran libraries , see "},{"type":"link","url":"https://github.com/JuliaPackaging/Yggdrasil/blob/6eab6835a55e33efd760852f29b0ba9bfc9bb536/O/OpenMPI/build_tarballs.jl#L14"},{"type":"text","text":".  Does anyone happen to know why?"}]}]}],"thread_ts":"1617136686.110000","reply_count":32,"reply_users_count":5,"latest_reply":"1617142279.117300","reply_users":["U680THK2S","U67461GUB","UBJUA1YAV","U66GD0880","UDB26738Q"],"is_locked":false,"subscribed":false},{"client_msg_id":"d45e92f6-4b4b-4a84-908f-1affbffd0048","type":"message","text":"Added in <https://github.com/JuliaPackaging/Yggdrasil/pull/308>. Viral noted that he purposefully omitted the Fortran stuff but didn't say why.","user":"U680THK2S","ts":"1617136770.110100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TgpK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Added in "},{"type":"link","url":"https://github.com/JuliaPackaging/Yggdrasil/pull/308"},{"type":"text","text":". Viral noted that he purposefully omitted the Fortran stuff but didn't say why."}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"8bfa47fc-e479-44a0-81c6-d70d8abfd402","type":"message","text":"<@U67461GUB>?","user":"U680THK2S","ts":"1617136775.110300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qJACW","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U67461GUB"},{"type":"text","text":"?"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"52f4b317-7fbf-45e9-a27d-ba28a95076fe","type":"message","text":"I don’t think there was a reason beyond just getting something building reliably first.","user":"U67461GUB","ts":"1617136911.110500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"j7yBU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don’t think there was a reason beyond just getting something building reliably first."}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV","reactions":[{"name":"+1","users":["U680THK2S"],"count":1}]},{"client_msg_id":"b63a4d2d-c366-4542-9952-288d654d8dc0","type":"message","text":"Everything takes longer when you add Fortran in the mix","user":"U680THK2S","ts":"1617136930.110800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dV1pr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Everything takes longer when you add Fortran in the mix"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"3a561cbf-4527-45c7-afd8-4354291d8ee7","type":"message","text":"Cool, I'll try to turn it on and see what breaks","user":"UBJUA1YAV","ts":"1617136939.111000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kWF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Cool, I'll try to turn it on and see what breaks"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV","reactions":[{"name":"+1","users":["U67461GUB","U680THK2S"],"count":2}]},{"client_msg_id":"c5f65f0e-33d4-4340-afdc-4f6c51ee722b","type":"message","text":"We should certainly enable it.","user":"U67461GUB","ts":"1617136941.111200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CGVjB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We should certainly enable it."}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"51247fc9-50b9-41e7-9d0d-b05813b2a3ba","type":"message","text":"First issue is\n```configure: error: Can not determine size of CHARACTER when cross-compiling\nPrevious command exited with 1\nchecking size of Fortran CHARACTER... ERROR: LoadError: Build for OpenMPI on aarch64-linux-gnu did not complete successfully```\n:eyes:","user":"UBJUA1YAV","ts":"1617137352.111600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"siXa3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"First issue is\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"configure: error: Can not determine size of CHARACTER when cross-compiling\nPrevious command exited with 1\nchecking size of Fortran CHARACTER... ERROR: LoadError: Build for OpenMPI on aarch64-linux-gnu did not complete successfully"}]},{"type":"rich_text_section","elements":[{"type":"emoji","name":"eyes"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"5f0e7497-6248-4557-8248-9c1d75b3d3c4","type":"message","text":"Maybe that’s why I disabled it. :joy:","user":"U67461GUB","ts":"1617137539.111800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4iNG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe that’s why I disabled it. "},{"type":"emoji","name":"joy"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"4134d2e8-85e9-4ada-80b2-177636d66ed3","type":"message","text":"See if there’s a way to manually provide the information it is looking for","user":"U66GD0880","ts":"1617137576.112000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uby5t","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"See if there’s a way to manually provide the information it is looking for"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV","reactions":[{"name":"eyes","users":["UBJUA1YAV"],"count":1}]},{"client_msg_id":"bddecf3f-62b6-409b-8e96-3ecc64f24295","type":"message","text":"many configure scripts allow you to set variables a la `cv_fortran_char_width=1` or something","user":"U66GD0880","ts":"1617137600.112200","team":"T68168MUP","edited":{"user":"U66GD0880","ts":"1617137605.000000"},"blocks":[{"type":"rich_text","block_id":"5Cz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"many configure scripts allow you to set variables a la "},{"type":"text","text":"cv_fortran_char_width=1","style":{"code":true}},{"type":"text","text":" or something"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"e6c385eb-c18c-49c5-87ad-b5cbced27cec","type":"message","text":"It looks like it is using this <https://github.com/open-mpi/ompi/blob/master/config/ompi_fortran_check.m4> to determine the size of the fortran types but I haven't figured out yet how to override it.","user":"UBJUA1YAV","ts":"1617139157.112600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gVa6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It looks like it is using this "},{"type":"link","url":"https://github.com/open-mpi/ompi/blob/master/config/ompi_fortran_check.m4"},{"type":"text","text":" to determine the size of the fortran types but I haven't figured out yet how to override it."}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"1675d05e-8fca-4d3e-afbf-1ae7552c337d","type":"message","text":"yeah so I often find it clearer to read the actually generated `configure` files","user":"U66GD0880","ts":"1617139328.112800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aYy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah so I often find it clearer to read the actually generated "},{"type":"text","text":"configure","style":{"code":true}},{"type":"text","text":" files"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV","reactions":[{"name":"+1","users":["UDB26738Q"],"count":1}]},{"client_msg_id":"1fa9981f-f004-4400-b678-c8ab0d3ad93e","type":"message","text":"rather than the autotools input source","user":"U66GD0880","ts":"1617139332.113000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jPc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"rather than the autotools input source"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"17792c18-3b5e-4d99-80e6-7886c5e69203","type":"message","text":"hilarious as that may be","user":"U66GD0880","ts":"1617139339.113300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xF3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hilarious as that may be"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"b01fdbe9-f584-4148-ba9c-d6b8bd83a589","type":"message","text":"looking at the `configure` file for OpenMPI 4.1.0, I see on line 45346 there’s something called `ompi_cv_fortran_sizeof_CHARACTER`","user":"U66GD0880","ts":"1617139370.113500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oT0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"looking at the "},{"type":"text","text":"configure","style":{"code":true}},{"type":"text","text":" file for OpenMPI 4.1.0, I see on line 45346 there’s something called "},{"type":"text","text":"ompi_cv_fortran_sizeof_CHARACTER","style":{"code":true}}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"39c3bd3b-9583-4ca5-af53-d33622d27f9c","type":"message","text":"but it's a bit worrying it depends on openmpi, no?  don't we want something kind of standalone?","user":"UDB26738Q","ts":"1617139381.113700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7KFOh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but it's a bit worrying it depends on openmpi, no?  don't we want something kind of standalone?"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"07759ab1-6dd8-4669-8d5d-815da94992ed","type":"message","text":"I tried `./configure ompi_cv_fortran_sizeof_CHARACTER=1 --prefix=$prefix --host=$target --enable-shared=yes --enable-static=no --without-cs-fs` but no luck.","user":"UBJUA1YAV","ts":"1617140168.113900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rs=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I tried "},{"type":"text","text":"./configure ompi_cv_fortran_sizeof_CHARACTER=1 --prefix=$prefix --host=$target --enable-shared=yes --enable-static=no --without-cs-fs","style":{"code":true}},{"type":"text","text":" but no luck."}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"32b74374-6720-40f3-9bb1-f5025ceb352c","type":"message","text":"what happens","user":"U66GD0880","ts":"1617140194.114100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Sq+D","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what happens"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"85bf8919-ea11-4ea4-83f1-686cbf8720bc","type":"message","text":"same error?","user":"U66GD0880","ts":"1617140197.114300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3kWx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"same error?"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"5bc87d4a-062a-4755-9ac4-10910bfbbaa3","type":"message","text":"yep","user":"UBJUA1YAV","ts":"1617140204.114500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Liml","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yep"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"6323f10b-d8f2-470e-854c-2a5af79447e0","type":"message","text":"<@UDB26738Q> it is a bit worrying.  I am hoping it is only a build or test dependence but I don't really know how it works.","user":"UBJUA1YAV","ts":"1617140268.114700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FD4","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UDB26738Q"},{"type":"text","text":" it is a bit worrying.  I am hoping it is only a build or test dependence but I don't really know how it works."}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"21d49036-d6c3-4a0d-95e6-4e5590f0f0d7","type":"message","text":"Can you modify the `configure` script and put `set -x` a few lines before the part we’re interested in, and `set +x` a few lines afterward, so we can see what’s going on","user":"U66GD0880","ts":"1617140336.114900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PjmP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Can you modify the "},{"type":"text","text":"configure","style":{"code":true}},{"type":"text","text":" script and put "},{"type":"text","text":"set -x","style":{"code":true}},{"type":"text","text":" a few lines before the part we’re interested in, and "},{"type":"text","text":"set +x","style":{"code":true}},{"type":"text","text":" a few lines afterward, so we can see what’s going on"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"68b39b51-dbbd-4045-b630-2802a481a416","type":"message","text":"OpenMPI seems to be a prerequisite: <https://github.com/cea-hpc/wi4mpi/blob/7ca1a7d0d91b1b8b135f09f1efc05d77f9130618/README.md#prerequisites>","user":"UDB26738Q","ts":"1617140359.115100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ayOF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"OpenMPI seems to be a prerequisite: "},{"type":"link","url":"https://github.com/cea-hpc/wi4mpi/blob/7ca1a7d0d91b1b8b135f09f1efc05d77f9130618/README.md#prerequisites"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"da4c494e-b099-4d26-9af7-ec058fc8984a","type":"message","text":"maybe it's used as standard interface like what Elliot suggested in the call","user":"UDB26738Q","ts":"1617140419.115300","team":"T68168MUP","edited":{"user":"UDB26738Q","ts":"1617140426.000000"},"blocks":[{"type":"rich_text","block_id":"elwnG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"maybe it's used as standard interface like what Elliot suggested in the call"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"46d89af3-dff9-449e-8738-667e352764ab","type":"message","text":"I can modify the configure script, is there a way to run `julia build_tarballs.jl` in interactive mode so I can edit the config file by hand or is there an example in Yggdrasil of applying a patch before building?","user":"UBJUA1YAV","ts":"1617140570.115600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=8KB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I can modify the configure script, is there a way to run "},{"type":"text","text":"julia build_tarballs.jl","style":{"code":true}},{"type":"text","text":" in interactive mode so I can edit the config file by hand or is there an example in Yggdrasil of applying a patch before building?"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"319696fd-6b09-44d9-9e16-cb262ec4666c","type":"message","text":"add `--debug=begin` to your `build_tarballs.jl` script.","user":"U66GD0880","ts":"1617140602.115800","team":"T68168MUP","edited":{"user":"U66GD0880","ts":"1617140638.000000"},"blocks":[{"type":"rich_text","block_id":"g1u8s","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"add "},{"type":"text","text":"--debug=begin","style":{"code":true}},{"type":"text","text":" to your "},{"type":"text","text":"build_tarballs.jl","style":{"code":true}},{"type":"text","text":" script."}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"efdc5e93-7821-43a4-9473-3904b9c6172b","type":"message","text":"Or just `--debug` and add a `false` into your script to break on error","user":"U66GD0880","ts":"1617140617.116000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rYg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Or just "},{"type":"text","text":"--debug","style":{"code":true}},{"type":"text","text":" and add a "},{"type":"text","text":"false","style":{"code":true}},{"type":"text","text":" into your script to break on error"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV","reactions":[{"name":"+1","users":["UBJUA1YAV"],"count":1}]},{"client_msg_id":"2d5e1186-1c22-4f08-ae35-932dc611fde8","type":"message","text":"* `--debug=begin`","user":"UDB26738Q","ts":"1617140628.116200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Kgh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"* "},{"type":"text","text":"--debug=begin","style":{"code":true}}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"037a483f-bf2e-4486-80f6-498905c22118","type":"message","text":"en example of recipe applying a patch to the source code: <https://github.com/JuliaPackaging/Yggdrasil/blob/eddbb6c28bccd635ba56eeb31c59993cb703ea9b/P/protoc/build_tarballs.jl> the `DirectorySource` mounts the content of the `bundled` directory, inside which there are the patches <https://github.com/JuliaPackaging/Yggdrasil/tree/eddbb6c28bccd635ba56eeb31c59993cb703ea9b/P/protoc/bundled/patches> applied with `atomic_patch` in the script","user":"UDB26738Q","ts":"1617140766.116600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+6d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"en example of recipe applying a patch to the source code: "},{"type":"link","url":"https://github.com/JuliaPackaging/Yggdrasil/blob/eddbb6c28bccd635ba56eeb31c59993cb703ea9b/P/protoc/build_tarballs.jl"},{"type":"text","text":" the "},{"type":"text","text":"DirectorySource","style":{"code":true}},{"type":"text","text":" mounts the content of the "},{"type":"text","text":"bundled","style":{"code":true}},{"type":"text","text":" directory, inside which there are the patches "},{"type":"link","url":"https://github.com/JuliaPackaging/Yggdrasil/tree/eddbb6c28bccd635ba56eeb31c59993cb703ea9b/P/protoc/bundled/patches"},{"type":"text","text":" applied with "},{"type":"text","text":"atomic_patch","style":{"code":true}},{"type":"text","text":" in the script"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV","reactions":[{"name":"+1","users":["UBJUA1YAV"],"count":1}]},{"client_msg_id":"2f65a411-9548-48e2-aed2-d6ef97d76e9d","type":"message","text":"while we like patches in Yggdrasil, if you wanted to do this interactively, you can of course just save an entire `configure` script and then copy it over in your bash script :P","user":"U66GD0880","ts":"1617141749.116900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FKJxd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"while we like patches in Yggdrasil, if you wanted to do this interactively, you can of course just save an entire "},{"type":"text","text":"configure","style":{"code":true}},{"type":"text","text":" script and then copy it over in your bash script :P"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"56fbfe23-1e78-42fd-ad5d-183f55966d0d","type":"message","text":"<https://gist.github.com/lcw/22bff467f6028b51159151b09607725a>","user":"UBJUA1YAV","ts":"1617142119.117100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fp6","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://gist.github.com/lcw/22bff467f6028b51159151b09607725a"}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"},{"client_msg_id":"845ede51-2da8-423e-8b02-561b1d8c043b","type":"message","text":"Not sure if I got the `set -x` and `set +x` in the right places.","user":"UBJUA1YAV","ts":"1617142279.117300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wzb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Not sure if I got the "},{"type":"text","text":"set -x","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"set +x","style":{"code":true}},{"type":"text","text":" in the right places."}]}]}],"thread_ts":"1617136686.110000","parent_user_id":"UBJUA1YAV"}]