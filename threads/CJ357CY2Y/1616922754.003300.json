[{"client_msg_id":"029ea6a3-19ad-4fb3-8039-ac421a7087cf","type":"message","text":"Does anybody know how to use `IRTools.func()`  in a precompiled module? I'm trying to manually construct a function from IR and put it into my module, but during testing it fails with:\n\n&gt;  Evaluation into the closed module `Inner` breaks incremental compilation because the side effects will not be permanent. This is likely due to some other module mutating `Inner` with `eval` during precompilation - don't do this.\nPutting it into a submodule with `__precompile__(false)`  fixes the issue, but as far as I understand it prevents prcompilation of the parent module too.","user":"U72B014PN","ts":"1616922754.003300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ljY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Does anybody know how to use "},{"type":"text","text":"IRTools.func()","style":{"code":true}},{"type":"text","text":"  in a precompiled module? I'm trying to manually construct a function from IR and put it into my module, but during testing it fails with:\n\n"}]},{"type":"rich_text_quote","elements":[{"type":"text","text":" Evaluation into the closed module "},{"type":"text","text":"Inner","style":{"code":true}},{"type":"text","text":" breaks incremental compilation because the side effects will not be permanent. This is likely due to some other module mutating "},{"type":"text","text":"Inner","style":{"code":true}},{"type":"text","text":" with "},{"type":"text","text":"eval","style":{"code":true}},{"type":"text","text":" during precompilation - don't do this."}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nPutting it into a submodule with "},{"type":"text","text":"__precompile__(false)","style":{"code":true}},{"type":"text","text":"  fixes the issue, but as far as I understand it prevents prcompilation of the parent module too."}]}]}],"thread_ts":"1616922754.003300","reply_count":1,"reply_users_count":1,"latest_reply":"1616922921.003400","reply_users":["U72B014PN"],"is_locked":false,"subscribed":false},{"client_msg_id":"b0089337-9f6f-424f-83fc-7917528a1012","type":"message","text":"Here's the actual code:\n\n```module NEWMOD\n\n__precompile__(false)\n\nimport IRTools\n\nfunction make_splatnew()\n    ir = <http://IRTools.IR|IRTools.IR>()\n    vT = IRTools.argument!(ir)\n    vargs = IRTools.argument!(ir)\n    vres = push!(ir, IRTools.Statement(Expr(:splatnew, vT, vargs)))\n    IRTools.return!(ir, vres)\n    return IRTools.func(ir)\nend\n\n__splatnew__ = NEWMOD.make_splatnew()\n\nend\n\nimport .NEWMOD: __splatnew__\n\n__new__(T, args...) = __splatnew__(T, args)```","user":"U72B014PN","ts":"1616922921.003400","team":"T68168MUP","edited":{"user":"U72B014PN","ts":"1616922943.000000"},"blocks":[{"type":"rich_text","block_id":"DmLdB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Here's the actual code:\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"module NEWMOD\n\n__precompile__(false)\n\nimport IRTools\n\nfunction make_splatnew()\n    ir = IRTools.IR()\n    vT = IRTools.argument!(ir)\n    vargs = IRTools.argument!(ir)\n    vres = push!(ir, IRTools.Statement(Expr(:splatnew, vT, vargs)))\n    IRTools.return!(ir, vres)\n    return IRTools.func(ir)\nend\n\n__splatnew__ = NEWMOD.make_splatnew()\n\nend\n\nimport .NEWMOD: __splatnew__\n\n__new__(T, args...) = __splatnew__(T, args)"}]}]}],"thread_ts":"1616922754.003300","parent_user_id":"U72B014PN"}]