[{"client_msg_id":"43577f91-a978-4aeb-802b-5de292f97ed7","type":"message","text":"To what extent should I make my packages behave like the REPL vs non-REPL? e.g. `Integer^(negative integer)` :\n```julia&gt; 2^-1\n0.5\n\njulia&gt; foo(x, n) = x^n\nfoo (generic function with 1 method)\n\njulia&gt; foo(2, -1)\nERROR: DomainError with -1:\nCannot raise an integer x to a negative power -1.\nMake x or -1 a float by adding a zero decimal (e.g., 2.0^-1 or 2^-1.0 instead of 2^-1), or write 1/x^1, float(x)^-1, x^float(-1) or (x//1)^-1\nStacktrace:\n [1] throw_domerr_powbysq(#unused#::Int64, p::Int64)\n   @ Base ./intfuncs.jl:244\n [2] power_by_squaring(x_::Int64, p::Int64)\n   @ Base ./intfuncs.jl:265\n [3] ^\n   @ ./intfuncs.jl:289 [inlined]\n [4] foo(x::Int64, n::Int64)\n   @ Main ./REPL[2]:1\n [5] top-level scope\n   @ REPL[3]:1```\nIt's quite useful to automatically promote to `float`  and carry on, but is it bad practice?","user":"UDSG73JTH","ts":"1616166555.001500","team":"T68168MUP","edited":{"user":"UDSG73JTH","ts":"1616166591.000000"},"blocks":[{"type":"rich_text","block_id":"wuxq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"To what extent should I make my packages behave like the REPL vs non-REPL? e.g. "},{"type":"text","text":"Integer^(negative integer)","style":{"code":true}},{"type":"text","text":" :\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> 2^-1\n0.5\n\njulia> foo(x, n) = x^n\nfoo (generic function with 1 method)\n\njulia> foo(2, -1)\nERROR: DomainError with -1:\nCannot raise an integer x to a negative power -1.\nMake x or -1 a float by adding a zero decimal (e.g., 2.0^-1 or 2^-1.0 instead of 2^-1), or write 1/x^1, float(x)^-1, x^float(-1) or (x//1)^-1\nStacktrace:\n [1] throw_domerr_powbysq(#unused#::Int64, p::Int64)\n   @ Base ./intfuncs.jl:244\n [2] power_by_squaring(x_::Int64, p::Int64)\n   @ Base ./intfuncs.jl:265\n [3] ^\n   @ ./intfuncs.jl:289 [inlined]\n [4] foo(x::Int64, n::Int64)\n   @ Main ./REPL[2]:1\n [5] top-level scope\n   @ REPL[3]:1"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"It's quite useful to automatically promote to "},{"type":"text","text":"float","style":{"code":true}},{"type":"text","text":"  and carry on, but is it bad practice?"}]}]}],"thread_ts":"1616166555.001500","reply_count":13,"reply_users_count":4,"latest_reply":"1616169845.004200","reply_users":["U7HAYKY9X","U017LQ3A59U","UDSG73JTH","U68QW0PUZ"],"subscribed":false},{"client_msg_id":"0b433a6f-9b0d-4b60-ae9a-9e970eed0525","type":"message","text":"This is not an issue with the REPL directly, but with whether the exponent is a compile-time constant (a literal, in this case).\nIt's not bad style to promote to float, necessarily, but it will lead to type instability that can silently kill performance. You can do it internally in a package if you know performance won't be a problem, but I wouldn't do it with some function where the promoted result could be handed back to the user","user":"U7HAYKY9X","ts":"1616166768.001700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"k+GN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is not an issue with the REPL directly, but with whether the exponent is a compile-time constant (a literal, in this case).\nIt's not bad style to promote to float, necessarily, but it will lead to type instability that can silently kill performance. You can do it internally in a package if you know performance won't be a problem, but I wouldn't do it with some function where the promoted result could be handed back to the user"}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH","reactions":[{"name":"+1","users":["UDSG73JTH","U6740K1SP"],"count":2},{"name":"correct_answer","users":["U6740K1SP"],"count":1}]},{"client_msg_id":"2189ddb5-5b38-4e0e-926a-130b07c5fc3f","type":"message","text":"Because this particular case is such a weird quirk, I would avoid it completely and always require floats if your exponent could be negative","user":"U7HAYKY9X","ts":"1616166829.001900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6GAK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Because this particular case is such a weird quirk, I would avoid it completely and always require floats if your exponent could be negative"}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"},{"client_msg_id":"6099a851-56fe-4b4f-8e04-6143f830d624","type":"message","text":"Alternatively you could always promote the result regardless of the sign of the exponent, recovering type stability (but maybe confusing your user)","user":"U017LQ3A59U","ts":"1616166907.002100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2vh9n","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Alternatively you could always promote the result regardless of the sign of the exponent, recovering type stability (but maybe confusing your user)"}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"},{"client_msg_id":"88f2314c-a431-43a6-ac83-806250932f2b","type":"message","text":"Ahh. I've head a brief read of `intfuncts.jl`  and saw some `Val{p}` s going on for `literal_pow`","user":"UDSG73JTH","ts":"1616167709.002400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Jycva","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ahh. I've head a brief read of "},{"type":"text","text":"intfuncts.jl","style":{"code":true}},{"type":"text","text":"  and saw some "},{"type":"text","text":"Val{p}","style":{"code":true}},{"type":"text","text":" s going on for "},{"type":"text","text":"literal_pow","style":{"code":true}}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"},{"client_msg_id":"f2a9c3f4-6f40-4a7b-bf78-ccf72384b317","type":"message","text":"I reckon I'll leave it up to the users rather than do secret things under the hood.","user":"UDSG73JTH","ts":"1616167816.002600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nYwN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I reckon I'll leave it up to the users rather than do secret things under the hood."}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"},{"client_msg_id":"01b9a550-fd00-4c2a-92c4-f9d0869dcdd4","type":"message","text":"least surprise .. often the best surprise","user":"U68QW0PUZ","ts":"1616168062.002800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Sm/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"least surprise .. often the best surprise"}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"},{"client_msg_id":"f5817ea5-7b03-4426-b5ba-05e4f21d2c63","type":"message","text":"I can't make my mind up tbh. Would you be surprised if an operation on 2^0 failed (I know this doesn't actually fail)? Or would you prefer an answer of 1.0?","user":"UDSG73JTH","ts":"1616168275.003000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"I/6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I can't make my mind up tbh. Would you be surprised if an operation on 2^0 failed (I know this doesn't actually fail)? Or would you prefer an answer of 1.0?"}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"},{"client_msg_id":"fa975ebc-49d0-43b5-95fd-220fb2f14175","type":"message","text":"If the failure annoy me enough I'll open an issue and maybe a PR :stuck_out_tongue:. Unless you have a strong rational I would go with either the safer or the easier to implement option.","user":"U017LQ3A59U","ts":"1616168492.003200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"S7M","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If the failure annoy me enough I'll open an issue and maybe a PR "},{"type":"emoji","name":"stuck_out_tongue"},{"type":"text","text":". Unless you have a strong rational I would go with either the safer or the easier to implement option."}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"},{"client_msg_id":"5a640afe-7c32-4479-8bc1-b7868ddcd88c","type":"message","text":"least surprise &amp; least work it is.","user":"UDSG73JTH","ts":"1616168538.003400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fuL1I","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"least surprise & least work it is."}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"},{"client_msg_id":"4d4e21b1-338e-4197-8429-994a9a7f0c5f","type":"message","text":"The erroring code is also self documented in a sense, while with the other option you'd have to make sure what's happening is clear from the doc. The cost of maintaining documentation is easy to underestimate.","user":"U017LQ3A59U","ts":"1616168685.003600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3cB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The erroring code is also self documented in a sense, while with the other option you'd have to make sure what's happening is clear from the doc. The cost of maintaining documentation is easy to underestimate."}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"},{"client_msg_id":"4378e3e1-6c19-4ccd-93f7-d5f731608172","type":"message","text":"While I've got you all, is there a macro for showing the code paths to some configurable depth?","user":"UDSG73JTH","ts":"1616169376.003800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"di=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"While I've got you all, is there a macro for showing the code paths to some configurable depth?"}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"},{"client_msg_id":"8cd6e54b-d059-466b-a3d9-ba6d65b9d93f","type":"message","text":"Something like @code_warntype but showing all the calls","user":"UDSG73JTH","ts":"1616169414.004000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jkJfC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Something like @code_warntype but showing all the calls"}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"},{"client_msg_id":"50ce646c-470d-4d18-b335-8ec950604496","type":"message","text":"nvm, Debugger will do.","user":"UDSG73JTH","ts":"1616169845.004200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"v/C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"nvm, Debugger will do."}]}]}],"thread_ts":"1616166555.001500","parent_user_id":"UDSG73JTH"}]