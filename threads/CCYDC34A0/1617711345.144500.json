[{"client_msg_id":"bbc94cf5-ef7f-4f5f-87a7-c484fae3d3e7","type":"message","text":"Hi all, I'm tipping my toes gently in Julia and Turing and so far I really love what I see, but I have some difficulties coming from python (and relatively new to PPLs in general).\nI'm trying to do something that I guess should be simple but got stuck so I thought I'd fetch some help :slightly_smiling_face:\nI'm trying to fit a zero-truncated Poisson, and get errors where the autodiff cannot infer the types of something. I basically adapted the simple example on Turing's homepage like so:\n```# Import libraries.\nusing Turing, StatsPlots, Random\n\n# Set the true Poisson rate\nλ_true = 0.5\n\n# Number of un-truncated Poisson observations (I know I can directly sample from Truncated, but don't want to).\nN = 1000\n\n# Draw data from a Poisson distribution\nRandom.seed!(12)\ndata = rand(Poisson(λ_true), N)\ndata_trunc = data[data .&gt; 0]\n\n# Declare our Turing model.\n@model function truncated_poisson(y)\n    # Our prior belief about the Poisson rate.\n    λ ~ Beta(1, 1)\n\n    # Data model\n    for n in 1:length(y)\n        y[n] ~ truncated(Poisson(λ), 0, Inf)\n    end\nend\n\nprint(length(data_trunc))\n\n# Settings of the Hamiltonian Monte Carlo (HMC) sampler.\niterations = 1000\nϵ = 0.05\nτ = 10\n\n# Start sampling.\nchain = sample(truncated_poisson(data_trunc), HMC(ϵ, τ), iterations)\n\n# Plot a summary of the sampling process for the parameter p, i.e. the probability of heads in a coin.\nhistogram(chain[:λ])```\nAm I doing something obviously stupid? I'd really appreciate help on this, thanks! :sweat_smile:  And thanks for the good work you guys are doing!!","user":"U01PJ4X8YCV","ts":"1617711345.144500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2Dmq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi all, I'm tipping my toes gently in Julia and Turing and so far I really love what I see, but I have some difficulties coming from python (and relatively new to PPLs in general).\nI'm trying to do something that I guess should be simple but got stuck so I thought I'd fetch some help "},{"type":"emoji","name":"slightly_smiling_face"},{"type":"text","text":"\nI'm trying to fit a zero-truncated Poisson, and get errors where the autodiff cannot infer the types of something. I basically adapted the simple example on Turing's homepage like so:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"# Import libraries.\nusing Turing, StatsPlots, Random\n\n# Set the true Poisson rate\nλ_true = 0.5\n\n# Number of un-truncated Poisson observations (I know I can directly sample from Truncated, but don't want to).\nN = 1000\n\n# Draw data from a Poisson distribution\nRandom.seed!(12)\ndata = rand(Poisson(λ_true), N)\ndata_trunc = data[data .> 0]\n\n# Declare our Turing model.\n@model function truncated_poisson(y)\n    # Our prior belief about the Poisson rate.\n    λ ~ Beta(1, 1)\n\n    # Data model\n    for n in 1:length(y)\n        y[n] ~ truncated(Poisson(λ), 0, Inf)\n    end\nend\n\nprint(length(data_trunc))\n\n# Settings of the Hamiltonian Monte Carlo (HMC) sampler.\niterations = 1000\nϵ = 0.05\nτ = 10\n\n# Start sampling.\nchain = sample(truncated_poisson(data_trunc), HMC(ϵ, τ), iterations)\n\n# Plot a summary of the sampling process for the parameter p, i.e. the probability of heads in a coin.\nhistogram(chain[:λ])"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Am I doing something obviously stupid? I'd really appreciate help on this, thanks! "},{"type":"emoji","name":"sweat_smile"},{"type":"text","text":"  And thanks for the good work you guys are doing!!"}]}]}],"thread_ts":"1617711345.144500","reply_count":58,"reply_users_count":4,"latest_reply":"1617721825.157800","reply_users":["U01PJ4X8YCV","UC0SY9JFP","U85JBUGGP","UHDNY2YMA"],"is_locked":false,"subscribed":false},{"client_msg_id":"c26754d2-3d71-4aba-8d92-ba7645dae33a","type":"message","text":"I forgot to add the error message I get. It starts with:\n```MethodError: no method matching poiscdf(::ForwardDiff.Dual{ForwardDiff.Tag{Turing.Core.var\"#f#1\"{DynamicPPL.VarInfo{NamedTuple{(:λ,),Tuple{DynamicPPL.Metadata{Dict{DynamicPPL.VarName{:λ,Tuple{}},Int64},Array{Beta{Float64},1},Array{DynamicPPL.VarName{:λ,Tuple{}},1},Array{Float64,1},Array{Set{DynamicPPL.Selector},1}}}},Float64},DynamicPPL.Model{var\"#29#30\",(:y,),(),(),Tuple{Array{Int64,1}},Tuple{}},DynamicPPL.Sampler{HMC{Turing.Core.ForwardDiffAD{40},(),AdvancedHMC.UnitEuclideanMetric}},DynamicPPL.DefaultContext},Float64},Float64,1}, ::Int64)\nClosest candidates are:\n  poiscdf(::Union{Float64, Int64}, ::Union{Float64, Int64}) at /home/omri/.julia/packages/StatsFuns/zJ1EI/src/rmath.jl:77```","user":"U01PJ4X8YCV","ts":"1617711446.144600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"N5qDW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I forgot to add the error message I get. It starts with:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"MethodError: no method matching poiscdf(::ForwardDiff.Dual{ForwardDiff.Tag{Turing.Core.var\"#f#1\"{DynamicPPL.VarInfo{NamedTuple{(:λ,),Tuple{DynamicPPL.Metadata{Dict{DynamicPPL.VarName{:λ,Tuple{}},Int64},Array{Beta{Float64},1},Array{DynamicPPL.VarName{:λ,Tuple{}},1},Array{Float64,1},Array{Set{DynamicPPL.Selector},1}}}},Float64},DynamicPPL.Model{var\"#29#30\",(:y,),(),(),Tuple{Array{Int64,1}},Tuple{}},DynamicPPL.Sampler{HMC{Turing.Core.ForwardDiffAD{40},(),AdvancedHMC.UnitEuclideanMetric}},DynamicPPL.DefaultContext},Float64},Float64,1}, ::Int64)\nClosest candidates are:\n  poiscdf(::Union{Float64, Int64}, ::Union{Float64, Int64}) at /home/omri/.julia/packages/StatsFuns/zJ1EI/src/rmath.jl:77"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"5e8af94d-b378-43b9-9f67-e5cb83b60aec","type":"message","text":"Yeah, that looks like a typical *pain in the ass* AD issue for the CDF of a Poisson distribution as it’s imported as an R function from StatsFuns.","user":"UC0SY9JFP","ts":"1617712307.144800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sdh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, that looks like a typical "},{"type":"text","text":"pain in the ass","style":{"bold":true}},{"type":"text","text":" AD issue for the CDF of a Poisson distribution as it’s imported as an R function from StatsFuns."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"e6c9ec82-17e0-43d1-b496-fb2be4f8c50d","type":"message","text":"<@U85JBUGGP> any idea how to get around this?","user":"UC0SY9JFP","ts":"1617712329.145000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GiT","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U85JBUGGP"},{"type":"text","text":" any idea how to get around this?"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"77e9b848-f1f0-4619-aca7-9d8f67eb6c22","type":"message","text":"hmm never seen this before","user":"U85JBUGGP","ts":"1617712468.145200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zPxLj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hmm never seen this before"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"4d4bf356-0791-4165-9d2d-209d524db821","type":"message","text":"let me check","user":"U85JBUGGP","ts":"1617712471.145400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"J9V","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"let me check"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"9e23feb7-9806-4028-9aca-1d45a0b6c4b5","type":"message","text":"One option would be to simply hack up the zero truncated Poisson and add it to Turing’s stdlib as it’s a standard case anyways.","user":"UC0SY9JFP","ts":"1617712495.145600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hCdfp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"One option would be to simply hack up the zero truncated Poisson and add it to Turing’s stdlib as it’s a standard case anyways."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"617255de-1371-4b13-806f-3a1b9187eb7c","type":"message","text":"Alternatively just use Poisson. If your data is truncated, this will give you an unnormalised logpdf which is good enough for MCMC because the domain is constant.","user":"U85JBUGGP","ts":"1617712621.145800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"D=qxK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Alternatively just use Poisson. If your data is truncated, this will give you an unnormalised logpdf which is good enough for MCMC because the domain is constant."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"ab2e693e-66ff-4e51-8c51-7eac5c0bed25","type":"message","text":"but wouldn't that overestimate the rate? I have a case with very low rates (~0.05)","user":"U01PJ4X8YCV","ts":"1617712669.146000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wFWeJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but wouldn't that overestimate the rate? I have a case with very low rates (~0.05)"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"d5e32e9e-2702-46b4-ba9d-80871ee94c3e","type":"message","text":"and intend to build a GLM around that","user":"U01PJ4X8YCV","ts":"1617712678.146200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/UC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and intend to build a GLM around that"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"137b710d-a216-4531-8de5-2fb9a4773214","type":"message","text":"Well the only thing that a truncated does in this case is scale the probabilities up so they sum up to 1. If your data is truly truncated, you don’t really need this “scaling” at all when sampling because MCMC can handle unnormalised pdfs.","user":"U85JBUGGP","ts":"1617712753.146400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LsoQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well the only thing that a truncated does in this case is scale the probabilities up so they sum up to 1. If your data is truly truncated, you don’t really need this “scaling” at all when sampling because MCMC can handle unnormalised pdfs."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"3c1be3eb-3095-4093-b52f-86949b3279f8","type":"message","text":"If your data is not truncated, then your truncated model will error anyways.","user":"U85JBUGGP","ts":"1617712799.146600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xul","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If your data is not truncated, then your truncated model will error anyways."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"5dc9d329-8750-488d-a32a-ac510c3bf4f8","type":"message","text":"Well, actually, I followed this blog post (<http://blog.richardweiss.org/2017/10/18/pymc3-truncated-poisson.html>) to implement ZTP in PyMC3 where this worked just fine. I now tried running the sampling with true rate λ=0.05 and just a Poisson (not truncated) and got an estimate for λ around 1. Following that blogpost worked just fine but I was hoping to try this out in Julia..","user":"U01PJ4X8YCV","ts":"1617713007.146800","team":"T68168MUP","attachments":[{"title":"Truncated Poisson Distributions in PyMC3","title_link":"http://blog.richardweiss.org/2017/10/18/pymc3-truncated-poisson.html","text":"IntroductionIn this post, I’ll be describing how I implemented a zero-truncated poisson distribution in PyMC3, as well as why I did so.","fallback":"Truncated Poisson Distributions in PyMC3","from_url":"http://blog.richardweiss.org/2017/10/18/pymc3-truncated-poisson.html","service_icon":"http://blog.richardweiss.org/favicon.ico","service_name":"blog.richardweiss.org","id":1,"original_url":"http://blog.richardweiss.org/2017/10/18/pymc3-truncated-poisson.html"}],"blocks":[{"type":"rich_text","block_id":"cB7li","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well, actually, I followed this blog post ("},{"type":"link","url":"http://blog.richardweiss.org/2017/10/18/pymc3-truncated-poisson.html"},{"type":"text","text":") to implement ZTP in PyMC3 where this worked just fine. I now tried running the sampling with true rate λ=0.05 and just a Poisson (not truncated) and got an estimate for λ around 1. Following that blogpost worked just fine but I was hoping to try this out in Julia.."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"1992912e-1222-4f62-823e-401c550aaac3","type":"message","text":"The truncation does add a term to the log likelihood","user":"U01PJ4X8YCV","ts":"1617713021.147100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ryyV0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The truncation does add a term to the log likelihood"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"93bec573-8a8d-4ced-924d-cad09d18f024","type":"message","text":"Well, the zero truncated Poisson is a conditional Poisson distribution. So simply using a Poisson in MCMC should give you wrong estimates.","user":"UC0SY9JFP","ts":"1617713021.147300","team":"T68168MUP","edited":{"user":"UC0SY9JFP","ts":"1617713036.000000"},"blocks":[{"type":"rich_text","block_id":"PEV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well, the zero truncated Poisson is a conditional Poisson distribution. So simply using a Poisson in MCMC should give you wrong estimates."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"6633092b-50a6-4d4a-90fb-008a18c751ce","type":"message","text":"Exactly","user":"U01PJ4X8YCV","ts":"1617713033.147500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cTii","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Exactly"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"77b6fcff-c85a-414c-8f74-d34fa16e238b","type":"message","text":"I’m trying to write up a code example…. wip…","user":"UC0SY9JFP","ts":"1617713063.147800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Y2H0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m trying to write up a code example…. wip…"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"ea50db15-bb23-4c53-9e75-f0199a8538b2","type":"message","text":":pray:","user":"U01PJ4X8YCV","ts":"1617713072.148000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bXm","elements":[{"type":"rich_text_section","elements":[{"type":"emoji","name":"pray"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"1062d052-9f08-4066-b509-fc31a370acca","type":"message","text":"btw, I listened yesterday to your interview with Alex Andorra and really liked it :slightly_smiling_face:","user":"U01PJ4X8YCV","ts":"1617713086.148200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dlg=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"btw, I listened yesterday to your interview with Alex Andorra and really liked it "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"bc7fe31e-3b33-4e1b-bd82-bcc1984b1f02","type":"message","text":"Thanks! :slightly_smiling_face:","user":"UC0SY9JFP","ts":"1617713103.148400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SAJTG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks! "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"9c368a91-4598-49c0-9125-6ebe6c203e48","type":"message","text":"now I want to know more about probabilistic circuits :wink:","user":"U01PJ4X8YCV","ts":"1617713138.148600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RjHs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"now I want to know more about probabilistic circuits "},{"type":"emoji","name":"wink"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV","reactions":[{"name":"tada","users":["UC0SY9JFP"],"count":1}]},{"client_msg_id":"5d430b3c-5c08-4bf7-9379-9867f510e4b6","type":"message","text":"```using Distributions\nusing StatsFuns\nusing SpecialFunctions\n\nstruct PositivePoisson{T&lt;:Real} &lt;: DiscreteUnivariateDistribution\n  λ::T\nend\n\nDistributions.@distr_support PositivePoisson 1 (d.λ == zero(typeof(d.λ)) ? 1 : Inf)\n_ppoisson_logpdf(x, λ) = StatsFuns.xlogy(x, λ) - logexpm1(λ) - loggamma(x + 1)\nDistributions.logpdf(d::PositivePoisson, x::Real) = _ppoisson_logpdf(x, d.λ)```","user":"UC0SY9JFP","ts":"1617714785.148900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8LSgY","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using Distributions\nusing StatsFuns\nusing SpecialFunctions\n\nstruct PositivePoisson{T<:Real} <: DiscreteUnivariateDistribution\n  λ::T\nend\n\nDistributions.@distr_support PositivePoisson 1 (d.λ == zero(typeof(d.λ)) ? 1 : Inf)\n_ppoisson_logpdf(x, λ) = StatsFuns.xlogy(x, λ) - logexpm1(λ) - loggamma(x + 1)\nDistributions.logpdf(d::PositivePoisson, x::Real) = _ppoisson_logpdf(x, d.λ)"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"55fa4b87-00f6-4a2a-bbfe-0a84e748380b","type":"message","text":"I think that should do the trick, if I didn’t mess up something in coding it up.","user":"UC0SY9JFP","ts":"1617714803.149100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RpI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think that should do the trick, if I didn’t mess up something in coding it up."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"237700ba-c02f-4649-8a82-4d6ad65c58f9","type":"message","text":"&gt; Well, actually, I followed this blog post (<http://blog.richardweiss.org/2017/10/18/pymc3-truncated-poisson.html>) to implement ZTP in PyMC3\nI see. Thanks for this. The normalisation constant is actually a function of lambda. So yes the 2 are not the same. My bad.","user":"U85JBUGGP","ts":"1617715012.149300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Afc","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"Well, actually, I followed this blog post ("},{"type":"link","url":"http://blog.richardweiss.org/2017/10/18/pymc3-truncated-poisson.html"},{"type":"text","text":") to implement ZTP in PyMC3"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"I see. Thanks for this. The normalisation constant is actually a function of lambda. So yes the 2 are not the same. My bad."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"2203feca-f229-475a-8b39-765cf0fbee57","type":"message","text":"this would be nice in Distributions.jl btw","user":"U85JBUGGP","ts":"1617715115.149500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pD/6Z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"this would be nice in Distributions.jl btw"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV","reactions":[{"name":"+1","users":["UC0SY9JFP","U01PJ4X8YCV"],"count":2}]},{"client_msg_id":"62865805-ddc1-4277-9321-c7c136a38249","type":"message","text":"I agree. I can try write up a PR. Or maybe someone is faster and can add the missing functionallity.","user":"UC0SY9JFP","ts":"1617715241.149800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Yl1/0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I agree. I can try write up a PR. Or maybe someone is faster and can add the missing functionallity."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"8b96a7b4-6767-4855-8bfc-b3ebe144b3a6","type":"message","text":"Awesome! I think it would be really nice to have this supported out of the box :wink:","user":"U01PJ4X8YCV","ts":"1617715372.150100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pccsW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Awesome! I think it would be really nice to have this supported out of the box "},{"type":"emoji","name":"wink"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"8cf50241-f137-4238-aca7-6147a5438bde","type":"message","text":"it’s one PR away, you can do it!","user":"U85JBUGGP","ts":"1617715399.150300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kqTQ4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it’s one PR away, you can do it!"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"8ea75bf3-afe2-4adf-a2d9-4ac09adb8cd5","type":"message","text":"Would it be much more difficult to support any truncation? (I only need Zero, but maybe for someone else out there...)","user":"U01PJ4X8YCV","ts":"1617715401.150500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Fbqg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Would it be much more difficult to support any truncation? (I only need Zero, but maybe for someone else out there...)"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"54ca2a08-7aca-4275-a5da-55b1463ec714","type":"message","text":"Yes, because Distributions.jl currently uses an R implementation for the CDF of a Poisson distribution.","user":"UC0SY9JFP","ts":"1617715447.150700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MYfF/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, because Distributions.jl currently uses an R implementation for the CDF of a Poisson distribution."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"2ecf55f7-5e01-48a8-ac9b-86a2f30c85a4","type":"message","text":"I don't mind trying to make a PR, but my knowledge of Julia is very superficial and my time is relatively limited... But I can give it a go","user":"U01PJ4X8YCV","ts":"1617715626.150900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xbIK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't mind trying to make a PR, but my knowledge of Julia is very superficial and my time is relatively limited... But I can give it a go"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"e53ecb0a-245c-4037-854d-17a4f7862726","type":"message","text":"btw, I would name it ZeroTruncatedPoisson rather than PositivePoisson, since I believe that's what people use so it'll be easier to find, I think","user":"U01PJ4X8YCV","ts":"1617715662.151100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oOVwx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"btw, I would name it ZeroTruncatedPoisson rather than PositivePoisson, since I believe that's what people use so it'll be easier to find, I think"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV","reactions":[{"name":"+1","users":["UC0SY9JFP"],"count":1}]},{"client_msg_id":"8205b7c9-cf58-4303-aca6-fccfcce99341","type":"message","text":"Would you create a new file for it in `src/univariate/discrete/`?","user":"U01PJ4X8YCV","ts":"1617716842.151400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OIe+o","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Would you create a new file for it in "},{"type":"text","text":"src/univariate/discrete/","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"064b0cd0-2322-4846-9349-4f4c50247056","type":"message","text":"I think that’s reasonable","user":"U85JBUGGP","ts":"1617716897.151600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"avak","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think that’s reasonable"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV","reactions":[{"name":"+1","users":["UC0SY9JFP"],"count":1}]},{"client_msg_id":"ea43b2a7-3eec-4a10-a5d7-0438080d8374","type":"message","text":"Is the `using...` part in the beginning of the snapshot code from Martin necessary within the library?","user":"U01PJ4X8YCV","ts":"1617717983.151900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"t0T","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is the "},{"type":"text","text":"using...","style":{"code":true}},{"type":"text","text":" part in the beginning of the snapshot code from Martin necessary within the library?"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"8655b14c-38fb-4649-b041-87ba120ab8fc","type":"message","text":"No, Distributions.jl already depends on all of those packages.","user":"UC0SY9JFP","ts":"1617718141.152100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0zT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"No, Distributions.jl already depends on all of those packages."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"e0570c92-54b2-4ada-b074-41159bbe6780","type":"message","text":"I think you can probably use <https://github.com/JuliaStats/Distributions.jl/blob/master/src/univariate/discrete/poisson.jl> as a template.","user":"UC0SY9JFP","ts":"1617718174.152300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RD9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think you can probably use "},{"type":"link","url":"https://github.com/JuliaStats/Distributions.jl/blob/master/src/univariate/discrete/poisson.jl"},{"type":"text","text":" as a template."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"3e318e82-ffd3-4789-8c3a-fe1d01d57dd8","type":"message","text":":thinking_face:","user":"U01PJ4X8YCV","ts":"1617718676.152500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"t6+tB","elements":[{"type":"rich_text_section","elements":[{"type":"emoji","name":"thinking_face"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"9e7e33a7-11ed-4058-bc64-2f651fa9ce70","type":"message","text":"Is there some notion of inheritance in Julia? where I can re-use Poisson somehow for this?","user":"U01PJ4X8YCV","ts":"1617718689.152700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"55r","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there some notion of inheritance in Julia? where I can re-use Poisson somehow for this?"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"f5a8d390-556d-4547-893a-4c0152e9683d","type":"message","text":"There seems to be a lot of stuff going on in poisson.jl I don't really understand","user":"U01PJ4X8YCV","ts":"1617718868.152900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NPpll","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"There seems to be a lot of stuff going on in poisson.jl I don't really understand"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"697b0303-0186-4988-9cd9-1713e7f8ea58","type":"message","text":"define what you understand and others will guide you when you submit the PR","user":"U85JBUGGP","ts":"1617719177.153100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jTPtL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"define what you understand and others will guide you when you submit the PR"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"b543679c-c062-43da-ad28-4b7e1a60654e","type":"message","text":"a PR is like a paper submission but better, it will improve a lot from feedback","user":"U85JBUGGP","ts":"1617719207.153300","team":"T68168MUP","edited":{"user":"U85JBUGGP","ts":"1617719214.000000"},"blocks":[{"type":"rich_text","block_id":"=ygv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"a PR is like a paper submission but better, it will improve a lot from feedback"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"0bce4a33-dbf2-4707-a68a-36a99c3dc8bc","type":"message","text":"Actually, a PR to StatsFuns.jl is probably more approriate: <https://github.com/JuliaStats/StatsFuns.jl/blob/59989e1d73a5e3d0e6298a60c8c4eae9cac6bbc5/src/distrs/pois.jl>","user":"UHDNY2YMA","ts":"1617719495.153600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FxkH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Actually, a PR to StatsFuns.jl is probably more approriate: "},{"type":"link","url":"https://github.com/JuliaStats/StatsFuns.jl/blob/59989e1d73a5e3d0e6298a60c8c4eae9cac6bbc5/src/distrs/pois.jl"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"7473df52-cfc6-4053-a78a-919c85d197cd","type":"message","text":"You can see what they've done there for `poislogpdf`: in the case where it's not a `Float32` or `Float64` but still a `Real` (which is the case for `ForwardDiff.Dual`), it will \"fall back\" to a Julia implementation rather than calling the R-impl.","user":"UHDNY2YMA","ts":"1617719560.153800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bD6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You can see what they've done there for "},{"type":"text","text":"poislogpdf","style":{"code":true}},{"type":"text","text":": in the case where it's not a "},{"type":"text","text":"Float32","style":{"code":true}},{"type":"text","text":" or "},{"type":"text","text":"Float64","style":{"code":true}},{"type":"text","text":" but still a "},{"type":"text","text":"Real","style":{"code":true}},{"type":"text","text":" (which is the case for "},{"type":"text","text":"ForwardDiff.Dual","style":{"code":true}},{"type":"text","text":"), it will \"fall back\" to a Julia implementation rather than calling the R-impl."}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"b14d72f5-e3fb-47ca-a3e3-d0c734009818","type":"message","text":"If one were to implement a similar thing for the `poiscdf` and `poislogcdf`, things would just work:)","user":"UHDNY2YMA","ts":"1617719596.154000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ad+c","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If one were to implement a similar thing for the "},{"type":"text","text":"poiscdf","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"poislogcdf","style":{"code":true}},{"type":"text","text":", things would just work:)"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"e7d80b7a-e7a5-4dcd-a21b-254d2a0599a4","type":"message","text":"I love it when things Just Work™ :slightly_smiling_face:","user":"U01PJ4X8YCV","ts":"1617719656.154200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GT7L6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I love it when things Just Work™ "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV","reactions":[{"name":"point_up_2","users":["UHDNY2YMA"],"count":1}]},{"client_msg_id":"7e5a4a11-040c-4acb-9c7a-27e58dc69646","type":"message","text":"So that means not implementing a ZTP directly, but just making sure `Real` is supported by poisson would be enough?","user":"U01PJ4X8YCV","ts":"1617719707.154400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dXd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So that means not implementing a ZTP directly, but just making sure "},{"type":"text","text":"Real","style":{"code":true}},{"type":"text","text":" is supported by poisson would be enough?"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"1a55d7d5-9ec3-4302-a619-ba2173dacfc2","type":"message","text":"Exactly:)","user":"UHDNY2YMA","ts":"1617719735.154700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TJeZi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Exactly:)"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"f48f1db7-2450-41b0-a10d-3334058322d3","type":"message","text":"Actually that's why I tried using Turing.jl in the first place instead of PyMC3 - there I needed to implement the ZTP as a class, and it seemed that in Turing.jl I just need to do `y .~ truncated(Poisson(λ), 0, Inf)` which is way cooler","user":"U01PJ4X8YCV","ts":"1617719850.154900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LhI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Actually that's why I tried using Turing.jl in the first place instead of PyMC3 - there I needed to implement the ZTP as a class, and it seemed that in Turing.jl I just need to do "},{"type":"text","text":"y .~ truncated(Poisson(λ), 0, Inf)","style":{"code":true}},{"type":"text","text":" which is way cooler"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"f0ea5698-63f9-43a0-bc63-1f5ab28eed68","type":"message","text":"I'm trying to convert my colleagues to use more Bayesian methods (myself included) - so everything has to seem super simple and fluid :wink:","user":"U01PJ4X8YCV","ts":"1617719912.155100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xs+v/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm trying to convert my colleagues to use more Bayesian methods (myself included) - so everything has to seem super simple and fluid "},{"type":"emoji","name":"wink"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"79db189b-5f32-4558-b7d6-713bc0aac340","type":"message","text":"So what would be the simplest way to test this? Fork `StatsFuns.jl` and somehow install in locally?","user":"U01PJ4X8YCV","ts":"1617719967.155300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8W8Vg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So what would be the simplest way to test this? Fork "},{"type":"text","text":"StatsFuns.jl","style":{"code":true}},{"type":"text","text":" and somehow install in locally?"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"eaa8d322-a83a-49eb-a995-00b1959e3bd5","type":"message","text":"(sorry, I'm way more versed in `pip install -e .` :sweat_smile: )","user":"U01PJ4X8YCV","ts":"1617719995.155500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Yv4L","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(sorry, I'm way more versed in "},{"type":"text","text":"pip install -e .","style":{"code":true}},{"type":"text","text":" "},{"type":"emoji","name":"sweat_smile"},{"type":"text","text":" )"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"2a9520c7-6054-4836-aaee-6c009595fbc4","type":"message","text":"This is another neat thing about Julia: you can hack on packages without installing anything:) A sec","user":"UHDNY2YMA","ts":"1617720023.155700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"U41U","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is another neat thing about Julia: you can hack on packages without installing anything:) A sec"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"256ABB97-1EE9-480B-BF67-23E89896DDD3","type":"message","text":"Good point, implementing the CDF in Julia is probably a better idea. ","user":"UC0SY9JFP","ts":"1617720156.156800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8/ow9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Good point, implementing the CDF in Julia is probably a better idea. "}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"221dc884-d0b8-47f7-9afc-0e2f4efa5d0f","type":"message","text":"<https://gist.github.com/torfjelde/6652e2b0ae82ba7a487f8b374827779a>","user":"UHDNY2YMA","ts":"1617721023.157000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"z87t","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://gist.github.com/torfjelde/6652e2b0ae82ba7a487f8b374827779a"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"755c44f6-b48f-44ed-b4e6-302ef0b410af","type":"message","text":"FYI: you can copy-paste REPL-format/output into the Julia REPL, and it will only execute the code. So you can just copy paste my snippet if you want to try:)","user":"UHDNY2YMA","ts":"1617721092.157200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vbV=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"FYI: you can copy-paste REPL-format/output into the Julia REPL, and it will only execute the code. So you can just copy paste my snippet if you want to try:)"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"f2fda42f-4060-41c7-9521-c1241f3d2fac","type":"message","text":"Fair warning: when experimenting like this (in particular when you're overloading methods using a more abstract type, e.g. our `Number` vs. `Union{Int64, Float64}`), I'd suggest first implementing a `poiscdf`, *not* `StatsFuns.poiscdf`, then test your `poiscdf` against `StatsFuns.poiscdf` verify that your implementation is correct, and *then* overload the method.\n\nI say this because I just forgot to add a `exp` to the `StatsFuns.poiscdf` and noticed because I did the above :sweat_smile:","user":"UHDNY2YMA","ts":"1617721477.157400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UoCZ0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Fair warning: when experimenting like this (in particular when you're overloading methods using a more abstract type, e.g. our "},{"type":"text","text":"Number","style":{"code":true}},{"type":"text","text":" vs. "},{"type":"text","text":"Union{Int64, Float64}","style":{"code":true}},{"type":"text","text":"), I'd suggest first implementing a "},{"type":"text","text":"poiscdf","style":{"code":true}},{"type":"text","text":", "},{"type":"text","text":"not","style":{"bold":true}},{"type":"text","text":" "},{"type":"text","text":"StatsFuns.poiscdf","style":{"code":true}},{"type":"text","text":", then test your "},{"type":"text","text":"poiscdf","style":{"code":true}},{"type":"text","text":" against "},{"type":"text","text":"StatsFuns.poiscdf","style":{"code":true}},{"type":"text","text":" verify that your implementation is correct, and "},{"type":"text","text":"then","style":{"bold":true}},{"type":"text","text":" overload the method.\n\nI say this because I just forgot to add a "},{"type":"text","text":"exp","style":{"code":true}},{"type":"text","text":" to the "},{"type":"text","text":"StatsFuns.poiscdf","style":{"code":true}},{"type":"text","text":" and noticed because I did the above "},{"type":"emoji","name":"sweat_smile"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"76909719-8d3e-4249-ad24-ced0310c5c27","type":"message","text":"I updated the gist to reflect the workflow I described above","user":"UHDNY2YMA","ts":"1617721708.157600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aFrWs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I updated the gist to reflect the workflow I described above"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"},{"client_msg_id":"b1657e7f-00f9-4ad6-8e05-744cb1a16f34","type":"message","text":"Also, this is definitively something that should go to StatsFuns.jl, so if you make a PR, do let us know and we'll help out with feedback:)\nOtherwise one of us Turing-peeps should do it at some point, because this should be in StatsFuns.jl :+1:","user":"UHDNY2YMA","ts":"1617721825.157800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Tf5J","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also, this is definitively something that should go to StatsFuns.jl, so if you make a PR, do let us know and we'll help out with feedback:)\nOtherwise one of us Turing-peeps should do it at some point, because this should be in StatsFuns.jl "},{"type":"emoji","name":"+1"}]}]}],"thread_ts":"1617711345.144500","parent_user_id":"U01PJ4X8YCV"}]