[{"client_msg_id":"e04f1568-3a34-4297-896e-f1d2d6fa2e47","type":"message","text":"I’m trying to implement this simple hierarchical model in Turing:\ny_j | θ_j, σ_j ~ N(θ_j, σ_{j}^2$\n θ_j | μ, τ ~ N(μ, τ^2)$\nwith priors p(μ, τ)\n\nWould\n```@model meta(y) = begin\n    μ ~ Uniform(0, 1)\n    τ ~ Uniform(0, 1)\n    θ ~ Normal(μ, τ^2)\n\n    for j in eachindex(y) \n      y[j] ~  Normal(θ, τ)\n    end\nend```\nbe correct? Do I have to do anything to specify that the theta is specific to / potentially different for each y_j?","user":"US8V7JSKB","ts":"1615541250.026300","team":"T68168MUP","edited":{"user":"US8V7JSKB","ts":"1615541347.000000"},"blocks":[{"type":"rich_text","block_id":"JPOp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m trying to implement this simple hierarchical model in Turing:\ny_j | θ_j, σ_j ~ N(θ_j, σ_{j}^2$\n θ_j | μ, τ ~ N(μ, τ^2)$\nwith priors p(μ, τ)\n\nWould\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@model meta(y) = begin\n    μ ~ Uniform(0, 1)\n    τ ~ Uniform(0, 1)\n    θ ~ Normal(μ, τ^2)\n\n    for j in eachindex(y) \n      y[j] ~  Normal(θ, τ)\n    end\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"be correct? Do I have to do anything to specify that the theta is specific to / potentially different for each y_j?"}]}]}],"thread_ts":"1615541250.026300","reply_count":7,"reply_users_count":3,"latest_reply":"1615570064.036900","reply_users":["U01C2AJ9F63","US8V7JSKB","U01QBF4PHKP"],"subscribed":false},{"client_msg_id":"9826495b-9e03-4715-ad24-ce8a8749dccf","type":"message","text":"As a model, this is fine. But it certainly isn't hierarchical. Hierarchical models consider grouping/clustering of samples. What would be your groups in this model? Because if you have n samples and also n groups, I think that doesn't make much sense probably.","user":"U01C2AJ9F63","ts":"1615541434.026600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QqPQA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"As a model, this is fine. But it certainly isn't hierarchical. Hierarchical models consider grouping/clustering of samples. What would be your groups in this model? Because if you have n samples and also n groups, I think that doesn't make much sense probably."}]}]}],"thread_ts":"1615541250.026300","parent_user_id":"US8V7JSKB"},{"client_msg_id":"fabf46f7-94a0-4f55-8010-e883f3620001","type":"message","text":"it’s the meta-analysis example from Gelman BDA chapter 5","user":"US8V7JSKB","ts":"1615541513.026800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ckQU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it’s the meta-analysis example from Gelman BDA chapter 5"}]}]}],"thread_ts":"1615541250.026300","parent_user_id":"US8V7JSKB"},{"client_msg_id":"94a368bf-9a0c-4942-bdfc-e357ea4cfc7b","type":"message","text":"where the features are\n`mstudy control.deaths control.total treated.deaths treated.total`","user":"US8V7JSKB","ts":"1615541530.027000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sZaPF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"where the features are\n"},{"type":"text","text":"mstudy control.deaths control.total treated.deaths treated.total","style":{"code":true}}]}]}],"thread_ts":"1615541250.026300","parent_user_id":"US8V7JSKB"},{"client_msg_id":"76c28619-0b65-4c44-be7d-93050e47ae9c","type":"message","text":"(i need to go to bed, but I’ll be back in 8 hours. Thanks so much for the help!)","user":"US8V7JSKB","ts":"1615541586.027200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Vkal","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(i need to go to bed, but I’ll be back in 8 hours. Thanks so much for the help!)"}]}]}],"thread_ts":"1615541250.026300","parent_user_id":"US8V7JSKB"},{"type":"message","text":"<@US8V7JSKB> try this:\n\n```using Turing\nusing Statistics: mean, std\n\n# Model\n@model varying_intercept(X, idx, y; n_gr = length(unique(idx)), predictors = size(X, 2)) = begin\n    # priors\n    μ ~ Normal(mean(y), 2.5 * std(y))       # population-level intercept\n    σ ~ Exponential(1 / std(y))             # residual SD\n    # Coefficients Student-t(ν = 3)\n    β ~ filldist(TDist(3), predictors)\n    # Prior for variance of random intercepts. Usually requires thoughtful specification.\n    τ ~ truncated(Cauchy(0, 2), 0, Inf)\n    μⱼ ~ filldist(Normal(0, τ), n_gr) # group-level intercepts    \n    # likelihood\n    ŷ = μ .+ X * β .+ μⱼ[idx]\n    y ~ MvNormal(ŷ, σ)\nend```\nthis is:","files":[{"id":"F01RFGQ502V","created":1615561049,"timestamp":1615561049,"name":"Screen Shot 2021-03-12 at 11.57.23.png","title":"Screen Shot 2021-03-12 at 11.57.23.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"U01QBF4PHKP","editable":false,"size":128792,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01RFGQ502V/screen_shot_2021-03-12_at_11.57.23.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01RFGQ502V/download/screen_shot_2021-03-12_at_11.57.23.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01RFGQ502V-523823000e/screen_shot_2021-03-12_at_11.57.23_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01RFGQ502V-523823000e/screen_shot_2021-03-12_at_11.57.23_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01RFGQ502V-523823000e/screen_shot_2021-03-12_at_11.57.23_360.png","thumb_360_w":360,"thumb_360_h":278,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01RFGQ502V-523823000e/screen_shot_2021-03-12_at_11.57.23_480.png","thumb_480_w":480,"thumb_480_h":370,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01RFGQ502V-523823000e/screen_shot_2021-03-12_at_11.57.23_160.png","original_w":568,"original_h":438,"thumb_tiny":"AwAlADCvxjvmnfL3DCk5AHIpwJ4xIKZI07ccZowMZ5pxJxyymm7iOhoAOMDrSHGeOlBOaSgB3YcU7n/nmDTMcU7Y2OCPzoAXHONgBprDvjApdjeo/OgjHBP60AMopSOlJQAUUUUAFKCR0pKKAFzmkoooA//Z","permalink":"https://julialang.slack.com/files/U01QBF4PHKP/F01RFGQ502V/screen_shot_2021-03-12_at_11.57.23.png","permalink_public":"https://slack-files.com/T68168MUP-F01RFGQ502V-5aa46177f1","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"6wO","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"US8V7JSKB"},{"type":"text","text":" try this:\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using Turing\nusing Statistics: mean, std\n\n# Model\n@model varying_intercept(X, idx, y; n_gr = length(unique(idx)), predictors = size(X, 2)) = begin\n    # priors\n    μ ~ Normal(mean(y), 2.5 * std(y))       # population-level intercept\n    σ ~ Exponential(1 / std(y))             # residual SD\n    # Coefficients Student-t(ν = 3)\n    β ~ filldist(TDist(3), predictors)\n    # Prior for variance of random intercepts. Usually requires thoughtful specification.\n    τ ~ truncated(Cauchy(0, 2), 0, Inf)\n    μⱼ ~ filldist(Normal(0, τ), n_gr) # group-level intercepts    \n    # likelihood\n    ŷ = μ .+ X * β .+ μⱼ[idx]\n    y ~ MvNormal(ŷ, σ)\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nthis is:"}]}]}],"user":"U01QBF4PHKP","display_as_bot":false,"ts":"1615561057.036000","thread_ts":"1615541250.026300","parent_user_id":"US8V7JSKB","reactions":[{"name":"point_up","users":["ULG5V164A"],"count":1}]},{"client_msg_id":"a36d7cba-d05f-49cb-9f07-0cda8951e433","type":"message","text":"Ah I see, so I basically want to use `filldist` to make sure it varies with the groups. Thank you <@U01QBF4PHKP>!","user":"US8V7JSKB","ts":"1615568402.036700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mr0Xo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah I see, so I basically want to use "},{"type":"text","text":"filldist","style":{"code":true}},{"type":"text","text":" to make sure it varies with the groups. Thank you "},{"type":"user","user_id":"U01QBF4PHKP"},{"type":"text","text":"!"}]}]}],"thread_ts":"1615541250.026300","parent_user_id":"US8V7JSKB"},{"client_msg_id":"d452a6fb-eeeb-40c2-a503-90ec2e8c822a","type":"message","text":"No problem. You can also do QR decomposition on your X matrix if you are suffering from collinearity issues and low ESS. (Or scale/center your data).","user":"U01QBF4PHKP","ts":"1615570064.036900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SgyPX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"No problem. You can also do QR decomposition on your X matrix if you are suffering from collinearity issues and low ESS. (Or scale/center your data)."}]}]}],"thread_ts":"1615541250.026300","parent_user_id":"US8V7JSKB","reactions":[{"name":"+1","users":["US8V7JSKB"],"count":1}]}]