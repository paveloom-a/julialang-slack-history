[{"client_msg_id":"10605262-adea-4cf8-a838-525ba435ab49","type":"message","text":"Hi all-\n\nI noticed that the adaption steps are no longer removed from the chains. Where can I submit an issue?","user":"UH08DT0JU","ts":"1612372127.043400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"IdCD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi all-\n\nI noticed that the adaption steps are no longer removed from the chains. Where can I submit an issue?"}]}]}],"thread_ts":"1612372127.043400","reply_count":6,"reply_users_count":2,"latest_reply":"1612430927.044600","reply_users":["UH08DT0JU","U8T9JUA5R"],"subscribed":false},{"client_msg_id":"af6648e2-a5a1-4b56-a1d0-f61ba9858100","type":"message","text":"Also,  would someone be able to fix this issue soon or help me with a fix? Thanks!","user":"UH08DT0JU","ts":"1612372786.043500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4j/M","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also,  would someone be able to fix this issue soon or help me with a fix? Thanks!"}]}]}],"thread_ts":"1612372127.043400","parent_user_id":"UH08DT0JU"},{"client_msg_id":"4f6ed242-6b46-4aee-afbf-4e54cba32c24","type":"message","text":"They should be removed, `discard_adapt=true` is the default (<https://github.com/TuringLang/Turing.jl/blob/8886d35672b87f5c5b29caebd33a27326e2a3fa2/src/inference/hmc.jl#L119|https://github.com/TuringLang/Turing.jl/blob/8886d35672b87f5c5b29caebd33a27326e2a3fa2/src/inference/hmc.jl#L119>). However, IIRC while previously the total number of returned samples was reduced by the number of adaption steps, now always as many samples as specified are returned.","user":"U8T9JUA5R","ts":"1612373208.043700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ud2e","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"They should be removed, "},{"type":"text","text":"discard_adapt=true","style":{"code":true}},{"type":"text","text":" is the default ("},{"type":"link","url":"https://github.com/TuringLang/Turing.jl/blob/8886d35672b87f5c5b29caebd33a27326e2a3fa2/src/inference/hmc.jl#L119","text":"https://github.com/TuringLang/Turing.jl/blob/8886d35672b87f5c5b29caebd33a27326e2a3fa2/src/inference/hmc.jl#L119"},{"type":"text","text":"). However, IIRC while previously the total number of returned samples was reduced by the number of adaption steps, now always as many samples as specified are returned."}]}]}],"thread_ts":"1612372127.043400","parent_user_id":"UH08DT0JU"},{"client_msg_id":"e753dd3c-9d95-4c34-a540-d323e2adfcd5","type":"message","text":"David, thank you for taking time from your paternity leave to answer my question and congratulations!\n\nAre you saying that the number of returned samples when discard_adapt is true is n_samples rather than n_samples -n_adapt?. Unfortunately, it is not working for me either way. It returns the same number of samples regardless of whether discard_adapt is true or false.  Here is a MWE:\n\n```using Turing, Distributions\n\ny = rand(Normal(0,1), 30)\n\n@model function model(y)\n    μ ~ Normal(0,1)\n    y .~ Normal(μ,1)\nend\n\nn_samples = 3000\nn_adapt = 1500\nspecs = NUTS(n_adapt, .65)\nn_chains = 4\nchain = sample(model(y), specs, MCMCThreads(), n_samples, n_chains, discard_adapt=false)```\nHere are the results I get. Notice that it includes only 3000 samples, rather than 4,500 (if I understand correctly)\n\nI am using Turing  v0.15.8","user":"UH08DT0JU","ts":"1612373819.043900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YUaf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"David, thank you for taking time from your paternity leave to answer my question and congratulations!\n\nAre you saying that the number of returned samples when discard_adapt is true is n_samples rather than n_samples -n_adapt?. Unfortunately, it is not working for me either way. It returns the same number of samples regardless of whether discard_adapt is true or false.  Here is a MWE:\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using Turing, Distributions\n\ny = rand(Normal(0,1), 30)\n\n@model function model(y)\n    μ ~ Normal(0,1)\n    y .~ Normal(μ,1)\nend\n\nn_samples = 3000\nn_adapt = 1500\nspecs = NUTS(n_adapt, .65)\nn_chains = 4\nchain = sample(model(y), specs, MCMCThreads(), n_samples, n_chains, discard_adapt=false)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nHere are the results I get. Notice that it includes only 3000 samples, rather than 4,500 (if I understand correctly)\n\nI am using Turing  v0.15.8"}]}]}],"thread_ts":"1612372127.043400","parent_user_id":"UH08DT0JU"},{"client_msg_id":"695f3979-68ec-4916-bee2-5221f1a8258f","type":"message","text":"This might be helpful. When I run\n\n```@edit sample(model(y), specs, MCMCThreads(), n_samples, n_chains, discard_adapt=false)```\nI am pointed to a method in AbstractHMC that does not have a keyword for discard_adapt","user":"UH08DT0JU","ts":"1612374178.044100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TyMZC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This might be helpful. When I run\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@edit sample(model(y), specs, MCMCThreads(), n_samples, n_chains, discard_adapt=false)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nI am pointed to a method in AbstractHMC that does not have a keyword for discard_adapt"}]}]}],"thread_ts":"1612372127.043400","parent_user_id":"UH08DT0JU"},{"client_msg_id":"a262c476-cbbe-4643-ac02-0b0cc40c4a50","type":"message","text":"It seems odd to me that this evaluates to false:\n\n```NUTS &lt;: Turing.Sampler{&lt;:Turing.AdaptiveHamiltonian}```\nThat might be the reason NUTS uses the default sample method. Another potential issue is that it looks like there is no NUTS specific method for parallel sampling.","user":"UH08DT0JU","ts":"1612377560.044300","team":"T68168MUP","edited":{"user":"UH08DT0JU","ts":"1612377719.000000"},"blocks":[{"type":"rich_text","block_id":"E+o","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It seems odd to me that this evaluates to false:\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"NUTS <: Turing.Sampler{<:Turing.AdaptiveHamiltonian}"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"That might be the reason NUTS uses the default sample method. Another potential issue is that it looks like there is no NUTS specific method for parallel sampling."}]}]}],"thread_ts":"1612372127.043400","parent_user_id":"UH08DT0JU"},{"client_msg_id":"f499a1dd-4e66-45ff-9a40-d074a7094148","type":"message","text":"I opened an issue: <https://github.com/TuringLang/Turing.jl/issues/1537>","user":"UH08DT0JU","ts":"1612430927.044600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"c/tTk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I opened an issue: "},{"type":"link","url":"https://github.com/TuringLang/Turing.jl/issues/1537"}]}]}],"thread_ts":"1612372127.043400","parent_user_id":"UH08DT0JU"}]