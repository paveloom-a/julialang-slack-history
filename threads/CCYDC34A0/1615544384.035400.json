[{"client_msg_id":"022f8bc2-934c-4e01-935a-83eaa47fe49d","type":"message","text":"Is there a trick to working with parameter vectors and callbacks? For example, say I have a vector of parameters `κ ~ MvNormal(Fill(0.0,5),1.0)` . I've tried TuringCallbacks (without setting a variable_filter) and a few different things with Turkie but no luck so far.","user":"U017YGFQTE3","ts":"1615544384.035400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Bt97","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a trick to working with parameter vectors and callbacks? For example, say I have a vector of parameters "},{"type":"text","text":"κ ~ MvNormal(Fill(0.0,5),1.0)","style":{"code":true}},{"type":"text","text":" . I've tried TuringCallbacks (without setting a variable_filter) and a few different things with Turkie but no luck so far."}]}]}],"thread_ts":"1615544384.035400","reply_count":4,"reply_users_count":3,"latest_reply":"1615630864.049400","reply_users":["U85JBUGGP","U017YGFQTE3","U7QLM6E2E"],"subscribed":false},{"client_msg_id":"7964b963-e79a-448e-831a-a50ddc8475f5","type":"message","text":"The question is not clear to me.","user":"U85JBUGGP","ts":"1615571952.037700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6n+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The question is not clear to me."}]}]}],"thread_ts":"1615544384.035400","parent_user_id":"U017YGFQTE3"},{"client_msg_id":"cbcd3dfd-4389-438e-b122-07458e775cc9","type":"message","text":"Apologies for being vague. MWE below with `ρ` as the parameter of vectors. Each of the calls to sample will throw errors. This issue is not holding back my work, its just a nice to have, so the question was more \"has someone got this working and could share?\" rather than \"please help!\"\n```using TuringCallbacks\nusing Turing\nusing Turkie\nusing Makie\nusing Distributions\n\nx = rand(10,5)\ny = x * [0.5;2.1;0.6;1.5;0.3]\n\n@model function tmodel(x, y)\n    ρ ~ filldist(truncated(Normal(), 0, Inf), size(x, 2))\n    a = x * ρ\n    y ~ MvNormal(a, 1.0)\nend\n\ncb1 = TensorBoardCallback(\"tensorboard_logs/run\")\ncb2 = TurkieCallback(Dict(:ρ =&gt; [:trace, :mean]))\n\nchain1 = sample(tmodel(x,y), MH(), 1000;callback=cb1)\nchain2 = sample(tmodel(x,y), MH(), 1000;callback=cb2)```\nThe first few lines of the stacktrace are for cb1:\n`ERROR: MethodError: no method matching getindex(::String, ::String)`\n`Closest candidates are:`\n  `getindex(::String, ::UnitRange{Int64}) at strings/string.jl:244`\n  `getindex(::String, ::Int64) at strings/string.jl:209`\n  `getindex(::String, ::UnitRange{var\"#s91\"} where var\"#s91\"&lt;:Integer) at strings/string.jl:242`\n  `...`\n`Stacktrace:`\n `[1] (::TuringCallbacks.var\"#10#11\"{TensorBoardCallback{TuringCallbacks.var\"#4#7\"{Array{String,1},Array{String,1}},String},Turing.Inference.Transition{NamedTuple{(:ρ,),Tuple{Tuple{Array{Array{Float64,1},1},Array{String,1}}}},Float64},String,TuringCallbacks.var\"#4#7\"{Array{String,1},Array{String,1}}})() at /home/alfred/.julia/packages/TuringCallbacks/LX7CG/src/callbacks/tensorboard.jl:115`\n `[2] with_logstate(::Function, ::Any) at ./logging.jl:408`\n `[3] with_logger at ./logging.jl:514 [inlined]`\n\nThe cb2 stacktrace is straightforward:\n`ERROR: MethodError: no method matching Float32(::Array{Float64,1})`\n`Closest candidates are:`\n  `Float32(::Irrational{:φ}) at irrationals.jl:190`\n  `Float32(::Irrational{:quartπ}) at irrationals.jl:190`\n  `Float32(::Irrational{:invπ}) at irrationals.jl:190`\n  `...`\n`Stacktrace:`\n `[1] (::TurkieCallback)(::Random._GLOBAL_RNG, ::DynamicPPL.Model{var\"#1#2\",(:x, :y),(),(),Tuple{Array{Float64,2},Array{Float64,1}},Tuple{}}, ::DynamicPPL.Sampler{MH{(),NamedTuple{(),Tuple{}}},Turing.Inference.SamplerState{DynamicPPL.VarInfo{NamedTuple{(:ρ,),Tuple{DynamicPPL.Metadata{Dict{DynamicPPL.VarName{:ρ,Tuple{}},Int64},Array{Product{Continuous,Truncated{Normal{Float64},Continuous,Float64},FillArrays.Fill{Truncated{Normal{Float64},Continuous,Float64},1,Tuple{Base.OneTo{Int64}}}},1},Array{DynamicPPL.VarName{:ρ,Tuple{}},1},Array{Float64,1},Array{Set{DynamicPPL.Selector},1}}}},Float64}}}, ::Turing.Inference.Transition{NamedTuple{(:ρ,),Tuple{Tuple{Array{Array{Float64,1},1},Array{String,1}}}},Float64}, ::Int64) at /home/alfred/.julia/packages/Turkie/ySM4a/src/Turkie.jl:104`","user":"U017YGFQTE3","ts":"1615628899.048900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zCZk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Apologies for being vague. MWE below with "},{"type":"text","text":"ρ","style":{"code":true}},{"type":"text","text":" as the parameter of vectors. Each of the calls to sample will throw errors. This issue is not holding back my work, its just a nice to have, so the question was more \"has someone got this working and could share?\" rather than \"please help!\"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using TuringCallbacks\nusing Turing\nusing Turkie\nusing Makie\nusing Distributions\n\nx = rand(10,5)\ny = x * [0.5;2.1;0.6;1.5;0.3]\n\n@model function tmodel(x, y)\n    ρ ~ filldist(truncated(Normal(), 0, Inf), size(x, 2))\n    a = x * ρ\n    y ~ MvNormal(a, 1.0)\nend\n\ncb1 = TensorBoardCallback(\"tensorboard_logs/run\")\ncb2 = TurkieCallback(Dict(:ρ => [:trace, :mean]))\n\nchain1 = sample(tmodel(x,y), MH(), 1000;callback=cb1)\nchain2 = sample(tmodel(x,y), MH(), 1000;callback=cb2)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"The first few lines of the stacktrace are for cb1:\n"},{"type":"text","text":"ERROR: MethodError: no method matching getindex(::String, ::String)","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"Closest candidates are:","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"  getindex(::String, ::UnitRange{Int64}) at strings/string.jl:244","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"  getindex(::String, ::Int64) at strings/string.jl:209","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"  getindex(::String, ::UnitRange{var\"#s91\"} where var\"#s91\"<:Integer) at strings/string.jl:242","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"  ...","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"Stacktrace:","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [1] (::TuringCallbacks.var\"#10#11\"{TensorBoardCallback{TuringCallbacks.var\"#4#7\"{Array{String,1},Array{String,1}},String},Turing.Inference.Transition{NamedTuple{(:ρ,),Tuple{Tuple{Array{Array{Float64,1},1},Array{String,1}}}},Float64},String,TuringCallbacks.var\"#4#7\"{Array{String,1},Array{String,1}}})() at /home/alfred/.julia/packages/TuringCallbacks/LX7CG/src/callbacks/tensorboard.jl:115","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [2] with_logstate(::Function, ::Any) at ./logging.jl:408","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [3] with_logger at ./logging.jl:514 [inlined]","style":{"code":true}},{"type":"text","text":"\n\nThe cb2 stacktrace is straightforward:\n"},{"type":"text","text":"ERROR: MethodError: no method matching Float32(::Array{Float64,1})","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"Closest candidates are:","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"  Float32(::Irrational{:φ}) at irrationals.jl:190","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"  Float32(::Irrational{:quartπ}) at irrationals.jl:190","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"  Float32(::Irrational{:invπ}) at irrationals.jl:190","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"  ...","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"Stacktrace:","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [1] (::TurkieCallback)(::Random._GLOBAL_RNG, ::DynamicPPL.Model{var\"#1#2\",(:x, :y),(),(),Tuple{Array{Float64,2},Array{Float64,1}},Tuple{}}, ::DynamicPPL.Sampler{MH{(),NamedTuple{(),Tuple{}}},Turing.Inference.SamplerState{DynamicPPL.VarInfo{NamedTuple{(:ρ,),Tuple{DynamicPPL.Metadata{Dict{DynamicPPL.VarName{:ρ,Tuple{}},Int64},Array{Product{Continuous,Truncated{Normal{Float64},Continuous,Float64},FillArrays.Fill{Truncated{Normal{Float64},Continuous,Float64},1,Tuple{Base.OneTo{Int64}}}},1},Array{DynamicPPL.VarName{:ρ,Tuple{}},1},Array{Float64,1},Array{Set{DynamicPPL.Selector},1}}}},Float64}}}, ::Turing.Inference.Transition{NamedTuple{(:ρ,),Tuple{Tuple{Array{Array{Float64,1},1},Array{String,1}}}},Float64}, ::Int64) at /home/alfred/.julia/packages/Turkie/ySM4a/src/Turkie.jl:104","style":{"code":true}}]}]}],"thread_ts":"1615544384.035400","parent_user_id":"U017YGFQTE3"},{"client_msg_id":"9c471a88-0574-41b0-9efb-468ad64b88ac","type":"message","text":"The developer of Turkie <@U7QLM6E2E> may be able to help.","user":"U85JBUGGP","ts":"1615629842.049100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"q+dwb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The developer of Turkie "},{"type":"user","user_id":"U7QLM6E2E"},{"type":"text","text":" may be able to help."}]}]}],"thread_ts":"1615544384.035400","parent_user_id":"U017YGFQTE3","reactions":[{"name":"+1","users":["U7QLM6E2E"],"count":1}]},{"client_msg_id":"2c193efe-812f-4683-944a-0160fc0164d0","type":"message","text":"Yeah that would be because when passing variables, scalar variables are expected I'll try to have a look if something is easily fixable. Alternatively you could call `TurkieCallback(tmodel(x, y), [:trace, :mean])`","user":"U7QLM6E2E","ts":"1615630864.049400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fTGW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah that would be because when passing variables, scalar variables are expected I'll try to have a look if something is easily fixable. Alternatively you could call "},{"type":"text","text":"TurkieCallback(tmodel(x, y), [:trace, :mean])","style":{"code":true}}]}]}],"thread_ts":"1615544384.035400","parent_user_id":"U017YGFQTE3"}]