[{"client_msg_id":"ee7d1ddb-e31c-46a0-a284-26413586915d","type":"message","text":"How do I check why Zygote isn't picking up one of my rrule ?\n\nI have a function\n\n```function (f::BatchFastDense)(x::AbstractArray{&lt;:Real,TA}, p::AbstractVector{&lt;:Real}) where {TA}```\nAn rrule:\n\n```ChainRulesCore.rrule(::typeof(BatchFastDense), x::AbstractArray{&lt;:Real,TA}, p::AbstractVector{&lt;:Real}) where {TA}```\nAnd it's just trying to differentiate the former automatically, without using my rule","user":"UKJSNT1QR","ts":"1616434669.041700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UoS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How do I check why Zygote isn't picking up one of my rrule ?\n\nI have a function\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function (f::BatchFastDense)(x::AbstractArray{<:Real,TA}, p::AbstractVector{<:Real}) where {TA}"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"An rrule:\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"ChainRulesCore.rrule(::typeof(BatchFastDense), x::AbstractArray{<:Real,TA}, p::AbstractVector{<:Real}) where {TA}"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"And it's just trying to differentiate the former automatically, without using my rule"}]}]}],"thread_ts":"1616434669.041700","reply_count":6,"reply_users_count":2,"latest_reply":"1616436832.048000","reply_users":["UHDQQ4GN6","U6A936746"],"subscribed":false},{"client_msg_id":"0165af5a-e251-40cc-841c-90f17b8034af","type":"message","text":"The rrule as written is hitting the method `BatchFastDense(x::AbstractArray{&lt;:Real,TA}, p::AbstractVector{&lt;:Real}) where {TA}`. You probably want the rrule to be `ChainRulesCore.rrule(f::BatchFastDense, x::AbstractArray{&lt;:Real,TA}, p::AbstractVector{&lt;:Real}) where {TA}`","user":"UHDQQ4GN6","ts":"1616434776.042900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FXcU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The rrule as written is hitting the method "},{"type":"text","text":"BatchFastDense(x::AbstractArray{<:Real,TA}, p::AbstractVector{<:Real}) where {TA}","style":{"code":true}},{"type":"text","text":". You probably want the rrule to be "},{"type":"text","text":"ChainRulesCore.rrule(f::BatchFastDense, x::AbstractArray{<:Real,TA}, p::AbstractVector{<:Real}) where {TA}","style":{"code":true}}]}]}],"thread_ts":"1616434669.041700","parent_user_id":"UKJSNT1QR","reactions":[{"name":"point_up","users":["U6A936746","U7QLM6E2E","UKJSNT1QR"],"count":3},{"name":"100","users":["UKJSNT1QR"],"count":1}]},{"client_msg_id":"eea0984f-04ff-47ca-95d6-8c9dfeeaca97","type":"message","text":"I agree that it isn't hitting what you want.\nI think it's hitting worse than that, as that first `typeof` probably returns  `DataType` or `UnionAll`.\n\nBut anyway what Seth said to do seems right","user":"U6A936746","ts":"1616435104.044000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7Lv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I agree that it isn't hitting what you want.\nI think it's hitting worse than that, as that first `typeof` probably returns  "},{"type":"text","text":"DataType","style":{"code":true}},{"type":"text","text":" or "},{"type":"text","text":"UnionAll","style":{"code":true}},{"type":"text","text":".\n\nBut anyway what Seth said to do seems right"}]}]}],"thread_ts":"1616434669.041700","parent_user_id":"UKJSNT1QR","reactions":[{"name":"+1","users":["UHDQQ4GN6","UKG4WF8PJ","UKJSNT1QR"],"count":3}]},{"client_msg_id":"1432c865-ecaa-4013-98d1-ee092d267d6d","type":"message","text":"Oh, yes, THIS bug is the bane of my existence!","user":"UHDQQ4GN6","ts":"1616435137.044500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Aai","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh, yes, THIS bug is the bane of my existence!"}]}]}],"thread_ts":"1616434669.041700","parent_user_id":"UKJSNT1QR"},{"client_msg_id":"90df970e-cc60-43a6-b06f-ea059a39aa96","type":"message","text":"And I clearly haven't learned to spot it on the first time still.","user":"UHDQQ4GN6","ts":"1616435146.044700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0Q35","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And I clearly haven't learned to spot it on the first time still."}]}]}],"thread_ts":"1616434669.041700","parent_user_id":"UKJSNT1QR"},{"client_msg_id":"500fef41-760a-432f-912d-2878268ba4d6","type":"message","text":"We should think about tools to make this more obvious.\nMaybe something that lists the true things that have been targetted by all rules defined in a package?","user":"U6A936746","ts":"1616435168.044900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BwE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We should think about tools to make this more obvious.\nMaybe something that lists the true things that have been targetted by all rules defined in a package?"}]}]}],"thread_ts":"1616434669.041700","parent_user_id":"UKJSNT1QR"},{"client_msg_id":"de5290af-47a9-4b6f-977c-8c3dccbee922","type":"message","text":"Something like `ChainRulesTestUtils.check_all_rules(MyModule)` which as much as possible checks for things like type piracy, ambiguities, etc?","user":"UHDQQ4GN6","ts":"1616436832.048000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qSPT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Something like "},{"type":"text","text":"ChainRulesTestUtils.check_all_rules(MyModule)","style":{"code":true}},{"type":"text","text":" which as much as possible checks for things like type piracy, ambiguities, etc?"}]}]}],"thread_ts":"1616434669.041700","parent_user_id":"UKJSNT1QR","reactions":[{"name":"heavy_check_mark","users":["U6A936746","UKJSNT1QR"],"count":2}]}]