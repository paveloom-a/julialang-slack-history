[{"client_msg_id":"80a50049-c713-48db-8e03-2e7c29d09835","type":"message","text":"Will file an issue when I get a chance but for now wondering if maybe a fix to this comes easy to one of the rrule wizards here? :slightly_smiling_face:\n```julia&gt; gradient(rand(2,2)) do x\n           sum(cat(x, x, dims=Val(3)))\n       end\n\nERROR: MethodError: no method matching iterate(::Val{3})```","user":"UUMJUCYRK","ts":"1610414231.416600","team":"T68168MUP","edited":{"user":"UUMJUCYRK","ts":"1610414279.000000"},"blocks":[{"type":"rich_text","block_id":"o3T","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Will file an issue when I get a chance but for now wondering if maybe a fix to this comes easy to one of the rrule wizards here? "},{"type":"emoji","name":"slightly_smiling_face"},{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> gradient(rand(2,2)) do x\n           sum(cat(x, x, dims=Val(3)))\n       end\n\nERROR: MethodError: no method matching iterate(::Val{3})"}]}]}],"thread_ts":"1610414231.416600","reply_count":4,"reply_users_count":2,"latest_reply":"1610416395.417900","reply_users":["UUMJUCYRK","UHDQQ4GN6"],"subscribed":false},{"client_msg_id":"6f5b9891-c0cf-4eea-98be-902a30cdf1b7","type":"message","text":"```Closest candidates are:\n  iterate(::LibGit2.GitRevWalker) at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LibGit2/src/walker.jl:29\n  iterate(::LibGit2.GitRevWalker, ::Any) at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LibGit2/src/walker.jl:29\n  iterate(::Revise.LineSkippingIterator) at /global/homes/m/marius/.julia/packages/Revise/moD4B/src/relocatable_exprs.jl:70\n  ...\nStacktrace:\n [1] in(::Int64, ::Val{3}) at ./operators.jl:1057\n [2] (::Zygote.var\"#467#472\"{Array{Float64,2},Val{3}})(::Int64) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/lib/array.jl:121\n [3] ntuple(::Zygote.var\"#467#472\"{Array{Float64,2},Val{3}}, ::Int64) at ./ntuple.jl:18\n [4] (::Zygote.var\"#466#471\"{FillArrays.Fill{Float64,3,Tuple{Base.OneTo{Int64},Base.OneTo{Int64},Base.OneTo{Int64}}},Val{3}})(::Array{Float64,2}) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/lib/array.jl:121\n [5] map(::Zygote.var\"#466#471\"{FillArrays.Fill{Float64,3,Tuple{Base.OneTo{Int64},Base.OneTo{Int64},Base.OneTo{Int64}}},Val{3}}, ::Tuple{Array{Float64,2},Array{Float64,2}}) at ./tuple.jl:158\n [6] (::Zygote.var\"#464#469\"{Val{3},Tuple{Array{Float64,2},Array{Float64,2}}})(::FillArrays.Fill{Float64,3,Tuple{Base.OneTo{Int64},Base.OneTo{Int64},Base.OneTo{Int64}}}) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/lib/array.jl:120\n [7] (::Zygote.var\"#2493#back#475\"{Zygote.var\"#464#469\"{Val{3},Tuple{Array{Float64,2},Array{Float64,2}}}})(::FillArrays.Fill{Float64,3,Tuple{Base.OneTo{Int64},Base.OneTo{Int64},Base.OneTo{Int64}}}) at /global/homes/m/marius/.julia/packages/ZygoteRules/OjfTt/src/adjoint.jl:65\n [8] #5 at ./REPL[5]:2 [inlined]\n [9] (::typeof(∂(#5)))(::Float64) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/compiler/interface2.jl:0\n [10] (::Zygote.var\"#41#42\"{typeof(∂(#5))})(::Float64) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/compiler/interface.jl:40\n [11] gradient(::Function, ::Array{Float64,2}) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/compiler/interface.jl:49\n [12] top-level scope at REPL[5]:1```","user":"UUMJUCYRK","ts":"1610414283.417100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"o66","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"Closest candidates are:\n  iterate(::LibGit2.GitRevWalker) at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LibGit2/src/walker.jl:29\n  iterate(::LibGit2.GitRevWalker, ::Any) at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LibGit2/src/walker.jl:29\n  iterate(::Revise.LineSkippingIterator) at /global/homes/m/marius/.julia/packages/Revise/moD4B/src/relocatable_exprs.jl:70\n  ...\nStacktrace:\n [1] in(::Int64, ::Val{3}) at ./operators.jl:1057\n [2] (::Zygote.var\"#467#472\"{Array{Float64,2},Val{3}})(::Int64) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/lib/array.jl:121\n [3] ntuple(::Zygote.var\"#467#472\"{Array{Float64,2},Val{3}}, ::Int64) at ./ntuple.jl:18\n [4] (::Zygote.var\"#466#471\"{FillArrays.Fill{Float64,3,Tuple{Base.OneTo{Int64},Base.OneTo{Int64},Base.OneTo{Int64}}},Val{3}})(::Array{Float64,2}) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/lib/array.jl:121\n [5] map(::Zygote.var\"#466#471\"{FillArrays.Fill{Float64,3,Tuple{Base.OneTo{Int64},Base.OneTo{Int64},Base.OneTo{Int64}}},Val{3}}, ::Tuple{Array{Float64,2},Array{Float64,2}}) at ./tuple.jl:158\n [6] (::Zygote.var\"#464#469\"{Val{3},Tuple{Array{Float64,2},Array{Float64,2}}})(::FillArrays.Fill{Float64,3,Tuple{Base.OneTo{Int64},Base.OneTo{Int64},Base.OneTo{Int64}}}) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/lib/array.jl:120\n [7] (::Zygote.var\"#2493#back#475\"{Zygote.var\"#464#469\"{Val{3},Tuple{Array{Float64,2},Array{Float64,2}}}})(::FillArrays.Fill{Float64,3,Tuple{Base.OneTo{Int64},Base.OneTo{Int64},Base.OneTo{Int64}}}) at /global/homes/m/marius/.julia/packages/ZygoteRules/OjfTt/src/adjoint.jl:65\n [8] #5 at ./REPL[5]:2 [inlined]\n [9] (::typeof(∂(#5)))(::Float64) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/compiler/interface2.jl:0\n [10] (::Zygote.var\"#41#42\"{typeof(∂(#5))})(::Float64) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/compiler/interface.jl:40\n [11] gradient(::Function, ::Array{Float64,2}) at /global/homes/m/marius/.julia/packages/Zygote/ywhiG/src/compiler/interface.jl:49\n [12] top-level scope at REPL[5]:1"}]}]}],"thread_ts":"1610414231.416600","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"36b3a59b-5453-412d-b446-fc9c9e59b264","type":"message","text":"As the traceback indicates, it's an issue with Zygote's adjoint for `cat` at <https://github.com/FluxML/Zygote.jl/blob/9bcbf150bfebb2e51668d27608a55849b5941fd6/src/lib/array.jl#L121>. That adjoint assumes `in(::Int, dims)` will work, which it doesn't for `dims::Val{3}`. The right thing to do is to update Zygote's adjoint, but of you're in a hurry and want to commit type piracy, this might work\n```@adjoint function cat(Xs...; dims_::Val{dims}) where {dims}\n  cat(Xs...; dims = dims_), Δ -&gt; begin\n    start = ntuple(_ -&gt; 0, ndims(Δ))\n    dXs = map(Xs) do x\n      move = ntuple(d -&gt; d in dims ? size(x,d) : 0, ndims(Δ))\n      x_in_Δ = ntuple(d -&gt; d in dims ? (start[d]+1:start[d]+move[d]) : Colon(), ndims(Δ))\n      start = start .+ move\n      dx = reshape(Δ[x_in_Δ...], size(x))\n    end\n  end\nend ```","user":"UHDQQ4GN6","ts":"1610415039.417300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vviN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"As the traceback indicates, it's an issue with Zygote's adjoint for "},{"type":"text","text":"cat","style":{"code":true}},{"type":"text","text":" at "},{"type":"link","url":"https://github.com/FluxML/Zygote.jl/blob/9bcbf150bfebb2e51668d27608a55849b5941fd6/src/lib/array.jl#L121"},{"type":"text","text":". That adjoint assumes "},{"type":"text","text":"in(::Int, dims)","style":{"code":true}},{"type":"text","text":" will work, which it doesn't for "},{"type":"text","text":"dims::Val{3}","style":{"code":true}},{"type":"text","text":". The right thing to do is to update Zygote's adjoint, but of you're in a hurry and want to commit type piracy, this might work\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@adjoint function cat(Xs...; dims_::Val{dims}) where {dims}\n  cat(Xs...; dims = dims_), Δ -> begin\n    start = ntuple(_ -> 0, ndims(Δ))\n    dXs = map(Xs) do x\n      move = ntuple(d -> d in dims ? size(x,d) : 0, ndims(Δ))\n      x_in_Δ = ntuple(d -> d in dims ? (start[d]+1:start[d]+move[d]) : Colon(), ndims(Δ))\n      start = start .+ move\n      dx = reshape(Δ[x_in_Δ...], size(x))\n    end\n  end\nend "}]}]}],"thread_ts":"1610414231.416600","parent_user_id":"UUMJUCYRK","reactions":[{"name":"pray","users":["UUMJUCYRK"],"count":1}]},{"client_msg_id":"ed28473a-6a6b-4360-b500-eaa3932140c5","type":"message","text":"Perfect, thank you!","user":"UUMJUCYRK","ts":"1610416383.417600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ghMb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Perfect, thank you!"}]}]}],"thread_ts":"1610414231.416600","parent_user_id":"UUMJUCYRK"},{"bot_id":"BUQUB8RBN","type":"message","text":"pirate","user":"UUMJUCYRK","ts":"1610416395.417900","team":"T68168MUP","bot_profile":{"id":"BUQUB8RBN","deleted":false,"name":"giphy","updated":1583162249,"app_id":"A0F827J2C","icons":{"image_36":"https://a.slack-edge.com/dc483/img/plugins/giphy/service_72.png","image_48":"https://a.slack-edge.com/dc483/img/plugins/giphy/service_48.png","image_72":"https://a.slack-edge.com/dc483/img/plugins/giphy/service_72.png"},"team_id":"T68168MUP"},"blocks":[{"type":"image","block_id":"K=bUH","image_url":"https://media3.giphy.com/media/FGbeYTiFyLYmQ/giphy.gif?cid=6104955e4792a4057eb85553222d2c7841a13bcc42d991b8&rid=giphy.gif","alt_text":"pirate","title":{"type":"plain_text","text":"pirate","emoji":true},"fallback":"150x150px image","image_width":150,"image_height":150,"image_bytes":306614,"is_animated":true},{"type":"context","block_id":"N+G","elements":[{"type":"image","image_url":"https://a.slack-edge.com/dc483/img/plugins/giphy/service_32.png","alt_text":"giphy logo"},{"type":"mrkdwn","text":"Posted using /giphy","verbatim":false}]}],"thread_ts":"1610414231.416600","parent_user_id":"UUMJUCYRK"}]