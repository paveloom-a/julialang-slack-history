[{"client_msg_id":"42f4adef-05fd-4297-a965-89b773ecc1df","type":"message","text":"Does Zygote currently support eliminating ChainRules thunks when not needed in the backwards pass?","user":"UM6JW2SF9","ts":"1617267745.133400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gvd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Does Zygote currently support eliminating ChainRules thunks when not needed in the backwards pass?"}]}]}],"thread_ts":"1617267745.133400","reply_count":5,"reply_users_count":3,"latest_reply":"1617271459.134500","reply_users":["U0160CXEY3Z","UM6JW2SF9","U8T9JUA5R"],"is_locked":false,"subscribed":false},{"client_msg_id":"43f38833-c5d5-4e7f-8821-7b5c5dd6077c","type":"message","text":"thunks are unthunked before Zygote internals see them, see <https://github.com/FluxML/Zygote.jl/blob/fef5b433a7035705259956e78f323ffcdbabaf35/src/compiler/chainrules.jl#L41>","user":"U0160CXEY3Z","ts":"1617267974.133500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NdDqq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thunks are unthunked before Zygote internals see them, see "},{"type":"link","url":"https://github.com/FluxML/Zygote.jl/blob/fef5b433a7035705259956e78f323ffcdbabaf35/src/compiler/chainrules.jl#L41"}]}]}],"thread_ts":"1617267745.133400","parent_user_id":"UM6JW2SF9"},{"client_msg_id":"4008431f-bcb0-469f-884e-6369c00be547","type":"message","text":"I think we need to support ChainRules differential types in Zygote internally before we can benefit from thunks (discarding computation, inplace accumulation).","user":"U0160CXEY3Z","ts":"1617268361.133700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LEK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think we need to support ChainRules differential types in Zygote internally before we can benefit from thunks (discarding computation, inplace accumulation)."}]}]}],"thread_ts":"1617267745.133400","parent_user_id":"UM6JW2SF9","reactions":[{"name":"+1","users":["UM6JW2SF9","U6A936746","UKG4WF8PJ"],"count":3}]},{"client_msg_id":"dd88b573-00bd-4c66-abd4-b75fff9da578","type":"message","text":"Thanks <@U0160CXEY3Z>! I think that might also answer <https://github.com/FluxML/Zygote.jl/issues/931> that after an rrule of `*`, it will also instantiate the derivative w.r.t. the sparse matrix `A`","user":"UM6JW2SF9","ts":"1617268517.134000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PKQZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks "},{"type":"user","user_id":"U0160CXEY3Z"},{"type":"text","text":"! I think that might also answer "},{"type":"link","url":"https://github.com/FluxML/Zygote.jl/issues/931"},{"type":"text","text":" that after an rrule of "},{"type":"text","text":"*","style":{"code":true}},{"type":"text","text":", it will also instantiate the derivative w.r.t. the sparse matrix "},{"type":"text","text":"A","style":{"code":true}}]}]}],"thread_ts":"1617267745.133400","parent_user_id":"UM6JW2SF9"},{"client_msg_id":"9c2d8e1f-6522-45b1-ad6e-9ba1ef974d61","type":"message","text":"yep, that sounds right","user":"U0160CXEY3Z","ts":"1617268861.134300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9ixw0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yep, that sounds right"}]}]}],"thread_ts":"1617267745.133400","parent_user_id":"UM6JW2SF9"},{"client_msg_id":"979f6c14-23a6-4ab7-948b-179c5dddd8ba","type":"message","text":"Another problem of the expansion is that it breaks differentiation of `besseli` and other functions for which differentials are defined only for a subset of arguments: <https://github.com/FluxML/Zygote.jl/issues/873>","user":"U8T9JUA5R","ts":"1617271459.134500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"E=M=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Another problem of the expansion is that it breaks differentiation of "},{"type":"text","text":"besseli","style":{"code":true}},{"type":"text","text":" and other functions for which differentials are defined only for a subset of arguments: "},{"type":"link","url":"https://github.com/FluxML/Zygote.jl/issues/873"}]}]}],"thread_ts":"1617267745.133400","parent_user_id":"UM6JW2SF9"}]