[{"client_msg_id":"61c2b5b6-1248-44a1-9390-122f2d62f550","type":"message","text":"I already had the same problem but I guess I forgot how it was solved but... How do I debug why my rrules are not being used ?\n\n```nmsoftmax(x::AbstractArray{T}; dims = 1) where {T} = nmsoftmax!(similar(x), x; dims = dims)\n\nfunction ∇nmsoftmax(Δ::AbstractArray{T}, x::AbstractArray, y::AbstractArray{S}; dims = 1) where {T,S} \n  @show \"Using ∇nmsoftmax\"\n   ....\nend\n\nfunction rrule(::typeof(nmsoftmax), xs::AbstractArray{T}; dims=1) where {T}\n    y = nmsoftmax(xs; dims=dims)\n    softmax_pullback(Δ) = (NO_FIELDS, ChainRules.@thunk(∇nmsoftmax(Δ, xs, y, dims=dims)))\n    return y, softmax_pullback\nend```\nBut it's actually trying to differentiate `nmsoftmax!` when I run it","user":"UKJSNT1QR","ts":"1617805985.151400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mLnn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I already had the same problem but I guess I forgot how it was solved but... How do I debug why my rrules are not being used ?\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"nmsoftmax(x::AbstractArray{T}; dims = 1) where {T} = nmsoftmax!(similar(x), x; dims = dims)\n\nfunction ∇nmsoftmax(Δ::AbstractArray{T}, x::AbstractArray, y::AbstractArray{S}; dims = 1) where {T,S} \n  @show \"Using ∇nmsoftmax\"\n   ....\nend\n\nfunction rrule(::typeof(nmsoftmax), xs::AbstractArray{T}; dims=1) where {T}\n    y = nmsoftmax(xs; dims=dims)\n    softmax_pullback(Δ) = (NO_FIELDS, ChainRules.@thunk(∇nmsoftmax(Δ, xs, y, dims=dims)))\n    return y, softmax_pullback\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"But it's actually trying to differentiate "},{"type":"text","text":"nmsoftmax!","style":{"code":true}},{"type":"text","text":" when I run it"}]}]}],"thread_ts":"1617805985.151400","reply_count":3,"reply_users_count":2,"latest_reply":"1617882172.154800","reply_users":["UKJSNT1QR","U6A936746"],"is_locked":false,"subscribed":false,"reactions":[{"name":"white_check_mark","users":["UKJSNT1QR"],"count":1}]},{"client_msg_id":"b5a1662c-a4ab-43d3-b690-bfbbf015415d","type":"message","text":"For posterity, the answer is simple: I am dumb and forgot to qualify `ChainRules.rrule`","user":"UKJSNT1QR","ts":"1617812838.152700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Vbk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For posterity, the answer is simple: I am dumb and forgot to qualify "},{"type":"text","text":"ChainRules.rrule","style":{"code":true}}]}]}],"thread_ts":"1617805985.151400","parent_user_id":"UKJSNT1QR"},{"client_msg_id":"ec3a952e-ed86-4cf4-8a71-df33f431a333","type":"message","text":"I recommend writing tests.","user":"U6A936746","ts":"1617881953.154600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=2N3/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I recommend writing tests."}]}]}],"thread_ts":"1617805985.151400","parent_user_id":"UKJSNT1QR"},{"client_msg_id":"3699e16a-e28c-4950-9017-4754d83c6e81","type":"message","text":"In particular, ChainRulesTestUtils should catch this (and many other things)\nand is much easier to use now than it was a few months ago.\nit should just be\n```test_rrule(nmsoftmax, rand(5, 6))\ntest_rrule(nmsoftmax, rand(5, 6); fkwargs=(;dims=2))```\n(assuming nmsoftmax takes a matrix?)","user":"U6A936746","ts":"1617882172.154800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SRi1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"In particular, ChainRulesTestUtils should catch this (and many other things)\nand is much easier to use now than it was a few months ago.\nit should just be\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"test_rrule(nmsoftmax, rand(5, 6))\ntest_rrule(nmsoftmax, rand(5, 6); fkwargs=(;dims=2))"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"(assuming nmsoftmax takes a matrix?)"}]}]}],"thread_ts":"1617805985.151400","parent_user_id":"UKJSNT1QR"}]