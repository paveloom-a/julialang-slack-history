[{"client_msg_id":"f23b265a-0dc9-4482-b8fb-62dbe9c9cbd4","type":"message","text":"Can I trust `@code_warntype` when using Zygote code ? My results are full of `Any` and `Union{Nothing, Tuple}`\n\nAnd if it's accurate, how do I prevent return types of Any","user":"UKJSNT1QR","ts":"1616753033.099200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sBFV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Can I trust "},{"type":"text","text":"@code_warntype","style":{"code":true}},{"type":"text","text":" when using Zygote code ? My results are full of "},{"type":"text","text":"Any","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"Union{Nothing, Tuple}","style":{"code":true}},{"type":"text","text":"\n\nAnd if it's accurate, how do I prevent return types of Any"}]}]}],"thread_ts":"1616753033.099200","reply_count":7,"reply_users_count":3,"latest_reply":"1616767599.104700","reply_users":["U6A936746","UKJSNT1QR","UGU761DU2"],"is_locked":false,"subscribed":false},{"client_msg_id":"2e158154-935d-4695-9092-e8fbe89d85bf","type":"message","text":"1. Yes\n2. Difficult in general. Zygote (like Cassette) easily breaks type inference.  It's a thing Diffractor will fix one day.\nThough don't worry about the small unions. Those are fine","user":"U6A936746","ts":"1616754310.099300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UZfq2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"1. Yes\n2. Difficult in general. Zygote (like Cassette) easily breaks type inference.  It's a thing Diffractor will fix one day.\nThough don't worry about the small unions. Those are fine"}]}]}],"thread_ts":"1616753033.099200","parent_user_id":"UKJSNT1QR"},{"type":"message","text":"Well it runs reasonably well so I'm not that worried. But there's more red than blue. My monkey brain doesn't like that :slightly_smiling_face:","files":[{"id":"F01SJ3SF82F","created":1616754398,"timestamp":1616754398,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"UKJSNT1QR","editable":false,"size":93275,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01SJ3SF82F/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01SJ3SF82F/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01SJ3SF82F-874c035c99/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01SJ3SF82F-874c035c99/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01SJ3SF82F-874c035c99/image_360.png","thumb_360_w":360,"thumb_360_h":192,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01SJ3SF82F-874c035c99/image_480.png","thumb_480_w":480,"thumb_480_h":256,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01SJ3SF82F-874c035c99/image_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01SJ3SF82F-874c035c99/image_720.png","thumb_720_w":720,"thumb_720_h":384,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01SJ3SF82F-874c035c99/image_800.png","thumb_800_w":800,"thumb_800_h":426,"original_w":897,"original_h":478,"thumb_tiny":"AwAZADCmaQmlGD1FBUCgBufrSU7A9DSYoASilxRigBy0pB9qaOhptAC5pKKKACiiigD/2Q==","permalink":"https://julialang.slack.com/files/UKJSNT1QR/F01SJ3SF82F/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01SJ3SF82F-5092de92d3","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"jRlyc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well it runs reasonably well so I'm not that worried. But there's more red than blue. My monkey brain doesn't like that "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"user":"UKJSNT1QR","display_as_bot":false,"ts":"1616754403.099500","thread_ts":"1616753033.099200","parent_user_id":"UKJSNT1QR"},{"client_msg_id":"fc448a0f-3ff5-4192-a8bd-f256325b1826","type":"message","text":"For relatively simple code\n\n```function batchdiv(f, x)\n    y, back = Zygote.pullback(f, x)\n    o = Zygote.@ignore fill!(similar(y), 1)\n    dfdx = back(o)[1]\n    y, dfdx\nend```","user":"UKJSNT1QR","ts":"1616754478.099900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3AlZy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For relatively simple code\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function batchdiv(f, x)\n    y, back = Zygote.pullback(f, x)\n    o = Zygote.@ignore fill!(similar(y), 1)\n    dfdx = back(o)[1]\n    y, dfdx\nend"}]}]}],"thread_ts":"1616753033.099200","parent_user_id":"UKJSNT1QR"},{"client_msg_id":"65939ca9-914f-472b-943e-ba81db70a1c6","type":"message","text":"Is there any way to help the type inference / provide hints ?","user":"UKJSNT1QR","ts":"1616754642.100100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YUT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there any way to help the type inference / provide hints ?"}]}]}],"thread_ts":"1616753033.099200","parent_user_id":"UKJSNT1QR"},{"client_msg_id":"5835fe9f-582b-44cc-bbed-8a3c95c2b397","type":"message","text":"I wonder if adding annotations would work?","user":"UGU761DU2","ts":"1616765450.102700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Y9dwZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I wonder if adding annotations would work?"}]}]}],"thread_ts":"1616753033.099200","parent_user_id":"UKJSNT1QR"},{"client_msg_id":"d6720dfd-6fc2-4e18-937d-38d44bd66e6c","type":"message","text":"By annotation you mean things like\n\n```y::T, back = Zygote.pullback(f, x)```\n?\n\ni thought it was just for type checking","user":"UKJSNT1QR","ts":"1616765498.103100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0Dh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"By annotation you mean things like\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"y::T, back = Zygote.pullback(f, x)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"?\n\ni thought it was just for type checking"}]}]}],"thread_ts":"1616753033.099200","parent_user_id":"UKJSNT1QR"},{"client_msg_id":"29801aae-cc58-40a4-a087-5031af509fd0","type":"message","text":"I’m not sure if that exact syntax will work (I think the annotation might have to be on the rhs of the assignment), but yeah  — it’s not super elegant, but if you pull something out of an untyped container then doing  e.g.\n```A = [1, 5.0, \"qwer\"] # Array{Any}. Ew!\nb = A[1]::Int64```\ncan help tamp down the type instability.\n\nSee, e.g.: <https://docs.julialang.org/en/v1/manual/performance-tips/#Annotate-values-taken-from-untyped-locations>\n\nNo idea if that’ll work for these sorts of cases with Zygote or not though!","user":"UGU761DU2","ts":"1616767599.104700","team":"T68168MUP","edited":{"user":"UGU761DU2","ts":"1616767634.000000"},"blocks":[{"type":"rich_text","block_id":"RXh7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m not sure if that exact syntax will work (I think the annotation might have to be on the rhs of the assignment), but yeah  — it’s not super elegant, but if you pull something out of an untyped container then doing  e.g.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"A = [1, 5.0, \"qwer\"] # Array{Any}. Ew!\nb = A[1]::Int64"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"can help tamp down the type instability.\n\nSee, e.g.: "},{"type":"link","url":"https://docs.julialang.org/en/v1/manual/performance-tips/#Annotate-values-taken-from-untyped-locations"},{"type":"text","text":"\n\nNo idea if that’ll work for these sorts of cases with Zygote or not though!"}]}]}],"thread_ts":"1616753033.099200","parent_user_id":"UKJSNT1QR"}]