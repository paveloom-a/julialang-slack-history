[{"client_msg_id":"41c45f9a-dad6-4edd-9301-dc9592aae188","type":"message","text":"Here's a full MWE.\n```using Zygote: gradient, @adjoint\n\nstruct ArrayWrapper\n    arr\nend\n\nBase.sum(A::ArrayWrapper) = sum(A.arr)\n@adjoint ArrayWrapper(arr) = ArrayWrapper(arr), Δ -&gt; (Δ.arr,)\n\ngradient(A -&gt; sum(A), ArrayWrapper([1,2,3]))[1]\n# (arr = 3-element Fill{Int64}: entries equal to 1,)```\nKind of guessing this doesn't work like I think it does? Or chance of a bug?","user":"UUMJUCYRK","ts":"1608677079.241000","team":"T68168MUP","edited":{"user":"UUMJUCYRK","ts":"1608678260.000000"},"blocks":[{"type":"rich_text","block_id":"r+Z2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Here's a full MWE.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using Zygote: gradient, @adjoint\n\nstruct ArrayWrapper\n    arr\nend\n\nBase.sum(A::ArrayWrapper) = sum(A.arr)\n@adjoint ArrayWrapper(arr) = ArrayWrapper(arr), Δ -> (Δ.arr,)\n\ngradient(A -> sum(A), ArrayWrapper([1,2,3]))[1]\n# (arr = 3-element Fill{Int64}: entries equal to 1,)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Kind of guessing this doesn't work like I think it does? Or chance of a bug?"}]}]}],"thread_ts":"1608677079.241000","reply_count":10,"reply_users_count":2,"latest_reply":"1608680527.243500","reply_users":["UD0NS8PDF","UUMJUCYRK"],"subscribed":false},{"client_msg_id":"8511c681-c334-4fac-8c29-a06501cde3a9","type":"message","text":"Looks like you wrap twice?","user":"UD0NS8PDF","ts":"1608678219.241100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3Lq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Looks like you wrap twice?"}]}]}],"thread_ts":"1608677079.241000","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"0abf32b2-f0f3-4feb-90ec-4d4ea342fb41","type":"message","text":"Crap sorry, messed up the MWE, fixed now, and that doesn't solve the issue","user":"UUMJUCYRK","ts":"1608678274.241400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+tx+y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Crap sorry, messed up the MWE, fixed now, and that doesn't solve the issue"}]}]}],"thread_ts":"1608677079.241000","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"b8252284-4a97-4818-a211-54528eb63522","type":"message","text":"It’s the second of these which you would like to work:\n```julia&gt; gradient(A -&gt; sum(ArrayWrapper(A)), [1,2,3])[1]\n3-element FillArrays.Fill{Int64, 1, Tuple{Base.OneTo{Int64}}} = 1\n\njulia&gt; gradient(sum, ArrayWrapper([1,2,3]))[1]\n(arr = 3-element FillArrays.Fill{Int64, 1, Tuple{Base.OneTo{Int64}}} = 1,)```","user":"UD0NS8PDF","ts":"1608678281.241600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=vtj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It’s the second of these which you would like to work:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> gradient(A -> sum(ArrayWrapper(A)), [1,2,3])[1]\n3-element FillArrays.Fill{Int64, 1, Tuple{Base.OneTo{Int64}}} = 1\n\njulia> gradient(sum, ArrayWrapper([1,2,3]))[1]\n(arr = 3-element FillArrays.Fill{Int64, 1, Tuple{Base.OneTo{Int64}}} = 1,)"}]}]}],"thread_ts":"1608677079.241000","parent_user_id":"UUMJUCYRK","reactions":[{"name":"+1","users":["UUMJUCYRK"],"count":1}]},{"client_msg_id":"2b7c114d-f3e9-412f-8e36-539b1e4c955e","type":"message","text":"Yes","user":"UUMJUCYRK","ts":"1608678312.241900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jrt9C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes"}]}]}],"thread_ts":"1608677079.241000","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"db1de131-9b15-4a6e-a1c0-d81d15e12c15","type":"message","text":"I think I have known how to do this","user":"UD0NS8PDF","ts":"1608678314.242100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bHy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think I have known how to do this"}]}]}],"thread_ts":"1608677079.241000","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"7ab5c60a-4b93-4b4e-b659-90468a3c0cff","type":"message","text":"but I don’t remember the trick. The adjoint rule only gets called in the first one.","user":"UD0NS8PDF","ts":"1608678749.242700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"I1LH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but I don’t remember the trick. The adjoint rule only gets called in the first one."}]}]}],"thread_ts":"1608677079.241000","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"5b54cdca-4a3d-49c9-b241-c16207f0fa1e","type":"message","text":"I also feel like this has worked before but don't know how, but yea, curious if you remember","user":"UUMJUCYRK","ts":"1608678866.242900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2KCU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I also feel like this has worked before but don't know how, but yea, curious if you remember"}]}]}],"thread_ts":"1608677079.241000","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"ba5a2dae-081c-4dff-b5f6-1d7d2cad31ea","type":"message","text":"Hmm I guess this rule fixes it\n```@adjoint Base.sum(A::ArrayWrapper) = sum(A), Δ -&gt; (ArrayWrapper(Δ .* one.(A.arr)),)```\n","user":"UUMJUCYRK","ts":"1608679194.243100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FKoF8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm I guess this rule fixes it\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@adjoint Base.sum(A::ArrayWrapper) = sum(A), Δ -> (ArrayWrapper(Δ .* one.(A.arr)),)"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1608677079.241000","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"4e153378-fa8e-4bc9-8a78-1aed477867b5","type":"message","text":"For my MWE at least","user":"UUMJUCYRK","ts":"1608679323.243300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QntQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For my MWE at least"}]}]}],"thread_ts":"1608677079.241000","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"2e4febff-b5f1-41e2-acf4-ebf7b33032b8","type":"message","text":"...but not really generically. I suppose you could also define\n```function Zygote.gradient(f, A::ArrayWrapper)\n    y, back = pullback(f, A)\n    return ArrayWrapper(back(sensitivity(y))[1].arr)\nend```\n","user":"UUMJUCYRK","ts":"1608680527.243500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5jTHq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"...but not really generically. I suppose you could also define\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function Zygote.gradient(f, A::ArrayWrapper)\n    y, back = pullback(f, A)\n    return ArrayWrapper(back(sensitivity(y))[1].arr)\nend"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1608677079.241000","parent_user_id":"UUMJUCYRK"}]