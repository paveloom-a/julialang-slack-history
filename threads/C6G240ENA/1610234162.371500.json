[{"client_msg_id":"a1d469c6-8332-4d66-9e5d-ca7c2a79cdf8","type":"message","text":"Good evening! I get an quite intimidating stack trace when I try to retrieve the gradient with regards to some parameters in an simulated ODE using Zygote. The error originates from <https://github.com/SciML/DiffEqSensitivity.jl/blob/master/src/derivative_wrappers.jl#L296> where the `dgrad[:]` and `vec(tmp2)` have different dimensions, `628` and `630` respectively. It is a difference of 2, so I strongly suspect  that I have implemented some of the `rrules` for boundary operation wrong. Do anyone have a clear understanding of what the role of  `tmp1` and `tmp2` in this function is?","user":"U016VPPCQA1","ts":"1610234162.371500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"n17","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Good evening! I get an quite intimidating stack trace when I try to retrieve the gradient with regards to some parameters in an simulated ODE using Zygote. The error originates from "},{"type":"link","url":"https://github.com/SciML/DiffEqSensitivity.jl/blob/master/src/derivative_wrappers.jl#L296"},{"type":"text","text":" where the "},{"type":"text","text":"dgrad[:]","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"vec(tmp2)","style":{"code":true}},{"type":"text","text":" have different dimensions, "},{"type":"text","text":"628","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"630","style":{"code":true}},{"type":"text","text":" respectively. It is a difference of 2, so I strongly suspect  that I have implemented some of the "},{"type":"text","text":"rrules","style":{"code":true}},{"type":"text","text":" for boundary operation wrong. Do anyone have a clear understanding of what the role of  "},{"type":"text","text":"tmp1","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"tmp2","style":{"code":true}},{"type":"text","text":" in this function is?"}]}]}],"thread_ts":"1610234162.371500","reply_count":3,"reply_users_count":2,"latest_reply":"1610284793.375000","reply_users":["UHDQQ4GN6","U016VPPCQA1"],"subscribed":false},{"client_msg_id":"baeafdea-a82e-4758-9aff-e31b8b9d53ca","type":"message","text":"`tmp1` and `tmp2` are adjoints (cotangents) of `y` and `p`, respectively, pulled back through `f`. Could you share an example of your code that is erroring?","user":"UHDQQ4GN6","ts":"1610240810.374600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9fWQh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"tmp1","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"tmp2","style":{"code":true}},{"type":"text","text":" are adjoints (cotangents) of "},{"type":"text","text":"y","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"p","style":{"code":true}},{"type":"text","text":", respectively, pulled back through "},{"type":"text","text":"f","style":{"code":true}},{"type":"text","text":". Could you share an example of your code that is erroring?"}]}]}],"thread_ts":"1610234162.371500","parent_user_id":"U016VPPCQA1"},{"client_msg_id":"148e62df-a257-409b-8593-b07885ebbbab","type":"message","text":"Section 2 of this paper is helpful for working out what this function is used for: <https://arxiv.org/pdf/1806.07366.pdf>. To compute pullbacks of an ODE, you solve an augmented system that contains not only the result of `f` but also its pullbacks. In algorithm 1, `a(t)ᵀ ∂f/∂z` and `a(t)ᵀ ∂f/∂θ` are I believe `tmp1` and `tmp2`.","user":"UHDQQ4GN6","ts":"1610241834.374800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dcXSR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Section 2 of this paper is helpful for working out what this function is used for: "},{"type":"link","url":"https://arxiv.org/pdf/1806.07366.pdf"},{"type":"text","text":". To compute pullbacks of an ODE, you solve an augmented system that contains not only the result of "},{"type":"text","text":"f","style":{"code":true}},{"type":"text","text":" but also its pullbacks. In algorithm 1, "},{"type":"text","text":"a(t)ᵀ ∂f/∂z","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"a(t)ᵀ ∂f/∂θ","style":{"code":true}},{"type":"text","text":" are I believe "},{"type":"text","text":"tmp1","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"tmp2","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1610234162.371500","parent_user_id":"U016VPPCQA1"},{"client_msg_id":"3247acc6-5367-46fb-b90c-12901673eca4","type":"message","text":"Thanks for the help and reference to the paper. It seems like a good night sleep and your inputs solved the problem. Figured out where I had dimension mismatches in my rules :blush:","user":"U016VPPCQA1","ts":"1610284793.375000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3+v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks for the help and reference to the paper. It seems like a good night sleep and your inputs solved the problem. Figured out where I had dimension mismatches in my rules "},{"type":"emoji","name":"blush"}]}]}],"thread_ts":"1610234162.371500","parent_user_id":"U016VPPCQA1","reactions":[{"name":"tada","users":["U6A936746"],"count":1}]}]