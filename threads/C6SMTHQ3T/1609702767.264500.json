[{"client_msg_id":"a25a8016-ec85-4ed0-b3e6-6d21463024d0","type":"message","text":"What is the best way to reduce the results of a `Threads.@threads` for loop?\n```N = 100_000\nvalue_to_reduce = Vector{Float64}(undef, N)\nThreads.@threads for i = 1:N\n   value_to_reduce[i] = some_expensive_calculation( i )\nend\nsum(value_to_reduce) # result I want```","user":"USU9FRPEU","ts":"1609702767.264500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VblF3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What is the best way to reduce the results of a "},{"type":"text","text":"Threads.@threads","style":{"code":true}},{"type":"text","text":" for loop?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"N = 100_000\nvalue_to_reduce = Vector{Float64}(undef, N)\nThreads.@threads for i = 1:N\n   value_to_reduce[i] = some_expensive_calculation( i )\nend\nsum(value_to_reduce) # result I want"}]}]}],"thread_ts":"1609702767.264500","reply_count":9,"reply_users_count":4,"latest_reply":"1609715836.266700","reply_users":["UDB26738Q","USU9FRPEU","U8D9768Q6","UH8A351DJ"],"subscribed":false},{"client_msg_id":"86956b0d-7784-4423-862f-525d1b296686","type":"message","text":"Accumulate in a vector of nthreads elements","user":"UDB26738Q","ts":"1609703597.264600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/glY2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Accumulate in a vector of nthreads elements"}]}]}],"thread_ts":"1609702767.264500","parent_user_id":"USU9FRPEU"},{"client_msg_id":"64b66b78-ad0f-4bb3-b89d-d04b1d51ffbf","type":"message","text":"Like this?\n```N = 100_000\nvalue_to_reduce = Vector{Float64}(undef, Threads.nthreads())\nThreads.@threads for i = 1:N\n   value_to_reduce[Threads.threadid()] += some_expensive_calculation( i )\nend\nsum(value_to_reduce) # result I want```","user":"USU9FRPEU","ts":"1609703642.264800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mYP4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Like this?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"N = 100_000\nvalue_to_reduce = Vector{Float64}(undef, Threads.nthreads())\nThreads.@threads for i = 1:N\n   value_to_reduce[Threads.threadid()] += some_expensive_calculation( i )\nend\nsum(value_to_reduce) # result I want"}]}]}],"thread_ts":"1609702767.264500","parent_user_id":"USU9FRPEU"},{"client_msg_id":"94844f37-8bee-43c2-9858-43a6d82bb394","type":"message","text":"Yes","user":"UDB26738Q","ts":"1609703903.265000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"AuE2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes"}]}]}],"thread_ts":"1609702767.264500","parent_user_id":"USU9FRPEU"},{"client_msg_id":"ed77adeb-97c3-479e-9610-257cdfaf8b43","type":"message","text":"Transducers.jl has excellent support for multithreaded reductions","user":"U8D9768Q6","ts":"1609703920.265200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3ZFz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Transducers.jl has excellent support for multithreaded reductions"}]}]}],"thread_ts":"1609702767.264500","parent_user_id":"USU9FRPEU"},{"client_msg_id":"394d1b05-8290-4ecf-9b91-33c11a309c64","type":"message","text":"```N = 100_000\nfoldxt(+, 1:N |&gt; Map(some_expensive_calculation))```","user":"U8D9768Q6","ts":"1609703952.265400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LFiY","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"N = 100_000\nfoldxt(+, 1:N |> Map(some_expensive_calculation))"}]}]}],"thread_ts":"1609702767.264500","parent_user_id":"USU9FRPEU"},{"client_msg_id":"414e26da-6fef-4100-a4fc-1e7bf845d37a","type":"message","text":"I'll have to look under the hood at some point, but I suppose that does something fancier than the for loop version above?","user":"USU9FRPEU","ts":"1609704221.265600","team":"T68168MUP","edited":{"user":"USU9FRPEU","ts":"1609704235.000000"},"blocks":[{"type":"rich_text","block_id":"FlS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'll have to look under the hood at some point, but I suppose that does something fancier than the for loop version above?"}]}]}],"thread_ts":"1609702767.264500","parent_user_id":"USU9FRPEU"},{"client_msg_id":"6db6a988-617c-4758-a35b-0c9b28a88fce","type":"message","text":"Yes. For one, it's load balanced which means that if different iterations of the loop take different lengths of time, you'll retain high thread usage (unlike `Threads.@threads`).","user":"U8D9768Q6","ts":"1609704402.265900","team":"T68168MUP","edited":{"user":"U8D9768Q6","ts":"1609704747.000000"},"blocks":[{"type":"rich_text","block_id":"PBD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes. For one, it's load balanced which means that if different iterations of the loop take different lengths of time, you'll retain high thread usage (unlike "},{"type":"text","text":"Threads.@threads","style":{"code":true}},{"type":"text","text":")."}]}]}],"thread_ts":"1609702767.264500","parent_user_id":"USU9FRPEU"},{"client_msg_id":"85723016-6e3f-4b87-bde0-b37de78e7818","type":"message","text":"`ThreadsX.mapreduce`","user":"UH8A351DJ","ts":"1609704829.266300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/JpIN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ThreadsX.mapreduce","style":{"code":true}}]}]}],"thread_ts":"1609702767.264500","parent_user_id":"USU9FRPEU","reactions":[{"name":"+1","users":["U8D9768Q6","USU9FRPEU"],"count":2}]},{"client_msg_id":"55604294-99c0-4d2b-86ca-05399a0325e8","type":"message","text":"Note, `ThreadsX.mapreduce(f, op, itr)` is just going to call `Transducers.foldxt(op, itr |&gt; Map(f))`","user":"U8D9768Q6","ts":"1609715836.266700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"T=5m","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Note, "},{"type":"text","text":"ThreadsX.mapreduce(f, op, itr)","style":{"code":true}},{"type":"text","text":" is just going to call "},{"type":"text","text":"Transducers.foldxt(op, itr |> Map(f))","style":{"code":true}}]}]}],"thread_ts":"1609702767.264500","parent_user_id":"USU9FRPEU"}]