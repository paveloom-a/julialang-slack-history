[{"client_msg_id":"0075a279-a990-4514-ba1b-705615489070","type":"message","text":"Yeah, that came with an extravagant performance penalty for them (okay, they got it down to under 5%, but still not great)","user":"U67BXBF99","ts":"1611004004.019000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ej1Rg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, that came with an extravagant performance penalty for them (okay, they got it down to under 5%, but still not great)"}]}]}],"thread_ts":"1611004004.019000","reply_count":13,"reply_users_count":2,"latest_reply":"1611077615.038200","reply_users":["U89GY9W1J","U674T3KB3"],"subscribed":false},{"client_msg_id":"e6a85dd5-1ba0-48d0-ab62-edc0f8a53443","type":"message","text":"But in the talk, they then say that they _didn't_ end up going with inserting safepoints into backedges because of the above slowdown, yeah? (<@U674T3KB3>)\n\nAnd they instead went with an approach that they argue has zero overhead: using a signal handler to preempt the coroutine, and simulate a call to the safepoint on that coroutine from within the signal handler. Is that what you took out of it, <@U67BXBF99>?","user":"U89GY9W1J","ts":"1611076663.035300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6cq8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But in the talk, they then say that they "},{"type":"text","text":"didn't","style":{"italic":true}},{"type":"text","text":" end up going with inserting safepoints into backedges because of the above slowdown, yeah? ("},{"type":"user","user_id":"U674T3KB3"},{"type":"text","text":")\n\nAnd they instead went with an approach that they argue has zero overhead: using a signal handler to preempt the coroutine, and simulate a call to the safepoint on that coroutine from within the signal handler. Is that what you took out of it, "},{"type":"user","user_id":"U67BXBF99"},{"type":"text","text":"?"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99"},{"client_msg_id":"a900d357-47c2-4bed-86fb-44c0d0f164bc","type":"message","text":"that's just safepoints with extra steps","user":"U674T3KB3","ts":"1611076712.035500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0jla","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's just safepoints with extra steps"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99"},{"client_msg_id":"986094eb-ba8d-4ccc-92ae-d244a239fbc0","type":"message","text":"except that they don't need to check the safepoint on every loop iteration; they only perform it when there's a GC pause, so you don't pay performance penalty when _not_ running gc.\n\nisn't that a relevant difference?","user":"U89GY9W1J","ts":"1611076760.035700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kUGS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"except that they don't need to check the safepoint on every loop iteration; they only perform it when there's a GC pause, so you don't pay performance penalty when "},{"type":"text","text":"not","style":{"italic":true}},{"type":"text","text":" running gc.\n\nisn't that a relevant difference?"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99"},{"client_msg_id":"81495c44-211e-4839-9809-67b21376944b","type":"message","text":"the 5% overhead was (if i remember correctly) what they mentioned they got when they tried safepoints on all backedges, so they didn't go with that approach because they saw the overhead as unacceptable","user":"U89GY9W1J","ts":"1611076828.035900","team":"T68168MUP","edited":{"user":"U89GY9W1J","ts":"1611076832.000000"},"blocks":[{"type":"rich_text","block_id":"l2OT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the 5% overhead was (if i remember correctly) what they mentioned they got when they tried safepoints on all backedges, so they didn't go with that approach because they saw the overhead as unacceptable"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99"},{"client_msg_id":"a77b975d-0e4b-4d2d-87cd-b20abfa867e2","type":"message","text":"this basically just turns every instruction into a safepoint","user":"U674T3KB3","ts":"1611076845.036200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uIn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"this basically just turns every instruction into a safepoint"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99"},{"client_msg_id":"a2f5ad81-d118-4d59-8bab-5b28d3176bdb","type":"message","text":"so they can't ever do any optimization relying on the GC not running","user":"U674T3KB3","ts":"1611076856.036400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qi=H","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so they can't ever do any optimization relying on the GC not running"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99"},{"client_msg_id":"3147ba43-ec79-495b-bdc6-2fb4896159a9","type":"message","text":"yeah, that's true, but they said they can get away with it because they do a cheaper kind of GC for the interrupty safepoint than the normal GC. And the cheaper GC is \"conservative,\" so it doesn't require any overhead from the compiler to track GC stuff? something like that","user":"U89GY9W1J","ts":"1611076914.036600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"e7dvT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, that's true, but they said they can get away with it because they do a cheaper kind of GC for the interrupty safepoint than the normal GC. And the cheaper GC is \"conservative,\" so it doesn't require any overhead from the compiler to track GC stuff? something like that"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99"},{"client_msg_id":"7686cba0-ce73-447a-a7c4-75ef9ee78741","type":"message","text":"and then they use the normal GC algorithm for everything up the callstack, because their function call site is a safepoint","user":"U89GY9W1J","ts":"1611076934.036800","team":"T68168MUP","edited":{"user":"U89GY9W1J","ts":"1611076978.000000"},"blocks":[{"type":"rich_text","block_id":"eseD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and then they use the normal GC algorithm for everything up the callstack, because their function call site is a safepoint"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99"},{"client_msg_id":"c592e330-e953-4060-9d3d-76780ae72ce6","type":"message","text":"seems like the kind of things that could use a kernel feature","user":"U674T3KB3","ts":"1611077080.037200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"G/o0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"seems like the kind of things that could use a kernel feature"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99","reactions":[{"name":"linux","users":["U89GY9W1J"],"count":1}]},{"client_msg_id":"b1aee454-1100-4d95-a749-26f7072f18c0","type":"message","text":"(it was a fairly interesting talk, i would say. probably worth a 1.5x listen)","user":"U89GY9W1J","ts":"1611077119.037500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aoCJQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(it was a fairly interesting talk, i would say. probably worth a 1.5x listen)"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99"},{"client_msg_id":"5af25a55-6ddc-43bb-aa6f-6807f3d03fbe","type":"message","text":"hope they benchmarked on an AVX-512 machine :wink:","user":"U674T3KB3","ts":"1611077178.037700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ccE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hope they benchmarked on an AVX-512 machine "},{"type":"emoji","name":"wink"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99"},{"client_msg_id":"0cbeb51c-041e-4886-9184-39baf0b5f187","type":"message","text":"signals have gotten way more expensive","user":"U674T3KB3","ts":"1611077190.037900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3bdrG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"signals have gotten way more expensive"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99","reactions":[{"name":"grimacing","users":["U89GY9W1J"],"count":1}]},{"client_msg_id":"2c0735d2-dd2b-4d10-bec6-2f75989951fe","type":"message","text":"also, cc: <@U67BJLYCS> since i started a thread on an old message instead of posting in the channel, so this is invisible; sorry","user":"U89GY9W1J","ts":"1611077615.038200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zUjv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"also, cc: "},{"type":"user","user_id":"U67BJLYCS"},{"type":"text","text":" since i started a thread on an old message instead of posting in the channel, so this is invisible; sorry"}]}]}],"thread_ts":"1611004004.019000","parent_user_id":"U67BXBF99"}]