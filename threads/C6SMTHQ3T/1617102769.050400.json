[{"client_msg_id":"cf5fc9b9-c950-4f3c-8c56-1c119431ec09","type":"message","text":"Can someone who is deep down in the rabbit hole of Julia’s multithreading infrastructure take a look at <https://discourse.julialang.org/t/thread-affinitization-pinning-julia-threads-to-cores/58069/5> ? In particular the `likwid-pin` part which almost seems to allow pinning julia threads to specific cores. There might also be something that the `likwid` developers can do, but unfortunately I don’t know what is going on with pthread in Julia at all. So I’d very much appreciate it if someone could shine some light onto this issue.","user":"U881D0W2C","ts":"1617102769.050400","team":"T68168MUP","attachments":[{"service_name":"JuliaLang","title":"Thread affinitization: pinning Julia threads to cores","title_link":"https://discourse.julialang.org/t/thread-affinitization-pinning-julia-threads-to-cores/58069/5","text":"Alright, I’ve done some testing and had some discussion on Slack/GitHub. Let me share my findings. 1) Query the core id of a thread. Let’s start with the second question of the OP first: Is there a way in Julia to figure out which core a thread is running on? Thanks @pbayer for the pointer to schedule_getcpu(). We can call it in Julia like so: glibc_coreid() = @ccall sched_getcpu()::Cint and query the core id of a specific thread using ThreadPools’ @tspawnat: using ThreadPools tglibc_co...","fallback":"JuliaLang: Thread affinitization: pinning Julia threads to cores","thumb_url":"https://aws1.discourse-cdn.com/business5/uploads/julialang/original/2X/1/12829a7ba92b924d4ce81099cbf99785bee9b405.png","ts":1617097649,"from_url":"https://discourse.julialang.org/t/thread-affinitization-pinning-julia-threads-to-cores/58069/5","thumb_width":408,"thumb_height":263,"service_icon":"https://aws1.discourse-cdn.com/business5/uploads/julialang/optimized/2X/6/6ca888e296f59ca2a599807f7d5edd489e3d1829_2_180x180.png","id":1,"original_url":"https://discourse.julialang.org/t/thread-affinitization-pinning-julia-threads-to-cores/58069/5"}],"blocks":[{"type":"rich_text","block_id":"n0s7C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Can someone who is deep down in the rabbit hole of Julia’s multithreading infrastructure take a look at "},{"type":"link","url":"https://discourse.julialang.org/t/thread-affinitization-pinning-julia-threads-to-cores/58069/5"},{"type":"text","text":" ? In particular the "},{"type":"text","text":"likwid-pin","style":{"code":true}},{"type":"text","text":" part which almost seems to allow pinning julia threads to specific cores. There might also be something that the "},{"type":"text","text":"likwid","style":{"code":true}},{"type":"text","text":" developers can do, but unfortunately I don’t know what is going on with pthread in Julia at all. So I’d very much appreciate it if someone could shine some light onto this issue."}]}]}],"thread_ts":"1617102769.050400","reply_count":6,"reply_users_count":2,"latest_reply":"1617108840.052900","reply_users":["U67BJLYCS","U881D0W2C"],"is_locked":false,"subscribed":false},{"client_msg_id":"e1231bb2-2e00-441b-a81f-77164a8917c8","type":"message","text":"I assume you have seen <https://github.com/JuliaPerf/LIKWID.jl|https://github.com/JuliaPerf/LIKWID.jl>","user":"U67BJLYCS","ts":"1617107990.051900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"g7I","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I assume you have seen "},{"type":"link","url":"https://github.com/JuliaPerf/LIKWID.jl","text":"https://github.com/JuliaPerf/LIKWID.jl"}]}]}],"thread_ts":"1617102769.050400","parent_user_id":"U881D0W2C"},{"client_msg_id":"55611d88-1008-425b-91b3-84951bdda051","type":"message","text":"But in general I suspect the issue is OpenBLAS","user":"U67BJLYCS","ts":"1617108111.052100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DpE8c","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But in general I suspect the issue is OpenBLAS"}]}]}],"thread_ts":"1617102769.050400","parent_user_id":"U881D0W2C"},{"client_msg_id":"b0a386f7-34ac-42da-b01f-d6fa1d1596d0","type":"message","text":"There are indeed multiple thread pools","user":"U67BJLYCS","ts":"1617108148.052300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7Sj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"There are indeed multiple thread pools"}]}]}],"thread_ts":"1617102769.050400","parent_user_id":"U881D0W2C"},{"client_msg_id":"6b842d28-dab2-469f-bd22-937ff3a4f9a0","type":"message","text":"Actually, I haven’t seen LIKWID.jl :joy:","user":"U881D0W2C","ts":"1617108277.052500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TKot","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Actually, I haven’t seen LIKWID.jl "},{"type":"emoji","name":"joy"}]}]}],"thread_ts":"1617102769.050400","parent_user_id":"U881D0W2C"},{"client_msg_id":"202aa02a-7b4d-4c9b-bb47-b959374493e1","type":"message","text":"Right now it only has the marker api","user":"U67BJLYCS","ts":"1617108821.052700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xD7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Right now it only has the marker api"}]}]}],"thread_ts":"1617102769.050400","parent_user_id":"U881D0W2C"},{"client_msg_id":"3fa8a69a-8ba1-4d19-bfb2-940eec9b6d2f","type":"message","text":"But if their are other pieces you find useful please add","user":"U67BJLYCS","ts":"1617108840.052900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zbRx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But if their are other pieces you find useful please add"}]}]}],"thread_ts":"1617102769.050400","parent_user_id":"U881D0W2C","reactions":[{"name":"+1","users":["U881D0W2C"],"count":1}]}]