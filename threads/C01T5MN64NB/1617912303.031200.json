[{"client_msg_id":"12f4a47c-4ff9-484a-abec-c269edb1e6c2","type":"message","text":"<@UKA81L34J> I think what you might run into is what happens when `f` is not inlined.","user":"U67BJLYCS","ts":"1617912303.031200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bWSL","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UKA81L34J"},{"type":"text","text":" I think what you might run into is what happens when "},{"type":"text","text":"f","style":{"code":true}},{"type":"text","text":" is not inlined."}]}]}],"thread_ts":"1617912303.031200","reply_count":9,"reply_users_count":2,"latest_reply":"1618063305.036400","reply_users":["UKA81L34J","U67BJLYCS"],"is_locked":false,"subscribed":false},{"client_msg_id":"51618c55-d6e1-4678-8eb9-8d5bf1473a3b","type":"message","text":"<https://github.com/femtomc/Mixtape.jl/blob/master/examples/noinline.jl>","user":"UKA81L34J","ts":"1617912667.032900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aBQ8","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/femtomc/Mixtape.jl/blob/master/examples/noinline.jl"}]}]}],"thread_ts":"1617912303.031200","parent_user_id":"U67BJLYCS"},{"client_msg_id":"ff3fb978-6afa-4416-8320-244053cdf0d6","type":"message","text":"Still seems to work — although I’m not exactly privy to what I would expect to happen. I see the lowered code now has an `Expr(:meta, :noinline)` — but we still try to infer it.","user":"UKA81L34J","ts":"1617912729.033100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VuIbE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Still seems to work — although I’m not exactly privy to what I would expect to happen. I see the lowered code now has an "},{"type":"text","text":"Expr(:meta, :noinline)","style":{"code":true}},{"type":"text","text":" — but we still try to infer it."}]}]}],"thread_ts":"1617912303.031200","parent_user_id":"U67BJLYCS"},{"client_msg_id":"1ce84bc5-8a37-498d-a216-a60274237663","type":"message","text":"right...","user":"U67BJLYCS","ts":"1617912743.033300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XEC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"right..."}]}]}],"thread_ts":"1617912303.031200","parent_user_id":"U67BJLYCS"},{"client_msg_id":"9c4d8646-1c93-44da-9209-74b94cbb15bd","type":"message","text":"on the callee side are you seeing a `Expr(:invoke, ...`","user":"U67BJLYCS","ts":"1617912776.033500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eLFmC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"on the callee side are you seeing a "},{"type":"text","text":"Expr(:invoke, ...","style":{"code":true}}]}]}],"thread_ts":"1617912303.031200","parent_user_id":"U67BJLYCS"},{"client_msg_id":"d68c8eef-8827-4b83-a725-db0931567a87","type":"message","text":"I would expect a `Expr(:call, ` to break","user":"U67BJLYCS","ts":"1617912790.033700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sPg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I would expect a `Expr(:call, ` to break"}]}]}],"thread_ts":"1617912303.031200","parent_user_id":"U67BJLYCS"},{"client_msg_id":"fe11fef1-701f-4413-9ecd-8b27250fae7c","type":"message","text":"```CodeInfo(\n    @ /Users/mccoybecker/dev/Mixtape.jl/examples/noinline.jl:15 within `f'\n1 ─      $(Expr(:meta, :noinline))\n│        Core.NewvarNode(:(g))\n│   %3 = (&lt;)(x, 5)\n└──      goto #3 if not %3\n2 ─      @_4 = Main.NoInliningAllowed.foo\n└──      goto #4\n3 ─      @_4 = Main.NoInliningAllowed.bar\n4 ┄      g = @_4\n│   %9 = (g)(2)\n└──      return %9\n)\nCodeInfo(\n    @ /Users/mccoybecker/dev/Mixtape.jl/examples/noinline.jl:11 within `bar'\n1 ─      $(Expr(:meta, :noinline))\n│   %2 = (Core.apply_type)(Val, 10)\n│   %3 = (%2)()\n│   %4 = (Main.NoInliningAllowed.apply)(*, x, %3)\n└──      return %4\n)\nCodeInfo(\n    @ /Users/mccoybecker/dev/Mixtape.jl/examples/noinline.jl:12 within `apply'\n1 ─ %1 = (f)(x1, $(Expr(:static_parameter, 1)))\n└──      return %1\n)\nCodeInfo(\n    @ /Users/mccoybecker/dev/Mixtape.jl/examples/noinline.jl:10 within `foo'\n1 ─      $(Expr(:meta, :noinline))\n│   %2 = (Core.apply_type)(Val, 5)\n│   %3 = (%2)()\n│   %4 = (Main.NoInliningAllowed.apply)(*, x, %3)\n└──      return %4\n)\nCodeInfo(\n    @ /Users/mccoybecker/dev/Mixtape.jl/examples/noinline.jl:12 within `apply'\n1 ─ %1 = (f)(x1, $(Expr(:static_parameter, 1)))\n└──      return %1\n)```\n","user":"UKA81L34J","ts":"1617912961.033900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Yqf","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"CodeInfo(\n    @ /Users/mccoybecker/dev/Mixtape.jl/examples/noinline.jl:15 within `f'\n1 ─      $(Expr(:meta, :noinline))\n│        Core.NewvarNode(:(g))\n│   %3 = (<)(x, 5)\n└──      goto #3 if not %3\n2 ─      @_4 = Main.NoInliningAllowed.foo\n└──      goto #4\n3 ─      @_4 = Main.NoInliningAllowed.bar\n4 ┄      g = @_4\n│   %9 = (g)(2)\n└──      return %9\n)\nCodeInfo(\n    @ /Users/mccoybecker/dev/Mixtape.jl/examples/noinline.jl:11 within `bar'\n1 ─      $(Expr(:meta, :noinline))\n│   %2 = (Core.apply_type)(Val, 10)\n│   %3 = (%2)()\n│   %4 = (Main.NoInliningAllowed.apply)(*, x, %3)\n└──      return %4\n)\nCodeInfo(\n    @ /Users/mccoybecker/dev/Mixtape.jl/examples/noinline.jl:12 within `apply'\n1 ─ %1 = (f)(x1, $(Expr(:static_parameter, 1)))\n└──      return %1\n)\nCodeInfo(\n    @ /Users/mccoybecker/dev/Mixtape.jl/examples/noinline.jl:10 within `foo'\n1 ─      $(Expr(:meta, :noinline))\n│   %2 = (Core.apply_type)(Val, 5)\n│   %3 = (%2)()\n│   %4 = (Main.NoInliningAllowed.apply)(*, x, %3)\n└──      return %4\n)\nCodeInfo(\n    @ /Users/mccoybecker/dev/Mixtape.jl/examples/noinline.jl:12 within `apply'\n1 ─ %1 = (f)(x1, $(Expr(:static_parameter, 1)))\n└──      return %1\n)"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1617912303.031200","parent_user_id":"U67BJLYCS"},{"client_msg_id":"e16fe3b2-911f-418b-ad4b-805728953f6a","type":"message","text":"I can try an `invoke`","user":"UKA81L34J","ts":"1617912976.034100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1ct","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I can try an "},{"type":"text","text":"invoke","style":{"code":true}}]}]}],"thread_ts":"1617912303.031200","parent_user_id":"U67BJLYCS"},{"client_msg_id":"fb3b89f3-48a1-4517-91c7-a404cbfbced5","type":"message","text":"`invoke` breaks it — you’re right.","user":"UKA81L34J","ts":"1617913034.034300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iVSv7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"invoke","style":{"code":true}},{"type":"text","text":" breaks it — you’re right."}]}]}],"thread_ts":"1617912303.031200","parent_user_id":"U67BJLYCS"},{"client_msg_id":"bca6fdb5-0a49-499a-816a-9e6235062c23","type":"message","text":"<@U67BJLYCS> one way around this is to modify invoke to to accept the `call` interface method (which enters the Mixtape pipeline) as the first argument, and pass it to the function and arguments, etc)","user":"UKA81L34J","ts":"1618063305.036400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jOXk2","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U67BJLYCS"},{"type":"text","text":" one way around this is to modify invoke to to accept the "},{"type":"text","text":"call","style":{"code":true}},{"type":"text","text":" interface method (which enters the Mixtape pipeline) as the first argument, and pass it to the function and arguments, etc)"}]}]}],"thread_ts":"1617912303.031200","parent_user_id":"U67BJLYCS"}]