[{"client_msg_id":"84f28d72-aa4e-4ec7-a513-c2dde7bc223a","type":"message","text":"Um, <@U66GD0880> you broke macos last week. I tried to ping your PR, but realize it was also moving into the weekend","user":"U67BXBF99","ts":"1617041245.015800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DcAw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Um, "},{"type":"user","user_id":"U66GD0880"},{"type":"text","text":" you broke macos last week. I tried to ping your PR, but realize it was also moving into the weekend"}]}]}],"thread_ts":"1617041245.015800","reply_count":35,"reply_users_count":3,"latest_reply":"1617141617.028500","reply_users":["U66GD0880","U67BXBF99","U7THT3TM3"],"is_locked":false,"subscribed":false},{"client_msg_id":"12ec1d06-09aa-4fe6-b6d5-fb5523dd20a1","type":"message","text":"well that’s unfortunate","user":"U66GD0880","ts":"1617041279.015900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WNyMk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"well that’s unfortunate"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"bc9cac5b-4ea3-4ccb-a418-dc504387bad0","type":"message","text":"We need buildkite, haha","user":"U67BXBF99","ts":"1617041310.016100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BOnGZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We need buildkite, haha"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99","reactions":[{"name":"soon","users":["U7THT3TM3"],"count":1}]},{"client_msg_id":"73d7217d-9728-4554-aac0-47cd2c804b91","type":"message","text":"which PR did I break it with?","user":"U66GD0880","ts":"1617041382.016300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Tcu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"which PR did I break it with?"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"11b13855-0397-4178-a0c4-2bce3b5a0cc5","type":"message","text":"ahhh it was my RTLD_NOLOAD one I bet","user":"U66GD0880","ts":"1617041583.016500","team":"T68168MUP","edited":{"user":"U66GD0880","ts":"1617042564.000000"},"blocks":[{"type":"rich_text","block_id":"m+S","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ahhh it was my RTLD_NOLOAD one I bet"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"85559e2f-d309-4105-8eb5-2124d974f728","type":"message","text":"and of course I can’t reproduce the failure locally","user":"U66GD0880","ts":"1617043419.017000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ND=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and of course I can’t reproduce the failure locally"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"67644415-5b94-45c3-a41f-914f05daba05","type":"message","text":"ahhh, haha","user":"U67BXBF99","ts":"1617043943.017300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SJtIg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ahhh, haha"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"645a1ecd-e7c6-4d7e-90bf-4d126c122cf9","type":"message","text":"okay I found it","user":"U66GD0880","ts":"1617045446.017500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sP9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"okay I found it"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"eb3f2bf4-9c32-4730-9211-d39d6d5d398c","type":"message","text":"The fundamental issue is that `dlopen(name, RTLD_NOLOAD)` is quite strict on MacOS","user":"U66GD0880","ts":"1617045463.017700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0tp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The fundamental issue is that "},{"type":"text","text":"dlopen(name, RTLD_NOLOAD)","style":{"code":true}},{"type":"text","text":" is quite strict on MacOS"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"87db6d18-0f2b-459d-a9c6-6630a89ac5fc","type":"message","text":"We rename the DYLIB_ID of `libjulia` to `@rpath/libjulia.dylib`","user":"U66GD0880","ts":"1617045478.017900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"t+h/j","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We rename the DYLIB_ID of "},{"type":"text","text":"libjulia","style":{"code":true}},{"type":"text","text":" to "},{"type":"text","text":"@rpath/libjulia.dylib","style":{"code":true}}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"0131e4a7-74d4-46f3-9d85-0456025ee13d","type":"message","text":"and if we do that, `dlopen(\"libjulia\", RTLD_NOLOAD)` fails.  We must provide `\"@rpath/libjulia.dylib\"` in its entirety as the name to `dlopen()`","user":"U66GD0880","ts":"1617045506.018100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=2l","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and if we do that, "},{"type":"text","text":"dlopen(\"libjulia\", RTLD_NOLOAD)","style":{"code":true}},{"type":"text","text":" fails.  We must provide "},{"type":"text","text":"\"@rpath/libjulia.dylib\"","style":{"code":true}},{"type":"text","text":" in its entirety as the name to "},{"type":"text","text":"dlopen()","style":{"code":true}}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"e6ee6322-9eae-4274-86f8-3a71f25bd58c","type":"message","text":"or at least `@rpath/libjulia` (the `.dylib` seems to be unnecessary)","user":"U66GD0880","ts":"1617045524.018300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fWRJF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"or at least "},{"type":"text","text":"@rpath/libjulia","style":{"code":true}},{"type":"text","text":" (the "},{"type":"text","text":".dylib","style":{"code":true}},{"type":"text","text":" seems to be unnecessary)"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"4cdbb307-5707-428f-acd2-eb275a1d1b1d","type":"message","text":"Proposed fix here: <https://github.com/JuliaLang/julia/pull/40262>","user":"U66GD0880","ts":"1617048543.018500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ZNo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Proposed fix here: "},{"type":"link","url":"https://github.com/JuliaLang/julia/pull/40262"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"532178C5-2809-473E-9DD0-38443C5B7C21","type":"message","text":"<@U67BXBF99> <@U66GD0880> would it be possible to merge #40262?","user":"U7THT3TM3","ts":"1617116620.020800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YQ7EV","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U67BXBF99"},{"type":"text","text":" "},{"type":"user","user_id":"U66GD0880"},{"type":"text","text":" would it be possible to merge #40262?"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"0c7448a6-39ea-4edb-93fb-e95ef435ab7d","type":"message","text":"I think that PR looks probably wrong","user":"U67BXBF99","ts":"1617117772.021000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WpTwx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think that PR looks probably wrong"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"c7ab5f61-c352-4277-b87a-74af8e4b3c68","type":"message","text":"We may want to revert the original PR","user":"U67BXBF99","ts":"1617117782.021200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6KYl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We may want to revert the original PR"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"6F56CADC-2B1C-4EAB-A4EB-E1636B9433A8","type":"message","text":"What was the original PR?","user":"U7THT3TM3","ts":"1617122132.022100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/Dm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What was the original PR?"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"52a4ca2b-a9eb-4b7c-a4b7-1523285097f7","type":"message","text":"making dlpath more efficient by telling it not search for the library","user":"U67BXBF99","ts":"1617125044.022400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JtT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"making dlpath more efficient by telling it not search for the library"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"FA914C80-16DE-46D1-8F7C-7572C4F3EDF8","type":"message","text":"What don’t you like about the fix Jameson? Can you list your objections on the PR?","user":"U66GD0880","ts":"1617125097.023300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Pvit","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What don’t you like about the fix Jameson? Can you list your objections on the PR?"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"7BF26969-CE56-408B-AC33-F45431BD1321","type":"message","text":"I agree it's annoying to work around. I feel perhaps the fix should be in dlopen and applied in the event that RTLD_NOLOAD is set on Darwin","user":"U66GD0880","ts":"1617125147.024500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ygXJF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I agree it's annoying to work around. I feel perhaps the fix should be in dlopen and applied in the event that RTLD_NOLOAD is set on Darwin"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"c1bf1c36-5382-4e0c-b298-bba0c8decbd4","type":"message","text":"It sounds like we’re attempting to duplicate the feature set of not having the flag, but as a list of special cases that don’t quite get the feature right","user":"U67BXBF99","ts":"1617139314.025200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RKV5K","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It sounds like we’re attempting to duplicate the feature set of not having the flag, but as a list of special cases that don’t quite get the feature right"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"6c77aa9b-2c7d-450c-9107-7c3b37f717e6","type":"message","text":"We can also muck around more directly with the API (e.g. _dyld_get_image_name)","user":"U67BXBF99","ts":"1617139498.025400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"crp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We can also muck around more directly with the API (e.g. _dyld_get_image_name)"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"b389b64a-3bd2-4cc6-bf3d-44d20b0a5155","type":"message","text":"But looking back at the original PR, this was also a somewhat breaking change","user":"U67BXBF99","ts":"1617139517.025600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jJ4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But looking back at the original PR, this was also a somewhat breaking change"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"eb4f10fd-c6ab-4ebd-9696-3fed07e4c3f1","type":"message","text":"I think the issue is that `RTLD_NOLOAD` doesn’t do what I thought it did","user":"U66GD0880","ts":"1617140104.025900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"85Dm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think the issue is that "},{"type":"text","text":"RTLD_NOLOAD","style":{"code":true}},{"type":"text","text":" doesn’t do what I thought it did"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"a18d11a2-8d98-4102-a5cc-d36ded5cd08d","type":"message","text":"yeah, agreed","user":"U67BXBF99","ts":"1617140113.026100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"C0r57","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, agreed"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"9213141d-36ca-4550-a82d-f51ceb872629","type":"message","text":"okay let’s revert :slightly_smiling_face:","user":"U66GD0880","ts":"1617140122.026300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ckxci","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"okay let’s revert "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"93549724-59e7-4e96-938a-c6c8465368e3","type":"message","text":"Just made that PR","user":"U67BXBF99","ts":"1617140128.026500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7vH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Just made that PR"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"794037bd-3d29-41ea-b0a3-e90058089e44","type":"message","text":"thanks :slightly_smiling_face:","user":"U66GD0880","ts":"1617140139.026800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mS=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"7f963a5b-4866-493c-bf95-f2f38330797d","type":"message","text":"If you look at jl_pathname_for_handle, we are using NOLOAD","user":"U67BXBF99","ts":"1617140156.027000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2T0x9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you look at jl_pathname_for_handle, we are using NOLOAD"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"2368a2be-1575-4f7a-bbec-cbf47058f308","type":"message","text":"yeah, I think I expected `RTLD_NOLOAD` to actually load, just not link it in, when that’s clearly not what it does","user":"U66GD0880","ts":"1617140185.027200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SmQj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, I think I expected "},{"type":"text","text":"RTLD_NOLOAD","style":{"code":true}},{"type":"text","text":" to actually load, just not link it in, when that’s clearly not what it does"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"e01cfed3-fafd-4af3-9db2-c7c701160f9c","type":"message","text":"yeah, Windows has a flag similar to that too","user":"U67BXBF99","ts":"1617140210.027400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ossM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, Windows has a flag similar to that too"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"f13b53aa-7a18-4b5c-8567-a32e5c744e7d","type":"message","text":"but I think I recall it having some of the same subtleties in practice","user":"U67BXBF99","ts":"1617140239.027600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"t1F","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but I think I recall it having some of the same subtleties in practice"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"a3229be0-82e3-4f98-acbc-24ce56021dbd","type":"message","text":"If you want that, use `findfirst(dllist())` instead","user":"U67BXBF99","ts":"1617140302.027800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gCf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you want that, use "},{"type":"text","text":"findfirst(dllist())","style":{"code":true}},{"type":"text","text":" instead"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"84098a6c-81b1-4fe0-9729-eec9c73d9b54","type":"message","text":"well, what I was hoping for is that users can use `dlpath(\"libfoo\")` without worrying about side-effects from loading `libfoo`","user":"U66GD0880","ts":"1617140363.028000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0Nrx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"well, what I was hoping for is that users can use "},{"type":"text","text":"dlpath(\"libfoo\")","style":{"code":true}},{"type":"text","text":" without worrying about side-effects from loading "},{"type":"text","text":"libfoo","style":{"code":true}}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"09ce6688-127c-4cc5-84ed-f11423efa33a","type":"message","text":"yeah, but that’s perhaps partly why we shouldn’t use dlpath","user":"U67BXBF99","ts":"1617141600.028300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"N3T","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, but that’s perhaps partly why we shouldn’t use dlpath"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99"},{"client_msg_id":"9db664da-2189-4978-a285-fe81eb654949","type":"message","text":"And why Artifacts can avoid it (content based, instead of dyld search)","user":"U67BXBF99","ts":"1617141617.028500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JQY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And why Artifacts can avoid it (content based, instead of dyld search)"}]}]}],"thread_ts":"1617041245.015800","parent_user_id":"U67BXBF99","reactions":[{"name":"heavy_check_mark","users":["U66GD0880"],"count":1}]}]