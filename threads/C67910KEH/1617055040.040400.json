[{"client_msg_id":"dcb21153-9273-4d9a-9212-6c6f44154e54","type":"message","text":"How crazy would I be to treat `Bool` as if it were the same as `Atomic{Bool}`?  My thinking is that it is 1 byte so what could the CPU possibly do to the thing that is not atomic?","user":"U9VG1AYSG","ts":"1617055040.040400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"t/4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How crazy would I be to treat "},{"type":"text","text":"Bool","style":{"code":true}},{"type":"text","text":" as if it were the same as "},{"type":"text","text":"Atomic{Bool}","style":{"code":true}},{"type":"text","text":"?  My thinking is that it is 1 byte so what could the CPU possibly do to the thing that is not atomic?"}]}]}],"thread_ts":"1617055040.040400","reply_count":22,"reply_users_count":3,"latest_reply":"1617056371.045300","reply_users":["U6QGE7S86","U9VG1AYSG","UC7AF7NSU"],"is_locked":false,"subscribed":false},{"client_msg_id":"8b71ce6f-982d-44bd-b974-592c7bcfc690","type":"message","text":"You'll cause someone to have a very very very bad time, yes.","user":"U6QGE7S86","ts":"1617055220.040700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Q1p5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You'll cause someone to have a very very very bad time, yes."}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"7517a4d7-146c-4e7c-a592-8e9bab6a62b7","type":"message","text":"what happens?","user":"U9VG1AYSG","ts":"1617055234.040900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vc9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what happens?"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"4a51fdd9-2d62-49c0-941c-2bdb7cfdb8ef","type":"message","text":"Even if you don't you have no guarantees that all the compilation steps won't reorder your code and lead to deadlocks/livelocks/data races.","user":"U6QGE7S86","ts":"1617055258.041100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dpf3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Even if you don't you have no guarantees that all the compilation steps won't reorder your code and lead to deadlocks/livelocks/data races."}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"a7f6bead-d7f2-4b32-9756-0e5358dad2be","type":"message","text":"And take the cross product of that with different architectures.","user":"U6QGE7S86","ts":"1617055275.041300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Wh+pd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And take the cross product of that with different architectures."}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"5345efc3-635f-4bec-a524-cce87ed66fd8","type":"message","text":"but I mean, it's not like `Atomic` in and of itself is capable of guaranteeing no race conditions right?  So while yes, you can have lots of crazy stuff happen, is `Atomic` really solving any of those in this case?","user":"U9VG1AYSG","ts":"1617055328.041500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3zd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but I mean, it's not like "},{"type":"text","text":"Atomic","style":{"code":true}},{"type":"text","text":" in and of itself is capable of guaranteeing no race conditions right?  So while yes, you can have lots of crazy stuff happen, is "},{"type":"text","text":"Atomic","style":{"code":true}},{"type":"text","text":" really solving any of those in this case?"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"0074a6fb-7f92-4a1c-8ef8-e90f4716aa1e","type":"message","text":"Someone else can chime in, but IMO, you have to be several engineering months into \"we're not getting enough instructions per cycle retired\" before considering this sort of approach.","user":"U6QGE7S86","ts":"1617055548.041700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EQZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Someone else can chime in, but IMO, you have to be several engineering months into \"we're not getting enough instructions per cycle retired\" before considering this sort of approach."}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"15443592-9f15-4cb3-bb41-028cf8d025b4","type":"message","text":"(If you're just spitballing then have at it, but uhhhh. Don't lose the guardrails in concurrency land :sweat_smile: )","user":"U6QGE7S86","ts":"1617055574.041900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"brxtD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(If you're just spitballing then have at it, but uhhhh. Don't lose the guardrails in concurrency land "},{"type":"emoji","name":"sweat_smile"},{"type":"text","text":" )"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"1f483357-fc06-47df-b5d9-af9e5db72a08","type":"message","text":"I'm not that serious about doing it, I just wonder how it could possibly fail.  I mean, technically it'll be hardware dependent, but no modern machines have sub-byte words sizes, and if somebody gets Julia running on a machine like that I think they're going to have bigger problems lol","user":"U9VG1AYSG","ts":"1617055669.042100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"V+L","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm not that serious about doing it, I just wonder how it could possibly fail.  I mean, technically it'll be hardware dependent, but no modern machines have sub-byte words sizes, and if somebody gets Julia running on a machine like that I think they're going to have bigger problems lol"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"e431bb93-7a9a-48f7-9ae1-93550eb2078a","type":"message","text":"For starters, if your byte falls on the overlap of adjacent structs  and is picked up by different cache lines then you're gonna have a bad time with ABA problems.","user":"U6QGE7S86","ts":"1617055733.042300","team":"T68168MUP","edited":{"user":"U6QGE7S86","ts":"1617055752.000000"},"blocks":[{"type":"rich_text","block_id":"FWD6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For starters, if your byte falls on the overlap of adjacent structs  and is picked up by different cache lines then you're gonna have a bad time with ABA problems."}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"5dfacb12-df6a-48d6-9c52-bdd3214f5ab7","type":"message","text":"And if you have several of those threads, debugging will be an NP nightmare (literally)","user":"U6QGE7S86","ts":"1617055807.042600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"a3pn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And if you have several of those threads, debugging will be an NP nightmare (literally)"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"ee8e2526-6c85-41c5-9809-637903e2e289","type":"message","text":"ah yes... now that is starting to make sense... I often forget that the threads have that caching behavior, I usually think of them as using literally the same memory","user":"U9VG1AYSG","ts":"1617055834.042800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LNI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ah yes... now that is starting to make sense... I often forget that the threads have that caching behavior, I usually think of them as using literally the same memory"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"5b0a8769-2527-42ce-a346-cfa206afec49","type":"message","text":"Yup, this distributed systems land is exactly the place where people's intuition of what a system can do given code is dwarfed by the possible state space explosion.","user":"U6QGE7S86","ts":"1617055956.043000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"c+gI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yup, this distributed systems land is exactly the place where people's intuition of what a system can do given code is dwarfed by the possible state space explosion."}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"72465aa7-1d63-4c51-8354-0bb8cf50729c","type":"message","text":"This is my favorite intro talk to all this \"You don't even know the worlds of landmines you are stepping on\" talk","user":"U6QGE7S86","ts":"1617055984.043200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"w8Pc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is my favorite intro talk to all this \"You don't even know the worlds of landmines you are stepping on\" talk"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"fd1cbe4d-ade4-4e9e-9793-cfb95669b671","type":"message","text":"<https://youtu.be/ATobswwFwQA?t=389>","user":"U6QGE7S86","ts":"1617055986.043400","team":"T68168MUP","attachments":[{"service_name":"YouTube","service_url":"https://www.youtube.com/","title":"YOW! 2019 - Hillel Wayne - Designing Distributed Systems with TLA+","title_link":"https://youtu.be/ATobswwFwQA?t=389","author_name":"YOW! Conferences","author_link":"https://www.youtube.com/c/YOWConferences","thumb_url":"https://i.ytimg.com/vi/ATobswwFwQA/hqdefault.jpg","thumb_width":480,"thumb_height":360,"fallback":"YouTube Video: YOW! 2019 - Hillel Wayne - Designing Distributed Systems with TLA+","video_html":"<iframe width=\"400\" height=\"225\" src=\"https://www.youtube.com/embed/ATobswwFwQA?start=389&feature=oembed&start=389&autoplay=1&iv_load_policy=3\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>","video_html_width":400,"video_html_height":225,"from_url":"https://youtu.be/ATobswwFwQA?t=389","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/youtube.png","id":1,"original_url":"https://youtu.be/ATobswwFwQA?t=389"}],"blocks":[{"type":"rich_text","block_id":"2hA","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://youtu.be/ATobswwFwQA?t=389"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"f2604b18-f971-4bff-9721-5ad40f3ca624","type":"message","text":"If you wanna talk more about the tool he uses called TLA+, join us on the zulip #formalmethods :smile:","user":"U6QGE7S86","ts":"1617056005.043700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"McgI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you wanna talk more about the tool he uses called TLA+, join us on the zulip #formalmethods "},{"type":"emoji","name":"smile"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"5b0d2c1d-dd0a-4f70-b690-f39e831668a5","type":"message","text":"atomic is not only about the location you are assigning to (of course, unless you are using relaxed ordering). the important property of atomic operation is that it creates ordering constraint of the instructions _surrounding_ the atomic operations and the compiler and the hardware both respect this constraint.","user":"UC7AF7NSU","ts":"1617056178.043900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nKg=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"atomic is not only about the location you are assigning to (of course, unless you are using relaxed ordering). the important property of atomic operation is that it creates ordering constraint of the instructions "},{"type":"text","text":"surrounding","style":{"italic":true}},{"type":"text","text":" the atomic operations and the compiler and the hardware both respect this constraint."}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG","reactions":[{"name":"100","users":["U6QGE7S86"],"count":1}]},{"client_msg_id":"17e7a64d-a525-458e-8503-f7cf18134e27","type":"message","text":"on x86, IIRC relaxed atomic read/write is the same as non-atomic","user":"UC7AF7NSU","ts":"1617056210.044200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gNP3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"on x86, IIRC relaxed atomic read/write is the same as non-atomic"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"00c6b852-67a5-427f-8caf-2f13d491da65","type":"message","text":"so, you should probably just use relaxed atmoic if you don't need the ordering","user":"UC7AF7NSU","ts":"1617056248.044400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ggA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so, you should probably just use relaxed atmoic if you don't need the ordering"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"55387d08-e01b-49d9-95bc-024079e2513c","type":"message","text":"hm, interesting","user":"U9VG1AYSG","ts":"1617056340.044600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vVk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hm, interesting"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"50243ae2-7154-48f8-ad54-ee0998adabd5","type":"message","text":"but I find relaxed atmoics very scary to use outside the common idiom, especially when you start thinking about how it'd interact with speculative executions","user":"UC7AF7NSU","ts":"1617056341.044800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"S6twG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but I find relaxed atmoics very scary to use outside the common idiom, especially when you start thinking about how it'd interact with speculative executions"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"3b7c3891-d08c-4b47-9ea5-85ebe6764cf7","type":"message","text":"I find this talk very useful <https://www.youtube.com/watch?v=cWkUqK71DZ0>","user":"UC7AF7NSU","ts":"1617056355.045000","team":"T68168MUP","attachments":[{"service_name":"YouTube","service_url":"https://www.youtube.com/","title":"A Relaxed Guide to memory_order_relaxed - Paul E. McKenney &amp; Hans Boehm - CppCon 2020","title_link":"https://www.youtube.com/watch?v=cWkUqK71DZ0","author_name":"CppCon","author_link":"https://www.youtube.com/user/CppCon","thumb_url":"https://i.ytimg.com/vi/cWkUqK71DZ0/hqdefault.jpg","thumb_width":480,"thumb_height":360,"fallback":"YouTube Video: A Relaxed Guide to memory_order_relaxed - Paul E. McKenney & Hans Boehm - CppCon 2020","video_html":"<iframe width=\"400\" height=\"225\" src=\"https://www.youtube.com/embed/cWkUqK71DZ0?feature=oembed&autoplay=1&iv_load_policy=3\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>","video_html_width":400,"video_html_height":225,"from_url":"https://www.youtube.com/watch?v=cWkUqK71DZ0","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/youtube.png","id":1,"original_url":"https://www.youtube.com/watch?v=cWkUqK71DZ0"}],"blocks":[{"type":"rich_text","block_id":"DKBMx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I find this talk very useful "},{"type":"link","url":"https://www.youtube.com/watch?v=cWkUqK71DZ0"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"2a5417c0-0290-4d73-8cb6-3263ddd58fac","type":"message","text":"cool, thanks","user":"U9VG1AYSG","ts":"1617056371.045300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/dC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"cool, thanks"}]}]}],"thread_ts":"1617055040.040400","parent_user_id":"U9VG1AYSG"}]