[{"client_msg_id":"37990457-ea2f-4c5d-ae10-016a07de09ff","type":"message","text":"Hey folks, just curious, are there any best practices to implement a singleton pattern <https://en.wikipedia.org/wiki/Singleton_pattern> in Julia? (Disclaimer: not supposed to holy war about whether singleton makes sense, just asking about the implementation)","user":"UEAHXC74L","ts":"1616324940.184000","team":"T68168MUP","edited":{"user":"UEAHXC74L","ts":"1616325304.000000"},"attachments":[{"image_url":"https://upload.wikimedia.org/wikipedia/commons/thumb/f/fb/Singleton_UML_class_diagram.svg/1200px-Singleton_UML_class_diagram.svg.png","image_width":1200,"image_height":720,"image_bytes":25689,"title":"Singleton pattern","title_link":"https://en.wikipedia.org/wiki/Singleton_pattern","from_url":"https://en.wikipedia.org/wiki/Singleton_pattern","author_name":"Wikipedia","author_link":"https://en.wikipedia.org/","text":"In software engineering, the singleton pattern is a software design pattern that restricts the instantiation of a class to one \"single\" instance. This is useful when exactly one object is needed to coordinate actions across the system. The term comes from the mathematical concept of a singleton.\nCritics consider the singleton to be an anti-pattern in that it is frequently used in scenarios where it is not beneficial, introduces unnecessary restrictions in situations where a sole instance of a class is not actually required, and introduces global state into an application.","fallback":"wikipedia: Singleton pattern","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/wikipedia.png","id":1,"original_url":"https://en.wikipedia.org/wiki/Singleton_pattern"}],"blocks":[{"type":"rich_text","block_id":"aRwS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hey folks, just curious, are there any best practices to implement a singleton pattern "},{"type":"link","url":"https://en.wikipedia.org/wiki/Singleton_pattern"},{"type":"text","text":" in Julia? (Disclaimer: not supposed to holy war about whether singleton makes sense, just asking about the implementation)"}]}]}],"thread_ts":"1616324940.184000","reply_count":20,"reply_users_count":5,"latest_reply":"1616325911.189000","reply_users":["U7HAYKY9X","UEAHXC74L","U72B7LTMX","U6N6VQE30","U67D54KS8"],"subscribed":false},{"client_msg_id":"380d97ea-c307-4a88-a56d-2e31482d3619","type":"message","text":"You can just make a struct with zero fields:\n`struct MySingleton end`","user":"U7HAYKY9X","ts":"1616324984.184200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nHq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You can just make a struct with zero fields:\n"},{"type":"text","text":"struct MySingleton end","style":{"code":true}}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"ae8a5ea4-bc73-4b6f-ac7d-fd8186627519","type":"message","text":"If the struct contains no data, any two instances are indistinguishable, and it behaves as if there is only one instance.","user":"U7HAYKY9X","ts":"1616325028.184400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/yYI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If the struct contains no data, any two instances are indistinguishable, and it behaves as if there is only one instance."}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"16175702-bb9f-4891-94e3-2ee96ce7b017","type":"message","text":"Thanks Jakob. And if I want to store some data there, how does it work then?","user":"UEAHXC74L","ts":"1616325075.184600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GAt7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks Jakob. And if I want to store some data there, how does it work then?"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"3961325e-7199-4d11-b836-96cb52b46283","type":"message","text":"Right, I think the Singleton pattern is more often about global data. Can you just use a global variable?","user":"U72B7LTMX","ts":"1616325118.184800","team":"T68168MUP","thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"c112ac9d-9843-4a71-85a5-ab71f3a8f881","type":"message","text":"Well, I wanted to make it more neat than just a global variable…","user":"UEAHXC74L","ts":"1616325179.185000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Hf2yp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well, I wanted to make it more neat than just a global variable…"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"6ca3825a-adca-4fc0-a5d9-159468c26e11","type":"message","text":"Hm... you could make getter and setter functions that accesses some external data:\n```const FooField = Ref(0)\nfoo(::MySingleton) = FooField[]\nsetfoo(::MySingleton, v) = FooField[] = v```","user":"U7HAYKY9X","ts":"1616325190.185200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Kf=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hm... you could make getter and setter functions that accesses some external data:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"const FooField = Ref(0)\nfoo(::MySingleton) = FooField[]\nsetfoo(::MySingleton, v) = FooField[] = v"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L","reactions":[{"name":"+1","users":["UEAHXC74L","UAUPJLBQX"],"count":2}]},{"client_msg_id":"6e2f1448-d8cc-44a5-a9a3-04aa657b3f6c","type":"message","text":"Neat in the sense of using setters and getters?","user":"U72B7LTMX","ts":"1616325296.185600","team":"T68168MUP","thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"b81b64ea-378f-46be-be31-20d4693db512","type":"message","text":"Yes, to be able to track the access to it","user":"UEAHXC74L","ts":"1616325318.185900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"W9k","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, to be able to track the access to it"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"aade9d0d-18b8-49aa-bc98-da32deaf4adb","type":"message","text":"You could also do something more direct, like:\n```julia&gt; struct Unsafe end\n\njulia&gt; struct Foo1\n           a::Vector{Int}\n           Foo1(::Unsafe, a::Vector{Int}) = new(a)\n       end\n\njulia&gt; const GlobalFoo1 = Base.RefValue{Union{Nothing, Foo1}}(nothing)\nBase.RefValue{Union{Nothing, Foo1}}(nothing)\n\njulia&gt; function Foo1(a)\n           if GlobalFoo1[] === nothing\n               foo1 = Foo1(Unsafe(), a)\n               GlobalFoo1[] = foo1\n               foo1\n           else\n               GlobalFoo1[]\n           end\n       end\nFoo1```","user":"U7HAYKY9X","ts":"1616325361.186100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XIRX7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You could also do something more direct, like:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> struct Unsafe end\n\njulia> struct Foo1\n           a::Vector{Int}\n           Foo1(::Unsafe, a::Vector{Int}) = new(a)\n       end\n\njulia> const GlobalFoo1 = Base.RefValue{Union{Nothing, Foo1}}(nothing)\nBase.RefValue{Union{Nothing, Foo1}}(nothing)\n\njulia> function Foo1(a)\n           if GlobalFoo1[] === nothing\n               foo1 = Foo1(Unsafe(), a)\n               GlobalFoo1[] = foo1\n               foo1\n           else\n               GlobalFoo1[]\n           end\n       end\nFoo1"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"722942d8-db66-4391-a682-51fcf4180090","type":"message","text":"Hm, also cool, thanks Jakob","user":"UEAHXC74L","ts":"1616325395.186300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uD0m+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hm, also cool, thanks Jakob"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"0dbb209b-c8c3-4ce6-8b35-455e64cd0bf4","type":"message","text":"Where you make a hidden type `Unsafe` that can be used to construct new Foo's","user":"U7HAYKY9X","ts":"1616325397.186500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6w+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Where you make a hidden type "},{"type":"text","text":"Unsafe","style":{"code":true}},{"type":"text","text":" that can be used to construct new Foo's"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"150397af-a4b4-4e7d-9438-b0022e954aef","type":"message","text":"Yes, get it","user":"UEAHXC74L","ts":"1616325406.186700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aS5O","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, get it"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"dccca28c-0e38-4831-a0b1-dc339e5be5c1","type":"message","text":"it's still not a singleton because you can construct Unsafe()","user":"U6N6VQE30","ts":"1616325407.186900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HbOgh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it's still not a singleton because you can construct Unsafe()"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L","reactions":[{"name":"heavy_plus_sign","users":["UEAHXC74L"],"count":1}]},{"client_msg_id":"c9da05f8-c826-448d-b9f5-8bddadee5966","type":"message","text":"Right, but assuming Unsafe is not exported, that will take people messing with the internals (in which case all bets are off anyway)","user":"U7HAYKY9X","ts":"1616325454.187100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"IK8y3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Right, but assuming Unsafe is not exported, that will take people messing with the internals (in which case all bets are off anyway)"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L","reactions":[{"name":"heavy_check_mark","users":["UEAHXC74L"],"count":1}]},{"type":"message","subtype":"thread_broadcast","text":"If you want to track accesses to some global variable, then you can just write functions to do that.","user":"U72B7LTMX","ts":"1616325578.187500","thread_ts":"1616324940.184000","root":{"client_msg_id":"37990457-ea2f-4c5d-ae10-016a07de09ff","type":"message","text":"Hey folks, just curious, are there any best practices to implement a singleton pattern <https://en.wikipedia.org/wiki/Singleton_pattern> in Julia? (Disclaimer: not supposed to holy war about whether singleton makes sense, just asking about the implementation)","user":"UEAHXC74L","ts":"1616324940.184000","team":"T68168MUP","edited":{"user":"UEAHXC74L","ts":"1616325304.000000"},"attachments":[{"image_url":"https://upload.wikimedia.org/wikipedia/commons/thumb/f/fb/Singleton_UML_class_diagram.svg/1200px-Singleton_UML_class_diagram.svg.png","image_width":1200,"image_height":720,"image_bytes":25689,"title":"Singleton pattern","title_link":"https://en.wikipedia.org/wiki/Singleton_pattern","from_url":"https://en.wikipedia.org/wiki/Singleton_pattern","author_name":"Wikipedia","author_link":"https://en.wikipedia.org/","text":"In software engineering, the singleton pattern is a software design pattern that restricts the instantiation of a class to one \"single\" instance. This is useful when exactly one object is needed to coordinate actions across the system. The term comes from the mathematical concept of a singleton.\nCritics consider the singleton to be an anti-pattern in that it is frequently used in scenarios where it is not beneficial, introduces unnecessary restrictions in situations where a sole instance of a class is not actually required, and introduces global state into an application.","fallback":"wikipedia: Singleton pattern","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/wikipedia.png","id":1,"original_url":"https://en.wikipedia.org/wiki/Singleton_pattern"}],"blocks":[{"type":"rich_text","block_id":"aRwS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hey folks, just curious, are there any best practices to implement a singleton pattern "},{"type":"link","url":"https://en.wikipedia.org/wiki/Singleton_pattern"},{"type":"text","text":" in Julia? (Disclaimer: not supposed to holy war about whether singleton makes sense, just asking about the implementation)"}]}]}],"thread_ts":"1616324940.184000","reply_count":20,"reply_users_count":5,"latest_reply":"1616325911.189000","reply_users":["U7HAYKY9X","UEAHXC74L","U72B7LTMX","U6N6VQE30","U67D54KS8"],"subscribed":false},"client_msg_id":"d5f96335-e6f6-4b0f-b16a-88109ce555f9"},{"client_msg_id":"7f3f6fef-df7f-4e11-9726-dfc80321530a","type":"message","text":"Are there multiple singletons one of which you need to e.g. pass into a function?","user":"U72B7LTMX","ts":"1616325659.187800","team":"T68168MUP","thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"6b8c9b65-4b59-4e89-97d5-18dc2d4da6fd","type":"message","text":"Well, that’s also a valid point. My intent is to have two.","user":"UEAHXC74L","ts":"1616325701.188000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=ZI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well, that’s also a valid point. My intent is to have two."}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"df8d2f65-f927-43fa-9866-f5135db53f38","type":"message","text":"```julia&gt; struct Singleton\n           data::Vector{Int}\n           function Singleton()\n               if SINGLETON[] === nothing\n                   s = new([1,2,3])\n                   SINGLETON[] = s\n                   return s\n               else\n                   return SINGLETON[]\n               end\n           end\n       end\n\njulia&gt; const SINGLETON = Ref{Union{Nothing, Singleton}}(nothing);\n\njulia&gt; a = Singleton()\nSingleton([1, 2, 3])\n\njulia&gt; pointer(a.data)\nPtr{Int64} @0x0000000108fcb770\n\njulia&gt; b = Singleton()\nSingleton([1, 2, 3])\n\njulia&gt; pointer(b.data)\nPtr{Int64} @0x0000000108fcb770```","user":"U67D54KS8","ts":"1616325725.188200","team":"T68168MUP","edited":{"user":"U67D54KS8","ts":"1616325802.000000"},"blocks":[{"type":"rich_text","block_id":"A8+ad","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> struct Singleton\n           data::Vector{Int}\n           function Singleton()\n               if SINGLETON[] === nothing\n                   s = new([1,2,3])\n                   SINGLETON[] = s\n                   return s\n               else\n                   return SINGLETON[]\n               end\n           end\n       end\n\njulia> const SINGLETON = Ref{Union{Nothing, Singleton}}(nothing);\n\njulia> a = Singleton()\nSingleton([1, 2, 3])\n\njulia> pointer(a.data)\nPtr{Int64} @0x0000000108fcb770\n\njulia> b = Singleton()\nSingleton([1, 2, 3])\n\njulia> pointer(b.data)\nPtr{Int64} @0x0000000108fcb770"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L","reactions":[{"name":"100","users":["U7HAYKY9X"],"count":1},{"name":"+1","users":["UEAHXC74L","UAUPJLBQX","U01QRM4E8HL"],"count":3}]},{"client_msg_id":"eaf68c54-c118-4d5d-8a5d-2d073cb2e0e6","type":"message","text":"maybe","user":"U67D54KS8","ts":"1616325729.188400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0i6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"maybe"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L"},{"client_msg_id":"b8304188-8193-4e94-890b-28887c454f11","type":"message","text":"Resembles Meyer’s singleton","user":"UEAHXC74L","ts":"1616325911.189000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"u1FjV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Resembles Meyer’s singleton"}]}]}],"thread_ts":"1616324940.184000","parent_user_id":"UEAHXC74L","reactions":[{"name":"100","users":["U01QRM4E8HL"],"count":1}]}]