[{"client_msg_id":"cb31d346-d54e-47c1-8423-6021737f35f5","type":"message","text":"```using BenchmarkTools\n\nfunction dot3(a, b)\n    return a[1]*b[1] + a[2]*b[2] + a[3]*b[3]\nend\n\nfunction main()\n    A = [1.0, 2.0, 3.0]\n    B = (1.0, 2.0, 3.0)\n    @btime dot3($A, $A)\n    @btime dot3($B, $B)\nend\n\nmain()\n\n# 2.460 ns (0 allocations: 0 bytes)\n# 0.023 ns (0 allocations: 0 bytes)```\nWhat is the technical explanation why the use of arrays is so slow compared to the use of tuples?","user":"UAGBT2X1A","ts":"1613070004.418000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LG2","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using BenchmarkTools\n\nfunction dot3(a, b)\n    return a[1]*b[1] + a[2]*b[2] + a[3]*b[3]\nend\n\nfunction main()\n    A = [1.0, 2.0, 3.0]\n    B = (1.0, 2.0, 3.0)\n    @btime dot3($A, $A)\n    @btime dot3($B, $B)\nend\n\nmain()\n\n# 2.460 ns (0 allocations: 0 bytes)\n# 0.023 ns (0 allocations: 0 bytes)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"What is the technical explanation why the use of arrays is so slow compared to the use of tuples?"}]}]}],"thread_ts":"1613070004.418000","reply_count":24,"reply_users_count":9,"latest_reply":"1613070649.423800","reply_users":["UDB26738Q","UH24GRBLL","U67BJLYCS","UAGBT2X1A","UH8A351DJ","UMZQBQU67","U6788D83U","U67D54KS8","U0179G7FG4F"],"subscribed":false},{"client_msg_id":"83e02e06-29b7-413e-b614-03bba9f78297","type":"message","text":"constant propagation probably.  subnanoseconds timings don't make sense","user":"UDB26738Q","ts":"1613070066.418100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=3E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"constant propagation probably.  subnanoseconds timings don't make sense"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A","reactions":[{"name":"heart","users":["U67BJLYCS","UH24GRBLL"],"count":2},{"name":"heavy_check_mark","users":["UH8A351DJ"],"count":1}]},{"client_msg_id":"b056b00c-0f4e-4437-89a8-3ab39971ca33","type":"message","text":"tuples have a length known to the compiler","user":"UH24GRBLL","ts":"1613070071.418300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Cf8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"tuples have a length known to the compiler"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"049a6050-a322-4421-a381-6572d5cbf333","type":"message","text":"so it's probably folded really efficiently","user":"UH24GRBLL","ts":"1613070089.418500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1MfE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so it's probably folded really efficiently"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"dfec44c7-e8c8-4cd4-9012-a4efd8a88efa","type":"message","text":"What Mose said","user":"U67BJLYCS","ts":"1613070099.418900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TckB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What Mose said"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"b8d47198-a165-4e83-9653-7b16697bab7c","type":"message","text":"`dot3` doesn't do anything","user":"U67BJLYCS","ts":"1613070110.419100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XL8Cm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"dot3","style":{"code":true}},{"type":"text","text":" doesn't do anything"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"1bc919a8-7eb9-4509-9fda-0a17d7b27751","type":"message","text":"You mean, this is a bit unfair comparison?","user":"UAGBT2X1A","ts":"1613070140.419400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2R1E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You mean, this is a bit unfair comparison?"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"c3279ca5-559a-4977-9bc7-052b085ad84e","type":"message","text":"0.02ns is literally a few clock cycle","user":"UH8A351DJ","ts":"1613070150.419600","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1613070158.000000"},"blocks":[{"type":"rich_text","block_id":"Y1y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"0.02ns is literally a few clock cycle"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"7942abd5-a8cb-438b-8f90-2cc0d5a1b384","type":"message","text":"```julia&gt; function main()\n           A = [1.0, 2.0, 3.0]\n           B = (1.0, 2.0, 3.0)\n           @btime dot3($(Ref(A))[], $(Ref(A))[])\n           @btime dot3($(Ref(B))[], $(Ref(B))[])\n       end\nmain (generic function with 1 method)\n\njulia&gt; main()\n  2.729 ns (0 allocations: 0 bytes)\n  1.644 ns (0 allocations: 0 bytes)\n14.0```\n`Ref` prevents constant propagation.  tuples are still faster, but not by order of magnitudes","user":"UDB26738Q","ts":"1613070156.419800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"03Aib","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> function main()\n           A = [1.0, 2.0, 3.0]\n           B = (1.0, 2.0, 3.0)\n           @btime dot3($(Ref(A))[], $(Ref(A))[])\n           @btime dot3($(Ref(B))[], $(Ref(B))[])\n       end\nmain (generic function with 1 method)\n\njulia> main()\n  2.729 ns (0 allocations: 0 bytes)\n  1.644 ns (0 allocations: 0 bytes)\n14.0"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Ref","style":{"code":true}},{"type":"text","text":" prevents constant propagation.  tuples are still faster, but not by order of magnitudes"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"596c5e54-421e-4db7-b304-d6bbb24dde98","type":"message","text":"`dot3(B, B) = 14`","user":"UMZQBQU67","ts":"1613070157.420000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nBr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"dot3(B, B) = 14","style":{"code":true}}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"ea694b2f-febe-40d8-8c01-2adcda887c3b","type":"message","text":"```julia&gt; @btime dot3(Ref($B)[], Ref($B)[])\n  1.143 ns (0 allocations: 0 bytes)\n14.0```","user":"U6788D83U","ts":"1613070165.420300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DyyY","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime dot3(Ref($B)[], Ref($B)[])\n  1.143 ns (0 allocations: 0 bytes)\n14.0"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A","reactions":[{"name":"slow_parrot","users":["UDB26738Q"],"count":1},{"name":"+1","users":["UH8A351DJ"],"count":1}]},{"client_msg_id":"059315bd-9b03-4e00-a784-d1e6033bab55","type":"message","text":"Don't run `btime` inside a function","user":"U67BJLYCS","ts":"1613070186.420800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nhg37","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Don't run "},{"type":"text","text":"btime","style":{"code":true}},{"type":"text","text":" inside a function"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A","reactions":[{"name":"julia-smirk","users":["UMZQBQU67"],"count":1}]},{"client_msg_id":"c02a828a-abb3-4940-9199-6751a291deb6","type":"message","text":"compiler did the work before the function ran :julia-illuminati:","user":"UH24GRBLL","ts":"1613070231.421100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"65v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"compiler did the work before the function ran "},{"type":"emoji","name":"julia-illuminati"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"c377e889-ff7d-4055-a799-98053edce860","type":"message","text":"Ok, so clearly my mistake of that.","user":"UAGBT2X1A","ts":"1613070238.421300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Cf6p","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ok, so clearly my mistake of that."}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"42a09f82-3d2e-475e-a2de-b5964ba6fcfe","type":"message","text":"This example and the explanation of its result is in fact a decent demonstration of why tuples are indeed faster than arrays in many cases?","user":"UMZQBQU67","ts":"1613070295.421500","team":"T68168MUP","edited":{"user":"UMZQBQU67","ts":"1613070348.000000"},"blocks":[{"type":"rich_text","block_id":"lWj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This example and the explanation of its result is in fact a decent demonstration of why tuples are indeed faster than arrays in many cases?"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"c82fa92e-0d85-4689-a63f-74806f76875e","type":"message","text":"I need to write up my: Going fast nowhere that talks about these pitfalls","user":"U67BJLYCS","ts":"1613070301.421700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yngw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I need to write up my: Going fast nowhere that talks about these pitfalls"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A","reactions":[{"name":"sonic","users":["UDB26738Q"],"count":1}]},{"client_msg_id":"da6ebbdf-5999-441f-bbbd-a87935e1f4b5","type":"message","text":"But anyway, the point was, why the use of tuples is so much faster than the use of arrays? Not with that magnitude of 10-100 but still faster. Like what we have in StaticArrays etc.","user":"UAGBT2X1A","ts":"1613070339.421900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"N5G","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But anyway, the point was, why the use of tuples is so much faster than the use of arrays? Not with that magnitude of 10-100 but still faster. Like what we have in StaticArrays etc."}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"3c4426ff-1530-46cb-8f27-8832d9f6e3bd","type":"message","text":"because the size is known to the compiler","user":"UH24GRBLL","ts":"1613070357.422300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"psNl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"because the size is known to the compiler"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"d4d4f0ac-7130-43e5-9054-950b77252ba2","type":"message","text":"`StaticArray` _is_ a tuple","user":"UDB26738Q","ts":"1613070362.422500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"q+5rN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"StaticArray","style":{"code":true}},{"type":"text","text":" "},{"type":"text","text":"is","style":{"italic":true}},{"type":"text","text":" a tuple"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"3cda1aee-c7c2-4528-815f-711db927517c","type":"message","text":"&gt; 0.02ns is literally a few clock cycle\n\nI think it is a bit less than that.","user":"U67D54KS8","ts":"1613070391.422700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HVOH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"> 0.02ns is literally a few clock cycle\n\nI think it is a bit less than that."}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A","reactions":[{"name":"heavy_check_mark","users":["UH8A351DJ"],"count":1}]},{"client_msg_id":"6e019df5-c911-4c9f-96ee-397340eb8ef8","type":"message","text":"specifically, it's 1/10th of a clock cycle (assuming 5ghz)","user":"U0179G7FG4F","ts":"1613070475.423000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ItF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"specifically, it's 1/10th of a clock cycle (assuming 5ghz)"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"704bd485-642f-4662-bb8f-671e0d3e59e2","type":"message","text":"Well, Tensors.jl is also one example of a high-performance library, but why we cannot achieve the same performance with regular dynamically allocated arrays, if the allocation is done outside of the calling function, is basically the topic of my wondering.","user":"UAGBT2X1A","ts":"1613070488.423200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PF/4G","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well, Tensors.jl is also one example of a high-performance library, but why we cannot achieve the same performance with regular dynamically allocated arrays, if the allocation is done outside of the calling function, is basically the topic of my wondering."}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"51a081e1-e5c2-408e-b3e8-7ef66561f2e4","type":"message","text":"that has nothing to do with dynamic allocation. it’s constant propagation","user":"U6788D83U","ts":"1613070557.423400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7=BQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that has nothing to do with dynamic allocation. it’s constant propagation"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"4045c56b-1eb0-4b16-8599-321c5c978849","type":"message","text":"```julia&gt; goo() = (B = (1.0, 2.0, 3.0); dot3(B, B))\ngoo (generic function with 1 method)\n\njulia&gt; @code_typed debuginfo=:none goo()\nCodeInfo(\n1 ─     return 14.0\n) =&gt; Float64```","user":"U6788D83U","ts":"1613070626.423600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xhR","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> goo() = (B = (1.0, 2.0, 3.0); dot3(B, B))\ngoo (generic function with 1 method)\n\njulia> @code_typed debuginfo=:none goo()\nCodeInfo(\n1 ─     return 14.0\n) => Float64"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"},{"client_msg_id":"ec114d59-b04b-4a84-890d-42563c203601","type":"message","text":"The less than 0.02ns case is constant prop, the case where tuples are still a factor 2 faster is the known size for the compiler","user":"UH24GRBLL","ts":"1613070649.423800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1H+R","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The less than 0.02ns case is constant prop, the case where tuples are still a factor 2 faster is the known size for the compiler"}]}]}],"thread_ts":"1613070004.418000","parent_user_id":"UAGBT2X1A"}]