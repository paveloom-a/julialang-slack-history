[{"client_msg_id":"d513572e-159c-4034-905e-6bcbacf43d82","type":"message","text":"If `Threads.@threads` is called on a thread that is not the primary thread, it only uses the thread it is currently on rather than farming out to all of them. This seems to <https://github.com/JuliaLang/julia/blob/c487dd03c5401be0177051e91c844cc774ea3595/base/threadingconstructs.jl#L85|be by design>. I was curious what the reason for this was?","user":"U017FUJDBT7","ts":"1610323355.188200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7=IOM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If "},{"type":"text","text":"Threads.@threads","style":{"code":true}},{"type":"text","text":" is called on a thread that is not the primary thread, it only uses the thread it is currently on rather than farming out to all of them. This seems to "},{"type":"link","url":"https://github.com/JuliaLang/julia/blob/c487dd03c5401be0177051e91c844cc774ea3595/base/threadingconstructs.jl#L85","text":"be by design"},{"type":"text","text":". I was curious what the reason for this was?"}]}]}],"thread_ts":"1610323355.188200","reply_count":4,"reply_users_count":3,"latest_reply":"1610323937.189000","reply_users":["UH8A351DJ","U6A936746","U017FUJDBT7"],"subscribed":false},{"client_msg_id":"56de7159-0c70-4f04-bfe8-8b271bfa219c","type":"message","text":"if the function you're calling implicitly do threading, and a user calls that function in a thread-ed for loop, you don't want to over spawn","user":"UH8A351DJ","ts":"1610323579.188300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PDm+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if the function you're calling implicitly do threading, and a user calls that function in a thread-ed for loop, you don't want to over spawn"}]}]}],"thread_ts":"1610323355.188200","parent_user_id":"U017FUJDBT7"},{"client_msg_id":"0848540e-81e9-4b6e-a908-6971466d6e5d","type":"message","text":"At a guess:\n`@thread` is designed for highly balanced workloads.\nWhere as `@spawn` is not.\nSo if you are using `@threads`  on an outer layer, then you already know the inner layer is balanced.\nSo that means all your cores are occupied already; and will stay occupied until the same time.\n(Excluding cases like using `@threads` on collections that are smaller than your number of cores)","user":"U6A936746","ts":"1610323693.188500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"D1Ngb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"At a guess:\n"},{"type":"text","text":"@thread","style":{"code":true}},{"type":"text","text":" is designed for highly balanced workloads.\nWhere as "},{"type":"text","text":"@spawn","style":{"code":true}},{"type":"text","text":" is not.\nSo if you are using "},{"type":"text","text":"@threads","style":{"code":true}},{"type":"text","text":"  on an outer layer, then you already know the inner layer is balanced.\nSo that means all your cores are occupied already; and will stay occupied until the same time.\n(Excluding cases like using "},{"type":"text","text":"@threads","style":{"code":true}},{"type":"text","text":" on collections that are smaller than your number of cores)"}]}]}],"thread_ts":"1610323355.188200","parent_user_id":"U017FUJDBT7"},{"client_msg_id":"db80231c-db16-441b-b5f9-21a2bf30255e","type":"message","text":"If you want more spawning use `@spawn`  or something built on it like `ThreadX.map` etc (I think ThreadX does this, I haven’t checked TBH)","user":"U6A936746","ts":"1610323731.188700","team":"T68168MUP","edited":{"user":"U6A936746","ts":"1610323755.000000"},"blocks":[{"type":"rich_text","block_id":"jdJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you want more spawning use "},{"type":"text","text":"@spawn","style":{"code":true}},{"type":"text","text":"  or something built on it like "},{"type":"text","text":"ThreadX.map","style":{"code":true}},{"type":"text","text":" etc (I think ThreadX does this, I haven’t checked TBH)"}]}]}],"thread_ts":"1610323355.188200","parent_user_id":"U017FUJDBT7"},{"client_msg_id":"15c3ddd5-6656-438d-821d-e5a3ea992435","type":"message","text":"Thanks both, makes sense.\n\nMy semi-related use case was to have threads `2-nthreads()` being used with the primary thread being left. I'm using `ThreadPools` for this which works well.","user":"U017FUJDBT7","ts":"1610323937.189000","team":"T68168MUP","edited":{"user":"U017FUJDBT7","ts":"1610323961.000000"},"blocks":[{"type":"rich_text","block_id":"t5mt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks both, makes sense.\n\nMy semi-related use case was to have threads "},{"type":"text","text":"2-nthreads()","style":{"code":true}},{"type":"text","text":" being used with the primary thread being left. I'm using "},{"type":"text","text":"ThreadPools","style":{"code":true}},{"type":"text","text":" for this which works well."}]}]}],"thread_ts":"1610323355.188200","parent_user_id":"U017FUJDBT7","reactions":[{"name":"heavy_check_mark","users":["U6A936746"],"count":1}]}]