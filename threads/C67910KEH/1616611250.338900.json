[{"client_msg_id":"072b79c9-7752-487c-b6c3-3866bdcb491e","type":"message","text":"`rand(a)`","user":"U6QPTG69E","ts":"1616611250.338900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6sr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"rand(a)","style":{"code":true}}]}]}],"thread_ts":"1616611250.338900","reply_count":18,"reply_users_count":6,"latest_reply":"1616613356.347500","reply_users":["UDB26738Q","U680THK2S","U6QPTG69E","U0179G7FG4F","U7HAYKY9X","U011V2YN59N"],"is_locked":false,"subscribed":false,"reactions":[{"name":"mind_blown","users":["UDB26738Q","U0138UTB7A4","U0179G7FG4F","U881D0W2C","U6QGE7S86","U017D621ELC"],"count":6},{"name":"game_die","users":["UDB26738Q","U0138UTB7A4","U680THK2S","U6QGE7S86"],"count":4},{"name":"joy","users":["U0138UTB7A4","U680THK2S","U6A936746","U6QGE7S86","U6C937ENB","U01CQTKB86N"],"count":6}]},{"client_msg_id":"aa81c0db-f97f-4e97-9839-19556a856229","type":"message","text":"of course you had to suggest that :smile:","user":"UDB26738Q","ts":"1616611312.339200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iQVT6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"of course you had to suggest that "},{"type":"emoji","name":"smile"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E","reactions":[{"name":"sweat_smile","users":["U6QPTG69E"],"count":1}]},{"client_msg_id":"0bb123da-289b-49ea-a958-9c69684e7e25","type":"message","text":"```rand:\n  9.603 ns (0 allocations: 0 bytes)```\nbut it's the worst :disappointed:","user":"UDB26738Q","ts":"1616611412.340000","team":"T68168MUP","edited":{"user":"UDB26738Q","ts":"1616611470.000000"},"blocks":[{"type":"rich_text","block_id":"8Xq","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"rand:\n  9.603 ns (0 allocations: 0 bytes)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"but it's the worst "},{"type":"emoji","name":"disappointed"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E","reactions":[{"name":"weary","users":["U680THK2S","U6QPTG69E"],"count":2}]},{"client_msg_id":"1a86ab3c-6e6d-4dcb-954c-17cd1e90b70a","type":"message","text":"Seems like justification for adding `length(a) == 1 &amp;&amp; return only(a)` to the top of that method definition in Base","user":"U680THK2S","ts":"1616611537.340700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/rCWc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Seems like justification for adding "},{"type":"text","text":"length(a) == 1 && return only(a)","style":{"code":true}},{"type":"text","text":" to the top of that method definition in Base"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E"},{"client_msg_id":"fc0cf2de-98a4-4ee1-bd2a-c2677471423d","type":"message","text":"Maybe!","user":"U6QPTG69E","ts":"1616611636.340900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OHw9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe!"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E"},{"client_msg_id":"a952b7a5-d585-46b9-a2c3-33b1cf85ac18","type":"message","text":"the counter-point is if anyone's problem is bottlenecked by drawing a random element of a 1 element collection, they have already done something very wrong.","user":"U0179G7FG4F","ts":"1616611681.341100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pZPXQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the counter-point is if anyone's problem is bottlenecked by drawing a random element of a 1 element collection, they have already done something very wrong."}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E","reactions":[{"name":"point_up","users":["U7HAYKY9X","U6C937ENB","U7THT3TM3"],"count":3}]},{"client_msg_id":"7283940f-cb9a-4854-8559-0372bba29dbd","type":"message","text":"Is it wrong to want `rand(a)` to win in this benchmark competition","user":"U680THK2S","ts":"1616611717.341300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QHPM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is it wrong to want "},{"type":"text","text":"rand(a)","style":{"code":true}},{"type":"text","text":" to win in this benchmark competition"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E","reactions":[{"name":"correct_answer","users":["U7HAYKY9X","U6QGE7S86","U6C937ENB"],"count":3},{"name":"smile","users":["U6QPTG69E","U6A936746"],"count":2}]},{"client_msg_id":"00b394ff-57f6-4dc0-8e71-5e052cc1cec6","type":"message","text":"Though I'm a little disappointed that `rand((1,))` doesn't just pull out the element","user":"U7HAYKY9X","ts":"1616611797.341900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+rk2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Though I'm a little disappointed that "},{"type":"text","text":"rand((1,))","style":{"code":true}},{"type":"text","text":" doesn't just pull out the element"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E"},{"client_msg_id":"7e7509e1-bf7d-419f-bdcc-5073b11bee56","type":"message","text":"&gt; Though I'm a little disappointed that rand((1,)) doesn't just pull out the element\nWhy do you think so?","user":"U6QPTG69E","ts":"1616611828.342200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Rha","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"Though I'm a little disappointed that rand((1,)) doesn't just pull out the element"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Why do you think so?"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E"},{"client_msg_id":"3952eab0-e2b3-4ab3-9504-ececec21cc91","type":"message","text":"What takes time here is to fetch the global RNG","user":"U6QPTG69E","ts":"1616611848.342400","team":"T68168MUP","edited":{"user":"U6QPTG69E","ts":"1616611893.000000"},"blocks":[{"type":"rich_text","block_id":"=sAHN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What takes time here is to fetch the global RNG"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E"},{"client_msg_id":"e46e088b-f71c-4157-ad22-fc23671e8aa3","type":"message","text":"Right, what I meant was that `rand((1,))` could dispatch to a specialized function, since the result is known at compiletime (something like `rand(x::Tuple{Any}) = first(x)` ), but then again:\n• If you do know the length of your tuple beforehand, why are you drawing random elements from it?\n• If you don't, you're gonna have a bad time performance wise anyway","user":"U7HAYKY9X","ts":"1616611940.342900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Vmt5H","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Right, what I meant was that "},{"type":"text","text":"rand((1,))","style":{"code":true}},{"type":"text","text":" could dispatch to a specialized function, since the result is known at compiletime (something like "},{"type":"text","text":"rand(x::Tuple{Any}) = first(x)","style":{"code":true}},{"type":"text","text":" ), but then again:\n"}]},{"type":"rich_text_list","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you do know the length of your tuple beforehand, why are you drawing random elements from it?"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"If you don't, you're gonna have a bad time performance wise anyway"}]}],"style":"bullet","indent":0}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E"},{"client_msg_id":"ec3bd15e-c576-4f70-978d-d8fb35a8fbe0","type":"message","text":"```julia&gt; @btime rand($(Random.default_rng()), x) setup=(x=rand(1,1));\n  4.756 ns (0 allocations: 0 bytes)```","user":"UDB26738Q","ts":"1616611959.343100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CNsS","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime rand($(Random.default_rng()), x) setup=(x=rand(1,1));\n  4.756 ns (0 allocations: 0 bytes)"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E"},{"client_msg_id":"a27f44e5-f595-4ae6-9265-07d36c64558f","type":"message","text":"I believe `rand((1,))` does what you think it should do... Actually, `rand((x,))` is the \"idiomatic\" way to draw a random value from a \"distribution\" which can yield only one value, it's the fastest","user":"U6QPTG69E","ts":"1616612100.343300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GvfJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I believe "},{"type":"text","text":"rand((1,))","style":{"code":true}},{"type":"text","text":" does what you think it should do... Actually, "},{"type":"text","text":"rand((x,))","style":{"code":true}},{"type":"text","text":" is the \"idiomatic\" way to draw a random value from a \"distribution\" which can yield only one value, it's the fastest"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E"},{"client_msg_id":"79c4fefe-88f8-4724-9f63-fb5aaad6b14f","type":"message","text":"```julia&gt; @btime rand($(MersenneTwister()), $(Ref((1,)))[])\n  1.749 ns (0 allocations: 0 bytes)\n1```","user":"U6QPTG69E","ts":"1616612266.344000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oj0j","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime rand($(MersenneTwister()), $(Ref((1,)))[])\n  1.749 ns (0 allocations: 0 bytes)\n1"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E","reactions":[{"name":"party_wizard","users":["UDB26738Q","U680THK2S","U7THT3TM3"],"count":3}]},{"client_msg_id":"9a139a1f-bf00-4771-97a3-6cd0e930265a","type":"message","text":"IIRC, `rand` on tuples is specifically (statically) optimized upto size 4, beyond it uses the same mechanism as drawing from an array","user":"U6QPTG69E","ts":"1616612392.345100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Taw+=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"IIRC, "},{"type":"text","text":"rand","style":{"code":true}},{"type":"text","text":" on tuples is specifically (statically) optimized upto size 4, beyond it uses the same mechanism as drawing from an array"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E"},{"client_msg_id":"87a25f3c-91f8-4abe-a050-5a75ce307dc0","type":"message","text":"I have no idea what `$(Ref((1,)))[]` is supposed to do here.","user":"U011V2YN59N","ts":"1616612764.346200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"x=i8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have no idea what "},{"type":"text","text":"$(Ref((1,)))[]","style":{"code":true}},{"type":"text","text":" is supposed to do here."}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E"},{"client_msg_id":"4c09a817-7385-4b24-a5d4-2e0ddf7f5ada","type":"message","text":"it prevents constant propagation","user":"UDB26738Q","ts":"1616612892.346400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ywG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it prevents constant propagation"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E","reactions":[{"name":"+1","users":["U011V2YN59N"],"count":1}]},{"client_msg_id":"ac641092-623b-431e-98bd-97f841d567c9","type":"message","text":"Ah. So why does it need to access the RNG?","user":"U7HAYKY9X","ts":"1616613294.347300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"59kkn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah. So why does it need to access the RNG?"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E"},{"client_msg_id":"1a30af56-5f29-4771-9aba-2f27d34c305a","type":"message","text":"It doesn't touch the RNG, but the general mechanism for `rand(x)` is to call `rand(default_rng(), x)`. I guess this could be special cased for length-1 tuples, but no-one cared till now","user":"U6QPTG69E","ts":"1616613356.347500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fQ+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It doesn't touch the RNG, but the general mechanism for "},{"type":"text","text":"rand(x)","style":{"code":true}},{"type":"text","text":" is to call "},{"type":"text","text":"rand(default_rng(), x)","style":{"code":true}},{"type":"text","text":". I guess this could be special cased for length-1 tuples, but no-one cared till now"}]}]}],"thread_ts":"1616611250.338900","parent_user_id":"U6QPTG69E","reactions":[{"name":"+1","users":["U7HAYKY9X","U680THK2S"],"count":2}]}]