[{"client_msg_id":"d6fa54cc-b292-4de9-87d7-dd586347cbb5","type":"message","text":"Well this is fun. NamedDims.jl + ComponentArrays.jl is a really nice combination, it turns out.\n\n```using ComponentArrays: ComponentArray\nusing ForwardDiff: jacobian!\nusing NamedDims: NamedDimsArray\nusing UnPack: @unpack\n\nbody = ComponentArray(pos=(x=1.0, y=2, z=3), vel=(x=4, y=5, z=7))\nD_body = zero(body)\nJ = NamedDimsArray{(:func, :var)}(0 * body * body')\n\nfunction elastic_pendulum!(D, vars)\n    @unpack pos, vel = vars\n    ω² = 3\n    L = 2\n    g = 10\n\n    r = sqrt(sum(pos.^2))\n\n    D.pos .= vel\n    D.vel .= -ω² * (r - L)/r * pos\n    D.vel.z -= g\nend\n\njacobian!(J, elastic_pendulum!, D_body, body)```\n```julia&gt; J[func=:vel, var=:pos]\n3×3 NamedDimsArray{(:func, :var),Float64,2,ComponentMatrix{Float64,SubArray...}}:\n -1.51097   -0.229081  -0.343622\n -0.229081  -1.85459   -0.687243\n -0.343622  -0.687243  -2.4273\n\njulia&gt; J[func=:vel, var=:pos][func=:x, var=:y]\n-0.22908106449636378\n\njulia&gt; J[func=:pos, var=:vel][func=:x, var=:x]\n1.0```","user":"US4A6G6B0","ts":"1608329515.180800","team":"T68168MUP","edited":{"user":"US4A6G6B0","ts":"1608329641.000000"},"blocks":[{"type":"rich_text","block_id":"S1Uu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well this is fun. NamedDims.jl + ComponentArrays.jl is a really nice combination, it turns out.\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using ComponentArrays: ComponentArray\nusing ForwardDiff: jacobian!\nusing NamedDims: NamedDimsArray\nusing UnPack: @unpack\n\nbody = ComponentArray(pos=(x=1.0, y=2, z=3), vel=(x=4, y=5, z=7))\nD_body = zero(body)\nJ = NamedDimsArray{(:func, :var)}(0 * body * body')\n\nfunction elastic_pendulum!(D, vars)\n    @unpack pos, vel = vars\n    ω² = 3\n    L = 2\n    g = 10\n\n    r = sqrt(sum(pos.^2))\n\n    D.pos .= vel\n    D.vel .= -ω² * (r - L)/r * pos\n    D.vel.z -= g\nend\n\njacobian!(J, elastic_pendulum!, D_body, body)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> J[func=:vel, var=:pos]\n3×3 NamedDimsArray{(:func, :var),Float64,2,ComponentMatrix{Float64,SubArray...}}:\n -1.51097   -0.229081  -0.343622\n -0.229081  -1.85459   -0.687243\n -0.343622  -0.687243  -2.4273\n\njulia> J[func=:vel, var=:pos][func=:x, var=:y]\n-0.22908106449636378\n\njulia> J[func=:pos, var=:vel][func=:x, var=:x]\n1.0"}]}]}],"thread_ts":"1608329515.180800","reply_count":2,"reply_users_count":2,"latest_reply":"1608330653.181400","reply_users":["US4A6G6B0","U6A936746"],"subscribed":false},{"client_msg_id":"919c489f-5648-4d7b-a3d5-8aecf29f5bd6","type":"message","text":"Although if you want performance, you'll probably want to do `J[func=Val(:vel), var=Val(:pos)]` because of the constant folding issues with named indexing ComponentArrays (`getproperty` access is fast, but `getindex` is slow without the `Val`s)","user":"US4A6G6B0","ts":"1608330233.181100","team":"T68168MUP","edited":{"user":"US4A6G6B0","ts":"1608330313.000000"},"blocks":[{"type":"rich_text","block_id":"sXisK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Although if you want performance, you'll probably want to do "},{"type":"text","text":"J[func=Val(:vel), var=Val(:pos)]","style":{"code":true}},{"type":"text","text":" because of the constant folding issues with named indexing ComponentArrays ("},{"type":"text","text":"getproperty","style":{"code":true}},{"type":"text","text":" access is fast, but "},{"type":"text","text":"getindex","style":{"code":true}},{"type":"text","text":" is slow without the "},{"type":"text","text":"Val","style":{"code":true}},{"type":"text","text":"s)"}]}]}],"thread_ts":"1608329515.180800","parent_user_id":"US4A6G6B0"},{"client_msg_id":"831e6240-b8bc-4f46-87f3-f9b693fc14c5","type":"message","text":"Yessss.\nLiving the dream. Look at all these independent parts working together.","user":"U6A936746","ts":"1608330653.181400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9svH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yessss.\nLiving the dream. Look at all these independent parts working together."}]}]}],"thread_ts":"1608329515.180800","parent_user_id":"US4A6G6B0","reactions":[{"name":"juliaclockwork","users":["US4A6G6B0","UB197FRCL","UKLKS1WC8","U7THT3TM3"],"count":4}]}]