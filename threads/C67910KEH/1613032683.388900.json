[{"client_msg_id":"3a08f9c0-a4e3-4257-8e06-92269465f4fe","type":"message","text":"Does anyone know why this is allocating?\n```function K(X, σ_squ, res=nothing)\n    (d, n) = size(X)\n    \n    if isnothing(res)\n        res = uninitialized(n, n)\n    end\n\n    res .= exp.(-pairwise(SqEuclidean(), X, X, dims=2)/(2*σ_squ))\nend```\nRunning\n```n = 100\nd = 50\n\nxs = rand(Float, d, n)\nres = uninitialized(n, n)\n@btime K(xs, 2, res)```\ngives me `134.033 μs (8 allocations: 118.39 KiB)`\nThe following is also allocating:\n```function test(a, b, c)\n    c .= a * b\nend\n\n@btime test(a,b,c)  #  2.469 ms (2 allocations: 1.91 MiB)```\n","user":"U7PD3M3L5","ts":"1613032683.388900","team":"T68168MUP","edited":{"user":"U7PD3M3L5","ts":"1613033538.000000"},"blocks":[{"type":"rich_text","block_id":"BYB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Does anyone know why this is allocating?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function K(X, σ_squ, res=nothing)\n    (d, n) = size(X)\n    \n    if isnothing(res)\n        res = uninitialized(n, n)\n    end\n\n    res .= exp.(-pairwise(SqEuclidean(), X, X, dims=2)/(2*σ_squ))\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Running\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"n = 100\nd = 50\n\nxs = rand(Float, d, n)\nres = uninitialized(n, n)\n@btime K(xs, 2, res)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"gives me "},{"type":"text","text":"134.033 μs (8 allocations: 118.39 KiB)","style":{"code":true}},{"type":"text","text":"\nThe following is also allocating:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function test(a, b, c)\n    c .= a * b\nend\n\n@btime test(a,b,c)  #  2.469 ms (2 allocations: 1.91 MiB)"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1613032683.388900","reply_count":4,"reply_users_count":2,"latest_reply":"1613034839.390100","reply_users":["U7HAYKY9X","UH24GRBLL"],"subscribed":false},{"client_msg_id":"00db7421-1d10-4887-8de1-a23f2f617734","type":"message","text":"In your test, what is a and b?","user":"U7HAYKY9X","ts":"1613034366.389100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1bR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"In your test, what is a and b?"}]}]}],"thread_ts":"1613032683.388900","parent_user_id":"U7PD3M3L5"},{"client_msg_id":"345b882c-d5cf-4f7d-adf2-247cade06259","type":"message","text":"if `a` and `b` are matrices, it allocates the result before copying it to `c`. you probably want three argument `mul!` instead","user":"UH24GRBLL","ts":"1613034662.389700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"loS1l","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if "},{"type":"text","text":"a","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"b","style":{"code":true}},{"type":"text","text":" are matrices, it allocates the result before copying it to "},{"type":"text","text":"c","style":{"code":true}},{"type":"text","text":". you probably want three argument "},{"type":"text","text":"mul!","style":{"code":true}},{"type":"text","text":" instead"}]}]}],"thread_ts":"1613032683.388900","parent_user_id":"U7PD3M3L5"},{"client_msg_id":"f08db4de-af6c-410d-9d88-e08f7aeb5360","type":"message","text":"you probably want to interpolate `xs` and `res` into the measurement like `@btime K($xs, 2, $res)`","user":"UH24GRBLL","ts":"1613034778.389900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HVfS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you probably want to interpolate "},{"type":"text","text":"xs","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"res","style":{"code":true}},{"type":"text","text":" into the measurement like "},{"type":"text","text":"@btime K($xs, 2, $res)","style":{"code":true}}]}]}],"thread_ts":"1613032683.388900","parent_user_id":"U7PD3M3L5"},{"client_msg_id":"e2c19997-bedc-41b3-bf97-4e276ecd94fa","type":"message","text":"where does `pairwise` and `uninitialized` come from?","user":"UH24GRBLL","ts":"1613034839.390100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hIdv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"where does "},{"type":"text","text":"pairwise","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"uninitialized","style":{"code":true}},{"type":"text","text":" come from?"}]}]}],"thread_ts":"1613032683.388900","parent_user_id":"U7PD3M3L5"}]