[{"type":"message","text":"<https://discourse.julialang.org/t/ann-loopvectorization/32843/159> suggested it might?","user":"U9MD78Z9N","ts":"1609941180.426600","team":"T68168MUP","edited":{"user":"U9MD78Z9N","ts":"1609945018.000000"},"attachments":[{"service_name":"JuliaLang","title":"[ANN] LoopVectorization","title_link":"https://discourse.julialang.org/t/ann-loopvectorization/32843/159","text":"Also meaning if you want the fix, it should be just a bisect away. I’ve honestly not seen that one before and it should certainly be reported. I have seen quite a few cases where it does a better job for the empty case/loop entry better then what I can easily come up with… As early as possible is always good. It’s very easy to pick up, at least the LLVM IR part. Machine IR is probably not harder though it is somewhat harder to dump and look at IMHO… And back to the point of wasted effort...","fallback":"JuliaLang: [ANN] LoopVectorization","thumb_url":"https://aws1.discourse-cdn.com/business5/uploads/julialang/original/2X/c/c99400a778aa00251029c81a8e0fb3e16beac742.png","ts":1590582909,"from_url":"https://discourse.julialang.org/t/ann-loopvectorization/32843/159","thumb_width":889,"thumb_height":527,"service_icon":"https://aws1.discourse-cdn.com/business5/uploads/julialang/optimized/2X/6/6ca888e296f59ca2a599807f7d5edd489e3d1829_2_180x180.png","id":1,"original_url":"https://discourse.julialang.org/t/ann-loopvectorization/32843/159"}],"thread_ts":"1609941180.426600","reply_count":16,"reply_users_count":5,"latest_reply":"1609945378.435500","reply_users":["UDB26738Q","U9MD78Z9N","U7THT3TM3","USU9FRPEU","UAUPJLBQX"],"subscribed":false},{"client_msg_id":"d867e40b-eb9d-484e-b66c-28a4edc7256b","type":"message","text":"I've reread this message a couple of times and I didn't see any suggestion about that","user":"UDB26738Q","ts":"1609942278.427700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vm6kP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I've reread this message a couple of times and I didn't see any suggestion about that"}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N","reactions":[{"name":"+1","users":["USU9FRPEU"],"count":1}]},{"type":"message","text":"\"If Julia 1.6 is to be the next LTS, it would be worth it for me to get it in there.\n\nAs early as possible is always good.\"","user":"U9MD78Z9N","ts":"1609945047.428900","team":"T68168MUP","edited":{"user":"U9MD78Z9N","ts":"1609945062.000000"},"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"5E2E0371-BB26-4001-94D6-567A346831F8","type":"message","text":"I think that refers specifically to an LLVM patch","user":"U7THT3TM3","ts":"1609945064.429600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NHjfC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think that refers specifically to an LLVM patch"}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N","reactions":[{"name":"heavy_check_mark","users":["UAUPJLBQX"],"count":1}]},{"type":"message","text":"Ohh","user":"U9MD78Z9N","ts":"1609945080.430300","team":"T68168MUP","thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"90B19A89-8B06-4641-B2C2-771DCD221F47","type":"message","text":"A patch that Chris made to LLVM upstream","user":"U7THT3TM3","ts":"1609945091.430700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"h9uGz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"A patch that Chris made to LLVM upstream"}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"db03e77c-b197-40e7-a60c-d21865b331f3","type":"message","text":"```I'd still have to carry the code managing asm call until I drop support for Julia versions that don't carry that patch.\nBut asm call is definitely a hack that it would be better to be rid of.\nI have a fair bit of logic deciding whether or not to use a the asm version. On AVX512, LLVM can optimize the @llvm.muladd version by combining it with select statements or with loads/broadcasts.\nSo I have to check if it seems likely LLVM may want to do that, to avoid missing those opportunities.\n\nI'll have to look at other PRs adding LLVM patches to Julia to see what it'd take.\n\nIf Julia 1.6 is to be the next LTS, it would be worth it for me to get it in there.```\n","user":"USU9FRPEU","ts":"1609945111.431100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"T=ZP8","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"I'd still have to carry the code managing asm call until I drop support for Julia versions that don't carry that patch.\nBut asm call is definitely a hack that it would be better to be rid of.\nI have a fair bit of logic deciding whether or not to use a the asm version. On AVX512, LLVM can optimize the @llvm.muladd version by combining it with select statements or with loads/broadcasts.\nSo I have to check if it seems likely LLVM may want to do that, to avoid missing those opportunities.\n\nI'll have to look at other PRs adding LLVM patches to Julia to see what it'd take.\n\nIf Julia 1.6 is to be the next LTS, it would be worth it for me to get it in there."}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"206bae42-69c6-46df-90ed-f14ef3bde715","type":"message","text":"Quote with context from <@UAUPJLBQX>","user":"USU9FRPEU","ts":"1609945126.431600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=t6N","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Quote with context from "},{"type":"user","user_id":"UAUPJLBQX"}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"B6F2A1AC-FE3D-4C93-8C90-34F5E602ECEC","type":"message","text":"Eventually, all patches made to LLVM upstream will get into Julia, whenever we upgrade LLVM","user":"U7THT3TM3","ts":"1609945133.432000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kj/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Eventually, all patches made to LLVM upstream will get into Julia, whenever we upgrade LLVM"}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"7A975FBD-E09E-426D-B7E9-9930C63E09D9","type":"message","text":"Sometimes people will also make PRs to put those LLVM patches into Julia directly so that we can have them sooner","user":"U7THT3TM3","ts":"1609945148.432600","team":"T68168MUP","edited":{"user":"U7THT3TM3","ts":"1609945184.000000"},"blocks":[{"type":"rich_text","block_id":"=yOV=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Sometimes people will also make PRs to put those LLVM patches into Julia directly so that we can have them sooner"}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"1CE21455-97BE-4A47-A0C3-8038D2D881FF","type":"message","text":"But if that doesn't happen, we'll get it eventually, if it is merged into LLVM upstream","user":"U7THT3TM3","ts":"1609945164.433300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KDZm0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But if that doesn't happen, we'll get it eventually, if it is merged into LLVM upstream"}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"2d33d04e-cd89-4e40-a57c-935f3341cc58","type":"message","text":"I didn't make the patch","user":"UAUPJLBQX","ts":"1609945192.433600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0QNl9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I didn't make the patch"}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"3bc0823b-681d-4264-9dd3-2336ccf00760","type":"message","text":"But yes, the patch I was interested in did make it into Julia 1.6.","user":"UAUPJLBQX","ts":"1609945206.433900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kOE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But yes, the patch I was interested in did make it into Julia 1.6."}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N","reactions":[{"name":"+1","users":["U7THT3TM3"],"count":1}]},{"client_msg_id":"51FFAE0C-DFD2-4868-BA48-157933F1FCA6","type":"message","text":"Ah, my mistake; a patch made by someone to LLVM upstream ","user":"U7THT3TM3","ts":"1609945221.434500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"i7W","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah, my mistake; a patch made by someone to LLVM upstream "}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"E0EB9857-32AA-47A2-977E-F8C31DB24D20","type":"message","text":"That's good news","user":"U7THT3TM3","ts":"1609945237.434900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ydL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That's good news"}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"4ffdaa79-cc12-4969-8d7d-7ce8b3388e21","type":"message","text":"Yes, LoopVectorization no longer needs to use asm call to select vf(n)m(add/sub)231 with LLVM &gt;=11.","user":"UAUPJLBQX","ts":"1609945319.435100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GFJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, LoopVectorization no longer needs to use asm call to select vf(n)m(add/sub)231 with LLVM >=11."}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N","reactions":[{"name":"tada","users":["U7THT3TM3","USU9FRPEU"],"count":2}]},{"client_msg_id":"e68ef6b8-21fa-42ad-a492-42d4853b7d9d","type":"message","text":"That simplifies the code, because there was some logic deciding when it was/wasn't worth using asm call (asm call prevents other optimizations, so it had to consider when those other optimizations would be possible).","user":"UAUPJLBQX","ts":"1609945378.435500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"27T","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That simplifies the code, because there was some logic deciding when it was/wasn't worth using asm call (asm call prevents other optimizations, so it had to consider when those other optimizations would be possible)."}]}]}],"thread_ts":"1609941180.426600","parent_user_id":"U9MD78Z9N","reactions":[{"name":"+1","users":["U7THT3TM3","USU9FRPEU","U9MED583T"],"count":3}]}]