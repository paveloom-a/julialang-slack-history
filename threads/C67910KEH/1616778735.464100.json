[{"client_msg_id":"1eb09ee5-95f3-4ebc-80ac-8b9068050afc","type":"message","text":"If I were to inject a shared library into a process, and start Julia REPL from there using `jl_load_repl` exported from libjulia, would the started Julia REPL share the same memory space as the process?","user":"U010ZKG6T60","ts":"1616778735.464100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DUwu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If I were to inject a shared library into a process, and start Julia REPL from there using "},{"type":"text","text":"jl_load_repl","style":{"code":true}},{"type":"text","text":" exported from libjulia, would the started Julia REPL share the same memory space as the process?"}]}]}],"thread_ts":"1616778735.464100","reply_count":13,"reply_users_count":2,"latest_reply":"1616788209.469300","reply_users":["USU9FRPEU","U010ZKG6T60"],"is_locked":false,"subscribed":false},{"client_msg_id":"fcdd45cc-1504-4b97-83bb-598e5357a971","type":"message","text":"You would probably need to do <https://docs.julialang.org/en/v1/manual/embedding/>","user":"USU9FRPEU","ts":"1616785290.466500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"E=HS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You would probably need to do "},{"type":"link","url":"https://docs.julialang.org/en/v1/manual/embedding/"}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"},{"client_msg_id":"3d61f5c2-b916-4bd9-9b9a-49875755a0c7","type":"message","text":"Why don't you just load the shared library into Julia using `Libdl` ?","user":"USU9FRPEU","ts":"1616785308.466700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UPV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Why don't you just load the shared library into Julia using "},{"type":"text","text":"Libdl","style":{"code":true}},{"type":"text","text":" ?"}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"},{"client_msg_id":"2dc77177-152c-4125-884a-2eaf39c4a01a","type":"message","text":"I am trying to start a Julia REPL in another process's memory so I can access its memory without any overhead.","user":"U010ZKG6T60","ts":"1616786365.466900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"G+dS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I am trying to start a Julia REPL in another process's memory so I can access its memory without any overhead."}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"},{"client_msg_id":"aca8e66d-e8f7-49da-b762-a18c47b5e815","type":"message","text":"I am trying an approach right now, will update on it soon.","user":"U010ZKG6T60","ts":"1616786380.467100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QwP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I am trying an approach right now, will update on it soon."}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"},{"client_msg_id":"8984dd5b-9af4-4938-9001-3b891745f75c","type":"message","text":"I would definitely look at the embedding docs then.","user":"USU9FRPEU","ts":"1616786651.467300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ypt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I would definitely look at the embedding docs then."}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"},{"client_msg_id":"e83114f1-c5c7-416c-9f7b-94ecca9b9a85","type":"message","text":"In particular, note that `jl_init` is defined `jl_init__threading`  in julia.h\n<https://github.com/JuliaLang/julia/blob/master/src/julia.h#L1644>","user":"USU9FRPEU","ts":"1616786719.467500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BkpbG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"In particular, note that "},{"type":"text","text":"jl_init","style":{"code":true}},{"type":"text","text":" is defined "},{"type":"text","text":"jl_init__threading","style":{"code":true}},{"type":"text","text":"  in julia.h\n"},{"type":"link","url":"https://github.com/JuliaLang/julia/blob/master/src/julia.h#L1644"}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"},{"client_msg_id":"716975bd-bb8b-49c0-97f6-97ad239763c0","type":"message","text":"```#include &lt;Windows.h&gt;\n#include &lt;stdio.h&gt;\n\nconst char *JULIA_BINDIR = \"C:\\\\julia\\\\bin\";\nconst char *SHARED_LIB_EXT = \"dll\";\n\nvoid entry()\n{\n    AllocConsole();\n    \n    char format_buffer[64];\n\n    sprintf_s(format_buffer, 64, \"JULIA_BINDIR=%s\", JULIA_BINDIR);\n    _putenv(format_buffer);\n\n    sprintf_s(format_buffer, 64, \"%s\\\\libjulia.%s\", JULIA_BINDIR, SHARED_LIB_EXT);\n    HANDLE libjulia = LoadLibraryA(format_buffer);\n\n    int (*jl_load_repl)(int argc, char *argv[]) = GetProcAddress(libjulia, \"jl_load_repl\");\n\n    char *argb_buffer[] = {NULL};\n    jl_load_repl(0, argb_buffer);\n}\n\nBOOL WINAPI DllMain(\n    HINSTANCE hinstDLL,\n    DWORD fdwReason,\n    LPVOID lpReserved)\n{\n    if (fdwReason == DLL_PROCESS_ATTACH)\n    {\n        CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)entry, NULL, NULL, NULL);\n    }\n\n    return TRUE;\n}```\ncompiling that as a shared library and injecting it into another process starts the REPL, now I only need to verify that it's in the same memory space and not a child process(hopefully, though eyeballing the code for jl_load_repl seems to shows it's not a separate process).","user":"U010ZKG6T60","ts":"1616786932.467700","team":"T68168MUP","edited":{"user":"U010ZKG6T60","ts":"1616787002.000000"},"blocks":[{"type":"rich_text","block_id":"5s=h","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"#include <Windows.h>\n#include <stdio.h>\n\nconst char *JULIA_BINDIR = \"C:\\\\julia\\\\bin\";\nconst char *SHARED_LIB_EXT = \"dll\";\n\nvoid entry()\n{\n    AllocConsole();\n    \n    char format_buffer[64];\n\n    sprintf_s(format_buffer, 64, \"JULIA_BINDIR=%s\", JULIA_BINDIR);\n    _putenv(format_buffer);\n\n    sprintf_s(format_buffer, 64, \"%s\\\\libjulia.%s\", JULIA_BINDIR, SHARED_LIB_EXT);\n    HANDLE libjulia = LoadLibraryA(format_buffer);\n\n    int (*jl_load_repl)(int argc, char *argv[]) = GetProcAddress(libjulia, \"jl_load_repl\");\n\n    char *argb_buffer[] = {NULL};\n    jl_load_repl(0, argb_buffer);\n}\n\nBOOL WINAPI DllMain(\n    HINSTANCE hinstDLL,\n    DWORD fdwReason,\n    LPVOID lpReserved)\n{\n    if (fdwReason == DLL_PROCESS_ATTACH)\n    {\n        CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)entry, NULL, NULL, NULL);\n    }\n\n    return TRUE;\n}"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"compiling that as a shared library and injecting it into another process starts the REPL, now I only need to verify that it's in the same memory space and not a child process(hopefully, though eyeballing the code for jl_load_repl seems to shows it's not a separate process)."}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"},{"type":"message","text":"","files":[{"id":"F01SL75PJQ3","created":1616787509,"timestamp":1616787509,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"U010ZKG6T60","editable":false,"size":2009,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01SL75PJQ3/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01SL75PJQ3/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01SL75PJQ3-d32344285f/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01SL75PJQ3-d32344285f/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01SL75PJQ3-d32344285f/image_360.png","thumb_360_w":360,"thumb_360_h":19,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01SL75PJQ3-d32344285f/image_160.png","original_w":388,"original_h":20,"thumb_tiny":"AwACADCzk560uTtHPrSd6P4V/GkApJyee9GT60HqfrSUwGSE569qIid6896JOv4UQ/6xfrQB/9k=","permalink":"https://julialang.slack.com/files/U010ZKG6T60/F01SL75PJQ3/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01SL75PJQ3-e3e043eadf","is_starred":false,"has_rich_preview":false},{"id":"F01SGU10ASZ","created":1616787519,"timestamp":1616787519,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"U010ZKG6T60","editable":false,"size":9503,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01SGU10ASZ/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01SGU10ASZ/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01SGU10ASZ-309260ab02/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01SGU10ASZ-309260ab02/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01SGU10ASZ-309260ab02/image_360.png","thumb_360_w":360,"thumb_360_h":123,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01SGU10ASZ-309260ab02/image_160.png","original_w":370,"original_h":126,"thumb_tiny":"AwAQADChxn7ppT6lTRhf9n86btHqKADK+lGV/un86cFHcg/jRhfb86AGUlOyP7o/OkoA/9k=","permalink":"https://julialang.slack.com/files/U010ZKG6T60/F01SGU10ASZ/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01SGU10ASZ-9e6ef329ab","is_starred":false,"has_rich_preview":false}],"upload":false,"user":"U010ZKG6T60","ts":"1616787524.468200","thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"},{"client_msg_id":"f7f3150d-c0c5-4a34-8dcc-81232091b5d7","type":"message","text":"Okay, that was surprisingly easy xD.","user":"U010ZKG6T60","ts":"1616787538.468400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ZWnf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Okay, that was surprisingly easy xD."}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"},{"client_msg_id":"11fb44d3-c029-4bb6-bc5b-bc235157ebc0","type":"message","text":"cool I guess","user":"U010ZKG6T60","ts":"1616787541.468600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0A00","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"cool I guess"}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60","reactions":[{"name":"+1","users":["USU9FRPEU"],"count":1}]},{"client_msg_id":"00b446e4-7db7-4d5d-a24c-58fac905b1a3","type":"message","text":"Can you `unsafe_load` from that pointer?","user":"USU9FRPEU","ts":"1616788005.468900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wkDc/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Can you "},{"type":"text","text":"unsafe_load","style":{"code":true}},{"type":"text","text":" from that pointer?"}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"},{"client_msg_id":"b9b3f400-1761-4081-945f-cd5b20fe566d","type":"message","text":"Sure why not, I don't see a reason it'd fail but I'll try it.","user":"U010ZKG6T60","ts":"1616788180.469100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"l17","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Sure why not, I don't see a reason it'd fail but I'll try it."}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"},{"client_msg_id":"e16eed2f-bcea-4c71-baf1-83b7ffb467bb","type":"message","text":"```julia&gt; unsafe_load(Ptr{Int}(0x000002b679d5f580))                                                                        123999123      ```","user":"U010ZKG6T60","ts":"1616788209.469300","team":"T68168MUP","edited":{"user":"U010ZKG6T60","ts":"1616788222.000000"},"blocks":[{"type":"rich_text","block_id":"=1JQ9","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> unsafe_load(Ptr{Int}(0x000002b679d5f580))                                                                        123999123      "}]}]}],"thread_ts":"1616778735.464100","parent_user_id":"U010ZKG6T60"}]