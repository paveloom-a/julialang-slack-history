[{"client_msg_id":"1e43e8bf-5ad1-460f-aab4-a1c4d8c61fcc","type":"message","text":"Hello, is there a way to speed up this loop? thanks.\n\n`var1=rand(1000,1000);`\n`var2=rand(1000,1);`\n`for t in 1:100000`\n`var3=var1*var2;`\n`end`","user":"U01QST11309","ts":"1615042696.144800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Vp5J","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hello, is there a way to speed up this loop? thanks.\n\n"},{"type":"text","text":"var1=rand(1000,1000);","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"var2=rand(1000,1);","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"for t in 1:100000","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"var3=var1*var2;","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"end","style":{"code":true}}]}]}],"thread_ts":"1615042696.144800","reply_count":9,"reply_users_count":5,"latest_reply":"1615130702.176900","reply_users":["UDB26738Q","U011V2YN59N","UD0NS8PDF","U01QST11309","UH24GRBLL"],"subscribed":false},{"client_msg_id":"a071e55c-b359-4e77-83ad-40f26244814b","type":"message","text":"you can reduce allocations by pre-allocating `var3`:\n```julia&gt; using LinearAlgebra, BenchmarkTools\n\njulia&gt; @btime var1 * var2 setup = (var1 = rand(1000, 1000); var2 = rand(1000, 1));\n  343.889 μs (1 allocation: 7.94 KiB)\n\njulia&gt; @btime mul!(var3, var1, var2) setup = (var1 = rand(1000, 1000); var2 = rand(1000, 1); var3 = Matrix{Float64}(undef, 1000, 1));\n  344.379 μs (0 allocations: 0 bytes)```\nbut if `var1` and `var2` are matrices of `Float64` there isn't in principle too much you can do, multiplication is done by a BLAS library","user":"UDB26738Q","ts":"1615043844.145100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"AYxt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can reduce allocations by pre-allocating "},{"type":"text","text":"var3","style":{"code":true}},{"type":"text","text":":\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> using LinearAlgebra, BenchmarkTools\n\njulia> @btime var1 * var2 setup = (var1 = rand(1000, 1000); var2 = rand(1000, 1));\n  343.889 μs (1 allocation: 7.94 KiB)\n\njulia> @btime mul!(var3, var1, var2) setup = (var1 = rand(1000, 1000); var2 = rand(1000, 1); var3 = Matrix{Float64}(undef, 1000, 1));\n  344.379 μs (0 allocations: 0 bytes)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"but if "},{"type":"text","text":"var1","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"var2","style":{"code":true}},{"type":"text","text":" are matrices of "},{"type":"text","text":"Float64","style":{"code":true}},{"type":"text","text":" there isn't in principle too much you can do, multiplication is done by a BLAS library"}]}]}],"thread_ts":"1615042696.144800","parent_user_id":"U01QST11309"},{"client_msg_id":"b9e7f88d-604f-41d5-85aa-a30672dc9fe7","type":"message","text":"you can try with a different BLAS library (MKL if you have an Intel CPU), or play with the number of threads of OpenBLAS.  there are some Julia libraries which offer BLAS functionalities, but usually performance is in the same ballpark (don't expect orders of magnitudes of difference)","user":"UDB26738Q","ts":"1615043911.145300","team":"T68168MUP","edited":{"user":"UDB26738Q","ts":"1615043928.000000"},"blocks":[{"type":"rich_text","block_id":"acwy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can try with a different BLAS library (MKL if you have an Intel CPU), or play with the number of threads of OpenBLAS.  there are some Julia libraries which offer BLAS functionalities, but usually performance is in the same ballpark (don't expect orders of magnitudes of difference)"}]}]}],"thread_ts":"1615042696.144800","parent_user_id":"U01QST11309"},{"client_msg_id":"eadfe1a6-be6e-4627-89f0-10f6290be571","type":"message","text":"huh TIL that `btime` has a `setup` keyword","user":"U011V2YN59N","ts":"1615044029.146700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ja1aT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"huh TIL that "},{"type":"text","text":"btime","style":{"code":true}},{"type":"text","text":" has a "},{"type":"text","text":"setup","style":{"code":true}},{"type":"text","text":" keyword"}]}]}],"thread_ts":"1615042696.144800","parent_user_id":"U01QST11309"},{"client_msg_id":"757433B6-814C-425F-AA3C-B0E56835C041","type":"message","text":"`var2 = rand(1000)` may help too, a true vector not a matrix (but I didn’t check)","user":"UD0NS8PDF","ts":"1615044052.147300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MWCVZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"var2 = rand(1000)","style":{"code":true}},{"type":"text","text":" may help too, a true vector not a matrix (but I didn’t check)"}]}]}],"thread_ts":"1615042696.144800","parent_user_id":"U01QST11309"},{"client_msg_id":"b9d8a586-bf7f-4543-b3f4-1ecab8bbba2c","type":"message","text":"```julia&gt; @btime var1 * var2 setup = (var1 = rand(1000, 1000); var2 = rand(1000));\n  173.374 μs (1 allocation: 7.94 KiB)\n\njulia&gt; @btime mul!(var3, var1, var2) setup = (var1 = rand(1000, 1000); var2 = rand(1000); var3 = Vector{Float64}(undef, 1000));\n  177.348 μs (0 allocations: 0 bytes)```\nseems to give a 2x speedup","user":"UDB26738Q","ts":"1615044130.147500","team":"T68168MUP","edited":{"user":"UDB26738Q","ts":"1615044166.000000"},"blocks":[{"type":"rich_text","block_id":"vb6v2","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime var1 * var2 setup = (var1 = rand(1000, 1000); var2 = rand(1000));\n  173.374 μs (1 allocation: 7.94 KiB)\n\njulia> @btime mul!(var3, var1, var2) setup = (var1 = rand(1000, 1000); var2 = rand(1000); var3 = Vector{Float64}(undef, 1000));\n  177.348 μs (0 allocations: 0 bytes)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"seems to give a 2x speedup"}]}]}],"thread_ts":"1615042696.144800","parent_user_id":"U01QST11309"},{"client_msg_id":"445b7a92-1764-4d18-a4ac-03b4bcb40f06","type":"message","text":"thank you everyone. The fact of preallocating vector instead of matrix (n,1) boost the function a lot. mul! and @fastmath were slower than simple * multiplicaiton. what I am surprise about is the fact of mentioning the format “Float64” is slowing down a little.","user":"U01QST11309","ts":"1615048308.149600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"udL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thank you everyone. The fact of preallocating vector instead of matrix (n,1) boost the function a lot. mul! and @fastmath were slower than simple * multiplicaiton. what I am surprise about is the fact of mentioning the format “Float64” is slowing down a little."}]}]}],"thread_ts":"1615042696.144800","parent_user_id":"U01QST11309"},{"client_msg_id":"5da23300-e7da-4426-89eb-0c70d24826b5","type":"message","text":"In my function I have ~10 lines vector operations and one line of matrix*vector and one line to generate random matrix. the last two lines are the slowest but matrix*vector line is twice slower than generating a random matrix !","user":"U01QST11309","ts":"1615048968.149800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Yw71l","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"In my function I have ~10 lines vector operations and one line of matrix*vector and one line to generate random matrix. the last two lines are the slowest but matrix*vector line is twice slower than generating a random matrix !"}]}]}],"thread_ts":"1615042696.144800","parent_user_id":"U01QST11309"},{"client_msg_id":"88b4c18a-6210-4b28-aff2-11eb026c7e57","type":"message","text":"It would be helpful if you posted some more context about what you're doing/what your function is doing - otherwise it's pretty hard to give specific advice that doesn't end in microbenchmarks of which BLAS is called.","user":"UH24GRBLL","ts":"1615108771.171100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uLu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It would be helpful if you posted some more context about what you're doing/what your function is doing - otherwise it's pretty hard to give specific advice that doesn't end in microbenchmarks of which BLAS is called."}]}]}],"thread_ts":"1615042696.144800","parent_user_id":"U01QST11309"},{"type":"message","text":"here is my function, as you can see lines 28th and 30th are slow. Also I am solving a model by Heun’s method but I don’t know how to use the Heun’s method implemented in Julia. If you can help I’d be grateful :wink:","files":[{"id":"F01QF6F0MEW","created":1615130600,"timestamp":1615130600,"name":"myFun.jl","title":"myFun.jl","mimetype":"text/plain","filetype":"text","pretty_type":"Plain Text","user":"U01QST11309","editable":true,"size":1034,"mode":"snippet","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01QF6F0MEW/myfun.jl","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01QF6F0MEW/download/myfun.jl","permalink":"https://julialang.slack.com/files/U01QST11309/F01QF6F0MEW/myfun.jl","permalink_public":"https://slack-files.com/T68168MUP-F01QF6F0MEW-09a2fdc80f","edit_link":"https://julialang.slack.com/files/U01QST11309/F01QF6F0MEW/myfun.jl/edit","preview":"\n\nusing Distributions\n\nfunction myFun()","preview_highlight":"<div class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\">\n<div class=\"CodeMirror-code\">\n<div><pre></pre></div>\n<div><pre></pre></div>\n<div><pre>using Distributions</pre></div>\n<div><pre></pre></div>\n<div><pre>function myFun()</pre></div>\n</div>\n</div>\n","lines":62,"lines_more":57,"preview_is_truncated":true,"is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"kpek","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"here is my function, as you can see lines 28th and 30th are slow. Also I am solving a model by Heun’s method but I don’t know how to use the Heun’s method implemented in Julia. If you can help I’d be grateful "},{"type":"emoji","name":"wink"}]}]}],"user":"U01QST11309","display_as_bot":false,"ts":"1615130702.176900","edited":{"user":"U01QST11309","ts":"1615130712.000000"},"thread_ts":"1615042696.144800","parent_user_id":"U01QST11309"}]