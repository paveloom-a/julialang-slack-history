[{"client_msg_id":"b8533a18-ccf3-4d4f-a925-0c3eb151f296","type":"message","text":"Does anyone know how `Core.__apply_iterate_` is meant to work / where or whether it is documented?","user":"U6PQP41C3","ts":"1612314159.058000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zw3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Does anyone know how "},{"type":"text","text":"Core._","style":{"code":true}},{"type":"text","text":"apply_iterate","style":{"italic":true,"code":true}},{"type":"text","text":" is meant to work / where or whether it is documented?"}]}]}],"thread_ts":"1612314159.058000","reply_count":22,"reply_users_count":6,"latest_reply":"1612338617.065000","reply_users":["U680THK2S","U6A936746","U6PQP41C3","UM30MT6RF","U67BJLYCS","UC4QQPG4A"],"subscribed":false},{"client_msg_id":"0e82f604-f198-4e38-8154-1e2588f81f51","type":"message","text":"Almost surely undocumented, as it's in Core and begins with an underscore :smile:","user":"U680THK2S","ts":"1612314191.058100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"AE3c","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Almost surely undocumented, as it's in Core and begins with an underscore "},{"type":"emoji","name":"smile"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3","reactions":[{"name":"joy","users":["UH8A351DJ","UDB26738Q","U6PQP41C3"],"count":3}]},{"client_msg_id":"66aa1d0e-fe99-44a5-8eda-237486d8e76f","type":"message","text":"<@UM30MT6RF> fixed it in Cassette.","user":"U6A936746","ts":"1612314223.058500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9TxN","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UM30MT6RF"},{"type":"text","text":" fixed it in Cassette."}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"11afcd96-21a3-4b76-a63d-24fbfffa1c99","type":"message","text":"Ooo that code seems quite enlightening","user":"U6PQP41C3","ts":"1612314300.058700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"riX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ooo that code seems quite enlightening"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"2bfddd70-e8a3-45fb-aa78-40d9d44252e2","type":"message","text":"I’m assuming you’re referring to here: <https://github.com/JuliaLabs/Cassette.jl/blob/9cb8367c5d028fdc01c2eda1618996d9365cf001/src/context.jl#L263>","user":"U6PQP41C3","ts":"1612314312.058900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"W+cA6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m assuming you’re referring to here: "},{"type":"link","url":"https://github.com/JuliaLabs/Cassette.jl/blob/9cb8367c5d028fdc01c2eda1618996d9365cf001/src/context.jl#L263"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"7e274bd7-1822-4eb3-bdcb-351f200de482","type":"message","text":"The problem in Cassette was just that the predecessor of `_apply_iterate`, `Core._apply` bitrotted and was just broken.","user":"UM30MT6RF","ts":"1612314558.059300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Lvs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The problem in Cassette was just that the predecessor of "},{"type":"text","text":"_apply_iterate","style":{"code":true}},{"type":"text","text":", "},{"type":"text","text":"Core._apply","style":{"code":true}},{"type":"text","text":" bitrotted and was just broken."}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"719e4a5a-df3b-49cd-be6c-7fe1364875c5","type":"message","text":"I don't think it's documented, but what `_apply_iterate` does is take a function as a second argument and splat all arguments after that as arguments into the function. The first argument is a `Base.iterate` like function that is used to perform the actual splatting on non-builtin iterators.","user":"UM30MT6RF","ts":"1612314798.060000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dQna","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't think it's documented, but what "},{"type":"text","text":"_apply_iterate","style":{"code":true}},{"type":"text","text":" does is take a function as a second argument and splat all arguments after that as arguments into the function. The first argument is a "},{"type":"text","text":"Base.iterate","style":{"code":true}},{"type":"text","text":" like function that is used to perform the actual splatting on non-builtin iterators."}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"32dfc805-d58b-472a-a1e0-c84682253c49","type":"message","text":"Ahh I see. Is it clear why the function (2nd argument) seems to be wrapped in a `Tuple` a lot of the time? Seems to moan about it not being iterable if it’s not, so I assume it has to be…","user":"U6PQP41C3","ts":"1612315016.060200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MzhP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ahh I see. Is it clear why the function (2nd argument) seems to be wrapped in a "},{"type":"text","text":"Tuple","style":{"code":true}},{"type":"text","text":" a lot of the time? Seems to moan about it not being iterable if it’s not, so I assume it has to be…"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"29844c73-c80b-4695-9b48-b0387f525779","type":"message","text":"The second argument should never be wrapped in a tuple, but the third one very likely might, because every argument is iterated over","user":"UM30MT6RF","ts":"1612315116.060400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zBR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The second argument should never be wrapped in a tuple, but the third one very likely might, because every argument is iterated over"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"92c71475-0121-4810-ba89-e553972cffb8","type":"message","text":"Hmm okay. I’m pleasantly confused then :joy:  I’m consistently seeing signatures like\n```_apply_iterate(::Base.iterator, ::Tuple{typeof(foo)}, args)```","user":"U6PQP41C3","ts":"1612315201.060600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cgy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm okay. I’m pleasantly confused then "},{"type":"emoji","name":"joy"},{"type":"text","text":"  I’m consistently seeing signatures like\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"_apply_iterate(::Base.iterator, ::Tuple{typeof(foo)}, args)"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"326df562-0d18-4a1f-97ad-2356371c8520","type":"message","text":"Hmm, that's odd. Where did you see that?","user":"UM30MT6RF","ts":"1612315280.061100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NQqy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm, that's odd. Where did you see that?"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"d4db1020-3f61-4526-adcf-37f147c2b94c","type":"message","text":"E.g. I get:\n```julia&gt; Core._apply_iterate(iterate, +, [1, 2])\n3\n\njulia&gt; Core._apply_iterate(iterate, (+,), [1, 2])\nERROR: MethodError: objects of type Tuple{typeof(+)} are not callable\nStacktrace:\n [1] top-level scope at REPL[56]:1```","user":"UM30MT6RF","ts":"1612315313.061300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KT20","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"E.g. I get:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> Core._apply_iterate(iterate, +, [1, 2])\n3\n\njulia> Core._apply_iterate(iterate, (+,), [1, 2])\nERROR: MethodError: objects of type Tuple{typeof(+)} are not callable\nStacktrace:\n [1] top-level scope at REPL[56]:1"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"e8483648-b508-42b1-be3a-914bcec00d26","type":"message","text":"Oh, wait, sorry, you’re right.","user":"U6PQP41C3","ts":"1612315445.061500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QzWi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh, wait, sorry, you’re right."}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"8be0ff95-9c37-450d-be40-e96a13acd5f7","type":"message","text":"I’m getting myself confused","user":"U6PQP41C3","ts":"1612315447.061700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oIS2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m getting myself confused"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"bf56f7ff-ee64-4cf1-97ff-fe53cd1620e5","type":"message","text":"```Core._apply_iterate(Base.iterate, Zygote.rrule, (*,), (randn(5, 5), randn(5, 5)))```\nworks, but\n```Core._apply_iterate(Base.iterate, Zygote.rrule, *, (randn(5, 5), randn(5, 5)))```\ndoesn’t. This makes sense, given what you’ve been saying.","user":"U6PQP41C3","ts":"1612315494.061900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wnK1","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"Core._apply_iterate(Base.iterate, Zygote.rrule, (*,), (randn(5, 5), randn(5, 5)))"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"works, but\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"Core._apply_iterate(Base.iterate, Zygote.rrule, *, (randn(5, 5), randn(5, 5)))"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"doesn’t. This makes sense, given what you’ve been saying."}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"efcef06f-6ce4-4cbc-b95d-1226f5f31748","type":"message","text":"I was mistaking the 3rd argument for the 2nd :joy:","user":"U6PQP41C3","ts":"1612315512.062100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"phjlf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I was mistaking the 3rd argument for the 2nd "},{"type":"emoji","name":"joy"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"b441395d-aaa0-4795-9054-c31f84d344d7","type":"message","text":"Yes, that can indeed sometimes be confusing when working with passes like this","user":"UM30MT6RF","ts":"1612315564.062300","team":"T68168MUP","edited":{"user":"UM30MT6RF","ts":"1612315626.000000"},"blocks":[{"type":"rich_text","block_id":"KZ9sL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, that can indeed sometimes be confusing when working with passes like this"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3","reactions":[{"name":"+1","users":["U6PQP41C3"],"count":1}]},{"client_msg_id":"69d081bc-6c51-4826-8cb5-bb30e814d4f0","type":"message","text":"Cool. Thanks for the assistance!","user":"U6PQP41C3","ts":"1612315641.063100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yT6gH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Cool. Thanks for the assistance!"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"19468135-5350-402b-bbdc-3d4d7821916f","type":"message","text":"IIUC we have `Core._apply_iterate` so that Cassette can overdub the iteration function used for the arguments","user":"U67BJLYCS","ts":"1612316111.063600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"87RO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"IIUC we have "},{"type":"text","text":"Core._apply_iterate","style":{"code":true}},{"type":"text","text":" so that Cassette can overdub the iteration function used for the arguments"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"51ae2444-4d3d-4e70-a6b1-e86ffb7c6f4e","type":"message","text":"but I think doing so was quite bad for performance","user":"U67BJLYCS","ts":"1612316203.063800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3YsJ/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but I think doing so was quite bad for performance"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"3d312c76-de7e-4aa1-917c-8df3e1b1eaa9","type":"message","text":"<https://github.com/JuliaLabs/Cassette.jl/pull/172>","user":"U67BJLYCS","ts":"1612316226.064000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/=3ZY","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/JuliaLabs/Cassette.jl/pull/172"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"dec32298-e514-4cbd-b394-109142b7fbb3","type":"message","text":"So that was unfortunate","user":"U67BJLYCS","ts":"1612316282.064200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3KDN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So that was unfortunate"}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"},{"client_msg_id":"19a68e0d-876b-426f-b527-5bf6f8bd201c","type":"message","text":"Oh we also have an issue with splatting with Flux on nightly which may come from the same place...","user":"UC4QQPG4A","ts":"1612338617.065000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YhJ7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh we also have an issue with splatting with Flux on nightly which may come from the same place..."}]}]}],"thread_ts":"1612314159.058000","parent_user_id":"U6PQP41C3"}]