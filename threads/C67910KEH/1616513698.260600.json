[{"client_msg_id":"f96f5515-dd54-4670-8eea-4abaace85426","type":"message","text":"I have some bad memories of the unboxing overhead of functions being pretty bad, but I did some benchmarking last night on 1.6 and now on 1.5, and it really seems to be nowhere near as bad as I though I remembered...\n```f(x) = x^2 + 1\ng(x) = -x + 4\n\nv = [f, g]\n\njulia&gt; @btime $f($1)\n  0.016 ns (0 allocations: 0 bytes)\n\njulia&gt; @btime $v[1]($1)\n  15.281 ns (0 allocations: 0 bytes)```\nThere seem to be 3 possibilities:\n- I am remembering wrong\n- There was a significant improvement made since I last benchmarked this\n- I am failing to capture the \"worst case\" that I am remembering in the above example.\nAnyone know which?","user":"U9VG1AYSG","ts":"1616513698.260600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"B5m","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have some bad memories of the unboxing overhead of functions being pretty bad, but I did some benchmarking last night on 1.6 and now on 1.5, and it really seems to be nowhere near as bad as I though I remembered...\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"f(x) = x^2 + 1\ng(x) = -x + 4\n\nv = [f, g]\n\njulia> @btime $f($1)\n  0.016 ns (0 allocations: 0 bytes)\n\njulia> @btime $v[1]($1)\n  15.281 ns (0 allocations: 0 bytes)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"There seem to be 3 possibilities:\n- I am remembering wrong\n- There was a significant improvement made since I last benchmarked this\n- I am failing to capture the \"worst case\" that I am remembering in the above example.\nAnyone know which?"}]}]}],"thread_ts":"1616513698.260600","reply_count":5,"reply_users_count":2,"latest_reply":"1616514100.264100","reply_users":["U6740K1SP","U9VG1AYSG"],"subscribed":false},{"client_msg_id":"2a422500-0c8c-4b3b-bd8f-ba634ed5bcfe","type":"message","text":"what you’ve written there performs identically on 1.0 and master","user":"U6740K1SP","ts":"1616513833.260700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ugqej","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what you’ve written there performs identically on 1.0 and master"}]}]}],"thread_ts":"1616513698.260600","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"6df84156-1dfa-4f82-9b93-c0e5290c8b9f","type":"message","text":"hm...","user":"U9VG1AYSG","ts":"1616513847.260900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0os","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hm..."}]}]}],"thread_ts":"1616513698.260600","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"4bfb5188-7aad-4964-bf4e-d7237e2f3dc0","type":"message","text":"I think I am failing to capture whatever it was I thought was so bad","user":"U9VG1AYSG","ts":"1616513863.261100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1iY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think I am failing to capture whatever it was I thought was so bad"}]}]}],"thread_ts":"1616513698.260600","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"5628de69-b98f-4235-96e8-b4805366d81a","type":"message","text":"I mean, in the above example it looks like the compiler evaluated at compile time for the first example, and just had 0 overhead on the second","user":"U9VG1AYSG","ts":"1616514000.262200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cl0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I mean, in the above example it looks like the compiler evaluated at compile time for the first example, and just had 0 overhead on the second"}]}]}],"thread_ts":"1616513698.260600","parent_user_id":"U9VG1AYSG"},{"client_msg_id":"5e4ec537-55d1-44c5-af3d-a301d0c635ea","type":"message","text":"the actual computation takes ~2ns for me:\n```julia&gt; arg = Ref(1)\nBase.RefValue{Int64}(1)\n\njulia&gt; @btime $f($arg[])\n  1.714 ns (0 allocations: 0 bytes)\n2```","user":"U6740K1SP","ts":"1616514100.264100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lQRn0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the actual computation takes ~2ns for me:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> arg = Ref(1)\nBase.RefValue{Int64}(1)\n\njulia> @btime $f($arg[])\n  1.714 ns (0 allocations: 0 bytes)\n2"}]}]}],"thread_ts":"1616513698.260600","parent_user_id":"U9VG1AYSG"}]