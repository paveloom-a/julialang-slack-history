[{"client_msg_id":"f522a9c3-e302-4d19-872e-beedd72ce1c4","type":"message","text":"Is anyone aware of a mechanism to do “really unsafe views”, where you provide the memory backing an `Array` directly from a contiguous section of another `Array` . So something like `really_unsafe_view(randn(10), 1:5)::Vector{Float64}`?","user":"U6PQP41C3","ts":"1612449545.128600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TgZwQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is anyone aware of a mechanism to do “really unsafe views”, where you provide the memory backing an "},{"type":"text","text":"Array","style":{"code":true}},{"type":"text","text":" directly from a contiguous section of another "},{"type":"text","text":"Array","style":{"code":true}},{"type":"text","text":" . So something like "},{"type":"text","text":"really_unsafe_view(randn(10), 1:5)::Vector{Float64}","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1612449545.128600","reply_count":13,"reply_users_count":6,"latest_reply":"1612456106.135700","reply_users":["U6740K1SP","UH8A351DJ","UDB26738Q","U6PQP41C3","UM30MT6RF","U6A936746"],"subscribed":false},{"client_msg_id":"ed6158ec-4be5-4616-b53c-903707de6cf9","type":"message","text":"but why?","user":"U6740K1SP","ts":"1612449713.128800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4X8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but why?"}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3","reactions":[{"name":"+1","users":["U67G3QRJM"],"count":1}]},{"client_msg_id":"e5306ab1-a72c-414b-b521-554510a8f5a6","type":"message","text":"how is that different from just view? notice you will need a new \"metadata\"(type, length) anyways","user":"UH8A351DJ","ts":"1612449822.129000","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1612449855.000000"},"blocks":[{"type":"rich_text","block_id":"2OxK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"how is that different from just view? notice you will need a new \"metadata\"(type, length) anyways"}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3"},{"client_msg_id":"f1045a3e-a8e5-4e4a-91b6-3665baeada03","type":"message","text":"maybe <https://github.com/JuliaArrays/UnsafeArrays.jl>?","user":"UDB26738Q","ts":"1612450051.132000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/MAj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"maybe "},{"type":"link","url":"https://github.com/JuliaArrays/UnsafeArrays.jl"},{"type":"text","text":"?"}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3"},{"client_msg_id":"d73cac6e-db4f-4ea2-86e8-eff865814807","type":"message","text":"I’m guessing Will knows about both of those since he want’s a _really_ unsafe view :stuck_out_tongue:","user":"U6740K1SP","ts":"1612450119.132200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WELS4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m guessing Will knows about both of those since he want’s a "},{"type":"text","text":"really","style":{"italic":true}},{"type":"text","text":" unsafe view "},{"type":"emoji","name":"stuck_out_tongue"}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3"},{"client_msg_id":"fd962ef0-dedc-4f97-9ae9-57e08144af44","type":"message","text":"Is it just to fit a square peg into the round hole that is a `::Vector{Float64}` method signature?","user":"U6740K1SP","ts":"1612450180.132400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XGmzn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is it just to fit a square peg into the round hole that is a "},{"type":"text","text":"::Vector{Float64}","style":{"code":true}},{"type":"text","text":" method signature?"}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3"},{"client_msg_id":"210a9210-e3e3-4cd3-a670-df49c25eb602","type":"message","text":"Haha fair question. I’m looking at building some memory management functionality that’s similar in spirit to what `ReverseDiff` does with tape management (ReverseDiff being an AD tool and memory-management tool rolled in together), but which is built in an AD agnostic manner.\n\nAs part of this, I’m looking to be able to allocate a single array that provides the memory for multiple smaller arrays. You _could_ use a `view` for this, but I would ideally like to make this work in a way which doesn’t risk accidentally changing the semantics of the programme, hence the need to obtain an `Array` rather than some subtype of `AbstractArray`.","user":"U6PQP41C3","ts":"1612450220.132600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0p8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Haha fair question. I’m looking at building some memory management functionality that’s similar in spirit to what "},{"type":"text","text":"ReverseDiff","style":{"code":true}},{"type":"text","text":" does with tape management (ReverseDiff being an AD tool and memory-management tool rolled in together), but which is built in an AD agnostic manner.\n\nAs part of this, I’m looking to be able to allocate a single array that provides the memory for multiple smaller arrays. You "},{"type":"text","text":"could","style":{"italic":true}},{"type":"text","text":" use a "},{"type":"text","text":"view","style":{"code":true}},{"type":"text","text":" for this, but I would ideally like to make this work in a way which doesn’t risk accidentally changing the semantics of the programme, hence the need to obtain an "},{"type":"text","text":"Array","style":{"code":true}},{"type":"text","text":" rather than some subtype of "},{"type":"text","text":"AbstractArray","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3"},{"client_msg_id":"afa3ebb7-3fa0-463e-a432-41933cfabdfe","type":"message","text":"&gt;  Is it just to fit a square peg into the round hole that is a `::Vector{Float64}` method signature?\nEssentially.","user":"U6PQP41C3","ts":"1612450229.132800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MNf3","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":" Is it just to fit a square peg into the round hole that is a "},{"type":"text","text":"::Vector{Float64}","style":{"code":true}},{"type":"text","text":" method signature?"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Essentially."}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3"},{"client_msg_id":"7adb50c1-b382-4da0-8dee-c2caa0522617","type":"message","text":"It’s probably not a deal breaker, I’m just keen to find out whether this is something that’s doable so that I can design accordingly.","user":"U6PQP41C3","ts":"1612450450.133000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BKDv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It’s probably not a deal breaker, I’m just keen to find out whether this is something that’s doable so that I can design accordingly."}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3"},{"client_msg_id":"4d944693-a9a8-468d-a982-61689f165be4","type":"message","text":"You probably want something like:\n```julia&gt; a = [1:10;]\n10-element Array{Int64,1}:\n  1\n  2\n  3\n  4\n  5\n  6\n  7\n  8\n  9\n 10\n\njulia&gt; Base.unsafe_wrap(Array, pointer(a) + 1 * sizeof(eltype(a)), 5)\n5-element Array{Int64,1}:\n 2\n 3\n 4\n 5\n 6```","user":"UM30MT6RF","ts":"1612450482.133200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zVQoI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You probably want something like:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> a = [1:10;]\n10-element Array{Int64,1}:\n  1\n  2\n  3\n  4\n  5\n  6\n  7\n  8\n  9\n 10\n\njulia> Base.unsafe_wrap(Array, pointer(a) + 1 * sizeof(eltype(a)), 5)\n5-element Array{Int64,1}:\n 2\n 3\n 4\n 5\n 6"}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3","reactions":[{"name":"eyes","users":["UH24GRBLL"],"count":1},{"name":"heavy_check_mark","users":["U8D9768Q6"],"count":1},{"name":"point_up","users":["U6A936746"],"count":1}]},{"client_msg_id":"1468f84b-4b6c-4edf-8b5a-287dc0dc7b7f","type":"message","text":"Oooooo","user":"U6PQP41C3","ts":"1612450507.133600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HTt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oooooo"}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3"},{"client_msg_id":"1c04e20c-a4d7-434f-8df0-6db93409052f","type":"message","text":"Just remember to `GC.@preserve` `a` as long as that array is in use","user":"UM30MT6RF","ts":"1612450523.133800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+HrN4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Just remember to "},{"type":"text","text":"GC.@preserve","style":{"code":true}},{"type":"text","text":" "},{"type":"text","text":"a","style":{"code":true}},{"type":"text","text":" as long as that array is in use"}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3","reactions":[{"name":"+1","users":["UKG4WF8PJ","UH8A351DJ","U6PQP41C3","U6740K1SP"],"count":4}]},{"client_msg_id":"9766e692-1825-40a5-8f57-489924b5ba5e","type":"message","text":"This is perfect, thanks <@UM30MT6RF>","user":"U6PQP41C3","ts":"1612451166.134300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pSh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is perfect, thanks "},{"type":"user","user_id":"UM30MT6RF"}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3"},{"client_msg_id":"c43824b2-6b9f-4de2-83c3-0a785166c7f5","type":"message","text":"Note that this will amongst other things make `mightalias`  lie.\nWhich might make some things that rely on not aliasing","user":"U6A936746","ts":"1612456106.135700","team":"T68168MUP","edited":{"user":"U6A936746","ts":"1612456523.000000"},"blocks":[{"type":"rich_text","block_id":"VrNKO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Note that this will amongst other things make "},{"type":"text","text":"mightalias","style":{"code":true}},{"type":"text","text":"  lie.\nWhich might make some things that rely on not aliasing"}]}]}],"thread_ts":"1612449545.128600","parent_user_id":"U6PQP41C3"}]