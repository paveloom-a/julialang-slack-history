[{"client_msg_id":"15ac1a02-cab9-4546-aebd-60637ae6fce6","type":"message","text":"Have anyone seen the `ERROR: LoadError: Mutating arrays is not supported` when trying to differentiate a function with `Zygote.gradient()` function? I am trying to differentiate a `DerivativeOperator` from `DiffEqOperators`. (Stacktrace in comments)","user":"U016VPPCQA1","ts":"1609196138.214200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cKEU=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Have anyone seen the "},{"type":"text","text":"ERROR: LoadError: Mutating arrays is not supported","style":{"code":true}},{"type":"text","text":" when trying to differentiate a function with "},{"type":"text","text":"Zygote.gradient()","style":{"code":true}},{"type":"text","text":" function? I am trying to differentiate a "},{"type":"text","text":"DerivativeOperator","style":{"code":true}},{"type":"text","text":" from "},{"type":"text","text":"DiffEqOperators","style":{"code":true}},{"type":"text","text":". (Stacktrace in comments)"}]}]}],"thread_ts":"1609196138.214200","reply_count":6,"reply_users_count":3,"latest_reply":"1610029947.251500","reply_users":["U016VPPCQA1","U69BL50BF","UG194JC5S"],"subscribed":false},{"client_msg_id":"8cd14082-b5c0-4af1-a63f-cdd9cbfbc746","type":"message","text":"`ERROR: LoadError: Mutating arrays is not supported`\n`Stacktrace:`\n `[1] error(::String) at ./error.jl:33`\n `[2] (::Zygote.var\"#364#365\")(::Nothing) at /home/simen/.julia/packages/Zygote/nK6sg/src/lib/array.jl:58`\n `[3] (::Zygote.var\"#2245#back#366\"{Zygote.var\"#364#365\"})(::Nothing) at /home/simen/.julia/packages/ZygoteRules/6nssF/src/adjoint.jl:49`\n `[4] #convolve_BC_right!#85 at /home/simen/Documents/school/masteroppgave/wave_simulation/dev/DiffEqOperators/src/derivative_operators/convolutions.jl:312 [inlined]`\n `[5] (::typeof(∂(#convolve_BC_right!#85)))(::Nothing) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0 (repeats 2 times)`\n `[6] #mul!#73 at /home/simen/Documents/school/masteroppgave/wave_simulation/dev/DiffEqOperators/src/derivative_operators/convolutions.jl:20 [inlined]`\n `[7] (::typeof(∂(#mul!#73)))(::Nothing) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0`\n `[8] mul! at /home/simen/Documents/school/masteroppgave/wave_simulation/dev/DiffEqOperators/src/derivative_operators/convolutions.jl:18 [inlined]`\n `[9] mul! at /home/simen/Documents/school/masteroppgave/wave_simulation/dev/DiffEqOperators/src/derivative_operators/ghost_derivative_operator.jl:16 [inlined]`\n `[10] (::typeof(∂(mul!)))(::Nothing) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0`\n `[11] * at /home/simen/Documents/school/masteroppgave/wave_simulation/dev/DiffEqOperators/src/derivative_operators/ghost_derivative_operator.jl:22 [inlined]`\n `[12] (::typeof(∂(*)))(::FillArrays.Fill{Float64,1,Tuple{Base.OneTo{Int64}}}) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0`\n `[13] * at ./operators.jl:538 [inlined]`\n `[14] (::typeof(∂(*)))(::FillArrays.Fill{Float64,1,Tuple{Base.OneTo{Int64}}}) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0`\n `[15] f_test at /home/simen/Documents/school/masteroppgave/wave_simulation/src/1D_optimization_testing.jl:115 [inlined]`\n `[16] (::typeof(∂(f_test)))(::FillArrays.Fill{Float64,1,Tuple{Base.OneTo{Int64}}}) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0`\n `[17] #16 at /home/simen/Documents/school/masteroppgave/wave_simulation/src/1D_optimization_testing.jl:120 [inlined]`\n `[18] (::typeof(∂(#16)))(::Float64) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0`\n `[19] (::Zygote.var\"#41#42\"{typeof(∂(#16))})(::Float64) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface.jl:40`\n `[20] gradient(::Function, ::Array{Float64,1}) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface.jl:49`\n `[21] top-level scope at /home/simen/Documents/school/masteroppgave/wave_simulation/src/1D_optimization_testing.jl:120`\n `[22] include_string(::Function, ::Module, ::String, ::String) at ./loading.jl:1091`\n `[23] invokelatest(::Any, ::Any, ::Vararg{Any,N} where N; kwargs::Base.Iterators.Pairs{Union{},Union{},Tuple{},NamedTuple{(),Tuple{}}}) at ./essentials.jl:710`\n `[24] invokelatest(::Any, ::Any, ::Vararg{Any,N} where N) at ./essentials.jl:709`\n `[25] inlineeval(::Module, ::String, ::Int64, ::Int64, ::String; softscope::Bool) at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:185`\n `[26] (::VSCodeServer.var\"#61#65\"{String,Int64,Int64,String,Module,Bool,VSCodeServer.ReplRunCodeRequestParams})() at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:144`\n `[27] withpath(::VSCodeServer.var\"#61#65\"{String,Int64,Int64,String,Module,Bool,VSCodeServer.ReplRunCodeRequestParams}, ::String) at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/repl.jl:124`\n `[28] (::VSCodeServer.var\"#60#64\"{String,Int64,Int64,String,Module,Bool,Bool,VSCodeServer.ReplRunCodeRequestParams})() at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:142`\n `[29] hideprompt(::VSCodeServer.var\"#60#64\"{String,Int64,Int64,String,Module,Bool,Bool,VSCodeServer.ReplRunCodeRequestParams}) at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/repl.jl:36`\n `[30] (::VSCodeServer.var\"#59#63\"{String,Int64,Int64,String,Module,Bool,Bool,VSCodeServer.ReplRunCodeRequestParams})() at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:110`\n `[31] with_logstate(::Function, ::Any) at ./logging.jl:408`\n `[32] with_logger at ./logging.jl:514 [inlined]`\n `[33] (::VSCodeServer.var\"#58#62\"{VSCodeServer.ReplRunCodeRequestParams})() at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:109`\n `[34] #invokelatest#1 at ./essentials.jl:710 [inlined]`\n `[35] invokelatest(::Any) at ./essentials.jl:709`\n `[36] macro expansion at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:27 [inlined]`\n `[37] (::VSCodeServer.var\"#56#57\")() at ./task.jl:356`\n`in expression starting at /home/simen/Documents/school/masteroppgave/wave_simulation/src/1D_optimization_testing.jl:120`","user":"U016VPPCQA1","ts":"1609196172.214300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PKx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ERROR: LoadError: Mutating arrays is not supported","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"Stacktrace:","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [1] error(::String) at ./error.jl:33","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [2] (::Zygote.var\"#364#365\")(::Nothing) at /home/simen/.julia/packages/Zygote/nK6sg/src/lib/array.jl:58","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [3] (::Zygote.var\"#2245#back#366\"{Zygote.var\"#364#365\"})(::Nothing) at /home/simen/.julia/packages/ZygoteRules/6nssF/src/adjoint.jl:49","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [4] #convolve_BC_right!#85 at /home/simen/Documents/school/masteroppgave/wave_simulation/dev/DiffEqOperators/src/derivative_operators/convolutions.jl:312 [inlined]","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [5] (::typeof(∂(#convolve_BC_right!#85)))(::Nothing) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0 (repeats 2 times)","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [6] #mul!#73 at /home/simen/Documents/school/masteroppgave/wave_simulation/dev/DiffEqOperators/src/derivative_operators/convolutions.jl:20 [inlined]","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [7] (::typeof(∂(#mul!#73)))(::Nothing) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [8] mul! at /home/simen/Documents/school/masteroppgave/wave_simulation/dev/DiffEqOperators/src/derivative_operators/convolutions.jl:18 [inlined]","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [9] mul! at /home/simen/Documents/school/masteroppgave/wave_simulation/dev/DiffEqOperators/src/derivative_operators/ghost_derivative_operator.jl:16 [inlined]","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [10] (::typeof(∂(mul!)))(::Nothing) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [11] * at /home/simen/Documents/school/masteroppgave/wave_simulation/dev/DiffEqOperators/src/derivative_operators/ghost_derivative_operator.jl:22 [inlined]","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [12] (::typeof(∂(*)))(::FillArrays.Fill{Float64,1,Tuple{Base.OneTo{Int64}}}) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [13] * at ./operators.jl:538 [inlined]","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [14] (::typeof(∂(*)))(::FillArrays.Fill{Float64,1,Tuple{Base.OneTo{Int64}}}) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [15] f_test at /home/simen/Documents/school/masteroppgave/wave_simulation/src/1D_optimization_testing.jl:115 [inlined]","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [16] (::typeof(∂(f_test)))(::FillArrays.Fill{Float64,1,Tuple{Base.OneTo{Int64}}}) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [17] #16 at /home/simen/Documents/school/masteroppgave/wave_simulation/src/1D_optimization_testing.jl:120 [inlined]","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [18] (::typeof(∂(#16)))(::Float64) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface2.jl:0","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [19] (::Zygote.var\"#41#42\"{typeof(∂(#16))})(::Float64) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface.jl:40","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [20] gradient(::Function, ::Array{Float64,1}) at /home/simen/.julia/packages/Zygote/nK6sg/src/compiler/interface.jl:49","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [21] top-level scope at /home/simen/Documents/school/masteroppgave/wave_simulation/src/1D_optimization_testing.jl:120","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [22] include_string(::Function, ::Module, ::String, ::String) at ./loading.jl:1091","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [23] invokelatest(::Any, ::Any, ::Vararg{Any,N} where N; kwargs::Base.Iterators.Pairs{Union{},Union{},Tuple{},NamedTuple{(),Tuple{}}}) at ./essentials.jl:710","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [24] invokelatest(::Any, ::Any, ::Vararg{Any,N} where N) at ./essentials.jl:709","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [25] inlineeval(::Module, ::String, ::Int64, ::Int64, ::String; softscope::Bool) at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:185","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [26] (::VSCodeServer.var\"#61#65\"{String,Int64,Int64,String,Module,Bool,VSCodeServer.ReplRunCodeRequestParams})() at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:144","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [27] withpath(::VSCodeServer.var\"#61#65\"{String,Int64,Int64,String,Module,Bool,VSCodeServer.ReplRunCodeRequestParams}, ::String) at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/repl.jl:124","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [28] (::VSCodeServer.var\"#60#64\"{String,Int64,Int64,String,Module,Bool,Bool,VSCodeServer.ReplRunCodeRequestParams})() at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:142","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [29] hideprompt(::VSCodeServer.var\"#60#64\"{String,Int64,Int64,String,Module,Bool,Bool,VSCodeServer.ReplRunCodeRequestParams}) at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/repl.jl:36","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [30] (::VSCodeServer.var\"#59#63\"{String,Int64,Int64,String,Module,Bool,Bool,VSCodeServer.ReplRunCodeRequestParams})() at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:110","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [31] with_logstate(::Function, ::Any) at ./logging.jl:408","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [32] with_logger at ./logging.jl:514 [inlined]","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [33] (::VSCodeServer.var\"#58#62\"{VSCodeServer.ReplRunCodeRequestParams})() at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:109","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [34] #invokelatest#1 at ./essentials.jl:710 [inlined]","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [35] invokelatest(::Any) at ./essentials.jl:709","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [36] macro expansion at /home/simen/.vscode/extensions/julialang.language-julia-1.0.10/scripts/packages/VSCodeServer/src/eval.jl:27 [inlined]","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":" [37] (::VSCodeServer.var\"#56#57\")() at ./task.jl:356","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"in expression starting at /home/simen/Documents/school/masteroppgave/wave_simulation/src/1D_optimization_testing.jl:120","style":{"code":true}}]}]}],"thread_ts":"1609196138.214200","parent_user_id":"U016VPPCQA1"},{"client_msg_id":"0f0b0d9b-c97f-4241-b935-a24208c9d977","type":"message","text":"Zygote cannot differentiate mutation calls","user":"U69BL50BF","ts":"1609201003.214500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"i9V","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Zygote cannot differentiate mutation calls"}]}]}],"thread_ts":"1609196138.214200","parent_user_id":"U016VPPCQA1"},{"client_msg_id":"e3c7a1a1-53ed-4137-bde4-08109d5cf9c1","type":"message","text":"the DerivativeOperator operations probably need defined rrules","user":"U69BL50BF","ts":"1609201019.214700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"op+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the DerivativeOperator operations probably need defined rrules"}]}]}],"thread_ts":"1609196138.214200","parent_user_id":"U016VPPCQA1"},{"client_msg_id":"21125b2a-e6d5-4099-8b5a-aa977ba995ed","type":"message","text":"Ok, yes, that makes sense! Thanks :blush:","user":"U016VPPCQA1","ts":"1609201870.214900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DerAV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ok, yes, that makes sense! Thanks "},{"type":"emoji","name":"blush"}]}]}],"thread_ts":"1609196138.214200","parent_user_id":"U016VPPCQA1"},{"client_msg_id":"889e03af-c56b-498d-983d-834397d5df6c","type":"message","text":"Did you find a work around  <@U016VPPCQA1>?","user":"UG194JC5S","ts":"1609975326.242800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7BVWW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Did you find a work around  "},{"type":"user","user_id":"U016VPPCQA1"},{"type":"text","text":"?"}]}]}],"thread_ts":"1609196138.214200","parent_user_id":"U016VPPCQA1"},{"client_msg_id":"d543b85f-d896-47ce-9d91-b96942aac176","type":"message","text":"Hi. I found out that Zygote can't differentiate functions with mutating calls, so you have to implement custom rules for the functions that use mutation. I'm working with the rules to get them working on `DerivativeOperators` from `DiffEqOperators`. Havent't got this working so far, but I have gotten some help from Rackauckas on how to define such rules or constructors. I'll bet I will be asking this chat more tho.","user":"U016VPPCQA1","ts":"1610029947.251500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Tyiw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi. I found out that Zygote can't differentiate functions with mutating calls, so you have to implement custom rules for the functions that use mutation. I'm working with the rules to get them working on "},{"type":"text","text":"DerivativeOperators","style":{"code":true}},{"type":"text","text":" from "},{"type":"text","text":"DiffEqOperators","style":{"code":true}},{"type":"text","text":". Havent't got this working so far, but I have gotten some help from Rackauckas on how to define such rules or constructors. I'll bet I will be asking this chat more tho."}]}]}],"thread_ts":"1609196138.214200","parent_user_id":"U016VPPCQA1"}]