[{"client_msg_id":"b912a784-3c26-4e92-81e5-f79525da8a5f","type":"message","text":"What would be the easiest way to loop over a grouped dataframe, while also receiving a tuple with indices, where each index denotes what cell of the product of grouping factors the current iteration is from? If I enumerate, I only get numbers from 1 to n. If I enumerate in multiple for loops, I only get numbers from 1:j for each group, but there might be missing combinations that offset the count. I need this for plotting :)","user":"UK1BNFHFV","ts":"1617812584.435900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BkXs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What would be the easiest way to loop over a grouped dataframe, while also receiving a tuple with indices, where each index denotes what cell of the product of grouping factors the current iteration is from? If I enumerate, I only get numbers from 1 to n. If I enumerate in multiple for loops, I only get numbers from 1:j for each group, but there might be missing combinations that offset the count. I need this for plotting :)"}]}]}],"thread_ts":"1617812584.435900","reply_count":25,"reply_users_count":3,"latest_reply":"1617821797.444200","reply_users":["UBF9YRB6H","UK1BNFHFV","U6BJ9E351"],"is_locked":false,"subscribed":false},{"client_msg_id":"742c7e7a-4a20-4d38-b77b-988576ebbd6c","type":"message","text":"&gt; what cell of the product of grouping factors the current iteration is from?\ncan you clarify what this means?","user":"UBF9YRB6H","ts":"1617814392.436100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ys=","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"what cell of the product of grouping factors the current iteration is from?"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\ncan you clarify what this means?"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"107a702d-586a-4285-96ae-8f68f5fb0410","type":"message","text":"I feared that I had to haha :)\n\nLet's say I have a dataframe with columns `color = [\"red\", \"blue\", \"blue\"]` and `shape = [\"circle\", \"circle\", \"rect\"]`\n\nThen I do `for ...... in groupby(df, [:color, :shape])`\n\nAnd want to have these as loop variables\n```(1, 1), group(\"red\", \"circle\")\n(2, 1), group(\"blue\", \"circle\")\n(2, 2), group(\"blue\", \"rect\")```\nThe critical thing is the third line, as blue is the second color in its group, as there is no red rectangle. It's not a fully crossed grouping","user":"UK1BNFHFV","ts":"1617814784.436500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HilOt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I feared that I had to haha :)\n\nLet's say I have a dataframe with columns "},{"type":"text","text":"color = [\"red\", \"blue\", \"blue\"]","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"shape = [\"circle\", \"circle\", \"rect\"]","style":{"code":true}},{"type":"text","text":"\n\nThen I do "},{"type":"text","text":"for ...... in groupby(df, [:color, :shape])","style":{"code":true}},{"type":"text","text":"\n\nAnd want to have these as loop variables\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"(1, 1), group(\"red\", \"circle\")\n(2, 1), group(\"blue\", \"circle\")\n(2, 2), group(\"blue\", \"rect\")"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"The critical thing is the third line, as blue is the second color in its group, as there is no red rectangle. It's not a fully crossed grouping"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"75b74b52-fbed-48e7-b78c-31021d4ffa14","type":"message","text":"I need this to index into color or linestyle vectors or create axes in a layout, and it's important what \"position\" each group is in","user":"UK1BNFHFV","ts":"1617814913.436700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Q39j","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I need this to index into color or linestyle vectors or create axes in a layout, and it's important what \"position\" each group is in"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"193b582c-dc24-4b33-bc4d-2b8e0494275d","type":"message","text":"ah i see. you don't want a box in the legend for \"red rectangle\"","user":"UBF9YRB6H","ts":"1617815001.436900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kt3C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ah i see. you don't want a box in the legend for \"red rectangle\""}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"4491a799-7c4e-4abb-b728-4fce03fa86ec","type":"message","text":"well the color is usually not in the dataframe itself, that example is a bit misleading :) just imagine arbitrary values that I want to assing plot attributes to","user":"UK1BNFHFV","ts":"1617815088.437100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KlxX1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"well the color is usually not in the dataframe itself, that example is a bit misleading :) just imagine arbitrary values that I want to assing plot attributes to"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"7c37c901-64d9-474d-bae7-992a9c158727","type":"message","text":"I think the answer is that it isn't defined. `gd.keymap` is a `Dict`, so I think there isn't a guaranteed order for `red =&gt; 1, blue =&gt; 2` etc.","user":"UBF9YRB6H","ts":"1617815457.437300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"diFK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think the answer is that it isn't defined. "},{"type":"text","text":"gd.keymap","style":{"code":true}},{"type":"text","text":" is a "},{"type":"text","text":"Dict","style":{"code":true}},{"type":"text","text":", so I think there isn't a guaranteed order for "},{"type":"text","text":"red => 1, blue => 2","style":{"code":true}},{"type":"text","text":" etc."}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"33f6e5e6-3f0f-4564-88c8-7ae5a2b06355","type":"message","text":"think this does what I want:\n```fgdf = groupby(\n    DataFrame(name = [\"Jack\", \"Lucy\", \"Lucy\"], lastname = [\"Smith\", \"Smith\", \"Miller\"]),\n    [:name, :lastname]\n)\n\nfunction myenum(gdf)\n    posdicts = Dict([c =&gt; Dict() for c in groupcols(gdf)])\n\n    for (groupkey, _) in pairs(gdf)\n        for (key, value) in pairs(groupkey)\n            d = posdicts[key]\n            if !haskey(d, value)\n                push!(d, value =&gt; length(d) + 1)\n            end\n        end\n    end\n\n    postuple(gkey) = tuple(map(pairs(gkey)) do (key, value)\n        posdicts[key][value]\n    end...)\n\n    (\n        (postuple(groupkey), values(groupkey), group)\n        for (groupkey, group) in pairs(gdf)\n    )\nend\n\nfor (indices, keys, group) in myenum(gdf)\n    @show indices, keys\nend```","user":"UK1BNFHFV","ts":"1617816112.437500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bIQvn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"think this does what I want:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"fgdf = groupby(\n    DataFrame(name = [\"Jack\", \"Lucy\", \"Lucy\"], lastname = [\"Smith\", \"Smith\", \"Miller\"]),\n    [:name, :lastname]\n)\n\nfunction myenum(gdf)\n    posdicts = Dict([c => Dict() for c in groupcols(gdf)])\n\n    for (groupkey, _) in pairs(gdf)\n        for (key, value) in pairs(groupkey)\n            d = posdicts[key]\n            if !haskey(d, value)\n                push!(d, value => length(d) + 1)\n            end\n        end\n    end\n\n    postuple(gkey) = tuple(map(pairs(gkey)) do (key, value)\n        posdicts[key][value]\n    end...)\n\n    (\n        (postuple(groupkey), values(groupkey), group)\n        for (groupkey, group) in pairs(gdf)\n    )\nend\n\nfor (indices, keys, group) in myenum(gdf)\n    @show indices, keys\nend"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"f10e4bb2-2b1e-49cd-8816-1298357f263f","type":"message","text":"```(indices, keys) = ((1, 1), (\"Jack\", \"Smith\"))\n(indices, keys) = ((2, 1), (\"Lucy\", \"Smith\"))\n(indices, keys) = ((2, 2), (\"Lucy\", \"Miller\"))```","user":"UK1BNFHFV","ts":"1617816123.437700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cnZ","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"(indices, keys) = ((1, 1), (\"Jack\", \"Smith\"))\n(indices, keys) = ((2, 1), (\"Lucy\", \"Smith\"))\n(indices, keys) = ((2, 2), (\"Lucy\", \"Miller\"))"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"db942aaf-7dd9-46b1-a56a-0cd91a17d0ef","type":"message","text":"then when plotting in that for loop I can give lucy in iteration 3 the correct color for her `name`, etc.","user":"UK1BNFHFV","ts":"1617816186.437900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"z/gOn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"then when plotting in that for loop I can give lucy in iteration 3 the correct color for her "},{"type":"text","text":"name","style":{"code":true}},{"type":"text","text":", etc."}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"fba9ef39-4c93-4f4d-ba8a-9b032dfeff1c","type":"message","text":"And sometimes I need the keys to for setting labels etc, that's why I like to access everything at once","user":"UK1BNFHFV","ts":"1617816213.438100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b6o8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And sometimes I need the keys to for setting labels etc, that's why I like to access everything at once"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"83d9f53e-4665-4e8d-bca3-808728eff3aa","type":"message","text":"Yeah this seems good. I guess I'd be curious how robust this is. I'd be worried that sometime \"Jack\" would be blue and other times green. Worth inspecting how groups are assigned in DataFrames.","user":"UBF9YRB6H","ts":"1617816291.438300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"L/9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah this seems good. I guess I'd be curious how robust this is. I'd be worried that sometime \"Jack\" would be blue and other times green. Worth inspecting how groups are assigned in DataFrames."}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"a7f666e5-53de-40c3-9ba9-c5b1ea7b8157","type":"message","text":"I usually do `groupby(... sort = true)` anyway for these kinds of things","user":"UK1BNFHFV","ts":"1617816487.438500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Sur9v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I usually do "},{"type":"text","text":"groupby(... sort = true)","style":{"code":true}},{"type":"text","text":" anyway for these kinds of things"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"badce167-533e-415b-8419-c2f4359a4168","type":"message","text":"is AlgebraofGraphics going to have DataFrames as a dependency? That's a little heavy, isn't it?","user":"UBF9YRB6H","ts":"1617816599.439100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0jKd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is AlgebraofGraphics going to have DataFrames as a dependency? That's a little heavy, isn't it?"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"bd710585-936b-4397-9c4a-fa68aca45fe0","type":"message","text":"not sure","user":"UK1BNFHFV","ts":"1617816683.439300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kt0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"not sure"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"c189cb27-201c-4445-8b43-ac90f27a1ffe","type":"message","text":"```mydf = DataFrame(\n    group = rand(1:4, 1000),\n    country = rand([\"DE\", \"GB\", \"FR\"], 1000),\n    values = randn(1000),\n    subgroup = rand(1:3, 1000)\n)\n\nlet\n    f = Figure(resolution = (1000, 1000))\n    for (indices, keys, group) in myenum(groupby(mydf, [:group, :country, :subgroup], sort = true))\n        if indices[3] == 1\n            Axis(f[indices[1:2]...], title = string(keys))\n        end\n        lines!(group.values, color = [:red, :blue, :green][indices[3]])\n    end\n    f\nend```","user":"UK1BNFHFV","ts":"1617816688.439500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oh66","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"mydf = DataFrame(\n    group = rand(1:4, 1000),\n    country = rand([\"DE\", \"GB\", \"FR\"], 1000),\n    values = randn(1000),\n    subgroup = rand(1:3, 1000)\n)\n\nlet\n    f = Figure(resolution = (1000, 1000))\n    for (indices, keys, group) in myenum(groupby(mydf, [:group, :country, :subgroup], sort = true))\n        if indices[3] == 1\n            Axis(f[indices[1:2]...], title = string(keys))\n        end\n        lines!(group.values, color = [:red, :blue, :green][indices[3]])\n    end\n    f\nend"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"336abf8f-3574-40f5-88df-801e951a9d3d","type":"message","text":"so this would be a contrived example","user":"UK1BNFHFV","ts":"1617816695.439700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LHh8w","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so this would be a contrived example"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"type":"message","text":"","files":[{"id":"F01TRMSMTS8","created":1617816704,"timestamp":1617816704,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"UK1BNFHFV","editable":false,"size":231428,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01TRMSMTS8/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01TRMSMTS8/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01TRMSMTS8-ad35a9018a/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01TRMSMTS8-ad35a9018a/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01TRMSMTS8-ad35a9018a/image_360.png","thumb_360_w":360,"thumb_360_h":355,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01TRMSMTS8-ad35a9018a/image_480.png","thumb_480_w":480,"thumb_480_h":473,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01TRMSMTS8-ad35a9018a/image_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01TRMSMTS8-ad35a9018a/image_720.png","thumb_720_w":720,"thumb_720_h":710,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01TRMSMTS8-ad35a9018a/image_800.png","thumb_800_w":800,"thumb_800_h":788,"original_w":828,"original_h":816,"thumb_tiny":"AwAvADDRJxnrQD9aU45pBzQAEmgHnoaX1xQKAEJPpmgfTFL9KB70AIR160AY9aGJoGfTFAARnrQBzSE9eM0qk/3cUAIVzSgYpCT6Uo68DAoAUkUlBXOeKNuD0oAUkUgoK+1Lj2oADSCjbSge2KAP/9k=","permalink":"https://julialang.slack.com/files/UK1BNFHFV/F01TRMSMTS8/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01TRMSMTS8-2b185b828d","is_starred":false,"has_rich_preview":false}],"upload":false,"user":"UK1BNFHFV","display_as_bot":false,"ts":"1617816714.439900","thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"2c5fc281-1149-4e62-be73-76ebe90c4871","type":"message","text":"what's the third `1` at the end for all of the plots?","user":"UBF9YRB6H","ts":"1617816906.440500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zlAY+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what's the third "},{"type":"text","text":"1","style":{"code":true}},{"type":"text","text":" at the end for all of the plots?"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"1FFC1BA0-829D-423D-AFE3-F3C0A822530C","type":"message","text":"Ah that was just careless, I only make a new axis in the first iteration of subgroup","user":"UK1BNFHFV","ts":"1617817454.441300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"q7Tsg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah that was just careless, I only make a new axis in the first iteration of subgroup"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"365C15B9-4C22-458F-8F0A-2BD8504BD791","type":"message","text":"That could be improved, maybe I need a macro so I have access to nested loops somehow. Not everything needs to happen in every inner loop","user":"UK1BNFHFV","ts":"1617817494.442600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DHy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That could be improved, maybe I need a macro so I have access to nested loops somehow. Not everything needs to happen in every inner loop"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"6baee04a-4cf1-40de-9bcd-ea50dcd12f50","type":"message","text":"This is a very nice plot! I appreciate the `facet_wrap`.","user":"UBF9YRB6H","ts":"1617817525.442800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CrBh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is a very nice plot! I appreciate the "},{"type":"text","text":"facet_wrap","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"d4a80ddb-a130-4e7a-b651-26224f8576b5","type":"message","text":"<@UK1BNFHFV> I finally found the time to work on (massively) simplifying AlgebraOfGraphics, and the main function would essentially be a `groupby` optimized for plotting, so it would be something like\n```splitapplyplot(figureOrAxis, data, group, style) do args...\n    # call a modifying plot function like scatter!\n    # here also fitted scales are passed in args\nend```\n","user":"U6BJ9E351","ts":"1617821616.443600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lYXbU","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UK1BNFHFV"},{"type":"text","text":" I finally found the time to work on (massively) simplifying AlgebraOfGraphics, and the main function would essentially be a "},{"type":"text","text":"groupby","style":{"code":true}},{"type":"text","text":" optimized for plotting, so it would be something like\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"splitapplyplot(figureOrAxis, data, group, style) do args...\n    # call a modifying plot function like scatter!\n    # here also fitted scales are passed in args\nend"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"7f53312d-55b9-4ee6-aa77-7f9297a77d60","type":"message","text":"still WIP but should be able to make it public in the next few days (will update here when I do). I think it's the only way forward, so that people can use all the MakieLayout functionality and tweaking in the `do` block, otherwise making it all available from AoG seemed very hard","user":"U6BJ9E351","ts":"1617821699.443800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mJk0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"still WIP but should be able to make it public in the next few days (will update here when I do). I think it's the only way forward, so that people can use all the MakieLayout functionality and tweaking in the "},{"type":"text","text":"do","style":{"code":true}},{"type":"text","text":" block, otherwise making it all available from AoG seemed very hard"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"c3b97f56-7d8d-4b04-b971-f35f68d9b3b0","type":"message","text":"<@UBF9YRB6H> actually it does not depend on DataFrames, StructArrays (already a transitive Makie dependency) has a grouping functionality that I'm using here","user":"U6BJ9E351","ts":"1617821776.444000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xP/Ge","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UBF9YRB6H"},{"type":"text","text":" actually it does not depend on DataFrames, StructArrays (already a transitive Makie dependency) has a grouping functionality that I'm using here"}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"},{"client_msg_id":"2ff4b7ce-6478-4d59-92ed-1b8d073ac7ab","type":"message","text":"ah very cool.","user":"UBF9YRB6H","ts":"1617821797.444200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Hrj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ah very cool."}]}]}],"thread_ts":"1617812584.435900","parent_user_id":"UK1BNFHFV"}]