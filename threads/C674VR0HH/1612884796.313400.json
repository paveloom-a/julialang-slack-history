[{"client_msg_id":"f41e1d2e-929a-41c7-a4c6-3eeb419baa0f","type":"message","text":"What's the most efficient way of filtering a DataFrame based on an existing BitVector? E.g. take the example from the docstring `filter!([:x, :y] =&gt; (x, y) -&gt; x == 1 || y == \"b\", df)`, but I've already computed the vector `(df.x .== 1) .| (df.y .== \"b\")` separately","user":"U7JQGPGCQ","ts":"1612884796.313400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OJGkN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What's the most efficient way of filtering a DataFrame based on an existing BitVector? E.g. take the example from the docstring "},{"type":"text","text":"filter!([:x, :y] => (x, y) -> x == 1 || y == \"b\", df)","style":{"code":true}},{"type":"text","text":", but I've already computed the vector "},{"type":"text","text":"(df.x .== 1) .| (df.y .== \"b\")","style":{"code":true}},{"type":"text","text":" separately"}]}]}],"thread_ts":"1612884796.313400","reply_count":18,"reply_users_count":4,"latest_reply":"1612890445.317600","reply_users":["UBF9YRB6H","U7JQGPGCQ","U8JAMQGQY","U017JTQFNEQ"],"subscribed":false},{"client_msg_id":"7b32aa25-198d-43af-8486-2b81ab83a6f3","type":"message","text":"`index`ing, then, I think.\n\nyou could check out the new `subset` command on `master` also.","user":"UBF9YRB6H","ts":"1612884981.313500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UmfxA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"`index`ing, then, I think.\n\nyou could check out the new "},{"type":"text","text":"subset","style":{"code":true}},{"type":"text","text":" command on "},{"type":"text","text":"master","style":{"code":true}},{"type":"text","text":" also."}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"b2681cb8-1fb4-4998-af44-6e4b5a947608","type":"message","text":"Indexing would allocate I guess?","user":"U7JQGPGCQ","ts":"1612885261.313700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"agj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Indexing would allocate I guess?"}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"c1f779a4-e2d6-4dbd-aef2-f985b839df09","type":"message","text":"both allocate, I think. `filter!` just modifies the `Index` vector-of-vectors. But it doesn't modify the columns in place","user":"UBF9YRB6H","ts":"1612885383.313900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"O18V","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"both allocate, I think. "},{"type":"text","text":"filter!","style":{"code":true}},{"type":"text","text":" just modifies the "},{"type":"text","text":"Index","style":{"code":true}},{"type":"text","text":" vector-of-vectors. But it doesn't modify the columns in place"}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"type":"message","text":"oh yes:","files":[{"id":"F01MHJP2M26","created":1612885539,"timestamp":1612885539,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"U7JQGPGCQ","editable":false,"size":27546,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01MHJP2M26/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01MHJP2M26/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01MHJP2M26-6b7e4774b0/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01MHJP2M26-6b7e4774b0/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01MHJP2M26-6b7e4774b0/image_360.png","thumb_360_w":360,"thumb_360_h":214,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01MHJP2M26-6b7e4774b0/image_480.png","thumb_480_w":480,"thumb_480_h":285,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01MHJP2M26-6b7e4774b0/image_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01MHJP2M26-6b7e4774b0/image_720.png","thumb_720_w":720,"thumb_720_h":428,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01MHJP2M26-6b7e4774b0/image_800.png","thumb_800_w":800,"thumb_800_h":475,"thumb_960":"https://files.slack.com/files-tmb/T68168MUP-F01MHJP2M26-6b7e4774b0/image_960.png","thumb_960_w":960,"thumb_960_h":570,"thumb_1024":"https://files.slack.com/files-tmb/T68168MUP-F01MHJP2M26-6b7e4774b0/image_1024.png","thumb_1024_w":1024,"thumb_1024_h":608,"original_w":1197,"original_h":711,"thumb_tiny":"AwAcADDSAxS0UmaAFopM0lADqQmkooAKKbuOe1OByPwoAKKUdKXAoAbRinYFFAH/2Q==","permalink":"https://julialang.slack.com/files/U7JQGPGCQ/F01MHJP2M26/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01MHJP2M26-37435ffeee","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"yvjax","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh yes:"}]}]}],"user":"U7JQGPGCQ","display_as_bot":false,"ts":"1612885542.314100","thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"d97f74d0-f45d-4257-b198-ec4498ce67f7","type":"message","text":"try `@view` though","user":"UBF9YRB6H","ts":"1612885632.314500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PL3E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"try "},{"type":"text","text":"@view","style":{"code":true}},{"type":"text","text":" though"}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ","reactions":[{"name":"heavy_check_mark","users":["U7JQGPGCQ"],"count":1}]},{"client_msg_id":"ab24a33e-82d6-403d-94b9-695ea346758f","type":"message","text":"I'm trying to drop 500k rows from a 27m rows x 34 columns df, and it looks like it just maxes out my RAM and then becomes really slow","user":"U7JQGPGCQ","ts":"1612885676.314700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+K8T","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm trying to drop 500k rows from a 27m rows x 34 columns df, and it looks like it just maxes out my RAM and then becomes really slow"}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"1fd8e660-880c-4482-a8b0-91de3a6b951a","type":"message","text":"That is why we provide `@view df[bit_vector, :]`","user":"U8JAMQGQY","ts":"1612885710.314900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UBvv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That is why we provide "},{"type":"text","text":"@view df[bit_vector, :]","style":{"code":true}}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ","reactions":[{"name":"heavy_check_mark","users":["U7JQGPGCQ","U017JTQFNEQ"],"count":2}]},{"client_msg_id":"bf0847ef-3e7c-40f4-bb2a-d2fb6f98dd32","type":"message","text":"```0.142319 seconds (23.77 k allocations: 205.757 MiB, 6.18% gc time, 15.53% compilation time)```","user":"U7JQGPGCQ","ts":"1612885778.315300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1jD4","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"0.142319 seconds (23.77 k allocations: 205.757 MiB, 6.18% gc time, 15.53% compilation time)"}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"15cc2048-686e-4db4-a038-c02b9377c380","type":"message","text":"with `@view`","user":"U7JQGPGCQ","ts":"1612885783.315500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sqhej","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"with "},{"type":"text","text":"@view","style":{"code":true}}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"647196ef-63ff-4086-acd2-361f3ea7ab23","type":"message","text":"that's good, right?","user":"UBF9YRB6H","ts":"1612885807.315700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lVjSw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's good, right?"}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"db53ad54-7b06-4897-8cd4-506f90fdb216","type":"message","text":"yes that's brilliant - before it was more like \"interrupt after 10 minutes as my RAM is maxed out and nothing seems to be happening\"","user":"U7JQGPGCQ","ts":"1612885885.315900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/dG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yes that's brilliant - before it was more like \"interrupt after 10 minutes as my RAM is maxed out and nothing seems to be happening\""}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"4b5569b2-3373-4ea4-bd43-c7ec9fcf5d2e","type":"message","text":"so 0.1 seconds is quite the speedup :slightly_smiling_face:","user":"U7JQGPGCQ","ts":"1612885893.316100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"a4y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so 0.1 seconds is quite the speedup "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"ebfaa3b7-24a8-4f4b-a9b6-27bac1d7c2a8","type":"message","text":"Are there any issues with sequential application of this? E.g.\n```df = @view df[condition1, :];\ndf = @view df[condition2, :]```\nthis should be fine, right? As in, this would be the same as `@view df[condition1 .&amp; condition2, :]`, right?","user":"U7JQGPGCQ","ts":"1612886264.316300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0oWUJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Are there any issues with sequential application of this? E.g.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"df = @view df[condition1, :];\ndf = @view df[condition2, :]"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"this should be fine, right? As in, this would be the same as "},{"type":"text","text":"@view df[condition1 .& condition2, :]","style":{"code":true}},{"type":"text","text":", right?"}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"e8f72d78-a9f1-4281-bd76-01265e650f9c","type":"message","text":"I don’t think it is the same. you are eliminating rows each time.","user":"U017JTQFNEQ","ts":"1612888866.316600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"emW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don’t think it is the same. you are eliminating rows each time."}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"2b9aa631-9254-4bfe-9ce5-0c242d3c5aa0","type":"message","text":"Also do you really want to eliminate your access to the original data by re-using `df`?","user":"U017JTQFNEQ","ts":"1612889051.316800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"alXr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also do you really want to eliminate your access to the original data by re-using "},{"type":"text","text":"df","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"2ba7eed0-dfb3-4230-a99f-a7cc9995e0fd","type":"message","text":"oh, i guess you do, since you were using `filter!`. But in any case do `df = @view df[c1 .&amp; c2,:]`","user":"U017JTQFNEQ","ts":"1612889105.317000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"U+rv6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh, i guess you do, since you were using "},{"type":"text","text":"filter!","style":{"code":true}},{"type":"text","text":". But in any case do "},{"type":"text","text":"df = @view df[c1 .& c2,:]","style":{"code":true}}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"2402f6c2-d918-40f1-98ce-d7842b54bec0","type":"message","text":"Sequential `@view` is fine, but as <@U017JTQFNEQ> commented the second one will work on the filtered `SubDataFrame`. So it will be rather that `c2[c1]` should be run on a view to get an equivalent of `c1 .&amp; c2`  (but `c1 .&amp; c2` will be faster). Note that when you reduce `df` to a small data frame (that would fit in the memory) you can materialize it using `copy` (as materializing might speed up some operations on it)","user":"U8JAMQGQY","ts":"1612890202.317400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iPD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Sequential "},{"type":"text","text":"@view","style":{"code":true}},{"type":"text","text":" is fine, but as "},{"type":"user","user_id":"U017JTQFNEQ"},{"type":"text","text":" commented the second one will work on the filtered "},{"type":"text","text":"SubDataFrame","style":{"code":true}},{"type":"text","text":". So it will be rather that "},{"type":"text","text":"c2[c1]","style":{"code":true}},{"type":"text","text":" should be run on a view to get an equivalent of "},{"type":"text","text":"c1 .& c2","style":{"code":true}},{"type":"text","text":"  (but "},{"type":"text","text":"c1 .& c2","style":{"code":true}},{"type":"text","text":" will be faster). Note that when you reduce "},{"type":"text","text":"df","style":{"code":true}},{"type":"text","text":" to a small data frame (that would fit in the memory) you can materialize it using "},{"type":"text","text":"copy","style":{"code":true}},{"type":"text","text":" (as materializing might speed up some operations on it)"}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"},{"client_msg_id":"97e694ec-fc36-4da3-b6fe-379895def84e","type":"message","text":"how would `copy` after filtering compare to just doing  `delete!` ?","user":"U017JTQFNEQ","ts":"1612890445.317600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/V1gB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"how would "},{"type":"text","text":"copy","style":{"code":true}},{"type":"text","text":" after filtering compare to just doing  "},{"type":"text","text":"delete!","style":{"code":true}},{"type":"text","text":" ?"}]}]}],"thread_ts":"1612884796.313400","parent_user_id":"U7JQGPGCQ"}]