[{"client_msg_id":"1b85085d-84d6-4c43-972f-95ddce5d4cb8","type":"message","text":"is `mapreduce(DataFrame∘CSV.File, vcat, all_csvs);` the best practice of reading multiple CSV into a single DataFrame?","user":"UH8A351DJ","ts":"1608227930.183700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fWbV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is "},{"type":"text","text":"mapreduce(DataFrame∘CSV.File, vcat, all_csvs);","style":{"code":true}},{"type":"text","text":" the best practice of reading multiple CSV into a single DataFrame?"}]}]}],"thread_ts":"1608227930.183700","reply_count":22,"reply_users_count":6,"latest_reply":"1608243979.194000","reply_users":["UBF9YRB6H","U8JAMQGQY","UH8A351DJ","U681ELA87","UDXST8ARK","U82LX4ACB"],"subscribed":false},{"client_msg_id":"fb88329e-18bf-4d90-9313-a07c975a28e1","type":"message","text":"I believe so, yes","user":"UBF9YRB6H","ts":"1608228273.183800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ujqO3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I believe so, yes"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"3a2f3cd6-220a-4c2c-b853-9e504fcfeb0e","type":"message","text":"it will excessively allocate. I think that currently the recommended pattern is `reduce(vcat, map(DataFrame∘CSV.File, all_csvs))`.","user":"U8JAMQGQY","ts":"1608228600.184000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QYbS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it will excessively allocate. I think that currently the recommended pattern is "},{"type":"text","text":"reduce(vcat, map(DataFrame∘CSV.File, all_csvs))","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ","reactions":[{"name":"point_up","users":["U82LX4ACB"],"count":1}]},{"client_msg_id":"a0f3881b-1ccd-4784-bd1c-348a0945f10a","type":"message","text":"thx!, looks better","user":"UH8A351DJ","ts":"1608229011.184200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RFmm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thx!, looks better"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"type":"message","text":"","files":[{"id":"F01HC0RHLR2","created":1608229011,"timestamp":1608229011,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"UH8A351DJ","editable":false,"size":150025,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01HC0RHLR2/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01HC0RHLR2/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01HC0RHLR2-46b9a4f93a/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01HC0RHLR2-46b9a4f93a/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01HC0RHLR2-46b9a4f93a/image_360.png","thumb_360_w":360,"thumb_360_h":220,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01HC0RHLR2-46b9a4f93a/image_480.png","thumb_480_w":480,"thumb_480_h":293,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01HC0RHLR2-46b9a4f93a/image_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01HC0RHLR2-46b9a4f93a/image_720.png","thumb_720_w":720,"thumb_720_h":439,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01HC0RHLR2-46b9a4f93a/image_800.png","thumb_800_w":800,"thumb_800_h":488,"original_w":944,"original_h":576,"thumb_tiny":"AwAdADCpnjqKM+4/KjPv+lGf9r9KADPHUflRn3FGePvfpRn/AGv0oAM+4pp/Cnf8Cpv40AOx7frRj/Z/WkyPSjI9KAFx/s/rRj2pMj0oyPSgBce1NP40uR6UlAH/2Q==","permalink":"https://julialang.slack.com/files/UH8A351DJ/F01HC0RHLR2/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01HC0RHLR2-39ace4e0ed","is_starred":false,"has_rich_preview":false}],"upload":false,"user":"UH8A351DJ","display_as_bot":false,"ts":"1608229013.184400","thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"FE9C5CFC-D1DD-467B-8500-4B71FF975CEC","type":"message","text":"You could also do: `DataFrame(TableOperations.joinpartitions(Tables.partitions(csv1, csv2)))` where `csvX` are individual CSV.Files","user":"U681ELA87","ts":"1608229541.186900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vG2w","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You could also do: "},{"type":"text","text":"DataFrame(TableOperations.joinpartitions(Tables.partitions(csv1, csv2)))","style":{"code":true}},{"type":"text","text":" where "},{"type":"text","text":"csvX","style":{"code":true}},{"type":"text","text":" are individual CSV.Files"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ","reactions":[{"name":"+1","users":["UCZ7VBGUD","U6A936746"],"count":2}]},{"client_msg_id":"1444dc71-a058-451f-8433-d8fdaf590ef6","type":"message","text":"Maybe also `x -&gt; CSV.read(x, DataFrame`) in the map code to avoid copying cols?","user":"UDXST8ARK","ts":"1608229690.187100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ewN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe also "},{"type":"text","text":"x -> CSV.read(x, DataFrame","style":{"code":true}},{"type":"text","text":") in the map code to avoid copying cols?"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"a86e3318-3964-4c73-a34c-4437d73104aa","type":"message","text":"I think by default cols are not copied already","user":"UH8A351DJ","ts":"1608229704.187300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qJ/pk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think by default cols are not copied already"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"79532161-fbab-46f8-8999-651bdebed73e","type":"message","text":"<@U681ELA87> that gives me back a weird dataframe","user":"UH8A351DJ","ts":"1608229843.188000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EJUv","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U681ELA87"},{"type":"text","text":" that gives me back a weird dataframe"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"6e980abd-1a1d-4d49-9337-6330eb77e8ee","type":"message","text":"instead of `1918093×10 DataFrame` I get back `13×10 DataFrame`","user":"UH8A351DJ","ts":"1608229864.188200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QlSP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"instead of "},{"type":"text","text":"1918093×10 DataFrame","style":{"code":true}},{"type":"text","text":" I get back "},{"type":"text","text":"13×10 DataFrame","style":{"code":true}}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"B4D14A69-4249-4400-81C5-4410DDFDF238","type":"message","text":"Hmmm, are you on latest Tables.jl version? You might try wrapping the `csvX` in a tuple ","user":"U681ELA87","ts":"1608230061.189400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b9iWx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmmm, are you on latest Tables.jl version? You might try wrapping the "},{"type":"text","text":"csvX","style":{"code":true}},{"type":"text","text":" in a tuple "}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"bdc0392c-4148-43df-831b-3a9920de061e","type":"message","text":"wapping in tuple is the same, `Tables v1.2.2`","user":"UH8A351DJ","ts":"1608230315.189600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"S4g","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"wapping in tuple is the same, "},{"type":"text","text":"Tables v1.2.2","style":{"code":true}}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"172aa644-a5e4-4735-93e4-fd96c517a58c","type":"message","text":"welp, that's too many pkgs in 1 time, I will stick with reduce map I guess, it's 1 time cost anyway","user":"UH8A351DJ","ts":"1608230331.189800","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1608230336.000000"},"blocks":[{"type":"rich_text","block_id":"PtCNu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"welp, that's too many pkgs in 1 time, I will stick with reduce map I guess, it's 1 time cost anyway"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"39396989-95ca-4d87-a6e0-b414433e4bdb","type":"message","text":"although, it's a bit weird mapreduce uses 2x memory than reduce map","user":"UH8A351DJ","ts":"1608230348.190100","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1608230351.000000"},"blocks":[{"type":"rich_text","block_id":"T/17r","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"although, it's a bit weird mapreduce uses 2x memory than reduce map"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"459E2AA8-B7E0-4334-AD47-2774914F0AB5","type":"message","text":"Hmmm, I’ll have to take a look when I get back to a computer. Sorry for the hassle ","user":"U681ELA87","ts":"1608231203.191200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1W0F","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmmm, I’ll have to take a look when I get back to a computer. Sorry for the hassle "}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"e9498eeb-61cc-4c01-bb89-5fe352a0c072","type":"message","text":"<@U681ELA87> - why `joinpartitions` would be better than `reduce` over `vcat`?","user":"U8JAMQGQY","ts":"1608231298.191400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xYwPF","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U681ELA87"},{"type":"text","text":" - why "},{"type":"text","text":"joinpartitions","style":{"code":true}},{"type":"text","text":" would be better than "},{"type":"text","text":"reduce","style":{"code":true}},{"type":"text","text":" over "},{"type":"text","text":"vcat","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"92F123DB-FBCB-43CE-B141-929292383CD9","type":"message","text":"It uses `ChainedVector` to lazily boat","user":"U681ELA87","ts":"1608231341.192200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"l2eRQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It uses "},{"type":"text","text":"ChainedVector","style":{"code":true}},{"type":"text","text":" to lazily boat"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"014A8D96-3DE1-49B3-B8B0-F76BD710BA13","type":"message","text":"*vcat ","user":"U681ELA87","ts":"1608231346.192500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gl3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"*vcat "}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"2ca08a94-40e0-416c-8230-5efad55c73e2","type":"message","text":"`reduce` over `vcat` first calculates the size of the target data frame and then populates it - so it does not do any excessive allocations either","user":"U8JAMQGQY","ts":"1608231497.192700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lQPyF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"reduce","style":{"code":true}},{"type":"text","text":" over "},{"type":"text","text":"vcat","style":{"code":true}},{"type":"text","text":" first calculates the size of the target data frame and then populates it - so it does not do any excessive allocations either"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"d2194cf8-8199-4c96-ae69-ade238f04074","type":"message","text":"but mapreduce doesn't have this special route?","user":"UH8A351DJ","ts":"1608231578.192900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NVr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but mapreduce doesn't have this special route?"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"62da4891-f697-48f3-959c-f38acdfd3679","type":"message","text":"no - because in `mapreduce` we cannot dispatch on `AbstractDataFrame` type (as it is created by the `map` part on the go)","user":"U8JAMQGQY","ts":"1608231618.193100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0Dce","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"no - because in "},{"type":"text","text":"mapreduce","style":{"code":true}},{"type":"text","text":" we cannot dispatch on "},{"type":"text","text":"AbstractDataFrame","style":{"code":true}},{"type":"text","text":" type (as it is created by the "},{"type":"text","text":"map","style":{"code":true}},{"type":"text","text":" part on the go)"}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ","reactions":[{"name":"+1","users":["UH8A351DJ","UKG4WF8PJ","UDXST8ARK"],"count":3}]},{"client_msg_id":"e5aabc9a-b92b-4128-b958-9ab44754b18e","type":"message","text":"You can probably do a for loop as well,\n```output = DataFrame() # specs\nfor file in files\n  append!(output, CSV.File(file))\nend```\n","user":"U82LX4ACB","ts":"1608241261.193800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nu6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You can probably do a for loop as well,\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"output = DataFrame() # specs\nfor file in files\n  append!(output, CSV.File(file))\nend"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"},{"client_msg_id":"a29871f2-b0ff-4fbf-abfc-a72eca3d50b4","type":"message","text":"you can but it will be a bit less efficient as `append!` will have to re-allocate vectors.","user":"U8JAMQGQY","ts":"1608243979.194000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HUfkZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can but it will be a bit less efficient as "},{"type":"text","text":"append!","style":{"code":true}},{"type":"text","text":" will have to re-allocate vectors."}]}]}],"thread_ts":"1608227930.183700","parent_user_id":"UH8A351DJ"}]