[{"client_msg_id":"9f48632c-102a-49b0-9c03-6f3e6e6574b4","type":"message","text":"data parallelism question. It seems `ThreadsX.map()` over a `TypedTables.Table(Arrow.Table( ...))` is no faster than normal map. Is this expected because the mmap?","user":"UH8A351DJ","ts":"1615247163.289400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hDO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"data parallelism question. It seems "},{"type":"text","text":"ThreadsX.map()","style":{"code":true}},{"type":"text","text":" over a "},{"type":"text","text":"TypedTables.Table(Arrow.Table( ...))","style":{"code":true}},{"type":"text","text":" is no faster than normal map. Is this expected because the mmap?"}]}]}],"thread_ts":"1615247163.289400","reply_count":12,"reply_users_count":4,"latest_reply":"1615305522.306000","reply_users":["U681ELA87","UH8A351DJ","U6A936746","U67D54KS8"],"subscribed":false},{"client_msg_id":"740cf75c-10e7-4b61-9ce6-607c2a5d63e8","type":"message","text":"What exactly are you mapping over? The rows of a `TypedTable` with Arrow columns?","user":"U681ELA87","ts":"1615247258.289700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iD8R","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What exactly are you mapping over? The rows of a "},{"type":"text","text":"TypedTable","style":{"code":true}},{"type":"text","text":" with Arrow columns?"}]}]}],"thread_ts":"1615247163.289400","parent_user_id":"UH8A351DJ"},{"client_msg_id":"2af714ee-ab72-4b4c-add5-b2645efe773c","type":"message","text":"correct. The task is non-columnar. Is there a way to use multi-threading on a Arrow table?","user":"UH8A351DJ","ts":"1615247431.289900","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615247496.000000"},"blocks":[{"type":"rich_text","block_id":"tuc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"correct. The task is non-columnar. Is there a way to use multi-threading on a Arrow table?"}]}]}],"thread_ts":"1615247163.289400","parent_user_id":"UH8A351DJ"},{"client_msg_id":"1aa6f729-5745-410d-b4b9-9afe904e2130","type":"message","text":"`Arrow.Table` itself can't be used:\n```no method matching halve(::Arrow.Table)```\n(also because I can't access `row.colname` when mapped over)\n `Tables.datavaluerows` doesn't work either","user":"UH8A351DJ","ts":"1615247586.290300","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615247637.000000"},"blocks":[{"type":"rich_text","block_id":"4UMO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Arrow.Table","style":{"code":true}},{"type":"text","text":" itself can't be used:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"no method matching halve(::Arrow.Table)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"(also because I can't access "},{"type":"text","text":"row.colname","style":{"code":true}},{"type":"text","text":" when mapped over)\n "},{"type":"text","text":"Tables.datavaluerows","style":{"code":true}},{"type":"text","text":" doesn't work either"}]}]}],"thread_ts":"1615247163.289400","parent_user_id":"UH8A351DJ"},{"client_msg_id":"8a7208a9-ecf5-450a-8a5d-0bca9dc03285","type":"message","text":"I’m not aware of anything that would prevent multithreaded iteration over rows via TypedTable","user":"U681ELA87","ts":"1615247899.290600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QK5D","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m not aware of anything that would prevent multithreaded iteration over rows via TypedTable"}]}]}],"thread_ts":"1615247163.289400","parent_user_id":"UH8A351DJ"},{"client_msg_id":"a474134b-3079-48a6-984f-d7048f7a27ad","type":"message","text":"I see, maybe I'm RAM bounded","user":"UH8A351DJ","ts":"1615247922.290800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fZNd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I see, maybe I'm RAM bounded"}]}]}],"thread_ts":"1615247163.289400","parent_user_id":"UH8A351DJ"},{"type":"message","text":"yeah, no speed up at all, not sure why I guess","files":[{"id":"F01QGU73VEZ","created":1615248453,"timestamp":1615248453,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"UH8A351DJ","editable":false,"size":13027,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01QGU73VEZ/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01QGU73VEZ/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01QGU73VEZ-486544aa7e/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01QGU73VEZ-486544aa7e/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01QGU73VEZ-486544aa7e/image_360.png","thumb_360_w":360,"thumb_360_h":163,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01QGU73VEZ-486544aa7e/image_160.png","original_w":425,"original_h":193,"thumb_tiny":"AwAVADDSB96Nw9abtOMh2+gxSEEfxt+lAD8gHFGRnHeoxk/xt+lAyf42/MUASAg0bhjNM2t/fb9KXa399v0oAcBxRilHSigAxRiiigAooooA/9k=","permalink":"https://julialang.slack.com/files/UH8A351DJ/F01QGU73VEZ/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01QGU73VEZ-f5a376b6df","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"QKn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, no speed up at all, not sure why I guess"}]}]}],"user":"UH8A351DJ","display_as_bot":false,"ts":"1615248472.291000","thread_ts":"1615247163.289400","parent_user_id":"UH8A351DJ"},{"client_msg_id":"d4eea61d-62d0-4d72-b216-68a7ffc5beb3","type":"message","text":"Did you remember to start with threads turned on?\nCheck `Threads.nthreads()`?","user":"U6A936746","ts":"1615249479.291400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3lrrH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Did you remember to start with threads turned on?\nCheck "},{"type":"text","text":"Threads.nthreads()","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1615247163.289400","parent_user_id":"UH8A351DJ","reactions":[{"name":"+1","users":["UCZ7VBGUD"],"count":1}]},{"client_msg_id":"915fe303-ddec-42c2-a7e6-64cfbc67b877","type":"message","text":"checked, had 28, which was too many, reduced it to 10, still no speed up. (the node has more than 10 physical cpu cores, each can hyperthread)","user":"UH8A351DJ","ts":"1615251456.291700","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615251488.000000"},"blocks":[{"type":"rich_text","block_id":"/bJ7=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"checked, had 28, which was too many, reduced it to 10, still no speed up. (the node has more than 10 physical cpu cores, each can hyperthread)"}]}]}],"thread_ts":"1615247163.289400","parent_user_id":"UH8A351DJ"},{"type":"message","subtype":"thread_broadcast","text":"found part of the problem. I was doing:\n```for id in eachindex(dfc)\n   x = dfc[id]\n   f(x.col1, x.col2)\nend```\ninstant 5x speed up if I do:\n```for id in eachindex(dfc)\n\n   f(dfc.col1[id], dfc.col2[id])\nend```\n","user":"UH8A351DJ","ts":"1615256262.293000","thread_ts":"1615247163.289400","root":{"client_msg_id":"9f48632c-102a-49b0-9c03-6f3e6e6574b4","type":"message","text":"data parallelism question. It seems `ThreadsX.map()` over a `TypedTables.Table(Arrow.Table( ...))` is no faster than normal map. Is this expected because the mmap?","user":"UH8A351DJ","ts":"1615247163.289400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hDO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"data parallelism question. It seems "},{"type":"text","text":"ThreadsX.map()","style":{"code":true}},{"type":"text","text":" over a "},{"type":"text","text":"TypedTables.Table(Arrow.Table( ...))","style":{"code":true}},{"type":"text","text":" is no faster than normal map. Is this expected because the mmap?"}]}]}],"thread_ts":"1615247163.289400","reply_count":12,"reply_users_count":4,"latest_reply":"1615305522.306000","reply_users":["U681ELA87","UH8A351DJ","U6A936746","U67D54KS8"],"subscribed":false},"blocks":[{"type":"rich_text","block_id":"34osq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"found part of the problem. I was doing:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"for id in eachindex(dfc)\n   x = dfc[id]\n   f(x.col1, x.col2)\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"instant 5x speed up if I do:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"for id in eachindex(dfc)\n\n   f(dfc.col1[id], dfc.col2[id])\nend"}]},{"type":"rich_text_section","elements":[]}]}],"client_msg_id":"2db7db31-fe58-4aa5-b258-697740c2aa12"},{"client_msg_id":"c1d66fba-c9e6-474e-99b5-71260bbf6ee1","type":"message","text":"Memory allocation really quickly bottle neck multithreaded code so make sure to measure that and lower it as much as possible.","user":"U67D54KS8","ts":"1615277221.297900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RwSf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Memory allocation really quickly bottle neck multithreaded code so make sure to measure that and lower it as much as possible."}]}]}],"thread_ts":"1615247163.289400","parent_user_id":"UH8A351DJ"},{"client_msg_id":"6a7ae1a8-c08a-4027-80eb-962d1e6c30cc","type":"message","text":"in this case the file itself is huge and there's nothing I can do about it since I can't trim off columns from a Arrow table upon reading it","user":"UH8A351DJ","ts":"1615305109.302000","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615305127.000000"},"blocks":[{"type":"rich_text","block_id":"5sh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"in this case the file itself is huge and there's nothing I can do about it since I can't trim off columns from a Arrow table upon reading it"}]}]}],"thread_ts":"1615247163.289400","parent_user_id":"UH8A351DJ"},{"client_msg_id":"93e37bab-f895-474b-a603-93330fdf3c9b","type":"message","text":"I meant allocations inside the threaded region.","user":"U67D54KS8","ts":"1615305522.306000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hv9WQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I meant allocations inside the threaded region."}]}]}],"thread_ts":"1615247163.289400","parent_user_id":"UH8A351DJ"}]