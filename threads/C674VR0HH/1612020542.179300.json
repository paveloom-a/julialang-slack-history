[{"client_msg_id":"d5d55a6f-1125-434b-b886-d0ddae403736","type":"message","text":"Why do the two functions have very different run times? Shouldn't they compile to the same code?\n```@inbounds function MovingAverage(period, input, output)\n    output[1:(period-1)] .= missing\n    sm = mean(@view input[1:period])\n    output[period] = sm\n    @simd for i in (period+1):lastindex(input)\n        sm += (input[i] - input[i-period]) / period\n        output[i] = sm\n    end\n    return output\nend```\nBenchmarkTools.Trial:\n  memory estimate:  0 bytes\n  allocs estimate:  0\n  --------------\n  minimum time:     536.300 μs (0.00% GC)\n  median time:      605.200 μs (0.00% GC)\n  mean time:        701.222 μs (0.00% GC)\n  maximum time:     3.247 ms (0.00% GC)\n  --------------\n  samples:          7107\n  evals/sample:     1\n\nVS\n```function MovingAverage(period, input, output)\n    @inbounds begin\n        output[1:(period-1)] .= missing\n        sm = mean(@view input[1:period])\n        output[period] = sm\n        @simd for i in (period+1):lastindex(input)\n            sm += (input[i] - input[i-period]) / period\n            output[i] = sm\n        end\n        return output\n    end\nend```\nBenchmarkTools.Trial:\n  memory estimate:  0 bytes\n  allocs estimate:  0\n  --------------\n  minimum time:     308.600 μs (0.00% GC)\n  median time:      320.100 μs (0.00% GC)\n  mean time:        350.521 μs (0.00% GC)\n  maximum time:     2.049 ms (0.00% GC)\n  --------------\n  samples:          10000\n  evals/sample:     1","user":"U019S5MR0EN","ts":"1612020542.179300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"R1R","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Why do the two functions have very different run times? Shouldn't they compile to the same code?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@inbounds function MovingAverage(period, input, output)\n    output[1:(period-1)] .= missing\n    sm = mean(@view input[1:period])\n    output[period] = sm\n    @simd for i in (period+1):lastindex(input)\n        sm += (input[i] - input[i-period]) / period\n        output[i] = sm\n    end\n    return output\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"BenchmarkTools.Trial:\n  memory estimate:  0 bytes\n  allocs estimate:  0\n  --------------\n  minimum time:     536.300 μs (0.00% GC)\n  median time:      605.200 μs (0.00% GC)\n  mean time:        701.222 μs (0.00% GC)\n  maximum time:     3.247 ms (0.00% GC)\n  --------------\n  samples:          7107\n  evals/sample:     1\n\nVS\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function MovingAverage(period, input, output)\n    @inbounds begin\n        output[1:(period-1)] .= missing\n        sm = mean(@view input[1:period])\n        output[period] = sm\n        @simd for i in (period+1):lastindex(input)\n            sm += (input[i] - input[i-period]) / period\n            output[i] = sm\n        end\n        return output\n    end\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"BenchmarkTools.Trial:\n  memory estimate:  0 bytes\n  allocs estimate:  0\n  --------------\n  minimum time:     308.600 μs (0.00% GC)\n  median time:      320.100 μs (0.00% GC)\n  mean time:        350.521 μs (0.00% GC)\n  maximum time:     2.049 ms (0.00% GC)\n  --------------\n  samples:          10000\n  evals/sample:     1"}]}]}],"thread_ts":"1612020542.179300","reply_count":6,"reply_users_count":3,"latest_reply":"1612023692.181800","reply_users":["U67SCG4HG","U019S5MR0EN","UH24GRBLL"],"subscribed":false},{"client_msg_id":"95612cb9-ac8b-4ad7-baa8-97d880c740ca","type":"message","text":"I believe\n```@inbounds function() ... end```\nis a noop.","user":"U67SCG4HG","ts":"1612021083.179800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fYf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I believe\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@inbounds function() ... end"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"is a noop."}]}]}],"thread_ts":"1612020542.179300","parent_user_id":"U019S5MR0EN"},{"client_msg_id":"a111adbf-707e-47c8-b88a-28bb35c0f310","type":"message","text":"```julia&gt; function f()\n           x = [1,2,3]\n           @inbounds x[4]\n       end;\n\njulia&gt; @inbounds function g()\n           x = [1,2,3]\n           x[4]\n       end;\n\njulia&gt; f()\n0\n\njulia&gt; g()\nERROR: BoundsError: attempt to access 3-element Vector{Int64} at index [4]```","user":"U67SCG4HG","ts":"1612021161.180000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CP5","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> function f()\n           x = [1,2,3]\n           @inbounds x[4]\n       end;\n\njulia> @inbounds function g()\n           x = [1,2,3]\n           x[4]\n       end;\n\njulia> f()\n0\n\njulia> g()\nERROR: BoundsError: attempt to access 3-element Vector{Int64} at index [4]"}]}]}],"thread_ts":"1612020542.179300","parent_user_id":"U019S5MR0EN"},{"client_msg_id":"d4ad1fa1-ac47-4bff-bab4-82be17cd7e39","type":"message","text":"Is it correct to assume that doing  `@inbounds function() ... end`  is not the same as doing @inbounds on each relevant line inside the function?","user":"U019S5MR0EN","ts":"1612021418.180400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MFFz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is it correct to assume that doing  "},{"type":"text","text":"@inbounds function() ... end","style":{"code":true}},{"type":"text","text":"  is not the same as doing @inbounds on each relevant line inside the function?"}]}]}],"thread_ts":"1612020542.179300","parent_user_id":"U019S5MR0EN"},{"client_msg_id":"63875a3f-199d-4fbc-afaa-bf5d67fd648c","type":"message","text":"Yes, as you can see in my example, it is doing nothing.","user":"U67SCG4HG","ts":"1612021575.180600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yIBs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, as you can see in my example, it is doing nothing."}]}]}],"thread_ts":"1612020542.179300","parent_user_id":"U019S5MR0EN","reactions":[{"name":"thumbsup_all","users":["U019S5MR0EN"],"count":1}]},{"client_msg_id":"ca06350b-e0b0-420b-a9ad-6f0afc589c11","type":"message","text":"I've asked on internals to see if this is expected:\n<https://julialang.slack.com/archives/C688QKS7Q/p1612021886026900>","user":"U019S5MR0EN","ts":"1612022401.180900","team":"T68168MUP","attachments":[{"from_url":"https://julialang.slack.com/archives/C688QKS7Q/p1612021886026900","fallback":"[January 30th, 2021 7:51 AM] astad.mistry: Is doing nothing when using `@inbounds` before a function expected behavior?\n```julia&gt; function f()\n           x = [1,2,3]\n           @inbounds x[4]\n       end;\njulia&gt; @inbounds function g()\n           x = [1,2,3]\n           x[4]\n       end;\njulia&gt; f()\n0\njulia&gt; g()\nERROR: BoundsError: attempt to access 3-element Vector{Int64} at index [4]```\n","ts":"1612021886.026900","author_id":"U019S5MR0EN","author_subname":"Astad Mistry","channel_id":"C688QKS7Q","channel_name":"internals","is_msg_unfurl":true,"is_thread_root_unfurl":true,"text":"Is doing nothing when using `@inbounds` before a function expected behavior?\n```julia&gt; function f()\n           x = [1,2,3]\n           @inbounds x[4]\n       end;\njulia&gt; @inbounds function g()\n           x = [1,2,3]\n           x[4]\n       end;\njulia&gt; f()\n0\njulia&gt; g()\nERROR: BoundsError: attempt to access 3-element Vector{Int64} at index [4]```\n","author_name":"Astad Mistry","author_link":"https://julialang.slack.com/team/U019S5MR0EN","author_icon":"https://avatars.slack-edge.com/2020-10-05/1430870415296_991c740f67713ed1c1e2_48.jpg","mrkdwn_in":["text"],"id":1,"original_url":"https://julialang.slack.com/archives/C688QKS7Q/p1612021886026900","footer":"Thread in #internals"}],"blocks":[{"type":"rich_text","block_id":"SmmZ2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I've asked on internals to see if this is expected:\n"},{"type":"link","url":"https://julialang.slack.com/archives/C688QKS7Q/p1612021886026900"}]}]}],"thread_ts":"1612020542.179300","parent_user_id":"U019S5MR0EN"},{"client_msg_id":"66680e42-2197-4bf3-b597-01c3a86108aa","type":"message","text":"it's probably sufficient to put the `@inbounds` directly in front of the `@simd`","user":"UH24GRBLL","ts":"1612023692.181800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EPrL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it's probably sufficient to put the "},{"type":"text","text":"@inbounds","style":{"code":true}},{"type":"text","text":" directly in front of the "},{"type":"text","text":"@simd","style":{"code":true}}]}]}],"thread_ts":"1612020542.179300","parent_user_id":"U019S5MR0EN","reactions":[{"name":"thumbsup_all","users":["U019S5MR0EN"],"count":1}]}]