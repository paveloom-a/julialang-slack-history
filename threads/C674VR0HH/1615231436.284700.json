[{"client_msg_id":"7977eeac-3138-4591-916b-6a4d0f77d309","type":"message","text":"<https://github.com/JuliaData/DataFrames.jl/issues/2340> is done and you can use it on `main`. We would appreciate some correctness and performance tests before 1.0 release to make sure all works as expected.","user":"U8JAMQGQY","ts":"1615231436.284700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3S9x","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/JuliaData/DataFrames.jl/issues/2340"},{"type":"text","text":" is done and you can use it on "},{"type":"text","text":"main","style":{"code":true}},{"type":"text","text":". We would appreciate some correctness and performance tests before 1.0 release to make sure all works as expected."}]}]}],"thread_ts":"1615231436.284700","reply_count":43,"reply_users_count":3,"latest_reply":"1615402725.334500","reply_users":["U7JQGPGCQ","U8JAMQGQY","U681ELA87"],"subscribed":false,"reactions":[{"name":"tada","users":["UBF9YRB6H","UFWQ6DP0S","U7PGB5DU3","U6QGE7S86","UCZ7VBGUD","UAVMYR0F4","U66QZ3QF3","U969CNQU9","U6QF223TN"],"count":9},{"name":"10000","users":["U7JQGPGCQ","U6QGE7S86","U66QZ3QF3"],"count":3}]},{"client_msg_id":"ea313920-c820-4fe5-8e46-6d78cc08ec0e","type":"message","text":"I will have to continue a relatively lengthy analysis with quite a few joins of tables between 10 and 30 million rows tomorrow, so this comes in quite handy","user":"U7JQGPGCQ","ts":"1615233353.285300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9dYK2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I will have to continue a relatively lengthy analysis with quite a few joins of tables between 10 and 30 million rows tomorrow, so this comes in quite handy"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY","reactions":[{"name":"heart","users":["U8JAMQGQY"],"count":1}]},{"client_msg_id":"6812b5bb-85b3-4ec8-afc7-f6c2fb0821da","type":"message","text":"Do you think the `master` branch can be deleted? It seems that it still exists and points to version 0.22.1 (took me a while to figure out I wanted `main`...)","user":"U7JQGPGCQ","ts":"1615314601.310100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8Bc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Do you think the "},{"type":"text","text":"master","style":{"code":true}},{"type":"text","text":" branch can be deleted? It seems that it still exists and points to version 0.22.1 (took me a while to figure out I wanted "},{"type":"text","text":"main","style":{"code":true}},{"type":"text","text":"...)"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"type":"message","text":"Hm, at first glance I can't really see a difference:","files":[{"id":"F01QPPB838B","created":1615317995,"timestamp":1615317995,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"U7JQGPGCQ","editable":false,"size":29664,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01QPPB838B/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01QPPB838B/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01QPPB838B-c065dff102/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01QPPB838B-c065dff102/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01QPPB838B-c065dff102/image_360.png","thumb_360_w":360,"thumb_360_h":188,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01QPPB838B-c065dff102/image_480.png","thumb_480_w":480,"thumb_480_h":251,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01QPPB838B-c065dff102/image_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01QPPB838B-c065dff102/image_720.png","thumb_720_w":720,"thumb_720_h":376,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01QPPB838B-c065dff102/image_800.png","thumb_800_w":800,"thumb_800_h":418,"original_w":905,"original_h":473,"thumb_tiny":"AwAZADDT7U35qd1puB60AHzUvzUmB60YHrQAvNAz60YGKBjtigBaZx70+igBnHoaOPQ0+igBo6dKUfTFLRQB/9k=","permalink":"https://julialang.slack.com/files/U7JQGPGCQ/F01QPPB838B/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01QPPB838B-ccaaabdb08","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"4zqy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hm, at first glance I can't really see a difference:"}]}]}],"user":"U7JQGPGCQ","display_as_bot":false,"ts":"1615317998.311300","thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"42344237-8400-470d-92c9-c50b5059adec","type":"message","text":"This is running twice on 0.22.5, then twice on `main` (clearly we are beyond the realm of `@btime` here :slightly_smiling_face: )","user":"U7JQGPGCQ","ts":"1615318034.311700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fCB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is running twice on 0.22.5, then twice on "},{"type":"text","text":"main","style":{"code":true}},{"type":"text","text":" (clearly we are beyond the realm of "},{"type":"text","text":"@btime","style":{"code":true}},{"type":"text","text":" here "},{"type":"emoji","name":"slightly_smiling_face"},{"type":"text","text":" )"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"89008063-da07-46cd-b650-6f8f411940a8","type":"message","text":"But maybe my use case doesn't really benefit from the improvements - I seem to remember that it was mainly beneficial for sorted tables? Here I'm joining two unsorted tables, left table has 18.5m rows, right table has 0.6m rows. There are four timings per batch here as the right table is joined onto the left table four times, using a different column in the left table each time.","user":"U7JQGPGCQ","ts":"1615318124.311900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BXoZr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But maybe my use case doesn't really benefit from the improvements - I seem to remember that it was mainly beneficial for sorted tables? Here I'm joining two unsorted tables, left table has 18.5m rows, right table has 0.6m rows. There are four timings per batch here as the right table is joined onto the left table four times, using a different column in the left table each time."}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"ca2e3fb5-2fec-4c01-8877-19adbec77fea","type":"message","text":"Also there are plenty of missings (&gt;50% for each join) in the left table, with no missings in the right table","user":"U7JQGPGCQ","ts":"1615318164.312100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1VS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also there are plenty of missings (>50% for each join) in the left table, with no missings in the right table"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"83112706-17fb-4e30-b23d-d682e7f5db02","type":"message","text":"I wanted to remove `master` but we cannot now as some legacy things might reference it.","user":"U8JAMQGQY","ts":"1615320507.313900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rQrz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I wanted to remove "},{"type":"text","text":"master","style":{"code":true}},{"type":"text","text":" but we cannot now as some legacy things might reference it."}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"2380441c-661b-4c85-bef6-25abb90d3e32","type":"message","text":"You must have benchmarked `master` not `main` as it is impossible that the number of allocations is the same. Could you recheck please. Thank you!","user":"U8JAMQGQY","ts":"1615320588.314100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"22O","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You must have benchmarked "},{"type":"text","text":"master","style":{"code":true}},{"type":"text","text":" not "},{"type":"text","text":"main","style":{"code":true}},{"type":"text","text":" as it is impossible that the number of allocations is the same. Could you recheck please. Thank you!"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"1bae3021-1b94-44fc-b846-44a072119e42","type":"message","text":"Also just for reproducibility what is the type of columns and do you have duplicates in the right table?","user":"U8JAMQGQY","ts":"1615321568.314300","team":"T68168MUP","edited":{"user":"U8JAMQGQY","ts":"1615321999.000000"},"blocks":[{"type":"rich_text","block_id":"Fbo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also just for reproducibility what is the type of columns and do you have duplicates in the right table?"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"cbad8e56-398f-4591-bd72-7a8d88aa9465","type":"message","text":"I have run a benchmark on `Vector{String}` (which is a worst case for the new algorithm) and I get:\non 0.22.5 (after compilation)\n```julia&gt; df1 = DataFrame(id = string.(1:20*10^6), x=1:20*10^6);\n\njulia&gt; allowmissing!(df1, :id);\n\njulia&gt; df1.id[1:2:end] .= missing;\n\njulia&gt; df2 = DataFrame(id=string.(rand(1:20*10^6, 500_000)), y=1:500_000);\n\njulia&gt; @time leftjoin(df1, df2, on=:id, matchmissing=:equal);\n 26.274402 seconds (228 allocations: 1.988 GiB, 2.58% gc time)```\non `main` (after compilation):\n```julia&gt; df1 = DataFrame(id = string.(1:20*10^6), x=1:20*10^6);\n\njulia&gt; allowmissing!(df1, :id);\n\njulia&gt; df1.id[1:2:end] .= missing;\n\njulia&gt; df2 = DataFrame(id=string.(rand(1:20*10^6, 500_000)), y=1:500_000);\n\njulia&gt; @time leftjoin(df1, df2, on=:id, matchmissing=:equal);\n  2.444262 seconds (253 allocations: 686.812 MiB, 21.19% gc time)```\nbut maybe your data has a different structure?","user":"U8JAMQGQY","ts":"1615322423.314600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gJZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have run a benchmark on "},{"type":"text","text":"Vector{String}","style":{"code":true}},{"type":"text","text":" (which is a worst case for the new algorithm) and I get:\non 0.22.5 (after compilation)\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> df1 = DataFrame(id = string.(1:20*10^6), x=1:20*10^6);\n\njulia> allowmissing!(df1, :id);\n\njulia> df1.id[1:2:end] .= missing;\n\njulia> df2 = DataFrame(id=string.(rand(1:20*10^6, 500_000)), y=1:500_000);\n\njulia> @time leftjoin(df1, df2, on=:id, matchmissing=:equal);\n 26.274402 seconds (228 allocations: 1.988 GiB, 2.58% gc time)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"on "},{"type":"text","text":"main","style":{"code":true}},{"type":"text","text":" (after compilation):\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> df1 = DataFrame(id = string.(1:20*10^6), x=1:20*10^6);\n\njulia> allowmissing!(df1, :id);\n\njulia> df1.id[1:2:end] .= missing;\n\njulia> df2 = DataFrame(id=string.(rand(1:20*10^6, 500_000)), y=1:500_000);\n\njulia> @time leftjoin(df1, df2, on=:id, matchmissing=:equal);\n  2.444262 seconds (253 allocations: 686.812 MiB, 21.19% gc time)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"but maybe your data has a different structure?"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"6c2e9a10-a3be-419d-939b-de4bc7cf9135","type":"message","text":"I will double check","user":"U7JQGPGCQ","ts":"1615323374.314800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cC+I","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I will double check"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY","reactions":[{"name":"+1","users":["U8JAMQGQY"],"count":1}]},{"client_msg_id":"56ba2f9a-c043-45d9-8183-d5be91322330","type":"message","text":"Unfortunately the data is not public","user":"U7JQGPGCQ","ts":"1615323401.315000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"y2Tq4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Unfortunately the data is not public"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"ee9ff941-7fb8-4e2b-b60c-13abdc2ce798","type":"message","text":"Okay <@U8JAMQGQY> you were right in that I must have screwed up the `main` `master` thing earlier - I've now benchmarked again and am indeed getting different allocation numbers. Unfortunately, there is not a uniform decrease in allocations, and in some cases there's quite an increase which overall leads to a significant performance regression for my use case. You will also see that the timings are quite variable though from run to run, so I'm not sure what to make of it (but clearly a script which runs for 5-10 minutes is hard to run over and over...)","user":"U7JQGPGCQ","ts":"1615373172.324700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5N6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Okay "},{"type":"user","user_id":"U8JAMQGQY"},{"type":"text","text":" you were right in that I must have screwed up the "},{"type":"text","text":"main","style":{"code":true}},{"type":"text","text":" "},{"type":"text","text":"master","style":{"code":true}},{"type":"text","text":" thing earlier - I've now benchmarked again and am indeed getting different allocation numbers. Unfortunately, there is not a uniform decrease in allocations, and in some cases there's quite an increase which overall leads to a significant performance regression for my use case. You will also see that the timings are quite variable though from run to run, so I'm not sure what to make of it (but clearly a script which runs for 5-10 minutes is hard to run over and over...)"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"2cc3e78b-c25a-4d87-af7e-412116281b15","type":"message","text":"The summary is as follows:\n```SUMMARY - stable 1\n27 seconds (159.41 M allocations: 8.188 GiB, 18.85% gc time, 9.95% compilation time)\n17 seconds (1.61 M allocations: 2.655 GiB, 43.97% gc time, 8.46% compilation time)\n21 seconds (362 allocations: 2.809 GiB, 57.83% gc time)\n38 seconds (382 allocations: 2.709 GiB, 78.45% gc time)\n195 seconds (96.52 M allocations: 9.449 GiB, 53.89% gc time, 0.94% compilation time)\n42 seconds (798.09 k allocations: 3.732 GiB, 81.24% gc time, 1.18% compilation time)\n47 seconds (237.37 k allocations: 3.735 GiB, 84.00% gc time, 0.18% compilation time)\nTotal = 387 seconds\n\nSUMMARY - stable 2\n23 seconds (159.41 M allocations: 8.188 GiB, 15.87% gc time, 8.43% compilation time)\n12 seconds (1.61 M allocations: 2.655 GiB, 44.64% gc time, 6.45% compilation time)\n15 seconds (362 allocations: 2.809 GiB, 56.33% gc time)\n29 seconds (382 allocations: 2.709 GiB, 78.02% gc time)\n137 seconds (112.85 M allocations: 9.937 GiB, 64.42% gc time, 0.79% compilation time)\n50 seconds (797.35 k allocations: 3.732 GiB, 81.69% gc time, 1.14% compilation time)\n90 seconds (254.46 k allocations: 3.736 GiB, 91.71% gc time, 0.13% compilation time\nTotal = 356 seconds\n\nSUMMARY - main run 1\n25 seconds (161.79 M allocations: 7.093 GiB, 29.61% gc time, 18.17% compilation time)\n16 seconds (1.29 M allocations: 1.481 GiB, 72.85% gc time, 5.67% compilation time)\n15 seconds (394 allocations: 1.578 GiB, 76.90% gc time)\n20 seconds (413 allocations: 1.541 GiB, 84.30% gc time)\n358 seconds (127.71 M allocations: 17.706 GiB, 58.23% gc time, 7.30% compilation time)\n30 seconds (534.57 k allocations: 2.382 GiB, 82.66% gc time, 1.47% compilation time)\n68 seconds (156.82 k allocations: 2.400 GiB, 94.29% gc time, 0.18% compilation time)\nTotal = 532 seconds\n\nSUMMARY - main run 2\n25 seconds (161.79 M allocations: 7.093 GiB, 23.42% gc time, 9.13% compilation time)\n  7 seconds (1.29 M allocations: 1.481 GiB, 55.94% gc time, 9.43% compilation time)\n 20 seconds (394 allocations: 1.578 GiB, 82.31% gc time)\n 20 seconds (413 allocations: 1.541 GiB, 84.70% gc time)\n243 seconds (127.71 M allocations: 17.706 GiB, 44.50% gc time, 6.30% compilation time)\n 31 seconds (534.57 k allocations: 2.382 GiB, 82.60% gc time, 1.41% compilation time)\n 67 seconds (156.82 k allocations: 2.400 GiB, 94.51% gc time, 0.19% compilation time)\n Total = 413 seconds```","user":"U7JQGPGCQ","ts":"1615373190.324900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5a+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The summary is as follows:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"SUMMARY - stable 1\n27 seconds (159.41 M allocations: 8.188 GiB, 18.85% gc time, 9.95% compilation time)\n17 seconds (1.61 M allocations: 2.655 GiB, 43.97% gc time, 8.46% compilation time)\n21 seconds (362 allocations: 2.809 GiB, 57.83% gc time)\n38 seconds (382 allocations: 2.709 GiB, 78.45% gc time)\n195 seconds (96.52 M allocations: 9.449 GiB, 53.89% gc time, 0.94% compilation time)\n42 seconds (798.09 k allocations: 3.732 GiB, 81.24% gc time, 1.18% compilation time)\n47 seconds (237.37 k allocations: 3.735 GiB, 84.00% gc time, 0.18% compilation time)\nTotal = 387 seconds\n\nSUMMARY - stable 2\n23 seconds (159.41 M allocations: 8.188 GiB, 15.87% gc time, 8.43% compilation time)\n12 seconds (1.61 M allocations: 2.655 GiB, 44.64% gc time, 6.45% compilation time)\n15 seconds (362 allocations: 2.809 GiB, 56.33% gc time)\n29 seconds (382 allocations: 2.709 GiB, 78.02% gc time)\n137 seconds (112.85 M allocations: 9.937 GiB, 64.42% gc time, 0.79% compilation time)\n50 seconds (797.35 k allocations: 3.732 GiB, 81.69% gc time, 1.14% compilation time)\n90 seconds (254.46 k allocations: 3.736 GiB, 91.71% gc time, 0.13% compilation time\nTotal = 356 seconds\n\nSUMMARY - main run 1\n25 seconds (161.79 M allocations: 7.093 GiB, 29.61% gc time, 18.17% compilation time)\n16 seconds (1.29 M allocations: 1.481 GiB, 72.85% gc time, 5.67% compilation time)\n15 seconds (394 allocations: 1.578 GiB, 76.90% gc time)\n20 seconds (413 allocations: 1.541 GiB, 84.30% gc time)\n358 seconds (127.71 M allocations: 17.706 GiB, 58.23% gc time, 7.30% compilation time)\n30 seconds (534.57 k allocations: 2.382 GiB, 82.66% gc time, 1.47% compilation time)\n68 seconds (156.82 k allocations: 2.400 GiB, 94.29% gc time, 0.18% compilation time)\nTotal = 532 seconds\n\nSUMMARY - main run 2\n25 seconds (161.79 M allocations: 7.093 GiB, 23.42% gc time, 9.13% compilation time)\n  7 seconds (1.29 M allocations: 1.481 GiB, 55.94% gc time, 9.43% compilation time)\n 20 seconds (394 allocations: 1.578 GiB, 82.31% gc time)\n 20 seconds (413 allocations: 1.541 GiB, 84.70% gc time)\n243 seconds (127.71 M allocations: 17.706 GiB, 44.50% gc time, 6.30% compilation time)\n 31 seconds (534.57 k allocations: 2.382 GiB, 82.60% gc time, 1.41% compilation time)\n 67 seconds (156.82 k allocations: 2.400 GiB, 94.51% gc time, 0.19% compilation time)\n Total = 413 seconds"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"3c4ba108-6342-4a7c-9414-4e0ce0b841d8","type":"message","text":"I will post below the full terminal output (removing the Julia welcome print and the output of `Pkg` operations for brevity) so you can see whether I did something funny in the way I derived these numbers. This also includes descriptions of each join (sizes of tables, eltypes of join columns, number of missings). The times printed here are just the output of `@time leftjoin(table1, table2, ...)` and should be the same as in the summary above:\n","user":"U7JQGPGCQ","ts":"1615373369.325100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+2H","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I will post below the full terminal output (removing the Julia welcome print and the output of "},{"type":"text","text":"Pkg","style":{"code":true}},{"type":"text","text":" operations for brevity) so you can see whether I did something funny in the way I derived these numbers. This also includes descriptions of each join (sizes of tables, eltypes of join columns, number of missings). The times printed here are just the output of "},{"type":"text","text":"@time leftjoin(table1, table2, ...)","style":{"code":true}},{"type":"text","text":" and should be the same as in the summary above:\n"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"3c4ba108-6342-4a7c-9414-4e0ce0b841d8","type":"message","text":"```C:\\Users\\ngudat&gt;julia\n\n(@v1.6) pkg&gt; activate --temp\n  Activating new environment at `C:\\Users\\ngudat\\AppData\\Local\\Temp\\jl_HXbbjP\\Project.toml`\n\n(jl_HXbbjP) pkg&gt; add Arrow CSV DataFrames;\n\njulia&gt; include(\"C:\\\\Users\\\\ngudat\\\\Desktop\\\\test_joins.jl\")\nJoin: left table (18505941, 6), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666460 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 27 seconds (159.41 M allocations: 8.188 GiB, 18.85% gc time, 9.95% compilation time)\nJoin: left table (18505941, 7), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666359 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 17 seconds (1.61 M allocations: 2.655 GiB, 43.97% gc time, 8.46% compilation time)\nJoin: left table (18505941, 8), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 1968400 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 21 seconds (362 allocations: 2.809 GiB, 57.83% gc time)\nJoin: left table (18505941, 9), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8042612 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 38 seconds (382 allocations: 2.709 GiB, 78.45% gc time)\nJoin: left table (16304796, 7), right table (18368865, 13)\non 2 variables: var1 is String, with 0 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n195 seconds (96.52 M allocations: 9.449 GiB, 53.89% gc time, 0.94% compilation time)\nJoin: left table (16305095, 18), right table (5607, 2)\non 1 variable: var1 is String, with 0 missing left, 0 missing right\n 42 seconds (798.09 k allocations: 3.732 GiB, 81.24% gc time, 1.18% compilation time)\nJoin: left table (16305095, 19), right table (2621, 2)\non 1 variable: var1 is Union{Missing, String}, with 178943 missing left, 0 missing right\n 47 seconds (237.37 k allocations: 3.735 GiB, 84.00% gc time, 0.18% compilation time)\n(16305095, 20)\n\njulia&gt; exit()\n\nC:\\Users\\ngudat&gt;julia\n\n(@v1.6) pkg&gt; activate --temp\n  Activating new environment at `C:\\Users\\ngudat\\AppData\\Local\\Temp\\jl_7WEGfB\\Project.toml`\n\n(jl_7WEGfB) pkg&gt; add Arrow CSV DataFrames\n\njulia&gt; include(\"C:\\\\Users\\\\ngudat\\\\Desktop\\\\test_joins.jl\")\nJoin: left table (18505941, 6), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666460 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 23 seconds (159.41 M allocations: 8.188 GiB, 15.87% gc time, 8.43% compilation time)\nJoin: left table (18505941, 7), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666359 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 12 seconds (1.61 M allocations: 2.655 GiB, 44.64% gc time, 6.45% compilation time)\nJoin: left table (18505941, 8), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 1968400 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 15 seconds (362 allocations: 2.809 GiB, 56.33% gc time)\nJoin: left table (18505941, 9), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8042612 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 29 seconds (382 allocations: 2.709 GiB, 78.02% gc time)\nJoin: left table (16304796, 7), right table (18368865, 13)\non 2 variables: var1 is String, with 0 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n137 seconds (112.85 M allocations: 9.937 GiB, 64.42% gc time, 0.79% compilation time)\nJoin: left table (16305095, 18), right table (5607, 2)\non 1 variable: var1 is String, with 0 missing left, 0 missing right\n 50 seconds (797.35 k allocations: 3.732 GiB, 81.69% gc time, 1.14% compilation time)\nJoin: left table (16305095, 19), right table (2621, 2)\non 1 variable: var1 is Union{Missing, String}, with 178943 missing left, 0 missing right\n 90 seconds (254.46 k allocations: 3.736 GiB, 91.71% gc time, 0.13% compilation time\n(16305095, 20)\n\njulia&gt; exit()\n\nC:\\Users\\ngudat&gt;julia\n\n(@v1.6) pkg&gt; activate --temp\n  Activating new environment at `C:\\Users\\ngudat\\AppData\\Local\\Temp\\jl_OjG0IT\\Project.toml`\n\n(jl_OjG0IT) pkg&gt; add Arrow CSV DataFrames#main\n\njulia&gt; include(\"C:\\\\Users\\\\ngudat\\\\Desktop\\\\test_joins.jl\")\nJoin: left table (18505941, 6), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666460 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 25 seconds (161.79 M allocations: 7.093 GiB, 29.61% gc time, 18.17% compilation time)\nJoin: left table (18505941, 7), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666359 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 16 seconds (1.29 M allocations: 1.481 GiB, 72.85% gc time, 5.67% compilation time)\nJoin: left table (18505941, 8), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 1968400 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 15 seconds (394 allocations: 1.578 GiB, 76.90% gc time)\nJoin: left table (18505941, 9), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8042612 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 20 seconds (413 allocations: 1.541 GiB, 84.30% gc time)\nJoin: left table (16304796, 7), right table (18368865, 13)\non 2 variables: var1 is String, with 0 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n358 seconds (127.71 M allocations: 17.706 GiB, 58.23% gc time, 7.30% compilation time)\nJoin: left table (16305095, 18), right table (5607, 2)\non 1 variable: var1 is String, with 0 missing left, 0 missing right\n 30 seconds (534.57 k allocations: 2.382 GiB, 82.66% gc time, 1.47% compilation time)\nJoin: left table (16305095, 19), right table (2621, 2)\non 1 variable: var1 is Union{Missing, String}, with 178943 missing left, 0 missing right\n 68 seconds (156.82 k allocations: 2.400 GiB, 94.29% gc time, 0.18% compilation time)\n(16305095, 20)\n\njulia&gt; exit()\n\nC:\\Users\\ngudat&gt;julia\n\n(@v1.6) pkg&gt; activate --temp\n  Activating new environment at `C:\\Users\\ngudat\\AppData\\Local\\Temp\\jl_98E88V\\Project.toml`\n\n(jl_98E88V) pkg&gt; add Arrow CSV DataFrames#main\n\njulia&gt; include(\"C:\\\\Users\\\\ngudat\\\\Desktop\\\\test_joins.jl\")\nJoin: left table (18505941, 6), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666460 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 25 seconds (161.79 M allocations: 7.093 GiB, 23.42% gc time, 9.13% compilation time)\nJoin: left table (18505941, 7), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666359 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n  7 seconds (1.29 M allocations: 1.481 GiB, 55.94% gc time, 9.43% compilation time)\nJoin: left table (18505941, 8), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 1968400 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 20 seconds (394 allocations: 1.578 GiB, 82.31% gc time)\nJoin: left table (18505941, 9), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8042612 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 20 seconds (413 allocations: 1.541 GiB, 84.70% gc time)\nJoin: left table (16304796, 7), right table (18368865, 13)\non 2 variables: var1 is String, with 0 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n243 seconds (127.71 M allocations: 17.706 GiB, 44.50% gc time, 6.30% compilation time)\nJoin: left table (16305095, 18), right table (5607, 2)\non 1 variable: var1 is String, with 0 missing left, 0 missing right\n 31 seconds (534.57 k allocations: 2.382 GiB, 82.60% gc time, 1.41% compilation time)\nJoin: left table (16305095, 19), right table (2621, 2)\non 1 variable: var1 is Union{Missing, String}, with 178943 missing left, 0 missing right\n 67 seconds (156.82 k allocations: 2.400 GiB, 94.51% gc time, 0.19% compilation time)\n(16305095, 20)```","user":"U7JQGPGCQ","ts":"1615373369.325300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+2H-8c2m","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"C:\\Users\\ngudat>julia\n\n(@v1.6) pkg> activate --temp\n  Activating new environment at `C:\\Users\\ngudat\\AppData\\Local\\Temp\\jl_HXbbjP\\Project.toml`\n\n(jl_HXbbjP) pkg> add Arrow CSV DataFrames;\n\njulia> include(\"C:\\\\Users\\\\ngudat\\\\Desktop\\\\test_joins.jl\")\nJoin: left table (18505941, 6), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666460 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 27 seconds (159.41 M allocations: 8.188 GiB, 18.85% gc time, 9.95% compilation time)\nJoin: left table (18505941, 7), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666359 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 17 seconds (1.61 M allocations: 2.655 GiB, 43.97% gc time, 8.46% compilation time)\nJoin: left table (18505941, 8), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 1968400 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 21 seconds (362 allocations: 2.809 GiB, 57.83% gc time)\nJoin: left table (18505941, 9), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8042612 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 38 seconds (382 allocations: 2.709 GiB, 78.45% gc time)\nJoin: left table (16304796, 7), right table (18368865, 13)\non 2 variables: var1 is String, with 0 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n195 seconds (96.52 M allocations: 9.449 GiB, 53.89% gc time, 0.94% compilation time)\nJoin: left table (16305095, 18), right table (5607, 2)\non 1 variable: var1 is String, with 0 missing left, 0 missing right\n 42 seconds (798.09 k allocations: 3.732 GiB, 81.24% gc time, 1.18% compilation time)\nJoin: left table (16305095, 19), right table (2621, 2)\non 1 variable: var1 is Union{Missing, String}, with 178943 missing left, 0 missing right\n 47 seconds (237.37 k allocations: 3.735 GiB, 84.00% gc time, 0.18% compilation time)\n(16305095, 20)\n\njulia> exit()\n\nC:\\Users\\ngudat>julia\n\n(@v1.6) pkg> activate --temp\n  Activating new environment at `C:\\Users\\ngudat\\AppData\\Local\\Temp\\jl_7WEGfB\\Project.toml`\n\n(jl_7WEGfB) pkg> add Arrow CSV DataFrames\n\njulia> include(\"C:\\\\Users\\\\ngudat\\\\Desktop\\\\test_joins.jl\")\nJoin: left table (18505941, 6), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666460 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 23 seconds (159.41 M allocations: 8.188 GiB, 15.87% gc time, 8.43% compilation time)\nJoin: left table (18505941, 7), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666359 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 12 seconds (1.61 M allocations: 2.655 GiB, 44.64% gc time, 6.45% compilation time)\nJoin: left table (18505941, 8), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 1968400 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 15 seconds (362 allocations: 2.809 GiB, 56.33% gc time)\nJoin: left table (18505941, 9), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8042612 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 29 seconds (382 allocations: 2.709 GiB, 78.02% gc time)\nJoin: left table (16304796, 7), right table (18368865, 13)\non 2 variables: var1 is String, with 0 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n137 seconds (112.85 M allocations: 9.937 GiB, 64.42% gc time, 0.79% compilation time)\nJoin: left table (16305095, 18), right table (5607, 2)\non 1 variable: var1 is String, with 0 missing left, 0 missing right\n 50 seconds (797.35 k allocations: 3.732 GiB, 81.69% gc time, 1.14% compilation time)\nJoin: left table (16305095, 19), right table (2621, 2)\non 1 variable: var1 is Union{Missing, String}, with 178943 missing left, 0 missing right\n 90 seconds (254.46 k allocations: 3.736 GiB, 91.71% gc time, 0.13% compilation time\n(16305095, 20)\n\njulia> exit()\n\nC:\\Users\\ngudat>julia\n\n(@v1.6) pkg> activate --temp\n  Activating new environment at `C:\\Users\\ngudat\\AppData\\Local\\Temp\\jl_OjG0IT\\Project.toml`\n\n(jl_OjG0IT) pkg> add Arrow CSV DataFrames#main\n\njulia> include(\"C:\\\\Users\\\\ngudat\\\\Desktop\\\\test_joins.jl\")\nJoin: left table (18505941, 6), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666460 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 25 seconds (161.79 M allocations: 7.093 GiB, 29.61% gc time, 18.17% compilation time)\nJoin: left table (18505941, 7), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666359 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 16 seconds (1.29 M allocations: 1.481 GiB, 72.85% gc time, 5.67% compilation time)\nJoin: left table (18505941, 8), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 1968400 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 15 seconds (394 allocations: 1.578 GiB, 76.90% gc time)\nJoin: left table (18505941, 9), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8042612 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 20 seconds (413 allocations: 1.541 GiB, 84.30% gc time)\nJoin: left table (16304796, 7), right table (18368865, 13)\non 2 variables: var1 is String, with 0 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n358 seconds (127.71 M allocations: 17.706 GiB, 58.23% gc time, 7.30% compilation time)\nJoin: left table (16305095, 18), right table (5607, 2)\non 1 variable: var1 is String, with 0 missing left, 0 missing right\n 30 seconds (534.57 k allocations: 2.382 GiB, 82.66% gc time, 1.47% compilation time)\nJoin: left table (16305095, 19), right table (2621, 2)\non 1 variable: var1 is Union{Missing, String}, with 178943 missing left, 0 missing right\n 68 seconds (156.82 k allocations: 2.400 GiB, 94.29% gc time, 0.18% compilation time)\n(16305095, 20)\n\njulia> exit()\n\nC:\\Users\\ngudat>julia\n\n(@v1.6) pkg> activate --temp\n  Activating new environment at `C:\\Users\\ngudat\\AppData\\Local\\Temp\\jl_98E88V\\Project.toml`\n\n(jl_98E88V) pkg> add Arrow CSV DataFrames#main\n\njulia> include(\"C:\\\\Users\\\\ngudat\\\\Desktop\\\\test_joins.jl\")\nJoin: left table (18505941, 6), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666460 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 25 seconds (161.79 M allocations: 7.093 GiB, 23.42% gc time, 9.13% compilation time)\nJoin: left table (18505941, 7), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8666359 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n  7 seconds (1.29 M allocations: 1.481 GiB, 55.94% gc time, 9.43% compilation time)\nJoin: left table (18505941, 8), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 1968400 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 20 seconds (394 allocations: 1.578 GiB, 82.31% gc time)\nJoin: left table (18505941, 9), right table (574811, 3)\non 2 variables: var1 is Union{Missing, String}, with 8042612 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n 20 seconds (413 allocations: 1.541 GiB, 84.70% gc time)\nJoin: left table (16304796, 7), right table (18368865, 13)\non 2 variables: var1 is String, with 0 missing left, 0 missing right\nvar2 is String, with 0 missing left, 0 missing right\n243 seconds (127.71 M allocations: 17.706 GiB, 44.50% gc time, 6.30% compilation time)\nJoin: left table (16305095, 18), right table (5607, 2)\non 1 variable: var1 is String, with 0 missing left, 0 missing right\n 31 seconds (534.57 k allocations: 2.382 GiB, 82.60% gc time, 1.41% compilation time)\nJoin: left table (16305095, 19), right table (2621, 2)\non 1 variable: var1 is Union{Missing, String}, with 178943 missing left, 0 missing right\n 67 seconds (156.82 k allocations: 2.400 GiB, 94.51% gc time, 0.19% compilation time)\n(16305095, 20)"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"04b7e850-98da-4dcc-9191-a64cfa68477a","type":"message","text":"An important question - I see you use Arrow.jl? Is this correct? Do you copy the data before joining or use the Arrow.jl-provided column types? If you use Arrow.jl-provided types could you re-run the tests when you copy them to be non-arrow vectors (just `copy` the data frames). The reason is that maybe the problem is related with Arrow.jl as we have not worked on performance of the types provided by it yet. Thank you! CC <@U681ELA87>","user":"U8JAMQGQY","ts":"1615374068.325500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"B=NRy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"An important question - I see you use Arrow.jl? Is this correct? Do you copy the data before joining or use the Arrow.jl-provided column types? If you use Arrow.jl-provided types could you re-run the tests when you copy them to be non-arrow vectors (just "},{"type":"text","text":"copy","style":{"code":true}},{"type":"text","text":" the data frames). The reason is that maybe the problem is related with Arrow.jl as we have not worked on performance of the types provided by it yet. Thank you! CC "},{"type":"user","user_id":"U681ELA87"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"079d148d-3ed0-4231-8ce0-cc6f58fd259c","type":"message","text":"Your're correct, let me adjust this","user":"U7JQGPGCQ","ts":"1615377927.325700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=0sqz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Your're correct, let me adjust this"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"572df238-4120-4506-b61d-cbeb25e2783c","type":"message","text":"Is `DataFrame(Arrow.Table(\"data.arrow\"), copycols = true)` the same as `copy(DataFrame(Arrow.Table(\"data.arrow\"))`?","user":"U7JQGPGCQ","ts":"1615378274.325900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"79Z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is "},{"type":"text","text":"DataFrame(Arrow.Table(\"data.arrow\"), copycols = true)","style":{"code":true}},{"type":"text","text":" the same as "},{"type":"text","text":"copy(DataFrame(Arrow.Table(\"data.arrow\"))","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"85f6a1c8-a8e5-4a9c-89d5-0a74d3b00da2","type":"message","text":"The other thing to note is that this is one long script which basically maxes out my memory after the second join already, so presumably I'm going to swap a lot when running the whole thing","user":"U7JQGPGCQ","ts":"1615378579.326200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"86pZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The other thing to note is that this is one long script which basically maxes out my memory after the second join already, so presumably I'm going to swap a lot when running the whole thing"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"8a279a4e-4e37-41b2-9ae8-8911a3567d0f","type":"message","text":"No luck unfortunately:\n```SUMMARY - main run 3 (copy Arrow table)\n 18 seconds (3.97 M allocations: 2.392 GiB, 56.19% gc time, 16.19% compilation time)\n 35 seconds (968.12 k allocations: 1.463 GiB, 86.84% gc time, 2.37% compilation time)\n 44 seconds (394 allocations: 1.578 GiB, 89.52% gc time)\n 39 seconds (413 allocations: 1.541 GiB, 90.92% gc time)\n320 seconds (128.18 M allocations: 17.730 GiB, 44.76% gc time, 9.87% compilation time)\n 33 seconds (534.57 k allocations: 2.382 GiB, 83.76% gc time, 1.23% compilation time)\n 76 seconds (156.82 k allocations: 2.400 GiB, 94.98% gc time, 0.17% compilation time)\n\nSUMMARY - main run 4 (copy Arrow table)\n 14 seconds (3.97 M allocations: 2.392 GiB, 58.37% gc time, 14.34% compilation time)\n 28 seconds (968.12 k allocations: 1.463 GiB, 87.58% gc time, 1.91% compilation time)\n 41 seconds (394 allocations: 1.578 GiB, 90.32% gc time)\n 53 seconds (413 allocations: 1.541 GiB, 90.95% gc time)\n458 seconds (128.18 M allocations: 17.730 GiB, 44.61% gc time, 5.76% compilation time)\n 42 seconds (534.57 k allocations: 2.382 GiB, 85.72% gc time, 1.17% compilation time)\n 81 seconds (156.82 k allocations: 2.400 GiB, 94.66% gc time, 0.19% compilation time)```","user":"U7JQGPGCQ","ts":"1615382289.326400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xSV1d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"No luck unfortunately:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"SUMMARY - main run 3 (copy Arrow table)\n 18 seconds (3.97 M allocations: 2.392 GiB, 56.19% gc time, 16.19% compilation time)\n 35 seconds (968.12 k allocations: 1.463 GiB, 86.84% gc time, 2.37% compilation time)\n 44 seconds (394 allocations: 1.578 GiB, 89.52% gc time)\n 39 seconds (413 allocations: 1.541 GiB, 90.92% gc time)\n320 seconds (128.18 M allocations: 17.730 GiB, 44.76% gc time, 9.87% compilation time)\n 33 seconds (534.57 k allocations: 2.382 GiB, 83.76% gc time, 1.23% compilation time)\n 76 seconds (156.82 k allocations: 2.400 GiB, 94.98% gc time, 0.17% compilation time)\n\nSUMMARY - main run 4 (copy Arrow table)\n 14 seconds (3.97 M allocations: 2.392 GiB, 58.37% gc time, 14.34% compilation time)\n 28 seconds (968.12 k allocations: 1.463 GiB, 87.58% gc time, 1.91% compilation time)\n 41 seconds (394 allocations: 1.578 GiB, 90.32% gc time)\n 53 seconds (413 allocations: 1.541 GiB, 90.95% gc time)\n458 seconds (128.18 M allocations: 17.730 GiB, 44.61% gc time, 5.76% compilation time)\n 42 seconds (534.57 k allocations: 2.382 GiB, 85.72% gc time, 1.17% compilation time)\n 81 seconds (156.82 k allocations: 2.400 GiB, 94.66% gc time, 0.19% compilation time)"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"63905586-5572-4be9-8bf6-5ebd7727d168","type":"message","text":"The timings are all over the place though - joins 1-4 and 6-7 are sometimes faster on main and sometimes on stable, plus their relative time within one of the branches is also not the same across runs. The main difference seems to be join 5, which is 16.3m rows left, 18.4m rows right, joined on two string columns (one with strings of length 10-12 which are alll unique, the other one with strings of length either 0 or 3-7, with ~5,000 unique values). This seems to take about 3 minutes on stable, and somewhere between 6 and 8 minutes on main.\n\nActually it turns out on that particularly join I was using a table which I had already read in with `DataFrame(Arrow.Table(...), copycols = true)` so there's no difference in results. The main difference is a much lower allocation count on the first join, presumably because those allocations now occur when the data is `copy`-ed rather than during the `leftjoin`","user":"U7JQGPGCQ","ts":"1615383012.326600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nc=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The timings are all over the place though - joins 1-4 and 6-7 are sometimes faster on main and sometimes on stable, plus their relative time within one of the branches is also not the same across runs. The main difference seems to be join 5, which is 16.3m rows left, 18.4m rows right, joined on two string columns (one with strings of length 10-12 which are alll unique, the other one with strings of length either 0 or 3-7, with ~5,000 unique values). This seems to take about 3 minutes on stable, and somewhere between 6 and 8 minutes on main.\n\nActually it turns out on that particularly join I was using a table which I had already read in with "},{"type":"text","text":"DataFrame(Arrow.Table(...), copycols = true)","style":{"code":true}},{"type":"text","text":" so there's no difference in results. The main difference is a much lower allocation count on the first join, presumably because those allocations now occur when the data is "},{"type":"text","text":"copy","style":{"code":true}},{"type":"text","text":"-ed rather than during the "},{"type":"text","text":"leftjoin","style":{"code":true}}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"184dd2a1-e3a6-4446-9162-a4e7e5b40f90","type":"message","text":"Thank you. I will investigate","user":"U8JAMQGQY","ts":"1615384815.326800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+tWIn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thank you. I will investigate"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"abd328c5-9997-4ef2-a902-c8e34eb8d78e","type":"message","text":"Do let me know if there's anything else I can do to help - `join`s are probably my main productivity bottleneck when working with Julia, so I'm immensely grateful that you and others are working to improve this. While the actual implementation is above my pay grade I'm happy to help in any way I can.","user":"U7JQGPGCQ","ts":"1615385108.327000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Cr0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Do let me know if there's anything else I can do to help - `join`s are probably my main productivity bottleneck when working with Julia, so I'm immensely grateful that you and others are working to improve this. While the actual implementation is above my pay grade I'm happy to help in any way I can."}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"736178d7-0127-4cbb-bb5c-8805cd0ff8ae","type":"message","text":"Actually while we're on the subject, I was wondering why there's no `matchmissing = :ignore` or similar option in `leftjoin`? I.e. an option that essentially just ignores missings in both tables, so that a `leftjoin` ends up with just `missing` in the columns coming from the right table.","user":"U7JQGPGCQ","ts":"1615385190.327200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CYz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Actually while we're on the subject, I was wondering why there's no "},{"type":"text","text":"matchmissing = :ignore","style":{"code":true}},{"type":"text","text":" or similar option in "},{"type":"text","text":"leftjoin","style":{"code":true}},{"type":"text","text":"? I.e. an option that essentially just ignores missings in both tables, so that a "},{"type":"text","text":"leftjoin","style":{"code":true}},{"type":"text","text":" ends up with just "},{"type":"text","text":"missing","style":{"code":true}},{"type":"text","text":" in the columns coming from the right table."}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"fafb9344-7f86-4f46-968d-8e72929543bf","type":"message","text":"Can you open an issue for `matchmissing=:ignore` please? Currently you should do it with `dropmissing` function before doing the join (possibly with `view=true` if you are memory constrained)","user":"U8JAMQGQY","ts":"1615388528.328400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5Py","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Can you open an issue for "},{"type":"text","text":"matchmissing=:ignore","style":{"code":true}},{"type":"text","text":" please? Currently you should do it with "},{"type":"text","text":"dropmissing","style":{"code":true}},{"type":"text","text":" function before doing the join (possibly with "},{"type":"text","text":"view=true","style":{"code":true}},{"type":"text","text":" if you are memory constrained)"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"3808482d-2c05-475b-96ed-6ed25120aee2","type":"message","text":"Also could you please comment if your columns are `Vector` or e.g. `PooledVector` or `CategoricalVector`?","user":"U8JAMQGQY","ts":"1615388638.328600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"n9v73","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also could you please comment if your columns are "},{"type":"text","text":"Vector","style":{"code":true}},{"type":"text","text":" or e.g. "},{"type":"text","text":"PooledVector","style":{"code":true}},{"type":"text","text":" or "},{"type":"text","text":"CategoricalVector","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"24acccf1-012b-4904-95be-e6b3c472ed73","type":"message","text":"I have looked into your timings. They are overwhelmed by GC time. I will try to reproduce your datasets and run them on my machine that has plenty of RAM.","user":"U8JAMQGQY","ts":"1615388787.328800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0hI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have looked into your timings. They are overwhelmed by GC time. I will try to reproduce your datasets and run them on my machine that has plenty of RAM."}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"46779fa0-2ee6-4c81-8abb-3082675ae57b","type":"message","text":"For the first four joins I have on the left:\n```6-element Vector{DataType}:\n SubArray{Union{Missing, String}, 1, Vector{Union{Missing, String}}, Tuple{Vector{Int64}}, false}\n SubArray{String, 1, Vector{String}, Tuple{Vector{Int64}}, false}\n SubArray{Union{Missing, String}, 1, Vector{Union{Missing, String}}, Tuple{Vector{Int64}}, false}\n SubArray{Union{Missing, String}, 1, Vector{Union{Missing, String}}, Tuple{Vector{Int64}}, false}\n SubArray{Union{Missing, String}, 1, Vector{Union{Missing, String}}, Tuple{Vector{Int64}}, false}\n SubArray{Union{Missing, String}, 1, Vector{Union{Missing, String}}, Tuple{Vector{Int64}}, false}```\nand on the right:\n```3-element Vector{DataType}:\n SentinelArrays.ChainedVector{String, Vector{String}}\n SentinelArrays.ChainedVector{String, Vector{String}}\n PooledArrays.PooledVector{String, UInt32, SentinelArrays.ChainedVector{UInt32, Vector{UInt32}}} (alias for PooledArrays.PooledArray{String, UInt32, 1, SentinelArrays.ChainedVector{UInt32, Array{UInt32, 1}}})```","user":"U7JQGPGCQ","ts":"1615389763.329000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"98xj+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For the first four joins I have on the left:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"6-element Vector{DataType}:\n SubArray{Union{Missing, String}, 1, Vector{Union{Missing, String}}, Tuple{Vector{Int64}}, false}\n SubArray{String, 1, Vector{String}, Tuple{Vector{Int64}}, false}\n SubArray{Union{Missing, String}, 1, Vector{Union{Missing, String}}, Tuple{Vector{Int64}}, false}\n SubArray{Union{Missing, String}, 1, Vector{Union{Missing, String}}, Tuple{Vector{Int64}}, false}\n SubArray{Union{Missing, String}, 1, Vector{Union{Missing, String}}, Tuple{Vector{Int64}}, false}\n SubArray{Union{Missing, String}, 1, Vector{Union{Missing, String}}, Tuple{Vector{Int64}}, false}"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"and on the right:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"3-element Vector{DataType}:\n SentinelArrays.ChainedVector{String, Vector{String}}\n SentinelArrays.ChainedVector{String, Vector{String}}\n PooledArrays.PooledVector{String, UInt32, SentinelArrays.ChainedVector{UInt32, Vector{UInt32}}} (alias for PooledArrays.PooledArray{String, UInt32, 1, SentinelArrays.ChainedVector{UInt32, Array{UInt32, 1}}})"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"f180c40f-5fc2-4510-a4c8-6a4dd9c706d9","type":"message","text":"I'm trying to get them for the other join as well but my machine is currently overwhelmed :slightly_smiling_face:","user":"U7JQGPGCQ","ts":"1615389788.329200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dOF2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm trying to get them for the other join as well but my machine is currently overwhelmed "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"1b20b9dc-7849-446e-8aaa-a9b0af58ff53","type":"message","text":"btw I have 24GB of RAM on this machine, so not massive but also not too restricted","user":"U7JQGPGCQ","ts":"1615389841.329400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SB3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"btw I have 24GB of RAM on this machine, so not massive but also not too restricted"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"507c9c59-15eb-4c57-9739-c78c0ff4eec9","type":"message","text":"<https://github.com/JuliaData/DataFrames.jl/issues/2650>","user":"U7JQGPGCQ","ts":"1615390604.329600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4syV","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/JuliaData/DataFrames.jl/issues/2650"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"483b24e3-ae6d-4da1-827b-4b1e3dd1e133","type":"message","text":"The big join (5) has on the left hand side:\n``` SubArray{String, 1, Arrow.List{String, Int32, Vector{UInt8}}, Tuple{Vector{Int64}}, false}\n SubArray{String, 1, Vector{String}, Tuple{Vector{Int64}}, false}```\nwhich is a bit surprising as I created it with `DataFrame(Arrow.Table(), copycols = true)` so I'm not sure why there's still a `Arrow.List` in there?","user":"U7JQGPGCQ","ts":"1615390846.329800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hNcM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The big join (5) has on the left hand side:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":" SubArray{String, 1, Arrow.List{String, Int32, Vector{UInt8}}, Tuple{Vector{Int64}}, false}\n SubArray{String, 1, Vector{String}, Tuple{Vector{Int64}}, false}"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"which is a bit surprising as I created it with "},{"type":"text","text":"DataFrame(Arrow.Table(), copycols = true)","style":{"code":true}},{"type":"text","text":" so I'm not sure why there's still a "},{"type":"text","text":"Arrow.List","style":{"code":true}},{"type":"text","text":" in there?"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"921e64a1-a44b-4329-a842-e56a01308687","type":"message","text":"CC <@U681ELA87>?","user":"U8JAMQGQY","ts":"1615391698.330000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"X2d5k","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"CC "},{"type":"user","user_id":"U681ELA87"},{"type":"text","text":"?"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"da89d7d2-3134-428b-ab44-4f66fa5a15df","type":"message","text":"In general regarding joins performance: when you have shuffled data frames that are `Vector{String}` and have a comparable number of rows the old and new algorithm should be similar (this was the case when the old algorithm was already fast).","user":"U8JAMQGQY","ts":"1615392250.330200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XHGA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"In general regarding joins performance: when you have shuffled data frames that are "},{"type":"text","text":"Vector{String}","style":{"code":true}},{"type":"text","text":" and have a comparable number of rows the old and new algorithm should be similar (this was the case when the old algorithm was already fast)."}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"F93BAC6A-2C14-4742-A6CD-26E4B9E11A40","type":"message","text":"Yeah, I ran into this before. If someone wouldnt mind opening an issue Ill look into it again.","user":"U681ELA87","ts":"1615392400.331100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JhRK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, I ran into this before. If someone wouldnt mind opening an issue Ill look into it again."}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"eb48f727-c5e8-4c16-a712-b5b70b19f43c","type":"message","text":"I have opened <https://github.com/JuliaData/Arrow.jl/issues/146>. <@U7JQGPGCQ> - if you could paste there some tips how to reproduce the problem it would be helpful. Thank you!","user":"U8JAMQGQY","ts":"1615397185.331400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fFw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have opened "},{"type":"link","url":"https://github.com/JuliaData/Arrow.jl/issues/146"},{"type":"text","text":". "},{"type":"user","user_id":"U7JQGPGCQ"},{"type":"text","text":" - if you could paste there some tips how to reproduce the problem it would be helpful. Thank you!"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"c574cf06-2de2-466e-a367-1372d42be6a1","type":"message","text":"I think I know how to reproduce","user":"U681ELA87","ts":"1615397371.331600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"id2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think I know how to reproduce"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY","reactions":[{"name":"+1","users":["U8JAMQGQY"],"count":1}]},{"client_msg_id":"82f0bbea-2b12-4649-a6c3-a8b0b747aa22","type":"message","text":"Unfortunately my data is not public, so I couldn't add that much - all I did was:\n```df = DataFrame(Arrow.Table(\"myfile.arrow\"), copycols = true)\n\ndf.x1 = coalesce.(df.x1, \"\");\n\nmask = (...) # some conditions based on a date column\n\ndf = @view df[mask, :]```\nand the column types posted above are what's in that last `df` after having created the `@view`","user":"U7JQGPGCQ","ts":"1615399056.332100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jmvz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Unfortunately my data is not public, so I couldn't add that much - all I did was:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"df = DataFrame(Arrow.Table(\"myfile.arrow\"), copycols = true)\n\ndf.x1 = coalesce.(df.x1, \"\");\n\nmask = (...) # some conditions based on a date column\n\ndf = @view df[mask, :]"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nand the column types posted above are what's in that last "},{"type":"text","text":"df","style":{"code":true}},{"type":"text","text":" after having created the "},{"type":"text","text":"@view","style":{"code":true}}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"07de00c6-88fc-460a-be2b-dda647485f1f","type":"message","text":"Actually Jacob while I have you here - is there a way to reduce the memory footprint of `Arrow.write`? I just got an `OutOfMemoryError` when doing\n```df = CSV.read(\"myfile.csv\", DataFrame)\n\nArrow.write(\"myfile.arrow\", df)```\nfor a 100m row table (8GB csv file)","user":"U7JQGPGCQ","ts":"1615399225.332300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b9I3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Actually Jacob while I have you here - is there a way to reduce the memory footprint of "},{"type":"text","text":"Arrow.write","style":{"code":true}},{"type":"text","text":"? I just got an "},{"type":"text","text":"OutOfMemoryError","style":{"code":true}},{"type":"text","text":" when doing\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"df = CSV.read(\"myfile.csv\", DataFrame)\n\nArrow.write(\"myfile.arrow\", df)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"for a 100m row table (8GB csv file)"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"78A5631C-7A0E-43A4-A599-BE6115657B7C","type":"message","text":"I have a PR open that allows limiting the number of tasks while writing You might also look into the TableOperations function for partitioning a table so that your table is chunked up when writing","user":"U681ELA87","ts":"1615402462.334100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xogD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have a PR open that allows limiting the number of tasks while writing You might also look into the TableOperations function for partitioning a table so that your table is chunked up when writing"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"5875bb3e-2312-42cc-bf69-074a90771f04","type":"message","text":"Seems to be working now - at least it's been writing for over an hour...","user":"U7JQGPGCQ","ts":"1615402701.334300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"x3Xk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Seems to be working now - at least it's been writing for over an hour..."}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"57ca9c7e-e48b-4dce-a4e4-712955ffb66c","type":"message","text":"Currently written ~7GB of what I assume should be around 8GB at the end, so looks like we'll get there","user":"U7JQGPGCQ","ts":"1615402725.334500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eIMac","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Currently written ~7GB of what I assume should be around 8GB at the end, so looks like we'll get there"}]}]}],"thread_ts":"1615231436.284700","parent_user_id":"U8JAMQGQY"}]