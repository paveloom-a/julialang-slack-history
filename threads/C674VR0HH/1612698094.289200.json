[{"client_msg_id":"377b637a-1e7e-465e-8c40-220a339e1f69","type":"message","text":"Slightly related, I remember that there was a comment on how some \"recyclable machinery\" for this kind of collection lives in the Transducers universe: <https://github.com/JuliaArrays/StructArrays.jl/pull/97#issuecomment-631937452>. It may lose some performance compared to the current implementations, but it is a useful thing to keep in mind to reduce code duplication in the future","user":"U6BJ9E351","ts":"1612698094.289200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DoVS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Slightly related, I remember that there was a comment on how some \"recyclable machinery\" for this kind of collection lives in the Transducers universe: "},{"type":"link","url":"https://github.com/JuliaArrays/StructArrays.jl/pull/97#issuecomment-631937452"},{"type":"text","text":". It may lose some performance compared to the current implementations, but it is a useful thing to keep in mind to reduce code duplication in the future"}]}]}],"thread_ts":"1612698094.289200","reply_count":1,"reply_users_count":1,"latest_reply":"1612698277.290300","reply_users":["U6BJ9E351"],"subscribed":false,"reactions":[{"name":"heavy_check_mark","users":["UKG4WF8PJ","U67431ELR"],"count":2}]},{"client_msg_id":"bdfac784-1567-4d09-a8ab-f54fde93d61c","type":"message","text":"StructArrays also has a similar machinery with minor differences. It does use `promote_typejoin`, but `promote_type` is also reasonable IMO, and it also only reallocates if the promoted type is different than the original.","user":"U6BJ9E351","ts":"1612698277.290300","team":"T68168MUP","edited":{"user":"U6BJ9E351","ts":"1612698287.000000"},"blocks":[{"type":"rich_text","block_id":"q9Fk8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"StructArrays also has a similar machinery with minor differences. It does use "},{"type":"text","text":"promote_typejoin","style":{"code":true}},{"type":"text","text":", but "},{"type":"text","text":"promote_type","style":{"code":true}},{"type":"text","text":" is also reasonable IMO, and it also only reallocates if the promoted type is different than the original."}]}]}],"thread_ts":"1612698094.289200","parent_user_id":"U6BJ9E351"}]