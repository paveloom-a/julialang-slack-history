[{"client_msg_id":"a92ba145-d94a-4a36-9bc9-b0813b2286ad","type":"message","text":"It will try to coerce a column type to a small union if possible and serialize accordingly. Otherwise, it will throw an error","user":"U681ELA87","ts":"1617288430.360000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aT/a","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It will try to coerce a column type to a small union if possible and serialize accordingly. Otherwise, it will throw an error"}]}]}],"thread_ts":"1617288430.360000","reply_count":7,"reply_users_count":2,"latest_reply":"1617311801.369100","reply_users":["U69J94HT9","U681ELA87"],"is_locked":false,"subscribed":false},{"client_msg_id":"964d6b26-20d3-4942-989b-bf374e746279","type":"message","text":"How many different types does it have to see before it gives up and errors?","user":"U69J94HT9","ts":"1617306278.366800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TzMs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How many different types does it have to see before it gives up and errors?"}]}]}],"thread_ts":"1617288430.360000","parent_user_id":"U681ELA87"},{"client_msg_id":"3612ad90-9d2a-4b07-a184-6a04d1bc6223","type":"message","text":"as long as they’re all concrete, there’s currently no limit. it can treat any number of Union eltypes as a `DenseUnion` vector type, as long as they’re concrete.","user":"U681ELA87","ts":"1617306592.367000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uApI9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"as long as they’re all concrete, there’s currently no limit. it can treat any number of Union eltypes as a "},{"type":"text","text":"DenseUnion","style":{"code":true}},{"type":"text","text":" vector type, as long as they’re concrete."}]}]}],"thread_ts":"1617288430.360000","parent_user_id":"U681ELA87"},{"client_msg_id":"befd1553-cfa9-4379-84ab-8d8de87e2206","type":"message","text":"Hmm I'm not sure I understand, since every value has a concrete type. Or do type parameters also need to be concrete?","user":"U69J94HT9","ts":"1617306778.367200","team":"T68168MUP","edited":{"user":"U69J94HT9","ts":"1617306784.000000"},"blocks":[{"type":"rich_text","block_id":"zjhWK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm I'm not sure I understand, since every value has a concrete type. Or do type parameters also need to be concrete?"}]}]}],"thread_ts":"1617288430.360000","parent_user_id":"U681ELA87"},{"client_msg_id":"eb712eaa-8bb6-4af9-9d63-10f387018902","type":"message","text":"Hmm, well it’s a bit tricky, but currently relies on this promotion mechanism:\n```function promoteunion(T, S)\n    new = promote_type(T, S)\n    return new === Any ? Union{T, S} : new\nend```\nWhat we’re trying to balance here is that if, for example, you have `Any[1, 1.0]` that we end up with final eltype of `Float64` instead of `Union{Int, Float64}`, but want to avoid ever getting an “inferred” eltype of, say, `Real` .","user":"U681ELA87","ts":"1617307094.367500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1aD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm, well it’s a bit tricky, but currently relies on this promotion mechanism:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function promoteunion(T, S)\n    new = promote_type(T, S)\n    return new === Any ? Union{T, S} : new\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"What we’re trying to balance here is that if, for example, you have "},{"type":"text","text":"Any[1, 1.0]","style":{"code":true}},{"type":"text","text":" that we end up with final eltype of "},{"type":"text","text":"Float64","style":{"code":true}},{"type":"text","text":" instead of "},{"type":"text","text":"Union{Int, Float64}","style":{"code":true}},{"type":"text","text":", but want to avoid ever getting an “inferred” eltype of, say, "},{"type":"text","text":"Real","style":{"code":true}},{"type":"text","text":" ."}]}]}],"thread_ts":"1617288430.360000","parent_user_id":"U681ELA87"},{"client_msg_id":"f5bdfb05-b7bb-457e-96fd-806e0a141f4b","type":"message","text":"So I think for the majority of cases, we’ll end up with `Union{…}`s that should work fine, but there might be cases where they’ve defined promotion rules that lead to some non-Any abstract type which we would end up erroring on.","user":"U681ELA87","ts":"1617307196.367700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M4S9T","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So I think for the majority of cases, we’ll end up with "},{"type":"text","text":"Union{…}","style":{"code":true}},{"type":"text","text":"s that should work fine, but there might be cases where they’ve defined promotion rules that lead to some non-Any abstract type which we would end up erroring on."}]}]}],"thread_ts":"1617288430.360000","parent_user_id":"U681ELA87"},{"client_msg_id":"25bac68c-12be-42d0-8615-e89e82b30d1d","type":"message","text":"perhaps we should just change that definition to:\n```function promoteunion(T, S)\n    new = promote_type(T, S)\n    return isabstracttype(new) ? Union{T, S} : new\nend```\nsince then we’re avoiding the abstract cases","user":"U681ELA87","ts":"1617307319.367900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"c6Vmz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"perhaps we should just change that definition to:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function promoteunion(T, S)\n    new = promote_type(T, S)\n    return isabstracttype(new) ? Union{T, S} : new\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"since then we’re avoiding the abstract cases"}]}]}],"thread_ts":"1617288430.360000","parent_user_id":"U681ELA87","reactions":[{"name":"+1","users":["U69J94HT9"],"count":1}]},{"client_msg_id":"1b72dd77-7795-47a6-a618-c33ea0a952fe","type":"message","text":"that change would match my intuition and cover more cases I think :slightly_smiling_face:","user":"U69J94HT9","ts":"1617311801.369100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5Us","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that change would match my intuition and cover more cases I think "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617288430.360000","parent_user_id":"U681ELA87"}]