[{"client_msg_id":"d12f6624-f9ba-4ce5-9132-251184c5e92e","type":"message","text":"How can I understand the very considerable differences in performance for `A_ij b_i` (no Einstein sum)?\n\n```function bmul1(A,b)\n  C = zero(A)\n  for j in 1:size(A,1)\n    @simd for i in 1:size(A,2)\n      @inbounds C[i,j] = A[i,j] * b[i]\n    end\n  end\n  return C\nend\n\nbmul2(A,b) = A .* b```\n```A = rand(64,64); b = rand(64)```\n```@btime bmul1($A, $b);\n4.770 μs (2 allocations: 32.08 KiB)```\n```@btime bmul2($A, $b);\n3.286 μs (2 allocations: 32.08 KiB)```\nI tried looking at `@code_typed` but found nothing suspicious!","user":"U01PLQWQXPV","ts":"1617267253.085100","team":"T68168MUP","edited":{"user":"U01PLQWQXPV","ts":"1617270402.000000"},"blocks":[{"type":"rich_text","block_id":"hrf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How can I understand the very considerable differences in performance for "},{"type":"text","text":"A_ij b_i","style":{"code":true}},{"type":"text","text":" (no Einstein sum)?\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function bmul1(A,b)\n  C = zero(A)\n  for j in 1:size(A,1)\n    @simd for i in 1:size(A,2)\n      @inbounds C[i,j] = A[i,j] * b[i]\n    end\n  end\n  return C\nend\n\nbmul2(A,b) = A .* b"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"A = rand(64,64); b = rand(64)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@btime bmul1($A, $b);\n4.770 μs (2 allocations: 32.08 KiB)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@btime bmul2($A, $b);\n3.286 μs (2 allocations: 32.08 KiB)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nI tried looking at "},{"type":"text","text":"@code_typed","style":{"code":true}},{"type":"text","text":" but found nothing suspicious!"}]}]}],"thread_ts":"1617267253.085100","reply_count":2,"reply_users_count":1,"latest_reply":"1617273353.086100","reply_users":["UAUPJLBQX"],"is_locked":false,"subscribed":false},{"client_msg_id":"d1ab4eb8-1a72-48e4-af9b-fae2f754a787","type":"message","text":"Try replacing `zero(A)` with `similar(A)`.","user":"UAUPJLBQX","ts":"1617273298.085900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GtS0d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Try replacing "},{"type":"text","text":"zero(A)","style":{"code":true}},{"type":"text","text":" with "},{"type":"text","text":"similar(A)","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1617267253.085100","parent_user_id":"U01PLQWQXPV"},{"client_msg_id":"d58bf620-1762-461e-bbe2-63097a3c7958","type":"message","text":"Filling your new array with zeros should be nearly as expensive as filling it with `A  .* b`.","user":"UAUPJLBQX","ts":"1617273353.086100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Hcu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Filling your new array with zeros should be nearly as expensive as filling it with "},{"type":"text","text":"A  .* b","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1617267253.085100","parent_user_id":"U01PLQWQXPV"}]