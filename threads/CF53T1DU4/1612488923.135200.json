[{"client_msg_id":"ab941f89-4af2-426c-8e80-03366a3acecd","type":"message","text":"I'm a little puzzled. Here's the output from `--track-allocation=user`  on a particular snippet of mine.\n```    23984     @inbounds for t ∈ 0:Δt:T\n        0         dynamics!(dx, x, params, t)\n        - \n   112112         x[:, :, 2] .+= Δt .* dx[:, :, 2]\n   112112         x[:, :, 1] .+= Δt .* x[:, :, 2] # Symplectic Euler\n        - \n   160160         x[:, reference_idx, 1] .= reference_vals\n   128096         x[:, reference_idx, 2] .= 0\n        -     end```\n`x` and `dx` are `Array{Float64,3} (3, 355, 2)`\n\nHow can I get this code to stop allocating? Clearly I'm missing something besides the broadcasting.","user":"UMC2RHKLZ","ts":"1612488923.135200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fsL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm a little puzzled. Here's the output from "},{"type":"text","text":"--track-allocation=user","style":{"code":true}},{"type":"text","text":"  on a particular snippet of mine.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"    23984     @inbounds for t ∈ 0:Δt:T\n        0         dynamics!(dx, x, params, t)\n        - \n   112112         x[:, :, 2] .+= Δt .* dx[:, :, 2]\n   112112         x[:, :, 1] .+= Δt .* x[:, :, 2] # Symplectic Euler\n        - \n   160160         x[:, reference_idx, 1] .= reference_vals\n   128096         x[:, reference_idx, 2] .= 0\n        -     end"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"dx","style":{"code":true}},{"type":"text","text":" are "},{"type":"text","text":"Array{Float64,3} (3, 355, 2)","style":{"code":true}},{"type":"text","text":"\n\nHow can I get this code to stop allocating? Clearly I'm missing something besides the broadcasting."}]}]}],"thread_ts":"1612488923.135200","reply_count":4,"reply_users_count":2,"latest_reply":"1612494257.135900","reply_users":["U011V2YN59N","UMC2RHKLZ"],"subscribed":false},{"client_msg_id":"8a123485-2651-4665-b2b3-4d3838816be7","type":"message","text":"try adding `@views`","user":"U011V2YN59N","ts":"1612491214.135300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/I/iM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"try adding "},{"type":"text","text":"@views","style":{"code":true}}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"498a4cad-c171-4c4d-b9f8-f17ffdcaa029","type":"message","text":"slices in julia copy by default","user":"U011V2YN59N","ts":"1612491265.135500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TIO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"slices in julia copy by default"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"663bfbb8-6581-439e-b147-e1dea393a12a","type":"message","text":"Unfortunately similar, if I did it right:\n```   129360         @views x[:, :, 2] .+= Δt .* dx[:, :, 2]\n   129360         @views x[:, :, 1] .+= Δt .* x[:, :, 2] # Symplectic Euler\n        - \n    86240         @views x[:, reference_idx, 1] .= reference_vals\n    68992         @views x[:, reference_idx, 2] .= 0```","user":"UMC2RHKLZ","ts":"1612492107.135700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b+VJL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Unfortunately similar, if I did it right:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"   129360         @views x[:, :, 2] .+= Δt .* dx[:, :, 2]\n   129360         @views x[:, :, 1] .+= Δt .* x[:, :, 2] # Symplectic Euler\n        - \n    86240         @views x[:, reference_idx, 1] .= reference_vals\n    68992         @views x[:, reference_idx, 2] .= 0"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"8cdf0a8e-b115-4f92-89c4-87e4d400ba3f","type":"message","text":"it's just `@view` for a single function call, views is used like\n``` @views for row in 1:3\n           b = A[row, :]\n           b[:] .= row\n       end```\nbut that shouldn't affect the results it's just more convenient.\n\nI am not sure how ``--track-allocation=user`  works exactly. Do you still get allocations if you measure with `BenchmarkTools.jl` ?","user":"U011V2YN59N","ts":"1612494257.135900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lat","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it's just "},{"type":"text","text":"@view","style":{"code":true}},{"type":"text","text":" for a single function call, views is used like\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":" @views for row in 1:3\n           b = A[row, :]\n           b[:] .= row\n       end"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nbut that shouldn't affect the results it's just more convenient.\n\nI am not sure how `"},{"type":"text","text":"--track-allocation=user","style":{"code":true}},{"type":"text","text":"  works exactly. Do you still get allocations if you measure with "},{"type":"text","text":"BenchmarkTools.jl","style":{"code":true}},{"type":"text","text":" ?"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"}]