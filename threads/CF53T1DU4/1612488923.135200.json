[{"client_msg_id":"ab941f89-4af2-426c-8e80-03366a3acecd","type":"message","text":"I'm a little puzzled. Here's the output from `--track-allocation=user`  on a particular snippet of mine.\n```    23984     @inbounds for t ∈ 0:Δt:T\n        0         dynamics!(dx, x, params, t)\n        - \n   112112         x[:, :, 2] .+= Δt .* dx[:, :, 2]\n   112112         x[:, :, 1] .+= Δt .* x[:, :, 2] # Symplectic Euler\n        - \n   160160         x[:, reference_idx, 1] .= reference_vals\n   128096         x[:, reference_idx, 2] .= 0\n        -     end```\n`x` and `dx` are `Array{Float64,3} (3, 355, 2)`\n\nHow can I get this code to stop allocating? Clearly I'm missing something besides the broadcasting.","user":"UMC2RHKLZ","ts":"1612488923.135200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fsL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm a little puzzled. Here's the output from "},{"type":"text","text":"--track-allocation=user","style":{"code":true}},{"type":"text","text":"  on a particular snippet of mine.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"    23984     @inbounds for t ∈ 0:Δt:T\n        0         dynamics!(dx, x, params, t)\n        - \n   112112         x[:, :, 2] .+= Δt .* dx[:, :, 2]\n   112112         x[:, :, 1] .+= Δt .* x[:, :, 2] # Symplectic Euler\n        - \n   160160         x[:, reference_idx, 1] .= reference_vals\n   128096         x[:, reference_idx, 2] .= 0\n        -     end"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"dx","style":{"code":true}},{"type":"text","text":" are "},{"type":"text","text":"Array{Float64,3} (3, 355, 2)","style":{"code":true}},{"type":"text","text":"\n\nHow can I get this code to stop allocating? Clearly I'm missing something besides the broadcasting."}]}]}],"thread_ts":"1612488923.135200","reply_count":59,"reply_users_count":3,"latest_reply":"1612512657.147200","reply_users":["U011V2YN59N","UMC2RHKLZ","UH24GRBLL"],"subscribed":false},{"client_msg_id":"8a123485-2651-4665-b2b3-4d3838816be7","type":"message","text":"try adding `@views`","user":"U011V2YN59N","ts":"1612491214.135300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/I/iM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"try adding "},{"type":"text","text":"@views","style":{"code":true}}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"498a4cad-c171-4c4d-b9f8-f17ffdcaa029","type":"message","text":"slices in julia copy by default","user":"U011V2YN59N","ts":"1612491265.135500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TIO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"slices in julia copy by default"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"663bfbb8-6581-439e-b147-e1dea393a12a","type":"message","text":"Unfortunately similar, if I did it right:\n```   129360         @views x[:, :, 2] .+= Δt .* dx[:, :, 2]\n   129360         @views x[:, :, 1] .+= Δt .* x[:, :, 2] # Symplectic Euler\n        - \n    86240         @views x[:, reference_idx, 1] .= reference_vals\n    68992         @views x[:, reference_idx, 2] .= 0```","user":"UMC2RHKLZ","ts":"1612492107.135700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b+VJL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Unfortunately similar, if I did it right:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"   129360         @views x[:, :, 2] .+= Δt .* dx[:, :, 2]\n   129360         @views x[:, :, 1] .+= Δt .* x[:, :, 2] # Symplectic Euler\n        - \n    86240         @views x[:, reference_idx, 1] .= reference_vals\n    68992         @views x[:, reference_idx, 2] .= 0"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"8cdf0a8e-b115-4f92-89c4-87e4d400ba3f","type":"message","text":"it's just `@view` for a single function call, views is used like\n``` @views for row in 1:3\n           b = A[row, :]\n           b[:] .= row\n       end```\nbut that shouldn't affect the results it's just more convenient.\n\nI am not sure how ``--track-allocation=user`  works exactly. Do you still get allocations if you measure with `BenchmarkTools.jl` ?","user":"U011V2YN59N","ts":"1612494257.135900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lat","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it's just "},{"type":"text","text":"@view","style":{"code":true}},{"type":"text","text":" for a single function call, views is used like\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":" @views for row in 1:3\n           b = A[row, :]\n           b[:] .= row\n       end"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nbut that shouldn't affect the results it's just more convenient.\n\nI am not sure how `"},{"type":"text","text":"--track-allocation=user","style":{"code":true}},{"type":"text","text":"  works exactly. Do you still get allocations if you measure with "},{"type":"text","text":"BenchmarkTools.jl","style":{"code":true}},{"type":"text","text":" ?"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"164713ff-8ad3-4c9b-8360-14679db624ed","type":"message","text":"Unfortunately `@btime` also shows the same amount of allocation.\n\nWithout `@views`:\n```  14.213 s (2349684 allocations: 2.09 GiB)```\nWith `@views`:\n```  13.892 s (2349685 allocations: 2.09 GiB)```","user":"UMC2RHKLZ","ts":"1612508057.136100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0tm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Unfortunately "},{"type":"text","text":"@btime","style":{"code":true}},{"type":"text","text":" also shows the same amount of allocation.\n\nWithout "},{"type":"text","text":"@views","style":{"code":true}},{"type":"text","text":":\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"  14.213 s (2349684 allocations: 2.09 GiB)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"With "},{"type":"text","text":"@views","style":{"code":true}},{"type":"text","text":":\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"  13.892 s (2349685 allocations: 2.09 GiB)"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"8fc9715d-a2a9-45bb-8084-1de6711d960e","type":"message","text":"what does `@code_warntype` say?","user":"UH24GRBLL","ts":"1612509825.136300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LXFzU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what does "},{"type":"text","text":"@code_warntype","style":{"code":true}},{"type":"text","text":" say?"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"b9d8cb75-807b-46f6-80e6-f7f2c38d74d9","type":"message","text":"usually if things allocate that shouldn't it's because of some type instability and the dynamic dispatch that occurs because of that","user":"UH24GRBLL","ts":"1612509854.136500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eOS2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"usually if things allocate that shouldn't it's because of some type instability and the dynamic dispatch that occurs because of that"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"2c9b146d-e288-491d-aaee-662abfef136c","type":"message","text":"are dt and T Ints or Floats?","user":"UH24GRBLL","ts":"1612509911.136700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"n+42","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"are dt and T Ints or Floats?"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"20005579-f6c6-45e6-ae37-ac2e64a3af03","type":"message","text":"ahhh","user":"UMC2RHKLZ","ts":"1612510888.136900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=1K","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ahhh"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"1b003854-e630-4803-a8e5-9f6185833c67","type":"message","text":"T is an Int, dt is a float","user":"UMC2RHKLZ","ts":"1612510900.137100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gzAjK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"T is an Int, dt is a float"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"cb3a62b5-528a-46c3-b50d-e12665a4606b","type":"message","text":"what version are you on? I don't remember how the element type of that range is calculated exactly, it may be Union{Int,Float64} even though it's always going to produce Floats","user":"UH24GRBLL","ts":"1612511060.137300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"R1NpV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what version are you on? I don't remember how the element type of that range is calculated exactly, it may be Union{Int,Float64} even though it's always going to produce Floats"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"4323ff2e-b583-451c-a179-1d97c2522b67","type":"message","text":"1.5.3","user":"UMC2RHKLZ","ts":"1612511106.137500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4ax+i","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"1.5.3"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"4b2392ec-e636-4e57-953d-eef570b12ac6","type":"message","text":"does `@code_warntype` show anything out of the ordinary? what's the rest of the function look like?","user":"UH24GRBLL","ts":"1612511108.137700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3OxsY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"does "},{"type":"text","text":"@code_warntype","style":{"code":true}},{"type":"text","text":" show anything out of the ordinary? what's the rest of the function look like?"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"15e1d19e-e749-43e4-bb7d-8ab3a013e9b0","type":"message","text":"i changed T to float64 but it didn't change too much","user":"UMC2RHKLZ","ts":"1612511122.137900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WyEXO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"i changed T to float64 but it didn't change too much"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"0954f791-c7d6-46f1-b35f-6ca064e0b267","type":"message","text":"Checking now  with `@code_warntype`","user":"UMC2RHKLZ","ts":"1612511135.138100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/MXk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Checking now  with "},{"type":"text","text":"@code_warntype","style":{"code":true}}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"038ba991-19c5-4aac-a763-411d27294932","type":"message","text":"are you maybe using global variables for `dx` and `x`?","user":"UH24GRBLL","ts":"1612511172.138300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oym","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"are you maybe using global variables for "},{"type":"text","text":"dx","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"3d324679-e7e1-4b3a-917d-eaae3108668b","type":"message","text":"```function rollout(pose; goal, T::Float64=5.0)\n    x = copy(convert(Array{eltype(pose),3}, reference_state))\n    Δt = sim_params.Δt\n...\n    dx = zero(x)\n...```","user":"UMC2RHKLZ","ts":"1612511274.138500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Cvj8","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function rollout(pose; goal, T::Float64=5.0)\n    x = copy(convert(Array{eltype(pose),3}, reference_state))\n    Δt = sim_params.Δt\n...\n    dx = zero(x)\n..."}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"0378ec9b-5286-4711-9ad4-1d3e162d5424","type":"message","text":"`sim_params` is global","user":"UMC2RHKLZ","ts":"1612511283.138700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"e9Z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"sim_params","style":{"code":true}},{"type":"text","text":" is global"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"73a24bb9-bccd-4bb7-990c-8e7f951b4069","type":"message","text":"the others should be local copies","user":"UMC2RHKLZ","ts":"1612511301.138900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cJiu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the others should be local copies"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"beb1531c-a1cd-4551-8e81-6a9d09cce966","type":"message","text":"and same with dt i imagine since it's a primative","user":"UMC2RHKLZ","ts":"1612511319.139100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"e1c","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and same with dt i imagine since it's a primative"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"866ae13c-83f1-4494-b87c-10fd6aa3aecf","type":"message","text":"if anything shows red in `@code_warntype`, that's bad","user":"UH24GRBLL","ts":"1612511428.139300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2E9Z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if anything shows red in "},{"type":"text","text":"@code_warntype","style":{"code":true}},{"type":"text","text":", that's bad"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"f9fd50ba-de5c-40cd-b4de-256f7b520502","type":"message","text":"I am getting red","user":"UMC2RHKLZ","ts":"1612511444.139500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tjO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I am getting red"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"8aedbc5e-b754-41cc-a7c3-486e518ea417","type":"message","text":"yay","user":"UMC2RHKLZ","ts":"1612511446.139700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PFY+W","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yay"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"fca4a23b-a539-4097-95a7-4d14dda86124","type":"message","text":"how can I use this effectively?","user":"UMC2RHKLZ","ts":"1612511475.139900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qnciH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"how can I use this effectively?"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"76db7a8c-aef2-4ede-a47a-be44f3e84abc","type":"message","text":"ok - just a guess, but is it `dt`, `x`, `dx` that show red?","user":"UH24GRBLL","ts":"1612511478.140100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sXv4W","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ok - just a guess, but is it "},{"type":"text","text":"dt","style":{"code":true}},{"type":"text","text":", "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":", "},{"type":"text","text":"dx","style":{"code":true}},{"type":"text","text":" that show red?"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"e250e2f4-6370-4032-8024-d9e0978e333c","type":"message","text":"I'm clearly not doing something right with code_warntype","user":"UMC2RHKLZ","ts":"1612511494.140300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"L4d=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm clearly not doing something right with code_warntype"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"1416fcbe-6599-4709-b2cc-a00dcf292f0f","type":"message","text":"it seems to only give info about the function call but not recursively descend into the functin","user":"UMC2RHKLZ","ts":"1612511510.140500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8WMs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it seems to only give info about the function call but not recursively descend into the functin"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"fb07918a-f464-4399-b07c-ddfa252ae1f6","type":"message","text":"is `rollout` recursive?","user":"UH24GRBLL","ts":"1612511523.140700","team":"T68168MUP","edited":{"user":"UH24GRBLL","ts":"1612511529.000000"},"blocks":[{"type":"rich_text","block_id":"bqG+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is "},{"type":"text","text":"rollout","style":{"code":true}},{"type":"text","text":" recursive?"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"5b443868-b953-42cb-b766-5985054c7bbd","type":"message","text":"no","user":"UMC2RHKLZ","ts":"1612511539.141000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Vwp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"no"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"45a3ef80-209b-4609-a85d-a2c52195c865","type":"message","text":"it definitely does descend, it might just have stuff inlined into it","user":"UH24GRBLL","ts":"1612511545.141200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"exX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it definitely does descend, it might just have stuff inlined into it"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"de8f3d44-200d-4d40-8119-eab5f7af244d","type":"message","text":"```julia&gt; @code_warntype rollout(zeros(6); goal=zeros(3), T=5.0)\nVariables\n  #unused#::Core.Compiler.Const(var\"#rollout##kw\"(), false)\n  @_2::NamedTuple{(:goal, :T),Tuple{Array{Float64,1},Float64}}\n  @_3::Core.Compiler.Const(rollout, false)\n  pose::Array{Float64,1}\n  goal::Array{Float64,1}\n  T::Float64\n  @_7::Array{Float64,1}\n  @_8::Float64\n\nBody::Any\n1 ─ %1  = Base.haskey(@_2, :goal)::Core.Compiler.Const(true, false)\n│         %1\n│         (@_7 = Base.getindex(@_2, :goal))\n└──       goto #3\n2 ─       Core.Compiler.Const(:(Core.UndefKeywordError(:goal)), false)\n└──       Core.Compiler.Const(:(@_7 = Core.throw(%5)), false)\n3 ┄       (goal = @_7)\n│   %8  = Base.haskey(@_2, :T)::Core.Compiler.Const(true, false)\n│         %8\n│   %10 = Base.getindex(@_2, :T)::Float64\n│   %11 = (%10 isa Main.Float64)::Core.Compiler.Const(true, false)\n│         %11\n└──       goto #5\n4 ─       Core.Compiler.Const(:(%new(Core.TypeError, Symbol(\"keyword argument\"), :T, Main.Float64, %10)), false)\n└──       Core.Compiler.Const(:(Core.throw(%14)), false)\n5 ┄       (@_8 = %10)\n└──       goto #7\n6 ─       Core.Compiler.Const(:(@_8 = 5), false)\n7 ┄       (T = @_8)\n│   %20 = (:goal, :T)::Core.Compiler.Const((:goal, :T), false)\n│   %21 = Core.apply_type(Core.NamedTuple, %20)::Core.Compiler.Const(NamedTuple{(:goal, :T),T} where T&lt;:Tuple, false)\n│   %22 = Base.structdiff(@_2, %21)::Core.Compiler.Const(NamedTuple(), false)\n│   %23 = Base.pairs(%22)::Core.Compiler.Const(Base.Iterators.Pairs{Union{},Union{},Tuple{},NamedTuple{(),Tuple{}}}(), false)\n│   %24 = Base.isempty(%23)::Core.Compiler.Const(true, false)\n│         %24\n└──       goto #9\n8 ─       Core.Compiler.Const(:(Base.kwerr(@_2, @_3, pose)), false)\n9 ┄ %28 = Main.:(var\"#rollout#7\")(goal, T, @_3, pose)::Any\n└──       return %28```","user":"UMC2RHKLZ","ts":"1612511561.141400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eMzb8","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @code_warntype rollout(zeros(6); goal=zeros(3), T=5.0)\nVariables\n  #unused#::Core.Compiler.Const(var\"#rollout##kw\"(), false)\n  @_2::NamedTuple{(:goal, :T),Tuple{Array{Float64,1},Float64}}\n  @_3::Core.Compiler.Const(rollout, false)\n  pose::Array{Float64,1}\n  goal::Array{Float64,1}\n  T::Float64\n  @_7::Array{Float64,1}\n  @_8::Float64\n\nBody::Any\n1 ─ %1  = Base.haskey(@_2, :goal)::Core.Compiler.Const(true, false)\n│         %1\n│         (@_7 = Base.getindex(@_2, :goal))\n└──       goto #3\n2 ─       Core.Compiler.Const(:(Core.UndefKeywordError(:goal)), false)\n└──       Core.Compiler.Const(:(@_7 = Core.throw(%5)), false)\n3 ┄       (goal = @_7)\n│   %8  = Base.haskey(@_2, :T)::Core.Compiler.Const(true, false)\n│         %8\n│   %10 = Base.getindex(@_2, :T)::Float64\n│   %11 = (%10 isa Main.Float64)::Core.Compiler.Const(true, false)\n│         %11\n└──       goto #5\n4 ─       Core.Compiler.Const(:(%new(Core.TypeError, Symbol(\"keyword argument\"), :T, Main.Float64, %10)), false)\n└──       Core.Compiler.Const(:(Core.throw(%14)), false)\n5 ┄       (@_8 = %10)\n└──       goto #7\n6 ─       Core.Compiler.Const(:(@_8 = 5), false)\n7 ┄       (T = @_8)\n│   %20 = (:goal, :T)::Core.Compiler.Const((:goal, :T), false)\n│   %21 = Core.apply_type(Core.NamedTuple, %20)::Core.Compiler.Const(NamedTuple{(:goal, :T),T} where T<:Tuple, false)\n│   %22 = Base.structdiff(@_2, %21)::Core.Compiler.Const(NamedTuple(), false)\n│   %23 = Base.pairs(%22)::Core.Compiler.Const(Base.Iterators.Pairs{Union{},Union{},Tuple{},NamedTuple{(),Tuple{}}}(), false)\n│   %24 = Base.isempty(%23)::Core.Compiler.Const(true, false)\n│         %24\n└──       goto #9\n8 ─       Core.Compiler.Const(:(Base.kwerr(@_2, @_3, pose)), false)\n9 ┄ %28 = Main.:(var\"#rollout#7\")(goal, T, @_3, pose)::Any\n└──       return %28"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"b2a176ce-fadc-4151-be8a-d4bc85d5feaf","type":"message","text":"it looks like the things I care about are all on the last line, none of the variables from the function show up","user":"UMC2RHKLZ","ts":"1612511582.141600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Xraf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it looks like the things I care about are all on the last line, none of the variables from the function show up"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"bbe9fd8c-ac6e-4154-9751-9189f691c1ed","type":"message","text":"i'm assuming i'm not using code_warntype in the right way","user":"UMC2RHKLZ","ts":"1612511600.141800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Jmo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"i'm assuming i'm not using code_warntype in the right way"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"2396ef42-49f7-4b1b-bd55-d8e5006a751a","type":"message","text":"i've never used it before","user":"UMC2RHKLZ","ts":"1612511606.142000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4waAy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"i've never used it before"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"03a7d954-c8fc-435a-a429-86227ce8ed92","type":"message","text":"ah, you've used the keyword version","user":"UH24GRBLL","ts":"1612511631.142200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5A+P","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ah, you've used the keyword version"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"53a0df8c-4de5-49cc-b8ae-d8c63b596a8e","type":"message","text":"if you delete the `;` in the original function definition, you should get better results","user":"UH24GRBLL","ts":"1612511668.142400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ZvNr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if you delete the "},{"type":"text","text":";","style":{"code":true}},{"type":"text","text":" in the original function definition, you should get better results"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"3f62e691-ba74-481b-bb68-f9f0fb594705","type":"message","text":"reason being that keyword arguments don't participate in dispatch (and only get constant propagation in 1.6)","user":"UH24GRBLL","ts":"1612511688.142600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3DVy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"reason being that keyword arguments don't participate in dispatch (and only get constant propagation in 1.6)"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"24b87f11-c173-4c98-96ca-38e225eee925","type":"message","text":"i.e. modify the function head to be like `rollout(pose, goal, T=5.0)` and then use `@code_warntype rollout(zeros(6), zeros(3), 5.0)`","user":"UH24GRBLL","ts":"1612511743.142800","team":"T68168MUP","edited":{"user":"UH24GRBLL","ts":"1612511782.000000"},"blocks":[{"type":"rich_text","block_id":"iQl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"i.e. modify the function head to be like "},{"type":"text","text":"rollout(pose, goal, T=5.0)","style":{"code":true}},{"type":"text","text":" and then use "},{"type":"text","text":"@code_warntype rollout(zeros(6), zeros(3), 5.0)","style":{"code":true}}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"7a344150-b998-455c-bc0c-c1936e65b753","type":"message","text":"the difference being that `goal` and `T` are now positional arguments with default values","user":"UH24GRBLL","ts":"1612511764.143000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YQD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the difference being that "},{"type":"text","text":"goal","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"T","style":{"code":true}},{"type":"text","text":" are now positional arguments with default values"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"f525b965-6d6b-418e-b343-37965658671f","type":"message","text":"yup, very helpful indeed!","user":"UMC2RHKLZ","ts":"1612511797.143300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ObED","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yup, very helpful indeed!"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"a8542bc8-e364-41a4-ad15-ac5831f7e75a","type":"message","text":"should upgrade to 1.6...","user":"UMC2RHKLZ","ts":"1612511806.143500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"coy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"should upgrade to 1.6..."}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"2a030031-e6f6-4404-9753-6bcafbe28401","type":"message","text":"wait for a stable release :)","user":"UH24GRBLL","ts":"1612511813.143700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Xp3O0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"wait for a stable release :)"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"45ad9695-d87a-4eca-be25-bd2547acb001","type":"message","text":"indeed :smile:","user":"UMC2RHKLZ","ts":"1612511832.143900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hQs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"indeed "},{"type":"emoji","name":"smile"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"25529483-276b-4d23-80e9-80b007ca263b","type":"message","text":"ok, this gives me some pointers to debug now","user":"UMC2RHKLZ","ts":"1612511846.144100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=gfs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ok, this gives me some pointers to debug now"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"695de4e4-01c6-4e13-8d00-937530892d9e","type":"message","text":"thanks! I'll post more after trying to resolve the `Any`s here","user":"UMC2RHKLZ","ts":"1612511863.144300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9sD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks! I'll post more after trying to resolve the "},{"type":"text","text":"Any","style":{"code":true}},{"type":"text","text":"s here"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"b52b2ae4-5526-42e1-ab42-d60455687837","type":"message","text":"If my assumption about `x` `dx` and `dt` being `::Any` is correct, the easiest way forward would be to take a look at `sim_parameters` and either explicitly passing them in as an argument or checking where the instability comes from there","user":"UH24GRBLL","ts":"1612511947.144500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uaFk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If my assumption about "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" "},{"type":"text","text":"dx","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"dt","style":{"code":true}},{"type":"text","text":" being "},{"type":"text","text":"::Any","style":{"code":true}},{"type":"text","text":" is correct, the easiest way forward would be to take a look at "},{"type":"text","text":"sim_parameters","style":{"code":true}},{"type":"text","text":" and either explicitly passing them in as an argument or checking where the instability comes from there"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"4e44d3d0-7d23-47c6-ba7d-b8794685b644","type":"message","text":"My guess would be that it's a struct with untyped fields, which default to `::Any`","user":"UH24GRBLL","ts":"1612511969.144700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"T9sD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"My guess would be that it's a struct with untyped fields, which default to "},{"type":"text","text":"::Any","style":{"code":true}}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"097525be-bacf-422e-ae8e-a71342fe9e48","type":"message","text":"ok, i got rid of all the `Any`s","user":"UMC2RHKLZ","ts":"1612512461.144900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/mT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ok, i got rid of all the "},{"type":"text","text":"Any","style":{"code":true}},{"type":"text","text":"s"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"3056087f-58e6-4eed-a78b-c7f04cc0ce53","type":"message","text":"by passing everything in as an argument","user":"UMC2RHKLZ","ts":"1612512469.145100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jol","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"by passing everything in as an argument"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"fbf2fdef-e980-485c-ae59-b18ec08bc75a","type":"message","text":"sim_params has fully specified fields","user":"UMC2RHKLZ","ts":"1612512488.145300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GMv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"sim_params has fully specified fields"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"930b2577-e190-4767-9ef7-c2dbdc58cf7c","type":"message","text":"but every referenced global variable was giving me a red `Any`","user":"UMC2RHKLZ","ts":"1612512504.145500","team":"T68168MUP","edited":{"user":"UMC2RHKLZ","ts":"1612512514.000000"},"blocks":[{"type":"rich_text","block_id":"OK2g","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but every referenced global variable was giving me a red "},{"type":"text","text":"Any","style":{"code":true}}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"2960af61-931f-457c-9c77-08407da57b11","type":"message","text":"is the way around having exploding type signatures like this just to wrap functions in factory functions?","user":"UMC2RHKLZ","ts":"1612512542.145800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UuwA7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is the way around having exploding type signatures like this just to wrap functions in factory functions?"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"40ebdf4a-4858-4c22-b0be-c4dabe69e155","type":"message","text":"use structs and avoid global variables","user":"UH24GRBLL","ts":"1612512554.146000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FF3c","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"use structs and avoid global variables"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"dfe48bba-6aae-4f8c-84bb-1fd8eb8d9a4b","type":"message","text":"in global scope, any variable may (not necessarily will) change type at any time, so each access has to look it up again and again","user":"UH24GRBLL","ts":"1612512599.146200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3mJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"in global scope, any variable may (not necessarily will) change type at any time, so each access has to look it up again and again"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"d9e209e4-d1d7-4f12-90ad-5a8287dc828d","type":"message","text":"gotcha, i thought there was a more sophisticated analysis","user":"UMC2RHKLZ","ts":"1612512624.146400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M09k2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"gotcha, i thought there was a more sophisticated analysis"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"5656acc0-0387-4312-9779-7dee447a724b","type":"message","text":"thanks so much!","user":"UMC2RHKLZ","ts":"1612512634.146600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NP2hC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks so much!"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"e9aa01d1-8677-403f-bd34-1a6cb9ddcdbf","type":"message","text":"this prevents a whole range of optimizations - anything you can get into function arguments doesn't have this limitation","user":"UH24GRBLL","ts":"1612512649.146800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qF/rJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"this prevents a whole range of optimizations - anything you can get into function arguments doesn't have this limitation"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ","reactions":[{"name":"+1","users":["UMC2RHKLZ"],"count":1}]},{"client_msg_id":"f32f34ff-507d-4436-8eb0-ae2918b6107a","type":"message","text":"learning about `@code_warntype` was a big step up for me :slightly_smiling_face: :cake:","user":"UMC2RHKLZ","ts":"1612512650.147000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=jv1d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"learning about "},{"type":"text","text":"@code_warntype","style":{"code":true}},{"type":"text","text":" was a big step up for me "},{"type":"emoji","name":"slightly_smiling_face"},{"type":"text","text":" "},{"type":"emoji","name":"cake"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"},{"client_msg_id":"c0012373-a6c6-4936-bfd9-62d90d1aa83c","type":"message","text":"you're welcome!","user":"UH24GRBLL","ts":"1612512657.147200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zaWU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you're welcome!"}]}]}],"thread_ts":"1612488923.135200","parent_user_id":"UMC2RHKLZ"}]