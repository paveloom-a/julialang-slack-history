[{"client_msg_id":"b4d5e37c-e945-4bf5-ac03-fcd0ab0aae59","type":"message","text":"Is it possible to copy an arbitrary pixel in an file (png) without loading the entire image? I'm trying to speed up the simplified code below where the png image is one in a collection with a total size of 25GB+. I'm open to preprocessing the collection to make it easier to access the pixels\n```for frame = 1:Ntotalframes\n    newimg = copy(preloaded_img)\n    for j = 1:ysize\n        for i = 1:xsize\n            fname, pixelcoords = getDesiredFilenameAndPixelIndex(i, j, frame)\n            newimg[i, j] = load(fname)[pixelcoords[1], pixelcoords[2]]\n        end\n    end\n    newimg_file_name = @sprintf(\"%04d.png\", frame);\n    save(newimg_file_name, newimg)\nend```","user":"U0138UTB7A4","ts":"1616196756.012000","team":"T68168MUP","edited":{"user":"U0138UTB7A4","ts":"1616197210.000000"},"blocks":[{"type":"rich_text","block_id":"M+Dn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is it possible to copy an arbitrary pixel in an file (png) without loading the entire image? I'm trying to speed up the simplified code below where the png image is one in a collection with a total size of 25GB+. I'm open to preprocessing the collection to make it easier to access the pixels\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"for frame = 1:Ntotalframes\n    newimg = copy(preloaded_img)\n    for j = 1:ysize\n        for i = 1:xsize\n            fname, pixelcoords = getDesiredFilenameAndPixelIndex(i, j, frame)\n            newimg[i, j] = load(fname)[pixelcoords[1], pixelcoords[2]]\n        end\n    end\n    newimg_file_name = @sprintf(\"%04d.png\", frame);\n    save(newimg_file_name, newimg)\nend"}]}]}],"thread_ts":"1616196756.012000","reply_count":18,"reply_users_count":3,"latest_reply":"1616982386.051700","reply_users":["U0179G7FG4F","U0138UTB7A4","UPUBAM63X"],"is_locked":false,"subscribed":false},{"client_msg_id":"9cc410e5-4e7a-4ab4-9ab8-940aa774cd51","type":"message","text":"It's possible in general, but I'm not sure if there's a good way to in Julia yet","user":"U0179G7FG4F","ts":"1616197214.013000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jaob","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It's possible in general, but I'm not sure if there's a good way to in Julia yet"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"74c613c4-9c0e-4285-9702-a954a687cd25","type":"message","text":"TIL whats it called in other languages?","user":"U0138UTB7A4","ts":"1616197269.013200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tHZsT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"TIL whats it called in other languages?"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"2e79c1da-e327-4590-9045-9c0f05a17057","type":"message","text":"No idea. I'm just looking at the spec. Compression happens in blocks, so you can find what block you need, then use a lazy reader on the block <https://en.wikipedia.org/wiki/Portable_Network_Graphics#%22Chunks%22_within_the_file>","user":"U0179G7FG4F","ts":"1616197319.013400","team":"T68168MUP","attachments":[{"image_url":"https://upload.wikimedia.org/wikipedia/commons/4/47/PNG_transparency_demonstration_1.png","image_width":800,"image_height":600,"image_bytes":227963,"title":"Portable Network Graphics","title_link":"https://en.wikipedia.org/wiki/Portable_Network_Graphics#%22Chunks%22_within_the_file","from_url":"https://en.wikipedia.org/wiki/Portable_Network_Graphics#%22Chunks%22_within_the_file","author_name":"Wikipedia","author_link":"https://en.wikipedia.org/","text":"Portable Network Graphics (PNG, officially pronounced  PING, more commonly pronounced  PEE-en-JEE) is a raster-graphics file format that supports lossless data compression. PNG was developed as an improved, non-patented replacement for Graphics Interchange Format (GIF).\nPNG supports palette-based images (with palettes of 24-bit RGB or 32-bit RGBA colors), grayscale images (with or without alpha channel for transparency), and full-color non-palette-based RGB or RGBA images. The PNG working group designed the format for transferring images on the Internet, not for professional-quality print graphics; therefore non-RGB color spaces such as CMYK are not supported. A PNG file contains a single image in an extensible structure of chunks, encoding the basic pixels and other information such as textual comments and integrity checks documented in RFC 2083.PNG files use the file extension PNG or png and are assigned MIME media type image/png.\nPNG was published as informational RFC 2083 in March 1997 and as an ISO/IEC 15948 standard in 2004.","fallback":"wikipedia: Portable Network Graphics","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/wikipedia.png","id":1,"original_url":"https://en.wikipedia.org/wiki/Portable_Network_Graphics#%22Chunks%22_within_the_file"}],"blocks":[{"type":"rich_text","block_id":"RlDZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"No idea. I'm just looking at the spec. Compression happens in blocks, so you can find what block you need, then use a lazy reader on the block "},{"type":"link","url":"https://en.wikipedia.org/wiki/Portable_Network_Graphics#%22Chunks%22_within_the_file"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"4429bef9-aede-4546-b8f3-25f87cbefdf5","type":"message","text":"Oh I see what you mean, thank you! I wouldn't be sure how to do that, but good to know that its possible","user":"U0138UTB7A4","ts":"1616197524.013700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"To8p","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh I see what you mean, thank you! I wouldn't be sure how to do that, but good to know that its possible"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"73d2f0e3-981d-4e79-9052-b33b28106f2e","type":"message","text":"Maybe if I saved the entire image collection into one signle HDF5 (or another format), I could easily access single pixel values?","user":"U0138UTB7A4","ts":"1616197789.013900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jRV0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe if I saved the entire image collection into one signle HDF5 (or another format), I could easily access single pixel values?"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"d76c9c86-c10f-4396-9be5-b1e72d4c1ad4","type":"message","text":"<https://stackoverflow.com/questions/6444869/how-do-i-read-pixels-from-a-png-file> seems to suggest that java at least has `BufferedImages`that does this","user":"U0179G7FG4F","ts":"1616197792.014100","team":"T68168MUP","attachments":[{"service_name":"Stack Overflow","title":"How do I read pixels from a PNG file?","title_link":"https://stackoverflow.com/questions/6444869/how-do-i-read-pixels-from-a-png-file","text":"I know how to capture a screenshot by using Robot, Windowtester or FEST. I also know how to read a pixel from the screen by using robot. int x = 10; int y = 10; Color px = getPixelColor(int x, in...","fallback":"Stack Overflow: How do I read pixels from a PNG file?","thumb_url":"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded","from_url":"https://stackoverflow.com/questions/6444869/how-do-i-read-pixels-from-a-png-file","thumb_width":316,"thumb_height":316,"service_icon":"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a","id":1,"original_url":"https://stackoverflow.com/questions/6444869/how-do-i-read-pixels-from-a-png-file"}],"blocks":[{"type":"rich_text","block_id":"6a2","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://stackoverflow.com/questions/6444869/how-do-i-read-pixels-from-a-png-file"},{"type":"text","text":" seems to suggest that java at least has "},{"type":"text","text":"BufferedImages","style":{"code":true}},{"type":"text","text":"that does this"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"9a5bd947-b4ac-41ac-95a7-07d1ea8c88f1","type":"message","text":"you also might just be able to mmap the file which will only load the pages that you requested specifically","user":"U0179G7FG4F","ts":"1616197994.014400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PVi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you also might just be able to mmap the file which will only load the pages that you requested specifically"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"0bacac63-6625-4c57-8096-96166ab789ad","type":"message","text":"Ah thank you for the term `mmap` I didn't know that before. It seems like its leading me more to `HDF5.jl`\n&gt; In practice, consider encoding binary data using standard formats like HDF5 (which can be used with memory-mapping).\n&gt; <https://docs.julialang.org/en/v1/stdlib/Mmap/>","user":"U0138UTB7A4","ts":"1616198096.014600","team":"T68168MUP","edited":{"user":"U0138UTB7A4","ts":"1616198105.000000"},"blocks":[{"type":"rich_text","block_id":"ymeTz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah thank you for the term "},{"type":"text","text":"mmap","style":{"code":true}},{"type":"text","text":" I didn't know that before. It seems like its leading me more to "},{"type":"text","text":"HDF5.jl","style":{"code":true}},{"type":"text","text":"\n"}]},{"type":"rich_text_quote","elements":[{"type":"text","text":"In practice, consider encoding binary data using standard formats like HDF5 (which can be used with memory-mapping).\n"},{"type":"link","url":"https://docs.julialang.org/en/v1/stdlib/Mmap/"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4","reactions":[{"name":"thumbsup_all","users":["U0179G7FG4F"],"count":1}]},{"client_msg_id":"a1f6b53c-bb66-4f72-b31d-d6c459a55834","type":"message","text":"Thank you so much! This gives me some things to try","user":"U0138UTB7A4","ts":"1616198162.015000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Gef0b","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thank you so much! This gives me some things to try"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"4e2a8963-4dc2-474a-9bf8-f58c8498488d","type":"message","text":"e.g <https://juliaio.github.io/HDF5.jl/stable/#Memory-mapping>","user":"U0138UTB7A4","ts":"1616198230.015200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cFu=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"e.g "},{"type":"link","url":"https://juliaio.github.io/HDF5.jl/stable/#Memory-mapping"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"7b1ebfe7-226c-4216-b32a-e978491b87b1","type":"message","text":"By the way, some others on discourse also discussed other options. <https://discourse.julialang.org/t/should-i-use-hdf5-to-speed-up-reading-image-data-repeatedly/57576>","user":"U0138UTB7A4","ts":"1616346577.015500","team":"T68168MUP","attachments":[{"service_name":"JuliaLang","title":"Should I use HDF5 to speed up reading image data repeatedly?","title_link":"https://discourse.julialang.org/t/should-i-use-hdf5-to-speed-up-reading-image-data-repeatedly/57576","text":"Hi all, I’m trying to speed-up the following piece of code for an art project. I have a collection of png images. All of them together is 25GB+ And in a loop, I need to keep copying an arbitrary pixel in one of the png images (simplified code below), right now it takes running overnight (~9 hours) to complete even with some preloading of images as much as I can. How can I do this much faster possibly by preprocessing the images into a faster to access format, or possibly accessing the desire...","fallback":"JuliaLang: Should I use HDF5 to speed up reading image data repeatedly?","thumb_url":"https://aws1.discourse-cdn.com/business5/uploads/julialang/original/2X/1/12829a7ba92b924d4ce81099cbf99785bee9b405.png","fields":[{"title":"Reading time","value":"1 mins :clock2:","short":true},{"title":"Likes","value":"9 :heart:","short":true}],"ts":1616196393,"from_url":"https://discourse.julialang.org/t/should-i-use-hdf5-to-speed-up-reading-image-data-repeatedly/57576","thumb_width":408,"thumb_height":263,"service_icon":"https://aws1.discourse-cdn.com/business5/uploads/julialang/optimized/2X/6/6ca888e296f59ca2a599807f7d5edd489e3d1829_2_180x180.png","id":1,"original_url":"https://discourse.julialang.org/t/should-i-use-hdf5-to-speed-up-reading-image-data-repeatedly/57576"}],"blocks":[{"type":"rich_text","block_id":"epYro","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"By the way, some others on discourse also discussed other options. "},{"type":"link","url":"https://discourse.julialang.org/t/should-i-use-hdf5-to-speed-up-reading-image-data-repeatedly/57576"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"75e0f9e4-60ca-4939-83d5-55e8c630b7b2","type":"message","text":"e.g. \"With GDAL you can read only a little chunk of an image (PNG or other formats)\" by Joa-quim","user":"U0138UTB7A4","ts":"1616346619.015800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wlkH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"e.g. \"With GDAL you can read only a little chunk of an image (PNG or other formats)\" by Joa-quim"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"22aa60ef-8149-4ebd-b183-4aa80d9b9622","type":"message","text":"GDAL is good like that. Alternatively... I think PNG's are lossless? You should be able to `seek` your way to the right spot in a file. Caveat emptor... the file format is a little funky, you'd need to either read header information from one file and assume uniformity (at the risk of splosions) or parse each PNG's header.\n<https://en.wikipedia.org/wiki/Portable_Network_Graphics#File_header>\n\nPersonally I would avoid HDF5 unless you absolutely had to use it for something.","user":"UPUBAM63X","ts":"1616975966.050000","team":"T68168MUP","edited":{"user":"UPUBAM63X","ts":"1616975977.000000"},"blocks":[{"type":"rich_text","block_id":"zCx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"GDAL is good like that. Alternatively... I think PNG's are lossless? You should be able to "},{"type":"text","text":"seek","style":{"code":true}},{"type":"text","text":" your way to the right spot in a file. Caveat emptor... the file format is a little funky, you'd need to either read header information from one file and assume uniformity (at the risk of splosions) or parse each PNG's header.\n"},{"type":"link","url":"https://en.wikipedia.org/wiki/Portable_Network_Graphics#File_header"},{"type":"text","text":"\n\nPersonally I would avoid HDF5 unless you absolutely had to use it for something."}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"005c05b0-a927-44a8-9456-0c882fb95c6f","type":"message","text":"PNG is lossless but compressed. I'm pretty sure you need some fancy logic for arbitrary pixel reading","user":"U0179G7FG4F","ts":"1616976044.050400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Vik","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"PNG is lossless but compressed. I'm pretty sure you need some fancy logic for arbitrary pixel reading"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4","reactions":[{"name":"+1","users":["UPUBAM63X"],"count":1}]},{"client_msg_id":"5e4927b7-ab7c-42c2-8752-bbbc637b8982","type":"message","text":"Ah I see yea nvm what I said then.","user":"UPUBAM63X","ts":"1616976064.050700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"H+I4F","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah I see yea nvm what I said then."}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"630b02ab-4b1f-400c-ad11-0d9727be822a","type":"message","text":"I'm actually really liking HDF5 so far! Yeah the PNG reading arbitrary pixels ended up being too complicated for me. GDAL might be able to do it already but I went with an HDF5 approach.\n\nI prepared one big HDF5 file, then I read in each PNG normally, converted the RGB data into UInt8 data, then throw that into the HDF5. That still took a long time.\n\nBut for reading: I did a preliminary test and using readmmap with my HDF5 was impressively fast! So I'm excited to try it out with a bigger test. Haven't yet though","user":"U0138UTB7A4","ts":"1616977072.050900","team":"T68168MUP","edited":{"user":"U0138UTB7A4","ts":"1616978937.000000"},"blocks":[{"type":"rich_text","block_id":"eps","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm actually really liking HDF5 so far! Yeah the PNG reading arbitrary pixels ended up being too complicated for me. GDAL might be able to do it already but I went with an HDF5 approach.\n\nI prepared one big HDF5 file, then I read in each PNG normally, converted the RGB data into UInt8 data, then throw that into the HDF5. That still took a long time.\n\nBut for reading: I did a preliminary test and using readmmap with my HDF5 was impressively fast! So I'm excited to try it out with a bigger test. Haven't yet though"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"a9c274fe-4f11-4001-80a2-010a3f470560","type":"message","text":"guess it depends on what your goal is. if your goal was to avoid the overhead of having to read the entire file, then yea HDF5 has a read -&gt; write -&gt; read cost too it. If it was that you need to do this operation many times then sure store it in HDF5.","user":"UPUBAM63X","ts":"1616981967.051500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5/bOd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"guess it depends on what your goal is. if your goal was to avoid the overhead of having to read the entire file, then yea HDF5 has a read -> write -> read cost too it. If it was that you need to do this operation many times then sure store it in HDF5."}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"},{"client_msg_id":"8d83d2c2-10cf-422a-b8fa-fef9aa7a32be","type":"message","text":"Yeah thats what I realized a bit afterwards too. Before my goal was to (naively?) \"just do everything faster\". But now I think my goal is to be able to access/read the arbitrary pixel data much faster than before which leads to a higher productivity on trying out different things. So in the end I had to invest time into converting it all into HDF5 so that I can read the data much faster and iterate to try out different parameters which leads to different output products","user":"U0138UTB7A4","ts":"1616982386.051700","team":"T68168MUP","edited":{"user":"U0138UTB7A4","ts":"1616982398.000000"},"blocks":[{"type":"rich_text","block_id":"gwglY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah thats what I realized a bit afterwards too. Before my goal was to (naively?) \"just do everything faster\". But now I think my goal is to be able to access/read the arbitrary pixel data much faster than before which leads to a higher productivity on trying out different things. So in the end I had to invest time into converting it all into HDF5 so that I can read the data much faster and iterate to try out different parameters which leads to different output products"}]}]}],"thread_ts":"1616196756.012000","parent_user_id":"U0138UTB7A4"}]