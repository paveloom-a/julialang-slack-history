[{"client_msg_id":"187661c2-2df2-4c1d-a05a-b8673cdfac90","type":"message","text":"is it possible to use LoopVectorization’s threaded broadcasting `@avxt` on StructArrays? e.g.,\n```using StructArrays\nusing BenchmarkTools\nusing LoopVectorization\n\nu,v = ntuple(x-&gt;randn(10,1000),2)\nU = StructArray(u=u,v=v)\nf(U) = exp(U.u)*sin(U.v)\n\n@avxt f.(U)```\nWhen I tried on v.12.12, `@avxt f.(U)` wasn’t any faster than the non-threaded broadcast version.","user":"U011LUQ182G","ts":"1618189873.188800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b5gYL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is it possible to use LoopVectorization’s threaded broadcasting "},{"type":"text","text":"@avxt","style":{"code":true}},{"type":"text","text":" on StructArrays? e.g.,\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using StructArrays\nusing BenchmarkTools\nusing LoopVectorization\n\nu,v = ntuple(x->randn(10,1000),2)\nU = StructArray(u=u,v=v)\nf(U) = exp(U.u)*sin(U.v)\n\n@avxt f.(U)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"When I tried on v.12.12, "},{"type":"text","text":"@avxt f.(U)","style":{"code":true}},{"type":"text","text":" wasn’t any faster than the non-threaded broadcast version."}]}]}],"thread_ts":"1618189873.188800","reply_count":46,"reply_users_count":2,"latest_reply":"1618194297.199200","reply_users":["UAUPJLBQX","U011LUQ182G"],"is_locked":false,"subscribed":false},{"client_msg_id":"3dc3a912-12f7-47f5-963f-ad9ce662b220","type":"message","text":"That's because it was using the non-threaded broadcast version","user":"UAUPJLBQX","ts":"1618191375.188900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nL8O","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That's because it was using the non-threaded broadcast version"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"f44d38c3-5dae-45bd-90ef-e41b07cf46dc","type":"message","text":"```julia&gt; v = ntuple(x-&gt;randn(10,1000),2);\n\njulia&gt; U = StructArray(u=v[1],v=v[2]);\n\njulia&gt; f(U) = exp(U.u)*sin(U.v)\nf (generic function with 1 method)\n\njulia&gt; y = similar(v[1]);\n\njulia&gt; @benchmark @avxt @. $y = f($U)\nBenchmarkTools.Trial:\n  memory estimate:  0 bytes\n  allocs estimate:  0\n  --------------\n  minimum time:     152.114 μs (0.00% GC)\n  median time:      154.670 μs (0.00% GC)\n  mean time:        154.651 μs (0.00% GC)\n  maximum time:     171.640 μs (0.00% GC)\n  --------------\n  samples:          10000\n  evals/sample:     1\n\njulia&gt; @benchmark @avxt @. $y = exp($U.u)*sin($U.v)\nBenchmarkTools.Trial:\n  memory estimate:  0 bytes\n  allocs estimate:  0\n  --------------\n  minimum time:     2.395 μs (0.00% GC)\n  median time:      2.699 μs (0.00% GC)\n  mean time:        2.689 μs (0.00% GC)\n  maximum time:     8.977 μs (0.00% GC)\n  --------------\n  samples:          10000\n  evals/sample:     9\n\njulia&gt; @benchmark @avxt @. $(vec(y)) = exp($(vec(U.u)))*sin($(vec(U.v)))\nBenchmarkTools.Trial:\n  memory estimate:  0 bytes\n  allocs estimate:  0\n  --------------\n  minimum time:     1.597 μs (0.00% GC)\n  median time:      1.789 μs (0.00% GC)\n  mean time:        1.778 μs (0.00% GC)\n  maximum time:     7.486 μs (0.00% GC)\n  --------------\n  samples:          10000\n  evals/sample:     10```","user":"UAUPJLBQX","ts":"1618191788.189100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"B/TLt","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> v = ntuple(x->randn(10,1000),2);\n\njulia> U = StructArray(u=v[1],v=v[2]);\n\njulia> f(U) = exp(U.u)*sin(U.v)\nf (generic function with 1 method)\n\njulia> y = similar(v[1]);\n\njulia> @benchmark @avxt @. $y = f($U)\nBenchmarkTools.Trial:\n  memory estimate:  0 bytes\n  allocs estimate:  0\n  --------------\n  minimum time:     152.114 μs (0.00% GC)\n  median time:      154.670 μs (0.00% GC)\n  mean time:        154.651 μs (0.00% GC)\n  maximum time:     171.640 μs (0.00% GC)\n  --------------\n  samples:          10000\n  evals/sample:     1\n\njulia> @benchmark @avxt @. $y = exp($U.u)*sin($U.v)\nBenchmarkTools.Trial:\n  memory estimate:  0 bytes\n  allocs estimate:  0\n  --------------\n  minimum time:     2.395 μs (0.00% GC)\n  median time:      2.699 μs (0.00% GC)\n  mean time:        2.689 μs (0.00% GC)\n  maximum time:     8.977 μs (0.00% GC)\n  --------------\n  samples:          10000\n  evals/sample:     9\n\njulia> @benchmark @avxt @. $(vec(y)) = exp($(vec(U.u)))*sin($(vec(U.v)))\nBenchmarkTools.Trial:\n  memory estimate:  0 bytes\n  allocs estimate:  0\n  --------------\n  minimum time:     1.597 μs (0.00% GC)\n  median time:      1.789 μs (0.00% GC)\n  mean time:        1.778 μs (0.00% GC)\n  maximum time:     7.486 μs (0.00% GC)\n  --------------\n  samples:          10000\n  evals/sample:     10"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"ad920945-fc26-4b44-9cb0-0a0bb70cbb4c","type":"message","text":"LoopVectorization doesn't know what to do with a StructArray, so it just switches to regular broadcasting to be safe.","user":"UAUPJLBQX","ts":"1618191825.189300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lyB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"LoopVectorization doesn't know what to do with a StructArray, so it just switches to regular broadcasting to be safe."}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"069cca1b-6427-4dca-80bc-5571d51a3a8a","type":"message","text":"That's fixable. I'll get around to that sort of thing eventually.","user":"UAUPJLBQX","ts":"1618191853.189500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mTOfS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That's fixable. I'll get around to that sort of thing eventually."}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G","reactions":[{"name":"+1","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"3f63f60c-e964-44b6-be8e-88726d72f543","type":"message","text":"I'll also implement auto-flattening","user":"UAUPJLBQX","ts":"1618191865.189700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/u2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'll also implement auto-flattening"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"1146f04f-de74-4f5d-ab70-1af68c4ba448","type":"message","text":"but that'd be hard for broadcasting","user":"UAUPJLBQX","ts":"1618191897.190000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"I8F","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but that'd be hard for broadcasting"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"b6de9610-fc29-4337-bceb-0403ce2eb69d","type":"message","text":"because the semantics of broadcasting don't really allow you to flatten","user":"UAUPJLBQX","ts":"1618191908.190200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"o4JX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"because the semantics of broadcasting don't really allow you to flatten"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"edcb28a0-e66e-4eb5-9989-3b1f5ea4cc81","type":"message","text":"since maybe you have to broadcast one of the dimensions","user":"UAUPJLBQX","ts":"1618191920.190400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Qdjjf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"since maybe you have to broadcast one of the dimensions"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G","reactions":[{"name":"+1","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"cd6258bf-ec44-48b7-a94b-d602ee6853eb","type":"message","text":"So if you don't actually want to broadcast, loops using `eachindex` (so you're using linear indexing)","user":"UAUPJLBQX","ts":"1618191950.190600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lqr4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So if you don't actually want to broadcast, loops using "},{"type":"text","text":"eachindex","style":{"code":true}},{"type":"text","text":" (so you're using linear indexing)"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"92dfd4fd-2e63-41d2-a321-675e122a66ea","type":"message","text":"will be faster. Alternatively, you can use `vec` like I did there.","user":"UAUPJLBQX","ts":"1618191978.190900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7QFck","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"will be faster. Alternatively, you can use "},{"type":"text","text":"vec","style":{"code":true}},{"type":"text","text":" like I did there."}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"d79ff9c7-2d06-4eef-b12a-1b90846568c4","type":"message","text":"I may also implement something like the DiffEq ecosystem's `@..`","user":"UAUPJLBQX","ts":"1618191994.191100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Myt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I may also implement something like the DiffEq ecosystem's "},{"type":"text","text":"@..","style":{"code":true}}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G","reactions":[{"name":"+1","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"e1059a35-7747-4ce1-9b9b-535e082385c0","type":"message","text":"which does broadcasting minus the broadcasting","user":"UAUPJLBQX","ts":"1618192004.191300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=meiP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"which does broadcasting minus the broadcasting"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"eb70aed9-d32e-4092-8f8e-b4cc35ddf3a9","type":"message","text":"&gt; which does broadcasting minus the broadcasting\ndoes this mean minus the broadcasting to dimensions?","user":"U011LUQ182G","ts":"1618192078.191500","team":"T68168MUP","edited":{"user":"U011LUQ182G","ts":"1618192096.000000"},"blocks":[{"type":"rich_text","block_id":"AXDU","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"which does broadcasting minus the broadcasting"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"does this mean minus the broadcasting to dimensions?"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"43d8467f-a883-46c7-ae01-d6d7b545860b","type":"message","text":"Yes. It'd be easier to optimize by requiring all dimensions are either equal","user":"UAUPJLBQX","ts":"1618192141.191900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mF/CD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes. It'd be easier to optimize by requiring all dimensions are either equal"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G","reactions":[{"name":"+1","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"8d253c7b-cd84-4e24-bfaf-ff69d30ff2b3","type":"message","text":"or known at compile time to be be 1","user":"UAUPJLBQX","ts":"1618192149.192200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8NKXp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"or known at compile time to be be 1"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"9293e266-d0f7-45aa-b225-2150ac3d2bcb","type":"message","text":"(e..g, `rand(1,10)` would not be okay, but `rand(10)'` would be okay) alongside a `rand(8,10)`","user":"UAUPJLBQX","ts":"1618192173.192400","team":"T68168MUP","edited":{"user":"UAUPJLBQX","ts":"1618192190.000000"},"blocks":[{"type":"rich_text","block_id":"9Ds","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(e..g, "},{"type":"text","text":"rand(1,10)","style":{"code":true}},{"type":"text","text":" would not be okay, but "},{"type":"text","text":"rand(10)'","style":{"code":true}},{"type":"text","text":" would be okay) alongside a "},{"type":"text","text":"rand(8,10)","style":{"code":true}}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"7867d6d2-b81b-41af-a05d-6aac0f051b56","type":"message","text":"gotcha - thanks","user":"U011LUQ182G","ts":"1618192186.192600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M6HrN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"gotcha - thanks"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"b58568ef-0455-44fd-b777-cc572241d60a","type":"message","text":"what does the vec trick do?","user":"U011LUQ182G","ts":"1618192202.192900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LgIZN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what does the vec trick do?"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"fac42f18-1b6d-4fe0-b739-5c50bd69db94","type":"message","text":"oh nvm - i see","user":"U011LUQ182G","ts":"1618192213.193100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"g=2H","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh nvm - i see"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"a90bd886-b86e-4d94-b70f-8fb0659cb7af","type":"message","text":"`vec` turns them into vectors","user":"UAUPJLBQX","ts":"1618192213.193300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b0/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"vec","style":{"code":true}},{"type":"text","text":" turns them into vectors"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"d62b953e-4748-4910-90bf-546c3bb5fe24","type":"message","text":"I see what you did now - just wrote a scalar version of the function","user":"U011LUQ182G","ts":"1618192238.193500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cvaW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I see what you did now - just wrote a scalar version of the function"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"597d1c07-5fc6-4d50-bd3f-baa4ad5ed78f","type":"message","text":"`vec`ing basically lets it use linear indexing","user":"UAUPJLBQX","ts":"1618192273.193700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7ysz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"vec","style":{"code":true}},{"type":"text","text":"ing basically lets it use linear indexing"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G","reactions":[{"name":"+1","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"e7776580-f869-4b09-87d3-6b41fec4dcfa","type":"message","text":"that's important here, because 10 is an awkward size for SIMD","user":"UAUPJLBQX","ts":"1618192282.193900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yLu92","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's important here, because 10 is an awkward size for SIMD"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"65849f7e-95f2-4252-a821-af47fbbb79bc","type":"message","text":"and the arrays are 10xbignumber","user":"UAUPJLBQX","ts":"1618192299.194100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5SNt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and the arrays are 10xbignumber"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"d6b90d49-0b9f-41bd-af72-103d0fe9a71d","type":"message","text":"so as written, it's basically doing a loop of 10 (awkward to SIMD) bignumber times","user":"UAUPJLBQX","ts":"1618192350.194300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jaLHs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so as written, it's basically doing a loop of 10 (awkward to SIMD) bignumber times"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"de6bdf77-82b6-407f-ab90-f75336edfd24","type":"message","text":"instead of a single loop of length 10*bignumber","user":"UAUPJLBQX","ts":"1618192361.194500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mN7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"instead of a single loop of length 10*bignumber"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"194e4670-56ed-4394-83c4-caf7f22781fb","type":"message","text":"interesting - I thought broadcasting over dense arrays would automatically flatten to the underlying contiguous storage","user":"U011LUQ182G","ts":"1618192372.194700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eoN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"interesting - I thought broadcasting over dense arrays would automatically flatten to the underlying contiguous storage"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"1f8e6bf4-f91b-4453-8f48-b9dec664896f","type":"message","text":"Can't, because maybe it has to broadcast","user":"UAUPJLBQX","ts":"1618192386.194900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mUCXQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Can't, because maybe it has to broadcast"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"d0e12ded-e8ee-4788-9d6f-1cd7b80baa3e","type":"message","text":"Something base broadcasting does but LoopVectorization doesn't","user":"UAUPJLBQX","ts":"1618192404.195100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M8/Q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Something base broadcasting does but LoopVectorization doesn't"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"b946b2e5-6a24-451a-845b-3ed2452d704d","type":"message","text":"is do a huge number of checks","user":"UAUPJLBQX","ts":"1618192412.195400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"G+tzn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is do a huge number of checks"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"e356ac86-04c9-46ab-be58-1f40e524073b","type":"message","text":"for different special cases","user":"UAUPJLBQX","ts":"1618192424.195600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ufM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"for different special cases"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"27349b72-2b4c-4d4e-aab3-ab845b60f48c","type":"message","text":"and then optimize each of these.","user":"UAUPJLBQX","ts":"1618192434.195800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GrbfL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and then optimize each of these."}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"bdeafed4-5d6c-4c49-9add-861fbaa35298","type":"message","text":"that leads to broadcasts often generating a ton of code","user":"UAUPJLBQX","ts":"1618192450.196000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uU0aZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that leads to broadcasts often generating a ton of code"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"8b67949c-5797-49aa-9496-f5e75416b59b","type":"message","text":"Yeah - i’ve noticed that performance is trickier to predict with broadcasted code","user":"U011LUQ182G","ts":"1618192473.196200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"v=kAE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah - i’ve noticed that performance is trickier to predict with broadcasted code"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"1f23d363-e3e7-4e6e-b94f-3f6bb1723a1a","type":"message","text":"but that means they'll be fast if one of those special cases happened to be what your code does.","user":"UAUPJLBQX","ts":"1618192479.196400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EQu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but that means they'll be fast if one of those special cases happened to be what your code does."}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"26ad810a-3e43-4f90-bbf9-6db572e3daef","type":"message","text":"Yeah, often it ends up slow","user":"UAUPJLBQX","ts":"1618192485.196600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4AYx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, often it ends up slow"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"5faa4bf6-2784-4bc9-9b91-197da8f776dd","type":"message","text":"but that most of the broadcasting I do tends to be of the `@..` nature, so I might have to look at that","user":"U011LUQ182G","ts":"1618192487.196800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"L09","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but that most of the broadcasting I do tends to be of the "},{"type":"text","text":"@..","style":{"code":true}},{"type":"text","text":" nature, so I might have to look at that"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"a355b2cf-fed8-4514-a7e3-c8c6b4cdd38f","type":"message","text":"because the most common case/the one you actually have isn't among them...\nI think overall LV's strategy is better","user":"UAUPJLBQX","ts":"1618192518.197000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CgYf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"because the most common case/the one you actually have isn't among them...\nI think overall LV's strategy is better"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"50134200-07e4-4f08-9be2-5726e2e94764","type":"message","text":"LV’s strategy = macros and explicit loops?","user":"U011LUQ182G","ts":"1618192542.197200","team":"T68168MUP","edited":{"user":"U011LUQ182G","ts":"1618192548.000000"},"blocks":[{"type":"rich_text","block_id":"bkIGl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"LV’s strategy = macros and explicit loops?"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"f27fce93-d38a-42da-a595-8b70e3fdc8ec","type":"message","text":"When broadcasting, it assumes the contiguous axis aren't broadcast unless known at compile time to be of size 1 (dangerous, I think I have a big warning somewhere about that)","user":"UAUPJLBQX","ts":"1618192608.197500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cwydv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"When broadcasting, it assumes the contiguous axis aren't broadcast unless known at compile time to be of size 1 (dangerous, I think I have a big warning somewhere about that)"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G","reactions":[{"name":"+1","users":["U011LUQ182G"],"count":1},{"name":"today-i-learned","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"794c344f-cb1b-4356-9ab2-22093b8336f6","type":"message","text":"then for other dimensions, it sets the strides to 0 if size is 1","user":"UAUPJLBQX","ts":"1618192617.197700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6kPg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"then for other dimensions, it sets the strides to 0 if size is 1"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"6c97a126-7bc5-4f75-99f6-eb3a8aa1eb1f","type":"message","text":"it could maybe still add a flattening special case on top of this","user":"UAUPJLBQX","ts":"1618192646.198000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hkk1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it could maybe still add a flattening special case on top of this"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"1d5c588f-3c1e-4826-ab23-e375f0a09cbd","type":"message","text":"thanks for the clarification","user":"U011LUQ182G","ts":"1618192654.198200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gmtf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks for the clarification"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"387a061b-3d85-4c59-b72f-9db582199b65","type":"message","text":"but that at least means it can with 1 version of the loops SIMD everything","user":"UAUPJLBQX","ts":"1618192661.198400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JHB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but that at least means it can with 1 version of the loops SIMD everything"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"421d10c1-d600-49d9-8cb1-2c8a1a3f8037","type":"message","text":"I appreciate all the detail and insight into design choices - it gives me a better sense of how to use LoopVectorization too.\n\nI’ll keep an eye out for anything involving StructOfArray, but it gives me more than enough to optimize my existing codes using `@avxt`. Thanks!","user":"U011LUQ182G","ts":"1618193518.199000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Iyi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I appreciate all the detail and insight into design choices - it gives me a better sense of how to use LoopVectorization too.\n\nI’ll keep an eye out for anything involving StructOfArray, but it gives me more than enough to optimize my existing codes using "},{"type":"text","text":"@avxt","style":{"code":true}},{"type":"text","text":". Thanks!"}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"1a65af95-914d-410c-a16b-78665664c4d3","type":"message","text":"Happy to help!\nAnd feel free to ping me if you have any questions. I don't read every comment.\n\nYou can use `LoopVectorization.check_args(U)` to check whether LoopVectorization will run on `U`, or fall back to a generic implementation.","user":"UAUPJLBQX","ts":"1618194297.199200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Yqnm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Happy to help!\nAnd feel free to ping me if you have any questions. I don't read every comment.\n\nYou can use "},{"type":"text","text":"LoopVectorization.check_args(U)","style":{"code":true}},{"type":"text","text":" to check whether LoopVectorization will run on "},{"type":"text","text":"U","style":{"code":true}},{"type":"text","text":", or fall back to a generic implementation."}]}]}],"thread_ts":"1618189873.188800","parent_user_id":"U011LUQ182G","reactions":[{"name":"pray","users":["U011LUQ182G"],"count":1}]}]