[{"client_msg_id":"a4944fd3-9bfc-4a80-9721-f923e1ff7e8b","type":"message","text":"I'm trying to write a simple ode solver (like the ones <https://perso.crans.org/besson/publis/notebooks/Runge-Kutta_methods_for_ODE_integration_in_Julia.html|here>) but with a custom adaptive stepsize. What is a good way to pre-allocate the vectors given that I don't know how many steps I'll ultimately need?","user":"U91Q3595Y","ts":"1610401442.325100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cWG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm trying to write a simple ode solver (like the ones "},{"type":"link","url":"https://perso.crans.org/besson/publis/notebooks/Runge-Kutta_methods_for_ODE_integration_in_Julia.html","text":"here"},{"type":"text","text":") but with a custom adaptive stepsize. What is a good way to pre-allocate the vectors given that I don't know how many steps I'll ultimately need?"}]}]}],"thread_ts":"1610401442.325100","reply_count":26,"reply_users_count":4,"latest_reply":"1610403185.331600","reply_users":["U91Q3595Y","U0179G7FG4F","U9MED583T","U69BL50BF"],"subscribed":false},{"client_msg_id":"6a112161-abf2-4bb7-869f-38e57ee17996","type":"message","text":"We can use the Euler method as an example if that helps\n```function rungekutta1(f, y0, t)\n    n = length(t)\n    y = zeros((n, length(y0)))\n    y[1,:] = y0\n    for i in 1:n-1\n        h = t[i+1] - t[i]\n        y[i+1,:] = y[i,:] + h * f(y[i,:], t[i])\n    end\n    return y\nend```","user":"U91Q3595Y","ts":"1610401483.325200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JUcTy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We can use the Euler method as an example if that helps\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function rungekutta1(f, y0, t)\n    n = length(t)\n    y = zeros((n, length(y0)))\n    y[1,:] = y0\n    for i in 1:n-1\n        h = t[i+1] - t[i]\n        y[i+1,:] = y[i,:] + h * f(y[i,:], t[i])\n    end\n    return y\nend"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"3168a1aa-c40f-43bb-b8a1-08826e302d60","type":"message","text":"why not just use `push!`? I don't think you'll be able to do better unless you can get a good estimate for how big the vector will be","user":"U0179G7FG4F","ts":"1610401879.325400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"u9sP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"why not just use "},{"type":"text","text":"push!","style":{"code":true}},{"type":"text","text":"? I don't think you'll be able to do better unless you can get a good estimate for how big the vector will be"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"5b227d7c-0d19-4fe8-916f-94b154873ebc","type":"message","text":"So just instantiate an empty array and `push!` each iteration?","user":"U91Q3595Y","ts":"1610401912.325600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"u8t==","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So just instantiate an empty array and "},{"type":"text","text":"push!","style":{"code":true}},{"type":"text","text":" each iteration?"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y","reactions":[{"name":"+1","users":["U0179G7FG4F","U67G3QRJM"],"count":2}]},{"client_msg_id":"0f475555-67d1-431b-9214-65f77cab7725","type":"message","text":"Fair enough","user":"U91Q3595Y","ts":"1610401924.325900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TuY9U","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Fair enough"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"04d0428e-6bfb-44bc-88c5-11bc9310b0a9","type":"message","text":"I was hoping there might be something more clever, but I guess `push!` is implemented with some optimization already. Thanks!","user":"U91Q3595Y","ts":"1610401943.326300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Qkc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I was hoping there might be something more clever, but I guess "},{"type":"text","text":"push!","style":{"code":true}},{"type":"text","text":" is implemented with some optimization already. Thanks!"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"c1686636-c244-4921-929c-8f44f24b25ba","type":"message","text":"`push!` doubles the size when necessary so inserting is still amortized `O(1)`.  I'm also assuming this isn't performance critical, because if it is, you should just be using `DifferentialEquations.jl` which will almost certainly be faster since it's had years of optimization work","user":"U0179G7FG4F","ts":"1610402043.326600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iEt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"push!","style":{"code":true}},{"type":"text","text":" doubles the size when necessary so inserting is still amortized "},{"type":"text","text":"O(1)","style":{"code":true}},{"type":"text","text":".  I'm also assuming this isn't performance critical, because if it is, you should just be using "},{"type":"text","text":"DifferentialEquations.jl","style":{"code":true}},{"type":"text","text":" which will almost certainly be faster since it's had years of optimization work"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"56f5d62f-c485-4ced-a082-1bc1f23c3acf","type":"message","text":"That makes sense, thanks. `DifferentialEquations` hasn't worked for my problem so I've needed to implement something simple myself, at least while I figure out what's going wrong. I'll use `push!` . Thanks!","user":"U91Q3595Y","ts":"1610402099.326800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7x3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That makes sense, thanks. "},{"type":"text","text":"DifferentialEquations","style":{"code":true}},{"type":"text","text":" hasn't worked for my problem so I've needed to implement something simple myself, at least while I figure out what's going wrong. I'll use "},{"type":"text","text":"push!","style":{"code":true}},{"type":"text","text":" . Thanks!"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"79396bab-8c6e-4ba1-9657-dc2f8d95339a","type":"message","text":"I highly recommend posting a mwe here or on discourse <@U69BL50BF> (the author of the library) is generally very helpful for these kinds of issues","user":"U0179G7FG4F","ts":"1610402256.327000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dfb2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I highly recommend posting a mwe here or on discourse "},{"type":"user","user_id":"U69BL50BF"},{"type":"text","text":" (the author of the library) is generally very helpful for these kinds of issues"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y","reactions":[{"name":"+1","users":["U91Q3595Y","U67G3QRJM"],"count":2}]},{"client_msg_id":"6fb6bf92-2a6f-44f1-ab52-a8bceb0b06ba","type":"message","text":"you can use `sizehint!` on the empty array if you have a rough estimate for the size","user":"U9MED583T","ts":"1610402435.327300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nu1f","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can use "},{"type":"text","text":"sizehint!","style":{"code":true}},{"type":"text","text":" on the empty array if you have a rough estimate for the size"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y","reactions":[{"name":"+1","users":["U0179G7FG4F"],"count":1}]},{"client_msg_id":"ae2ba9b9-ad7a-4172-82da-7c598f7f81b0","type":"message","text":"What's the right way to use it? Right after instantiating?\n```v = Vector{Int}()\nsizehint!(v, 10)\nfor i in 1:10\n   push!(v, i)\nend```","user":"U91Q3595Y","ts":"1610402520.327600","team":"T68168MUP","edited":{"user":"U91Q3595Y","ts":"1610402538.000000"},"blocks":[{"type":"rich_text","block_id":"xzj4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What's the right way to use it? Right after instantiating?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"v = Vector{Int}()\nsizehint!(v, 10)\nfor i in 1:10\n   push!(v, i)\nend"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"b0cac7a2-9738-46fa-b4b0-bedd82fadd1d","type":"message","text":"yes","user":"U9MED583T","ts":"1610402532.327900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M6XRz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yes"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y","reactions":[{"name":"+1","users":["U91Q3595Y"],"count":1}]},{"client_msg_id":"d9da49f2-5fe3-44d9-9368-8ab85620399a","type":"message","text":"you can check if it helps performance by benchmarking the `push!` es after","user":"U9MED583T","ts":"1610402585.328300","team":"T68168MUP","edited":{"user":"U9MED583T","ts":"1610402603.000000"},"blocks":[{"type":"rich_text","block_id":"YiqaQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can check if it helps performance by benchmarking the "},{"type":"text","text":"push!","style":{"code":true}},{"type":"text","text":" es after"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y","reactions":[{"name":"+1","users":["U91Q3595Y"],"count":1}]},{"client_msg_id":"303526af-8495-45d1-ad2a-b0dcfa84b1fc","type":"message","text":"thanks!","user":"U91Q3595Y","ts":"1610402605.328700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Z/Ps5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks!"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"2f381cc0-0a11-4df5-b678-145576f7e9f7","type":"message","text":"why hasn't it worked?","user":"U69BL50BF","ts":"1610402694.328900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tgrn2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"why hasn't it worked?"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"dfd92979-0d9c-459b-8680-3c4fbae814d8","type":"message","text":"The same algorithm should already be implemented there, so you'd probably get the same failure in your version unless it's something really really weird.","user":"U69BL50BF","ts":"1610402718.329100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4gP6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The same algorithm should already be implemented there, so you'd probably get the same failure in your version unless it's something really really weird."}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"2a02d98e-7743-41a6-8340-6e7e95fefca1","type":"message","text":"i'll circle back to try to figure out when I get it working.. if my breaking example is still breaking I'll shoot you a note","user":"U91Q3595Y","ts":"1610402792.329500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GppI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"i'll circle back to try to figure out when I get it working.. if my breaking example is still breaking I'll shoot you a note"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"bcb5357d-0a66-43d5-97a0-58175ea0c015","type":"message","text":"But I did spend a decent amount of time banging my head against the wall -- coding it up by hand has been helpful in making progress","user":"U91Q3595Y","ts":"1610402821.329700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"biC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But I did spend a decent amount of time banging my head against the wall -- coding it up by hand has been helpful in making progress"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"1173702d-3e14-4360-a0c6-e28398592791","type":"message","text":"you could just use one of the methods in SimpleDiffEq.jl","user":"U69BL50BF","ts":"1610402877.329900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8CR8q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you could just use one of the methods in SimpleDiffEq.jl"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y","reactions":[{"name":"thinking_face","users":["U91Q3595Y"],"count":1}]},{"client_msg_id":"bcf70dab-9cb4-4019-a59f-071b205aba7c","type":"message","text":"i'll check it out","user":"U91Q3595Y","ts":"1610402903.330200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ErydJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"i'll check it out"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"5f57b71b-0832-4f8e-a795-b0f9f41f0ee7","type":"message","text":"<https://github.com/SciML/SimpleDiffEq.jl/blob/master/src/tsit5/gpuatsit5.jl#L64-L178>","user":"U69BL50BF","ts":"1610402907.330400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TDEM","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/SciML/SimpleDiffEq.jl/blob/master/src/tsit5/gpuatsit5.jl#L64-L178"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"f54a4b5d-bad9-42c1-9d46-ff54153cc105","type":"message","text":"that's almost exactly what you'd be writing","user":"U69BL50BF","ts":"1610402914.330600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sIr2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's almost exactly what you'd be writing"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"60823e0e-6594-44d8-86ba-b50b1fd4ff64","type":"message","text":"yeah, and implemented better :stuck_out_tongue:","user":"U91Q3595Y","ts":"1610402936.330800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aZ=z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, and implemented better "},{"type":"emoji","name":"stuck_out_tongue"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"2cedde3f-4d33-4e5d-95f8-8db26c3c2265","type":"message","text":"thanks :slightly_smiling_face:","user":"U91Q3595Y","ts":"1610402937.331000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Td31","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"986085cc-9db7-40c7-adb3-8f1db4efd2b1","type":"message","text":"`hcat(sol.u...)'`... whoever made that notebook... why... lol","user":"U69BL50BF","ts":"1610403174.331200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"B9C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hcat(sol.u...)'","style":{"code":true}},{"type":"text","text":"... whoever made that notebook... why... lol"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"},{"client_msg_id":"67d4a5fb-f99d-441f-a4d5-fc57a53b2be7","type":"message","text":"that's probably where most of the time is spent","user":"U69BL50BF","ts":"1610403180.331400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UWH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's probably where most of the time is spent"}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y","reactions":[{"name":"stuck_out_tongue","users":["U91Q3595Y"],"count":1}]},{"client_msg_id":"93165a81-63b7-4c7d-a6f9-a309bd0d362d","type":"message","text":"`sol'`","user":"U69BL50BF","ts":"1610403185.331600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GXGD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"sol'","style":{"code":true}}]}]}],"thread_ts":"1610401442.325100","parent_user_id":"U91Q3595Y"}]