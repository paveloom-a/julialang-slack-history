[{"client_msg_id":"e78c4329-9240-4895-9759-d32c8c900699","type":"message","text":"Is there a way to speed up this calculate this function faster? `x` and `y` are vectors `W` and `W_in` are matrices and activation is `tanh`\n```function foo(activation,W, W_in, x, y)\n    return activation.((W*x)+(W_in*y))\nend```","user":"U01C3624SGJ","ts":"1614956001.041400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lBLx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a way to speed up this calculate this function faster? "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"y","style":{"code":true}},{"type":"text","text":" are vectors "},{"type":"text","text":"W","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"W_in","style":{"code":true}},{"type":"text","text":" are matrices and activation is "},{"type":"text","text":"tanh","style":{"code":true}},{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function foo(activation,W, W_in, x, y)\n    return activation.((W*x)+(W_in*y))\nend"}]}]}],"thread_ts":"1614956001.041400","reply_count":18,"reply_users_count":4,"latest_reply":"1614961044.045700","reply_users":["U7HAYKY9X","U0179G7FG4F","U01C3624SGJ","U011V2YN59N"],"subscribed":false},{"client_msg_id":"7afb9396-7fe3-4462-919b-e704585a92ac","type":"message","text":"Pre-allocate the result vectors, though this will make the code a little more ugly","user":"U7HAYKY9X","ts":"1614956171.041500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5gK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Pre-allocate the result vectors, though this will make the code a little more ugly"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"c6c8ab5a-0c1c-4170-b9b5-f3993f61da8e","type":"message","text":"`return activation.((W*x).+(W_in*y))` will have 1/2 the allocations","user":"U0179G7FG4F","ts":"1614956603.041700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lGrYA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"return activation.((W*x).+(W_in*y))","style":{"code":true}},{"type":"text","text":" will have 1/2 the allocations"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"d3b7544c-b0e8-4df4-84ef-cd26f2276883","type":"message","text":"by result vectors you mean to make a mutating version of the function?","user":"U01C3624SGJ","ts":"1614956755.041900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wgZJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"by result vectors you mean to make a mutating version of the function?"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ","reactions":[{"name":"thumbsup_all","users":["U0179G7FG4F","U011V2YN59N"],"count":2},{"name":"+1","users":["U7HAYKY9X"],"count":1}]},{"client_msg_id":"ee2fcb29-3e93-4bdf-9ba7-955b6ccf6ae0","type":"message","text":"I was trying some things out. Does passing functions as parameters make them allocate?","user":"U01C3624SGJ","ts":"1614958662.042400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"998G","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I was trying some things out. Does passing functions as parameters make them allocate?"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"08ce5f01-ad1d-47b9-a354-39e68d0336fd","type":"message","text":"Nope","user":"U7HAYKY9X","ts":"1614958815.042600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OPaIF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Nope"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"ae6b3f1a-0783-487d-b9a1-b60033e7e358","type":"message","text":"I realized I had some type unstable code","user":"U01C3624SGJ","ts":"1614958957.042800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Yxg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I realized I had some type unstable code"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"93a5b6a4-442b-4f61-8367-549060c5ef29","type":"message","text":"yeah that would rly slow down your code","user":"U011V2YN59N","ts":"1614959031.043000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tWT6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah that would rly slow down your code"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"c697c530-b442-4c70-a70e-03f2d7e82b71","type":"message","text":"I wish we could turn on an option to make type instability an error.","user":"U011V2YN59N","ts":"1614959060.043200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ANRqz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I wish we could turn on an option to make type instability an error."}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ","reactions":[{"name":"thumbsup_all","users":["U0179G7FG4F"],"count":1}]},{"client_msg_id":"3168824d-1961-49b5-9145-9172b1b94950","type":"message","text":"I feel like I have asked that countless times, and I'm sure others have too. I don't remember why we can't have it though.","user":"U011V2YN59N","ts":"1614959148.043500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nl3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I feel like I have asked that countless times, and I'm sure others have too. I don't remember why we can't have it though."}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"20d00a7e-df2d-4f9c-ab52-a6987c4a3f3b","type":"message","text":"We can't have it for Julia in general, because sometimes type instability is required to avoid excessive compilation","user":"U7HAYKY9X","ts":"1614959179.043700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rAuw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We can't have it for Julia in general, because sometimes type instability is required to avoid excessive compilation"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"c38c9eae-0b87-4c83-8760-ef07f1887fe2","type":"message","text":"But we could have a macro `@stable foo(1 + 1)` , which would show an error if `foo(1 + 1)` , or any function called by it included a dynamic dispatch","user":"U7HAYKY9X","ts":"1614959240.043900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"08u","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But we could have a macro "},{"type":"text","text":"@stable foo(1 + 1)","style":{"code":true}},{"type":"text","text":" , which would show an error if "},{"type":"text","text":"foo(1 + 1)","style":{"code":true}},{"type":"text","text":" , or any function called by it included a dynamic dispatch"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"bd047286-dbcd-4287-8ef5-d1669e7d45fe","type":"message","text":"That would be amazing.","user":"U7HAYKY9X","ts":"1614959245.044100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JUROU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That would be amazing."}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"55f85f7f-fb3b-45e8-bd39-8f9fdc5108f9","type":"message","text":"Sure but I would like to be able to annotate parts of my code where I need it.","user":"U011V2YN59N","ts":"1614959248.044300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"J3e","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Sure but I would like to be able to annotate parts of my code where I need it."}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"951c32b6-6e76-4971-9293-aa54876fd230","type":"message","text":"Exactly yeah.","user":"U011V2YN59N","ts":"1614959250.044500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TbAf8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Exactly yeah."}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"76a8cd00-a6fb-4329-aab2-baa2dff32e0a","type":"message","text":"In fact I would probably prefer the inverse: a macro that allows dynamic dispatch. Generally the parts of my code where I don't care about performance are very decoupled from the parts where I do.","user":"U011V2YN59N","ts":"1614959350.044700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"n0mSa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"In fact I would probably prefer the inverse: a macro that allows dynamic dispatch. Generally the parts of my code where I don't care about performance are very decoupled from the parts where I do."}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"774f3fbf-9bef-4c23-8d03-66714c6d2c01","type":"message","text":"Some o f the instabilities mattered but others didnt since it was just the Dataframe","user":"U01C3624SGJ","ts":"1614959635.044900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dER0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Some o f the instabilities mattered but others didnt since it was just the Dataframe"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"66d31822-a1fd-4a5e-81f5-2d44a8890340","type":"message","text":"As it turns out at least for my functions passing an argument as a function does allocate and it ake a lot of difference.\n```julia&gt; @benchmark foo!($state2,$tanh,$W, $W_in, $state, $y)\nBenchmarkTools.Trial: \n  memory estimate:  544 bytes\n  allocs estimate:  4\n  --------------\n  minimum time:     497.990 ns (0.00% GC)\n  median time:      703.870 ns (0.00% GC)\n  mean time:        924.065 ns (9.20% GC)\n  maximum time:     88.769 μs (98.41% GC)\n  --------------\n  samples:          10000\n  evals/sample:     193\n\njulia&gt; @benchmark foo_no_act!($state2,$W, $W_in, $state, $y)\nBenchmarkTools.Trial: \n  memory estimate:  480 bytes\n  allocs estimate:  2\n  --------------\n  minimum time:     314.873 ns (0.00% GC)\n  median time:      436.458 ns (0.00% GC)\n  mean time:        556.459 ns (8.00% GC)\n  maximum time:     48.790 μs (97.95% GC)\n  --------------\n  samples:          10000\n  evals/sample:     237```","user":"U01C3624SGJ","ts":"1614961027.045500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oL4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"As it turns out at least for my functions passing an argument as a function does allocate and it ake a lot of difference.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @benchmark foo!($state2,$tanh,$W, $W_in, $state, $y)\nBenchmarkTools.Trial: \n  memory estimate:  544 bytes\n  allocs estimate:  4\n  --------------\n  minimum time:     497.990 ns (0.00% GC)\n  median time:      703.870 ns (0.00% GC)\n  mean time:        924.065 ns (9.20% GC)\n  maximum time:     88.769 μs (98.41% GC)\n  --------------\n  samples:          10000\n  evals/sample:     193\n\njulia> @benchmark foo_no_act!($state2,$W, $W_in, $state, $y)\nBenchmarkTools.Trial: \n  memory estimate:  480 bytes\n  allocs estimate:  2\n  --------------\n  minimum time:     314.873 ns (0.00% GC)\n  median time:      436.458 ns (0.00% GC)\n  mean time:        556.459 ns (8.00% GC)\n  maximum time:     48.790 μs (97.95% GC)\n  --------------\n  samples:          10000\n  evals/sample:     237"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"},{"client_msg_id":"06869385-3330-4585-988b-2e1df578fe06","type":"message","text":"```function foo!(results,activation,W, W_in, x, y)\n    results .= activation.((W*x).+(W_in*y))\n    return nothing\nend\nfunction foo_no_act!(results,W, W_in, x, y)\n    results .= tanh.((W*x).+(W_in*y))\n    return nothing\nend```","user":"U01C3624SGJ","ts":"1614961044.045700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"q+l8/","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function foo!(results,activation,W, W_in, x, y)\n    results .= activation.((W*x).+(W_in*y))\n    return nothing\nend\nfunction foo_no_act!(results,W, W_in, x, y)\n    results .= tanh.((W*x).+(W_in*y))\n    return nothing\nend"}]}]}],"thread_ts":"1614956001.041400","parent_user_id":"U01C3624SGJ"}]