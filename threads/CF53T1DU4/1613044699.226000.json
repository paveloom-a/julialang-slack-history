[{"client_msg_id":"daa93597-a3c3-4f1a-b739-41197605b7d7","type":"message","text":"For me the copy comparison looks like so, I don’t quite know what to make of these (fairly repeatable) numbers:\n```julia&gt; @btime calc_dx_K_loop($K, $X, 2, $res); # version with @avx\n  503.715 ns (0 allocations: 0 bytes)\n\njulia&gt; @btime calc_dx_K_loop(K_, X_, 2, res_)  setup=(K_=copy($K); X_=copy($X); res_=copy($res)) evals=1;\n  527.000 ns (0 allocations: 0 bytes)\n\njulia&gt; @btime calc_dx_K_loop(K_, X_, 2, res_)  setup=(K_=copy(K); X_=copy(X); res_=copy(res)) evals=1;\n  533.000 ns (0 allocations: 0 bytes)\n\njulia&gt; @btime calc_dx_K_loop(K_, X_, 2, res_)  setup=(K_=deepcopy($K); X_=deepcopy($X); res_=deepcopy($res)) evals=1;\n  707.000 ns (0 allocations: 0 bytes)\n\njulia&gt; @btime calc_dx_K_loop(K_, X_, 2, res_)  setup=(K_=deepcopy(K); X_=deepcopy(X); res_=deepcopy(res)) evals=1;\n  544.000 ns (0 allocations: 0 bytes)```","user":"UD0NS8PDF","ts":"1613044699.226000","team":"T68168MUP","edited":{"user":"UD0NS8PDF","ts":"1613044949.000000"},"blocks":[{"type":"rich_text","block_id":"8UF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For me the copy comparison looks like so, I don’t quite know what to make of these (fairly repeatable) numbers:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime calc_dx_K_loop($K, $X, 2, $res); # version with @avx\n  503.715 ns (0 allocations: 0 bytes)\n\njulia> @btime calc_dx_K_loop(K_, X_, 2, res_)  setup=(K_=copy($K); X_=copy($X); res_=copy($res)) evals=1;\n  527.000 ns (0 allocations: 0 bytes)\n\njulia> @btime calc_dx_K_loop(K_, X_, 2, res_)  setup=(K_=copy(K); X_=copy(X); res_=copy(res)) evals=1;\n  533.000 ns (0 allocations: 0 bytes)\n\njulia> @btime calc_dx_K_loop(K_, X_, 2, res_)  setup=(K_=deepcopy($K); X_=deepcopy($X); res_=deepcopy($res)) evals=1;\n  707.000 ns (0 allocations: 0 bytes)\n\njulia> @btime calc_dx_K_loop(K_, X_, 2, res_)  setup=(K_=deepcopy(K); X_=deepcopy(X); res_=deepcopy(res)) evals=1;\n  544.000 ns (0 allocations: 0 bytes)"}]}]}],"thread_ts":"1613044699.226000","reply_count":6,"reply_users_count":2,"latest_reply":"1613047069.240000","reply_users":["UH24GRBLL","UD0NS8PDF"],"subscribed":false},{"client_msg_id":"c282e18c-88b7-4a3e-8c55-0001c8c1020f","type":"message","text":"The first one has hottest cache lines for all things, the second one has to fetch from a new K, third one has the additonal overhead of also fetching X, fourth one has to fetch everything and fifth one has probably filled caches with relevant lines and the GC saves you by reusing memory from old `deepcopies`","user":"UH24GRBLL","ts":"1613045120.229500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MM5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The first one has hottest cache lines for all things, the second one has to fetch from a new K, third one has the additonal overhead of also fetching X, fourth one has to fetch everything and fifth one has probably filled caches with relevant lines and the GC saves you by reusing memory from old "},{"type":"text","text":"deepcopies","style":{"code":true}}]}]}],"thread_ts":"1613044699.226000","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"6a818799-436f-4b7a-b8aa-c87d304772a5","type":"message","text":"It must be something like that… I can see the first stays hot, but why the others differ seems mysterious. Isn’t `deepcopy` the same as `copy` for Arrays?","user":"UD0NS8PDF","ts":"1613045331.231700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"o=3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It must be something like that… I can see the first stays hot, but why the others differ seems mysterious. Isn’t "},{"type":"text","text":"deepcopy","style":{"code":true}},{"type":"text","text":" the same as "},{"type":"text","text":"copy","style":{"code":true}},{"type":"text","text":" for Arrays?"}]}]}],"thread_ts":"1613044699.226000","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"90993852-d592-4dfa-87f4-022608dbad42","type":"message","text":"And why removing the dollars speeds things up by making K global not local… maybe somehow BenchmarkTools’s machine for making them local is using up valuable cache space?","user":"UD0NS8PDF","ts":"1613045366.232300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tsQ8Q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And why removing the dollars speeds things up by making K global not local… maybe somehow BenchmarkTools’s machine for making them local is using up valuable cache space?"}]}]}],"thread_ts":"1613044699.226000","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"edfbff13-1831-4709-b7d2-70b60d65c67d","type":"message","text":"depends on your cachesize and how large the matrices are","user":"UH24GRBLL","ts":"1613045425.232600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DDzVs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"depends on your cachesize and how large the matrices are"}]}]}],"thread_ts":"1613044699.226000","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"5a8c447a-db23-46b1-b07f-95536da0247b","type":"message","text":"I guess it’s one more reminder not to take micro-benchmarks too seriously, too","user":"UD0NS8PDF","ts":"1613045716.236100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"86y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I guess it’s one more reminder not to take micro-benchmarks too seriously, too"}]}]}],"thread_ts":"1613044699.226000","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"a76a52d2-5253-4495-bdd2-01a8bf1f8283","type":"message","text":"yep","user":"UH24GRBLL","ts":"1613047069.240000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vICo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yep"}]}]}],"thread_ts":"1613044699.226000","parent_user_id":"UD0NS8PDF"}]