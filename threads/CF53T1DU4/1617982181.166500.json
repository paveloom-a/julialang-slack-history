[{"client_msg_id":"10689df6-3fbe-476c-b414-34fdae06757c","type":"message","text":"Ok, as someone noticed, the problem I posted above was actually trivial. Thanks. The problem I actually want to solve is\n```res[i, j] = (A[:, i]-A[:,j])' * Sigma * (A[:, i] - A[:, j])```\nI refactored this into\n```using BenchmarkTools\nusing LinearAlgebra\n\nfunction differences!(res, A, Σ)\n    D, M = size(A)\n    Temp = similar(A)\n    Temp2 = similar(A)\n    Temp3 = similar(A)\n    for i=1:M\n        Temp .= A[:, i] .- A\n        mul!(Temp2, Σ, A[:, i] .- A)\n        Temp3 .= Temp .* Temp2\n        sum!(res[:, i]', Temp3)\n    end\n    res\nend\n\nD = 500\nM = 300\n\nbench1 = @benchmark differences!(res, A, Σ) setup=(\n    res = rand(M, M);\n    A = rand(D, M);\n    Σ = rand(D, D);\n)```\nand am getting\n```julia&gt; bench1\nBenchmarkTools.Trial: \n  memory estimate:  349.89 MiB\n  allocs estimate:  1506\n  --------------\n  minimum time:     416.358 ms (1.70% GC)\n  median time:      429.999 ms (1.66% GC)\n  mean time:        443.107 ms (4.95% GC)\n  maximum time:     598.346 ms (31.10% GC)\n  --------------\n  samples:          12\n  evals/sample:     1```\n","user":"U7PD3M3L5","ts":"1617982181.166500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Mjxh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ok, as someone noticed, the problem I posted above was actually trivial. Thanks. The problem I actually want to solve is\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"res[i, j] = (A[:, i]-A[:,j])' * Sigma * (A[:, i] - A[:, j])"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"I refactored this into\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using BenchmarkTools\nusing LinearAlgebra\n\nfunction differences!(res, A, Σ)\n    D, M = size(A)\n    Temp = similar(A)\n    Temp2 = similar(A)\n    Temp3 = similar(A)\n    for i=1:M\n        Temp .= A[:, i] .- A\n        mul!(Temp2, Σ, A[:, i] .- A)\n        Temp3 .= Temp .* Temp2\n        sum!(res[:, i]', Temp3)\n    end\n    res\nend\n\nD = 500\nM = 300\n\nbench1 = @benchmark differences!(res, A, Σ) setup=(\n    res = rand(M, M);\n    A = rand(D, M);\n    Σ = rand(D, D);\n)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"and am getting\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> bench1\nBenchmarkTools.Trial: \n  memory estimate:  349.89 MiB\n  allocs estimate:  1506\n  --------------\n  minimum time:     416.358 ms (1.70% GC)\n  median time:      429.999 ms (1.66% GC)\n  mean time:        443.107 ms (4.95% GC)\n  maximum time:     598.346 ms (31.10% GC)\n  --------------\n  samples:          12\n  evals/sample:     1"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1617982181.166500","reply_count":3,"reply_users_count":2,"latest_reply":"1617982383.168200","reply_users":["UH24GRBLL","U7PD3M3L5"],"is_locked":false,"subscribed":false},{"client_msg_id":"4d8a6b70-4e80-49f6-af09-94359ae9e087","type":"message","text":"`Temp .= A[:, i] .- A` &lt;-- this allocates","user":"UH24GRBLL","ts":"1617982305.167300","team":"T68168MUP","edited":{"user":"UH24GRBLL","ts":"1617982311.000000"},"blocks":[{"type":"rich_text","block_id":"alMwu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Temp .= A[:, i] .- A","style":{"code":true}},{"type":"text","text":" <-- this allocates"}]}]}],"thread_ts":"1617982181.166500","parent_user_id":"U7PD3M3L5"},{"client_msg_id":"35bdffbc-4457-40f3-a88f-0621f41e63f2","type":"message","text":"`Temp .= (@view A[:, i]) .- A` &lt;--- this should not","user":"UH24GRBLL","ts":"1617982333.167600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"P2zF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Temp .= (@view A[:, i]) .- A","style":{"code":true}},{"type":"text","text":" <--- this should not"}]}]}],"thread_ts":"1617982181.166500","parent_user_id":"U7PD3M3L5"},{"client_msg_id":"2e20b527-fa96-49e7-aec4-0b3b5cd0b987","type":"message","text":"Ok, I'll try that too, thanks :slightly_smiling_face:","user":"U7PD3M3L5","ts":"1617982383.168200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eJw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ok, I'll try that too, thanks "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617982181.166500","parent_user_id":"U7PD3M3L5"}]