[{"client_msg_id":"4e940f00-5495-4663-8c0d-2b55a325ee93","type":"message","text":"I have a complicated function that at some point uses 100 times this one that I defined previously:\n```@inline nth_neighbor(i,n,N) = mod1(i + n,N) ```\nOther things also happen 100 times but this takes most of the time according to the profiler. Is mod1 expected to be slow? If it is something not known I can try and do a MWE to post a better question.","user":"UEGRU91B2","ts":"1617309052.089600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Aw3f","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have a complicated function that at some point uses 100 times this one that I defined previously:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@inline nth_neighbor(i,n,N) = mod1(i + n,N) "}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Other things also happen 100 times but this takes most of the time according to the profiler. Is mod1 expected to be slow? If it is something not known I can try and do a MWE to post a better question."}]}]}],"thread_ts":"1617309052.089600","reply_count":15,"reply_users_count":4,"latest_reply":"1617420251.115700","reply_users":["UEGRU91B2","U7HAYKY9X","U011V2YN59N","U67G3QRJM"],"is_locked":false,"subscribed":false},{"client_msg_id":"a66c0374-2a73-4aef-83bd-52ded30e906c","type":"message","text":"(also, I just threw the `@inline` in there to see if something magical happened","user":"UEGRU91B2","ts":"1617309084.089700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/Rf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(also, I just threw the "},{"type":"text","text":"@inline","style":{"code":true}},{"type":"text","text":" in there to see if something magical happened"}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"client_msg_id":"4b8ade0f-c4ec-4315-86bf-7a5da9f1606e","type":"message","text":"How slow is slow? Integer division is much, much slower than other integer operations, but it's still just maybe 10 nanoseconds","user":"U7HAYKY9X","ts":"1617309401.089900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UDd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How slow is slow? Integer division is much, much slower than other integer operations, but it's still just maybe 10 nanoseconds"}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2","reactions":[{"name":"+1","users":["U67G3QRJM"],"count":1}]},{"client_msg_id":"98172aac-aa4f-4e77-901a-1a5be0d037e0","type":"message","text":"I will try to isolate the issue and come back with proper measurements. Thanks for the order of magnitude estimate!","user":"UEGRU91B2","ts":"1617312293.090200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Lx3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I will try to isolate the issue and come back with proper measurements. Thanks for the order of magnitude estimate!"}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"type":"message","subtype":"thread_broadcast","text":"I don't have a solution to your problem, but I have also found `mod1` to be very slow. I am not sure if that can be fixed though, as I have no frame of reference for the implementation in other languages.","user":"U011V2YN59N","ts":"1617313403.090400","thread_ts":"1617309052.089600","root":{"client_msg_id":"4e940f00-5495-4663-8c0d-2b55a325ee93","type":"message","text":"I have a complicated function that at some point uses 100 times this one that I defined previously:\n```@inline nth_neighbor(i,n,N) = mod1(i + n,N) ```\nOther things also happen 100 times but this takes most of the time according to the profiler. Is mod1 expected to be slow? If it is something not known I can try and do a MWE to post a better question.","user":"UEGRU91B2","ts":"1617309052.089600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Aw3f","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have a complicated function that at some point uses 100 times this one that I defined previously:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@inline nth_neighbor(i,n,N) = mod1(i + n,N) "}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Other things also happen 100 times but this takes most of the time according to the profiler. Is mod1 expected to be slow? If it is something not known I can try and do a MWE to post a better question."}]}]}],"thread_ts":"1617309052.089600","reply_count":15,"reply_users_count":4,"latest_reply":"1617420251.115700","reply_users":["UEGRU91B2","U7HAYKY9X","U011V2YN59N","U67G3QRJM"],"is_locked":false,"subscribed":false},"blocks":[{"type":"rich_text","block_id":"uDv5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't have a solution to your problem, but I have also found "},{"type":"text","text":"mod1","style":{"code":true}},{"type":"text","text":" to be very slow. I am not sure if that can be fixed though, as I have no frame of reference for the implementation in other languages."}]}]}],"client_msg_id":"bea45f7a-117e-49fd-b978-cf58406220ff"},{"client_msg_id":"cf4a4705-0ff5-4fd7-9626-0e39fbf17c58","type":"message","text":"```julia&gt; y = 112312312; n = 11\n11\n\njulia&gt; @btime mod1($(Ref(y))[], $(Ref(n))[])\n  2.899 ns (0 allocations: 0 bytes)\n2```","user":"U67G3QRJM","ts":"1617318808.090700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M1kVO","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> y = 112312312; n = 11\n11\n\njulia> @btime mod1($(Ref(y))[], $(Ref(n))[])\n  2.899 ns (0 allocations: 0 bytes)\n2"}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"client_msg_id":"fbe3fec0-b830-4080-a9cf-7eb68ab7143d","type":"message","text":"Doesn’t seem very slow?","user":"U67G3QRJM","ts":"1617318813.090900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gLYV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Doesn’t seem very slow?"}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"client_msg_id":"0702a9ec-7f7b-4eef-89fb-0953b0d91d55","type":"message","text":"```julia&gt; i, n, N = 111234, 234234, 123\n(111234, 234234, 123)\n\njulia&gt; @btime nth_neighbor($(Ref(i))[], $(Ref(n))[], $(Ref(N))[])\n  3.039 ns (0 allocations: 0 bytes)```","user":"U67G3QRJM","ts":"1617318926.091100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NRAke","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> i, n, N = 111234, 234234, 123\n(111234, 234234, 123)\n\njulia> @btime nth_neighbor($(Ref(i))[], $(Ref(n))[], $(Ref(N))[])\n  3.039 ns (0 allocations: 0 bytes)"}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"client_msg_id":"fbd52979-b1c7-4bc0-a882-fbfcb03b32c8","type":"message","text":"<@U67G3QRJM> hm good point, I think I was too hyperbolic there :sweat_smile: it is about twice as slow as most other arithmetic operations.","user":"U011V2YN59N","ts":"1617324196.091300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PDI","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U67G3QRJM"},{"type":"text","text":" hm good point, I think I was too hyperbolic there "},{"type":"emoji","name":"sweat_smile"},{"type":"text","text":" it is about twice as slow as most other arithmetic operations."}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"client_msg_id":"47f730c0-b91b-4740-b7e8-533a0bec9171","type":"message","text":"Funny, David’s example gives me\n```julia&gt; @btime nth_neighbor($(Ref(i))[], $(Ref(n))[], $(Ref(N))[])\n  9.486 ns (0 allocations: 0 bytes)\n84```","user":"UEGRU91B2","ts":"1617403986.112400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"r5u","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Funny, David’s example gives me\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime nth_neighbor($(Ref(i))[], $(Ref(n))[], $(Ref(N))[])\n  9.486 ns (0 allocations: 0 bytes)\n84"}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"client_msg_id":"965fe16e-cea1-43fb-be54-4892024cc0a6","type":"message","text":"(on Julia 1.6 and Intel i7)","user":"UEGRU91B2","ts":"1617404047.112600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"W2yX9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(on Julia 1.6 and Intel i7)"}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"client_msg_id":"4274b9f1-69a2-49a7-aff2-fb0dc94949b6","type":"message","text":"```julia&gt; @btime nth_neighbor($(Ref(i))[], $(Ref(n))[], $(Ref(N))[])\n  1.870 ns (0 allocations: 0 bytes)\n84```\nStrange.. I am not sure why yours is so slow. I am on a 5950x, so it is faster than David's but still.","user":"U011V2YN59N","ts":"1617414204.113700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Fs4ku","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime nth_neighbor($(Ref(i))[], $(Ref(n))[], $(Ref(N))[])\n  1.870 ns (0 allocations: 0 bytes)\n84"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Strange.. I am not sure why yours is so slow. I am on a 5950x, so it is faster than David's but still."}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"client_msg_id":"2ebece98-9211-498e-878d-6ff01753245f","type":"message","text":"Perhaps it is due to the way that your CPU implements integer division?","user":"U011V2YN59N","ts":"1617414266.113900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eq0w","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Perhaps it is due to the way that your CPU implements integer division?"}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"client_msg_id":"760a96c8-83c6-4e96-9605-1a8bebd262d7","type":"message","text":"I have read that there are big differences between architectures in that respect. Specifically.. cannon lake? is slow at it. I am not sure though.","user":"U011V2YN59N","ts":"1617414317.114100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"j2A","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have read that there are big differences between architectures in that respect. Specifically.. cannon lake? is slow at it. I am not sure though."}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"type":"message","text":"Is that true? Because I have cannon lake","files":[{"id":"F01SSE65HGX","created":1617417830,"timestamp":1617417830,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"UEGRU91B2","editable":false,"size":45564,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01SSE65HGX/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01SSE65HGX/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01SSE65HGX-72ae446242/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01SSE65HGX-72ae446242/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01SSE65HGX-72ae446242/image_360.png","thumb_360_w":360,"thumb_360_h":82,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01SSE65HGX-72ae446242/image_480.png","thumb_480_w":480,"thumb_480_h":109,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01SSE65HGX-72ae446242/image_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01SSE65HGX-72ae446242/image_720.png","thumb_720_w":720,"thumb_720_h":164,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01SSE65HGX-72ae446242/image_800.png","thumb_800_w":800,"thumb_800_h":182,"thumb_960":"https://files.slack.com/files-tmb/T68168MUP-F01SSE65HGX-72ae446242/image_960.png","thumb_960_w":960,"thumb_960_h":219,"thumb_1024":"https://files.slack.com/files-tmb/T68168MUP-F01SSE65HGX-72ae446242/image_1024.png","thumb_1024_w":1024,"thumb_1024_h":233,"original_w":1484,"original_h":338,"thumb_tiny":"AwAKADDR4z2FOqMk+pqQUAFFFB6UAJk0c0icinUAf//Z","permalink":"https://julialang.slack.com/files/UEGRU91B2/F01SSE65HGX/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01SSE65HGX-c23902165b","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"bbZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is that true? Because I have cannon lake"}]}]}],"user":"UEGRU91B2","display_as_bot":false,"ts":"1617417833.115300","thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"},{"client_msg_id":"9728c670-54f5-4b50-b1da-885022ab3db3","type":"message","text":"hah my mistake, it's actually faster on cannon lake\n```Integer division has traditionally been implemented with microcode. Depending on the values of the input registers, division could take as long as 90 cycles on Skylake. Cannon Lake improves the divider microcode to bring the runtime down to 10-18 cycles.```\nthis is just from an old reddit post though so take with a grain of salt. I'm sure there are official sources but I couldn't find them with a quick google. Either way cannon lake should not be worse.","user":"U011V2YN59N","ts":"1617420251.115700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"foBD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hah my mistake, it's actually faster on cannon lake\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"Integer division has traditionally been implemented with microcode. Depending on the values of the input registers, division could take as long as 90 cycles on Skylake. Cannon Lake improves the divider microcode to bring the runtime down to 10-18 cycles."}]},{"type":"rich_text_section","elements":[{"type":"text","text":"this is just from an old reddit post though so take with a grain of salt. I'm sure there are official sources but I couldn't find them with a quick google. Either way cannon lake should not be worse."}]}]}],"thread_ts":"1617309052.089600","parent_user_id":"UEGRU91B2"}]