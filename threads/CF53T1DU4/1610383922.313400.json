[{"type":"message","text":"Is there a way to hint/force a particular function call to be inlined? [Inlined from the caller site.]","user":"U9MD78Z9N","ts":"1610383922.313400","team":"T68168MUP","edited":{"user":"U9MD78Z9N","ts":"1610384693.000000"},"thread_ts":"1610383922.313400","reply_count":22,"reply_users_count":4,"latest_reply":"1610385597.318000","reply_users":["UAUPJLBQX","U9MD78Z9N","U0179G7FG4F","U67BJLYCS"],"subscribed":false},{"client_msg_id":"b4684cb4-ddde-4d82-afec-e47d9c92de06","type":"message","text":"`@inline` on the definition of the function you want to be inlined.","user":"UAUPJLBQX","ts":"1610384127.313500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6oqy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"@inline","style":{"code":true}},{"type":"text","text":" on the definition of the function you want to be inlined."}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"type":"message","text":"I don't want to nudge that a certain function might be inlined more often. I want the function call, in this context to be inlined.","user":"U9MD78Z9N","ts":"1610384197.313700","team":"T68168MUP","thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"b97976a4-10dc-4f6f-9f07-59111c3fb865","type":"message","text":"`@inline` is not ignored unless the call is type unstable","user":"UAUPJLBQX","ts":"1610384217.313900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dHeB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"@inline","style":{"code":true}},{"type":"text","text":" is not ignored unless the call is type unstable"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"0374e939-63c7-4455-b561-83d3f5126f63","type":"message","text":"`Base.@_inline_meta` does what you want, but it's internal","user":"U0179G7FG4F","ts":"1610384218.314100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vZblb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Base.@_inline_meta","style":{"code":true}},{"type":"text","text":" does what you want, but it's internal"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"7707c93e-f222-4872-a09d-59ec2f5a6ced","type":"message","text":"That does the same thing as `@inline`","user":"UAUPJLBQX","ts":"1610384266.314300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2nsbS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That does the same thing as "},{"type":"text","text":"@inline","style":{"code":true}}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"e65107a1-99e6-4e52-a0d8-ec641d108f36","type":"message","text":"```julia&gt; @macroexpand function foo()\n           Base.@_inline_meta\n       end\n:(function foo()\n      #= REPL[47]:1 =#\n      #= REPL[47]:2 =#\n      $(Expr(:meta, :inline))\n  end)\n\njulia&gt; @macroexpand @inline function foo()\n\n       end\n:(function foo()\n      $(Expr(:meta, :inline))\n      #= REPL[48]:1 =#\n      #= REPL[48]:3 =#\n  end)```","user":"UAUPJLBQX","ts":"1610384268.314500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pMiQm","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @macroexpand function foo()\n           Base.@_inline_meta\n       end\n:(function foo()\n      #= REPL[47]:1 =#\n      #= REPL[47]:2 =#\n      $(Expr(:meta, :inline))\n  end)\n\njulia> @macroexpand @inline function foo()\n\n       end\n:(function foo()\n      $(Expr(:meta, :inline))\n      #= REPL[48]:1 =#\n      #= REPL[48]:3 =#\n  end)"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"96e35187-298d-4eb3-9e4d-f7d61bc0bd3f","type":"message","text":"I thought the purpose of `Base.@_inline_meta` was that `Base.@_inline_meta f()` inlines the call to `f` from the caller side","user":"U0179G7FG4F","ts":"1610384342.314700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RqB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I thought the purpose of "},{"type":"text","text":"Base.@_inline_meta","style":{"code":true}},{"type":"text","text":" was that "},{"type":"text","text":"Base.@_inline_meta f()","style":{"code":true}},{"type":"text","text":" inlines the call to "},{"type":"text","text":"f","style":{"code":true}},{"type":"text","text":" from the caller side"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"08d5ae2f-52fc-4048-b127-5560347ad7e4","type":"message","text":"Oh, from the caller side.\nI don't think that's possible? But I could be out of date on that.","user":"UAUPJLBQX","ts":"1610384397.314900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pXf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh, from the caller side.\nI don't think that's possible? But I could be out of date on that."}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"2c699231-a1e1-4228-8590-d46b1eedf83f","type":"message","text":"I thought it existed because `@inline` isn't available until a later stage in the bootstrapping process, or something to that effect","user":"UAUPJLBQX","ts":"1610384448.315100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ELMmr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I thought it existed because "},{"type":"text","text":"@inline","style":{"code":true}},{"type":"text","text":" isn't available until a later stage in the bootstrapping process, or something to that effect"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"9394eaf1-e363-4244-83b1-8fe1fdb4d484","type":"message","text":"You could follow the pattern:\n```@inline function _inline_foo(args...)\n    # do stuff\nend\nfoo(args...) = _inline_foo(args...)```\n","user":"UAUPJLBQX","ts":"1610384480.315300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JYC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You could follow the pattern:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@inline function _inline_foo(args...)\n    # do stuff\nend\nfoo(args...) = _inline_foo(args...)"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"3b6a8f52-1596-4ff9-b7ba-f6c2e9e81586","type":"message","text":"and then call `_inline_foo` if you want the inlined version, and `foo` when you want to let the compiler decide.","user":"UAUPJLBQX","ts":"1610384504.315500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=G2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and then call "},{"type":"text","text":"_inline_foo","style":{"code":true}},{"type":"text","text":" if you want the inlined version, and "},{"type":"text","text":"foo","style":{"code":true}},{"type":"text","text":" when you want to let the compiler decide."}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"5f374410-aa58-4f4a-ba2d-f1a142aa6955","type":"message","text":"Also, if `Base.@_inline_meta exp(x)` worked...\nBut the fact that the macro just inserts a `$(Expr(:meta,:inline))` is proof enough it doesn't.","user":"UAUPJLBQX","ts":"1610384524.315700","team":"T68168MUP","edited":{"user":"UAUPJLBQX","ts":"1610384595.000000"},"blocks":[{"type":"rich_text","block_id":"y9SyC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also, if "},{"type":"text","text":"Base.@_inline_meta exp(x)","style":{"code":true}},{"type":"text","text":" worked...\nBut the fact that the macro just inserts a "},{"type":"text","text":"$(Expr(:meta,:inline))","style":{"code":true}},{"type":"text","text":" is proof enough it doesn't."}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"type":"message","text":"Thanks, i complain at the place with the best core Julia developer visibility <#C67TK21LJ> to learn more.","user":"U9MD78Z9N","ts":"1610385026.316100","team":"T68168MUP","thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"e8ec8705-5c96-4a36-907a-250ffb8d9de0","type":"message","text":"No we don't have caller side inlining","user":"U67BJLYCS","ts":"1610385248.316300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CgA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"No we don't have caller side inlining"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N","reactions":[{"name":"correct_answer","users":["U9MD78Z9N"],"count":1}]},{"client_msg_id":"861978d4-a5c9-4644-abab-679d48cad1fa","type":"message","text":"theoretically writing a reverse inline macro would be possible right? All it would have to do is get the source code of the function and insert it (realistically, you also probably have to rename all the variables to prevent conflicts with the outer funcion","user":"U0179G7FG4F","ts":"1610385279.316600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+/Ch","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"theoretically writing a reverse inline macro would be possible right? All it would have to do is get the source code of the function and insert it (realistically, you also probably have to rename all the variables to prevent conflicts with the outer funcion"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"423576a4-2877-46dc-a100-e2c46db28461","type":"message","text":"Oh yeah it's possible :slightly_smiling_face:","user":"U67BJLYCS","ts":"1610385313.316800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uj2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh yeah it's possible "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"0c431f96-249c-44bb-bd32-d7567c66abed","type":"message","text":"you \"just\" need to get the metadata to the right place","user":"U67BJLYCS","ts":"1610385328.317000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ubR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you \"just\" need to get the metadata to the right place"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"type":"message","text":"And you need to make world age aware of the dependency.","user":"U9MD78Z9N","ts":"1610385345.317200","team":"T68168MUP","thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"fde0f08d-0c23-40bd-963b-5da955e68f1d","type":"message","text":"that should be fine. I.e. you need to tell the inliner that it should inline this call if possible","user":"U67BJLYCS","ts":"1610385384.317400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OcEl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that should be fine. I.e. you need to tell the inliner that it should inline this call if possible"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"70215dba-bb26-4d39-8177-fbc3b89f72cc","type":"message","text":"probably a fun project for someone who wants to learn about core/compiler","user":"U67BJLYCS","ts":"1610385408.317600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XWd0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"probably a fun project for someone who wants to learn about core/compiler"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"client_msg_id":"5c8c0a33-ccf9-4bc2-990f-5024540d422d","type":"message","text":"it would also be really valuable for `LoopVectorization` since it would allow the library to better unroll loops with special function calls","user":"U0179G7FG4F","ts":"1610385503.317800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Z8uZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it would also be really valuable for "},{"type":"text","text":"LoopVectorization","style":{"code":true}},{"type":"text","text":" since it would allow the library to better unroll loops with special function calls"}]}]}],"thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"},{"type":"message","text":"I currently have enough fun Julia project, so someone else can call dips on this, if it doesn't get done at all i might look into it.","user":"U9MD78Z9N","ts":"1610385597.318000","team":"T68168MUP","thread_ts":"1610383922.313400","parent_user_id":"U9MD78Z9N"}]