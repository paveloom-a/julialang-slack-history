[{"client_msg_id":"0a390832-7399-4f7b-9a00-c72225a5794f","type":"message","text":"I have a function like this (what it does isn't really important):\n```function stabilize(curr, tolerance, distance=maximum(size(curr)))\n    prev = nothing\n    while prev != curr\n        prev = deepcopy(curr)\n        for I in CartesianIndices(curr)\n            prev[I] == 'L' &amp;&amp; count_occupied(prev, I, distance) == 0         &amp;&amp; (curr[I] = '#')\n            prev[I] == '#' &amp;&amp; count_occupied(prev, I, distance) &gt;= tolerance &amp;&amp; (curr[I] = 'L')\n        end\n    end\n    count(==('#'), curr)\nend```\nAnd it takes this long to run:\n```julia&gt; @btime stabilize(......, 4, 1)\n  38.350 ms (720 allocations: 4.00 MiB)```\nBut the moment I replace `tolerance` and `distance` with the respective values in the function I see an improvement:\n```julia&gt; @btime stabilize(......)\n  13.499 ms (720 allocations: 4.00 MiB)```\nWhy is this the case?","user":"UC81ESVH6","ts":"1609280309.249400","team":"T68168MUP","edited":{"user":"UC81ESVH6","ts":"1609280384.000000"},"blocks":[{"type":"rich_text","block_id":"H9Z6C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have a function like this (what it does isn't really important):\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function stabilize(curr, tolerance, distance=maximum(size(curr)))\n    prev = nothing\n    while prev != curr\n        prev = deepcopy(curr)\n        for I in CartesianIndices(curr)\n            prev[I] == 'L' && count_occupied(prev, I, distance) == 0         && (curr[I] = '#')\n            prev[I] == '#' && count_occupied(prev, I, distance) >= tolerance && (curr[I] = 'L')\n        end\n    end\n    count(==('#'), curr)\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"And it takes this long to run:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime stabilize(......, 4, 1)\n  38.350 ms (720 allocations: 4.00 MiB)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"But the moment I replace "},{"type":"text","text":"tolerance","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"distance","style":{"code":true}},{"type":"text","text":" with the respective values in the function I see an improvement:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime stabilize(......)\n  13.499 ms (720 allocations: 4.00 MiB)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Why is this the case?"}]}]}],"thread_ts":"1609280309.249400","reply_count":7,"reply_users_count":3,"latest_reply":"1609282422.250900","reply_users":["UH24GRBLL","UC81ESVH6","U01GMP3HF9C"],"subscribed":false},{"client_msg_id":"c883aec4-e99d-42f1-8c66-5d01c331b6b2","type":"message","text":"you mean in the function definition?","user":"UH24GRBLL","ts":"1609280644.249700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"k=wSk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you mean in the function definition?"}]}]}],"thread_ts":"1609280309.249400","parent_user_id":"UC81ESVH6"},{"client_msg_id":"38ce8bc0-9662-4750-91a7-18d63fa78d22","type":"message","text":"most likely constant propagation","user":"UH24GRBLL","ts":"1609280649.249900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b3q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"most likely constant propagation"}]}]}],"thread_ts":"1609280309.249400","parent_user_id":"UC81ESVH6"},{"client_msg_id":"b6e46c6f-aae7-4e97-acd8-d3bd03843ad8","type":"message","text":"if you hard code the values in the function itself, the compiler has access to it","user":"UH24GRBLL","ts":"1609280662.250100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Uyu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if you hard code the values in the function itself, the compiler has access to it"}]}]}],"thread_ts":"1609280309.249400","parent_user_id":"UC81ESVH6"},{"client_msg_id":"3e8e1cf6-7b2b-4f1d-af23-4e9e629ea54f","type":"message","text":"if you \"only\" pass them in, they may not be propagated far enough to allow for the same optimization","user":"UH24GRBLL","ts":"1609280685.250300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Cphb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if you \"only\" pass them in, they may not be propagated far enough to allow for the same optimization"}]}]}],"thread_ts":"1609280309.249400","parent_user_id":"UC81ESVH6"},{"client_msg_id":"0289ebc5-3592-4425-bf10-bbb61fe793da","type":"message","text":"Yes, I meant the function definition.","user":"UC81ESVH6","ts":"1609280694.250500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8QgPX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, I meant the function definition."}]}]}],"thread_ts":"1609280309.249400","parent_user_id":"UC81ESVH6"},{"client_msg_id":"224f5b33-0ee4-4cd7-8fb8-4dcfd3bd9268","type":"message","text":"Is it possible to nudge the compiler to optimize?","user":"UC81ESVH6","ts":"1609280747.250700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Jdd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is it possible to nudge the compiler to optimize?"}]}]}],"thread_ts":"1609280309.249400","parent_user_id":"UC81ESVH6"},{"client_msg_id":"fcc4fe83-9b4b-4467-a0ed-7b3516a87233","type":"message","text":"would it change the efficiency to formulate this using an auxiliary function?","user":"U01GMP3HF9C","ts":"1609282422.250900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yiyY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"would it change the efficiency to formulate this using an auxiliary function?"}]}]}],"thread_ts":"1609280309.249400","parent_user_id":"UC81ESVH6"}]