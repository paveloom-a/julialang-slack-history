[{"client_msg_id":"108417d8-e4ca-401c-a8e1-72ccfc1df940","type":"message","text":"<@UEP056STX> I switched to `ConstantSmagorinsky` because `AnisotropicMinimumDissipation`  was causing diffusion of the pycnocline before the forcing started and the strength of the stratification is crucial to the case. Maybe I will try a finer grid and see what happens.\n\n<@U01E0U2RJJ2> Yes I am forcing from a file. The surface forcing is from a meterological buoy. I have studied the forcing extensively but, now that I think about it, I don’t think I have plotted the functions that I fit to the data in the run script. I should probably check that the fitting didn’t cause any weird jumps in the forcing. There is a decrease in wind speed right around that time but I didn’t think it would be felt so immediately through the whole surface.\nI know this question might not have a very direct answer but is there a standard method to finding the turbulent velocity components needed to calculate TKE? Is there a standard time scale to average over to get the Reynold’s averaged component?","user":"U01LBJ2VA9Z","ts":"1614277982.057000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rrD","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UEP056STX"},{"type":"text","text":" I switched to "},{"type":"text","text":"ConstantSmagorinsky","style":{"code":true}},{"type":"text","text":" because "},{"type":"text","text":"AnisotropicMinimumDissipation","style":{"code":true}},{"type":"text","text":"  was causing diffusion of the pycnocline before the forcing started and the strength of the stratification is crucial to the case. Maybe I will try a finer grid and see what happens.\n\n"},{"type":"user","user_id":"U01E0U2RJJ2"},{"type":"text","text":" Yes I am forcing from a file. The surface forcing is from a meterological buoy. I have studied the forcing extensively but, now that I think about it, I don’t think I have plotted the functions that I fit to the data in the run script. I should probably check that the fitting didn’t cause any weird jumps in the forcing. There is a decrease in wind speed right around that time but I didn’t think it would be felt so immediately through the whole surface.\nI know this question might not have a very direct answer but is there a standard method to finding the turbulent velocity components needed to calculate TKE? Is there a standard time scale to average over to get the Reynold’s averaged component?"}]}]}],"thread_ts":"1614277982.057000","reply_count":20,"reply_users_count":3,"latest_reply":"1614283763.069300","reply_users":["U01E0U2RJJ2","UMZQBQU67","U01LBJ2VA9Z"],"subscribed":false},{"client_msg_id":"25fda16f-9cb4-4786-9567-25ede7ff7a8b","type":"message","text":"So checking your functions is definitely something to do! haha","user":"U01E0U2RJJ2","ts":"1614279270.057300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JX=iN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So checking your functions is definitely something to do! haha"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z","reactions":[{"name":"+1","users":["UMZQBQU67"],"count":1}]},{"client_msg_id":"bc956416-44e4-456c-89f8-bd3e59d5deeb","type":"message","text":"For the TKE, if you're running on a CPU you can simply do something like","user":"U01E0U2RJJ2","ts":"1614279302.057500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LOn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For the TKE, if you're running on a CPU you can simply do something like"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"92cf6216-5098-49eb-9b88-689ffaa255c8","type":"message","text":"```u, v, w = model.velocities\ntke = ComputedField((u^2+v^2+w^2)/2)```","user":"U01E0U2RJJ2","ts":"1614279307.057700","team":"T68168MUP","edited":{"user":"U01E0U2RJJ2","ts":"1614279334.000000"},"blocks":[{"type":"rich_text","block_id":"cG0yH","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"u, v, w = model.velocities\ntke = ComputedField((u^2+v^2+w^2)/2)"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"95e34917-a268-416b-8277-5269432544be","type":"message","text":"ALthough I haven't tested, so there might be typos","user":"U01E0U2RJJ2","ts":"1614279358.058100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"T9Gzs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ALthough I haven't tested, so there might be typos"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"c088a48c-067d-4693-a7b7-e82bfee6b6cd","type":"message","text":"If you're running on GPUs you gotta do a bit more work (that we can help you with for sure)","user":"U01E0U2RJJ2","ts":"1614279385.058300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xAPjW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you're running on GPUs you gotta do a bit more work (that we can help you with for sure)"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"93ad3faa-9e96-4f37-99a9-f72d734402f5","type":"message","text":"As for the time scale, that's very dependent on your problem, so really there isn't any answer I can give you there","user":"U01E0U2RJJ2","ts":"1614279427.058500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Y7Bf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"As for the time scale, that's very dependent on your problem, so really there isn't any answer I can give you there"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"21a6761d-131e-4ab5-8dd2-064e74c90908","type":"message","text":"The vertical velocity is also often a good proxy for TKE. Outputting 2D (eg y-z) slices of w and making an animation can be a quick way to understand what’s going on in your solution","user":"UMZQBQU67","ts":"1614279987.058700","team":"T68168MUP","edited":{"user":"UMZQBQU67","ts":"1614280036.000000"},"blocks":[{"type":"rich_text","block_id":"hCY+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The vertical velocity is also often a good proxy for TKE. Outputting 2D (eg y-z) slices of w and making an animation can be a quick way to understand what’s going on in your solution"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"61d24c99-40f9-46f5-b20a-eddee0e571f8","type":"message","text":"<@U01E0U2RJJ2> Thank you! I am running on CPU’s for now so that makes things a bit easier. I had a feeling that the time scale was problem dependent, there is never an easy answer when dealing with turbulence haha.\nSo I wouldn’t be able to soundly calculate TKE from my horizontal mean fields that I already have outputted? The run took about 10 days so if I can avoid doing multiple reruns that would be good.","user":"U01LBJ2VA9Z","ts":"1614280363.062300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=ps","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U01E0U2RJJ2"},{"type":"text","text":" Thank you! I am running on CPU’s for now so that makes things a bit easier. I had a feeling that the time scale was problem dependent, there is never an easy answer when dealing with turbulence haha.\nSo I wouldn’t be able to soundly calculate TKE from my horizontal mean fields that I already have outputted? The run took about 10 days so if I can avoid doing multiple reruns that would be good."}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"388cf3b3-8e9f-45e1-a446-e410d51689c6","type":"message","text":"<@UMZQBQU67> So I would use the horizontal mean field as the mean to calculate the perturbations with which I can calculate TKE","user":"U01LBJ2VA9Z","ts":"1614280419.063600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"s4A4","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UMZQBQU67"},{"type":"text","text":" So I would use the horizontal mean field as the mean to calculate the perturbations with which I can calculate TKE"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"7a02a692-e6bf-4ce8-9e43-cf117796ae4d","type":"message","text":"For sure, though I suggest you reuse our existing implementations. There’s one in the LESbrary:\n\n<https://github.com/CliMA/LESbrary.jl/blob/master/src/TurbulenceStatistics/turbulent_kinetic_energy.jl>\n\nwhich you can use via\n\n```using LESbrary.TurbulenceStatistics: TurbulentKineticEnergy\ntke = TurbulentKineticEnergy(model)```\n(We should also port this over to Oceanostics.jl and implement it with `KernelComputedField`… but anyways.)","user":"UMZQBQU67","ts":"1614280489.064200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5HzO0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For sure, though I suggest you reuse our existing implementations. There’s one in the LESbrary:\n\n"},{"type":"link","url":"https://github.com/CliMA/LESbrary.jl/blob/master/src/TurbulenceStatistics/turbulent_kinetic_energy.jl"},{"type":"text","text":"\n\nwhich you can use via\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using LESbrary.TurbulenceStatistics: TurbulentKineticEnergy\ntke = TurbulentKineticEnergy(model)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n(We should also port this over to Oceanostics.jl and implement it with "},{"type":"text","text":"KernelComputedField","style":{"code":true}},{"type":"text","text":"… but anyways.)"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"1ab730c2-e752-4bf7-b956-b2736ac0b547","type":"message","text":"Would I need to save the full field of TKE or could I average horizontally still? My intention for this study is to treat the LES as a sophisticated ~1D model and that is why I am averaging horizontally","user":"U01LBJ2VA9Z","ts":"1614280602.065100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Hfa7v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Would I need to save the full field of TKE or could I average horizontally still? My intention for this study is to treat the LES as a sophisticated ~1D model and that is why I am averaging horizontally"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"fc596bf0-a516-44af-9b1b-220464e7534d","type":"message","text":"You can build up computations for output hierarchically, eg:\n\n```using LESbrary.TurbulenceStatistics: TurbulentKineticEnergy\ne = TurbulentKineticEnergy(model)\nE = AveragedField(e, dims=(1, 2))\nU = AveragedField(model.velocities.u, dims=(1, 2))\n\naveraged_outputs = (U=U, E=E)\n\n# put averaged_outputs into an output writer...```","user":"UMZQBQU67","ts":"1614280689.065700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nvgh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You can build up computations for output hierarchically, eg:\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using LESbrary.TurbulenceStatistics: TurbulentKineticEnergy\ne = TurbulentKineticEnergy(model)\nE = AveragedField(e, dims=(1, 2))\nU = AveragedField(model.velocities.u, dims=(1, 2))\n\naveraged_outputs = (U=U, E=E)\n\n# put averaged_outputs into an output writer..."}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"a2b7fa7e-2dd4-4dd5-8c37-52ae40e57d2c","type":"message","text":"Ok so it calculates the field, then I average over the horizontal, then write out the averaged field. Makes sense to me!","user":"U01LBJ2VA9Z","ts":"1614280934.066600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MdjZ+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ok so it calculates the field, then I average over the horizontal, then write out the averaged field. Makes sense to me!"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"1e16d7b8-5af9-4591-9195-56abe03b7fc8","type":"message","text":"For now, I am going to just re-run the first 12 hours so I can look at the TKE and viscosity around that weird jump","user":"U01LBJ2VA9Z","ts":"1614281032.067500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fd+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For now, I am going to just re-run the first 12 hours so I can look at the TKE and viscosity around that weird jump"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"9a15d1e6-dd51-441a-9c19-f9c7a4d819b4","type":"message","text":"How big is the run?","user":"UMZQBQU67","ts":"1614281768.068100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3j=y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How big is the run?"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"166f4f8d-4442-4c67-a9ae-4572afa5bb7d","type":"message","text":"I usually run things at super coarse resolution first just to make sure everything makes sense, and only crank up the resolution once i feel like i know what’s going on. Small runs can complete super quickly esp on the GPU;  you can do 12 hours in just a few minutes.","user":"UMZQBQU67","ts":"1614281828.068300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"db6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I usually run things at super coarse resolution first just to make sure everything makes sense, and only crank up the resolution once i feel like i know what’s going on. Small runs can complete super quickly esp on the GPU;  you can do 12 hours in just a few minutes."}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"c9fde908-d6b1-40f6-9438-da1704eb35ff","type":"message","text":"<@UMZQBQU67> That is a good point. I did initially start coarse and work my way to finer resolution but we were testing and changing so many things that I can’t recall which output file was from the coarse run. The run is 100mx100mx85m with 64x64x128 points. The first 12 hours usually run in approximately real time but after the forcing speeds up, the model slows down hahaha.\nRight now, I don’t have access to a dedicated GPU so I am staying away from that realm but I know I will need to go down that road soon because I want to play with the Craik-Leibovich appx!\nI will add in the TKE steps and run a coarse setup (32x32x128) and see what it looks like. Thanks for all the help, navigating the world of LES Is intimidating but rewarding!","user":"U01LBJ2VA9Z","ts":"1614282564.068500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qAjU","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UMZQBQU67"},{"type":"text","text":" That is a good point. I did initially start coarse and work my way to finer resolution but we were testing and changing so many things that I can’t recall which output file was from the coarse run. The run is 100mx100mx85m with 64x64x128 points. The first 12 hours usually run in approximately real time but after the forcing speeds up, the model slows down hahaha.\nRight now, I don’t have access to a dedicated GPU so I am staying away from that realm but I know I will need to go down that road soon because I want to play with the Craik-Leibovich appx!\nI will add in the TKE steps and run a coarse setup (32x32x128) and see what it looks like. Thanks for all the help, navigating the world of LES Is intimidating but rewarding!"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"fd82930d-4ebd-4c55-a0f4-ef1d12e5b644","type":"message","text":"Of course! You can check out the google cloud --- they have a free trial that gives you $300 of compute time (and access to V100 GPUs) that you can use to get spun up. I’m also hoping that in the next few months we can start running on AMD GPUs, which are a lot cheaper…\n\nLES is interesting --- I think many papers are a bit pretentious in describing LES models. It’s really just a convenient way to avoid having to “tune” an eddy viscosity when you change the resolution of your model. There are a lot of pitfalls and LES models certainly gives bogus answers in a lot of situations (just like any parameterization…) -- so be careful and always make sure your key results are “relatively insensitive” to resolution before publishing anything :stuck_out_tongue:\n\nCraik-Leibovich is another bag of worms entirely, and also tons of fun :-D","user":"UMZQBQU67","ts":"1614282996.068700","team":"T68168MUP","edited":{"user":"UMZQBQU67","ts":"1614283087.000000"},"blocks":[{"type":"rich_text","block_id":"N2aRM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Of course! You can check out the google cloud --- they have a free trial that gives you $300 of compute time (and access to V100 GPUs) that you can use to get spun up. I’m also hoping that in the next few months we can start running on AMD GPUs, which are a lot cheaper…\n\nLES is interesting --- I think many papers are a bit pretentious in describing LES models. It’s really just a convenient way to avoid having to “tune” an eddy viscosity when you change the resolution of your model. There are a lot of pitfalls and LES models certainly gives bogus answers in a lot of situations (just like any parameterization…) -- so be careful and always make sure your key results are “relatively insensitive” to resolution before publishing anything "},{"type":"emoji","name":"stuck_out_tongue"},{"type":"text","text":"\n\nCraik-Leibovich is another bag of worms entirely, and also tons of fun :-D"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z","reactions":[{"name":"thumbsup_all","users":["U01LBJ2VA9Z"],"count":1}]},{"client_msg_id":"678626ed-9b3d-4cae-8761-b1c7c8fe94c8","type":"message","text":"I also find it hard to get GPU access so let me just say that if your project is funded by NSF (or if you can get access to NCAR's supercomputers through any means) then you automatically get access to the Casper GPUs at CISL","user":"U01E0U2RJJ2","ts":"1614283744.069100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VTdq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I also find it hard to get GPU access so let me just say that if your project is funded by NSF (or if you can get access to NCAR's supercomputers through any means) then you automatically get access to the Casper GPUs at CISL"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"},{"client_msg_id":"678626ed-9b3d-4cae-8761-b1c7c8fe94c8","type":"message","text":"I also find it hard to get GPU access so let me just say that if your project is funded by NSF (or if you can get access to NCAR's supercomputers through any means) then you automatically get access to the Casper GPUs at CISL","user":"U01E0U2RJJ2","ts":"1614283763.069300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"q/86","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I also find it hard to get GPU access so let me just say that if your project is funded by NSF (or if you can get access to NCAR's supercomputers through any means) then you automatically get access to the Casper GPUs at CISL"}]}]}],"thread_ts":"1614277982.057000","parent_user_id":"U01LBJ2VA9Z"}]