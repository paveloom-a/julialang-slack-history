[{"client_msg_id":"D880894E-B3E5-4925-8ED6-84162B14E57A","type":"message","text":"Is there a relatively simple way to save the velocity values before the pressure correction step? Either along with the regular velocity output (ideal) or just instead of the usual velocity output. ","user":"U01DJ59B2SE","ts":"1616526579.020300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7t=d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a relatively simple way to save the velocity values before the pressure correction step? Either along with the regular velocity output (ideal) or just instead of the usual velocity output. "}]}]}],"thread_ts":"1616526579.020300","reply_count":7,"reply_users_count":1,"latest_reply":"1616528595.022500","reply_users":["UEP056STX"],"subscribed":false},{"client_msg_id":"3a9417f9-f48d-420b-b36a-ebc8f6e745c2","type":"message","text":"I don't think there's any super easy way unfortunately... Right now output only happens at the very end of a time step.","user":"UEP056STX","ts":"1616528150.020400","team":"T68168MUP","edited":{"user":"UEP056STX","ts":"1616528320.000000"},"blocks":[{"type":"rich_text","block_id":"ZFy8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't think there's any super easy way unfortunately... Right now output only happens at the very end of a time step."}]}]}],"thread_ts":"1616526579.020300","parent_user_id":"U01DJ59B2SE"},{"client_msg_id":"d81dd512-7a7b-43b1-a80c-9632fb435a00","type":"message","text":"Presumably this is for debugging? If so then shouldn't be too hard to hack something in","user":"UEP056STX","ts":"1616528192.020600","team":"T68168MUP","edited":{"user":"UEP056STX","ts":"1616528218.000000"},"blocks":[{"type":"rich_text","block_id":"Bfiy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Presumably this is for debugging? If so then shouldn't be too hard to hack something in"}]}]}],"thread_ts":"1616526579.020300","parent_user_id":"U01DJ59B2SE"},{"client_msg_id":"99033182-d48e-4961-b7f3-1a56f1c2e4e2","type":"message","text":"You could use a JLD2 file and manually write the velocity fields into it before each pressure correction step","user":"UEP056STX","ts":"1616528232.021000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QwAFt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You could use a JLD2 file and manually write the velocity fields into it before each pressure correction step"}]}]}],"thread_ts":"1616526579.020300","parent_user_id":"U01DJ59B2SE"},{"client_msg_id":"fd912c51-9079-4296-a34d-91cad60ae08c","type":"message","text":"You could then save also save the regular velocities along with it so both velocity fields end up in one file.","user":"UEP056STX","ts":"1616528283.021200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KoOc=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You could then save also save the regular velocities along with it so both velocity fields end up in one file."}]}]}],"thread_ts":"1616526579.020300","parent_user_id":"U01DJ59B2SE"},{"client_msg_id":"2aabb6ca-e579-4657-a4e5-b26e067be736","type":"message","text":"Assuming you're using RK3 you could add some lines around <https://github.com/CliMA/Oceananigans.jl/blob/80b0aad76cc4ca70cc146177ca19e34ff790d51c/src/TimeSteppers/runge_kutta_3.jl#L79-L82>","user":"UEP056STX","ts":"1616528376.022000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XFH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Assuming you're using RK3 you could add some lines around "},{"type":"link","url":"https://github.com/CliMA/Oceananigans.jl/blob/80b0aad76cc4ca70cc146177ca19e34ff790d51c/src/TimeSteppers/runge_kutta_3.jl#L79-L82"}]}]}],"thread_ts":"1616526579.020300","parent_user_id":"U01DJ59B2SE"},{"client_msg_id":"b814f170-7ebc-4d6a-a917-8719b8c3efdd","type":"message","text":"Before the pressure correction you could do\n```jldopen(\"velocities.jld2\", \"a+\") do file\n    i = model.clock.iteration\n    file[\"velocities_before_correction/u/$i\"] = model.velocities.u.data.parent\n    file[\"velocities_before_correction/v/$i\"] = model.velocities.v.data.parent\n    file[\"velocities_before_correction/w/$i\"] = model.velocities.w.data.parent\nend```\nand something similar after with `file[\"velocities/...\"]`","user":"UEP056STX","ts":"1616528560.022200","team":"T68168MUP","edited":{"user":"UEP056STX","ts":"1616528562.000000"},"blocks":[{"type":"rich_text","block_id":"mBlQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Before the pressure correction you could do\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"jldopen(\"velocities.jld2\", \"a+\") do file\n    i = model.clock.iteration\n    file[\"velocities_before_correction/u/$i\"] = model.velocities.u.data.parent\n    file[\"velocities_before_correction/v/$i\"] = model.velocities.v.data.parent\n    file[\"velocities_before_correction/w/$i\"] = model.velocities.w.data.parent\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"and something similar after with "},{"type":"text","text":"file[\"velocities/...\"]","style":{"code":true}}]}]}],"thread_ts":"1616526579.020300","parent_user_id":"U01DJ59B2SE"},{"client_msg_id":"c91e167d-c95e-448b-8e9b-1b16684139fe","type":"message","text":"If you don't want the halos you could do `interior(model.velocities.u)` or `interiorparent(model.velocities.u)` instead of `model.velocities.u.data.parent`","user":"UEP056STX","ts":"1616528595.022500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jpE95","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you don't want the halos you could do "},{"type":"text","text":"interior(model.velocities.u)","style":{"code":true}},{"type":"text","text":" or "},{"type":"text","text":"interiorparent(model.velocities.u)","style":{"code":true}},{"type":"text","text":" instead of "},{"type":"text","text":"model.velocities.u.data.parent","style":{"code":true}}]}]}],"thread_ts":"1616526579.020300","parent_user_id":"U01DJ59B2SE"}]