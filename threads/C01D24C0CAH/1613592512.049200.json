[{"client_msg_id":"774ddbd0-d50f-40f0-8604-533e28e6a45d","type":"message","text":"Don't think this is possible using just `AveragedField` and `FieldSlicer` as field slicing acts on the final result (in this case, it acts after the average has been computed).","user":"UEP056STX","ts":"1613592512.049200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"X/hY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Don't think this is possible using just "},{"type":"text","text":"AveragedField","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"FieldSlicer","style":{"code":true}},{"type":"text","text":" as field slicing acts on the final result (in this case, it acts after the average has been computed)."}]}]}],"thread_ts":"1613592512.049200","reply_count":21,"reply_users_count":3,"latest_reply":"1613764807.057200","reply_users":["U01E0U2RJJ2","UEP056STX","UMZQBQU67"],"subscribed":false},{"client_msg_id":"3b4f7dba-c190-446b-a6a4-f798087a7c6a","type":"message","text":"Hmm, that's what I was afraid of","user":"U01E0U2RJJ2","ts":"1613592621.050900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0/To","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm, that's what I was afraid of"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"e304ad39-432c-4290-b41a-51cb0f0c1f14","type":"message","text":"I'm trying to avoid as much post-processing as possible","user":"U01E0U2RJJ2","ts":"1613592645.051100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hP8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm trying to avoid as much post-processing as possible"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"9c48b23c-4706-444a-93f0-d293fece178d","type":"message","text":"Yeah same here...","user":"UEP056STX","ts":"1613592663.051300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SfeRF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah same here..."}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"63e97517-c428-48f7-86b1-2ca6d0238c1b","type":"message","text":"Is there any workaround at the moment? So that FieldSlicer can be applied before averaging?","user":"U01E0U2RJJ2","ts":"1613592681.051500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fpA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there any workaround at the moment? So that FieldSlicer can be applied before averaging?"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"2910a42f-9575-4a11-9e9f-06527414a2f8","type":"message","text":"I think <@UMZQBQU67> has proposed adding a `WindowedField` or `SlicedField` that represents some slice of a larger 3D field.","user":"UEP056STX","ts":"1613592711.051700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b6d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think "},{"type":"user","user_id":"UMZQBQU67"},{"type":"text","text":" has proposed adding a "},{"type":"text","text":"WindowedField","style":{"code":true}},{"type":"text","text":" or "},{"type":"text","text":"SlicedField","style":{"code":true}},{"type":"text","text":" that represents some slice of a larger 3D field."}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"bda6a3e2-1542-4d41-9a17-8366248b5293","type":"message","text":"Part of the `SlicedField` functionality could be that if you pass it to `AveragedField`, it'll only average the particular slice.","user":"UEP056STX","ts":"1613592739.051900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ujD9t","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Part of the "},{"type":"text","text":"SlicedField","style":{"code":true}},{"type":"text","text":" functionality could be that if you pass it to "},{"type":"text","text":"AveragedField","style":{"code":true}},{"type":"text","text":", it'll only average the particular slice."}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"f5639dfb-5d4a-4bed-9377-1ff6c4e572e1","type":"message","text":"It can be done as part of the simulation script","user":"UEP056STX","ts":"1613592777.052100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sj9Rc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It can be done as part of the simulation script"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"dd24e320-fff3-4ffd-b22f-ba43c32868df","type":"message","text":"Yeah, I agree","user":"U01E0U2RJJ2","ts":"1613592777.052300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jnno","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, I agree"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"b27ceaaa-cc10-4fe5-a23f-f1c2f7c1fed5","type":"message","text":"That would be super useful","user":"U01E0U2RJJ2","ts":"1613592782.052500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4mGU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That would be super useful"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"dfd62176-e37b-451e-a649-491ea1e4a2f5","type":"message","text":"Also I think the way it is done right now might be misleading. I have been using the example AveragedFields+Slicer I sent on the channel for a while before I realized that it might not be doing what I thought it was doing","user":"U01E0U2RJJ2","ts":"1613592846.052700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vos","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also I think the way it is done right now might be misleading. I have been using the example AveragedFields+Slicer I sent on the channel for a while before I realized that it might not be doing what I thought it was doing"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"8dbeef77-32b6-4949-b099-e0671adc0a59","type":"message","text":"Is there a comment/warning about that in the docs?","user":"U01E0U2RJJ2","ts":"1613592888.053200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+Az","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a comment/warning about that in the docs?"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"46f74c83-2353-4fc4-bc72-322873773df7","type":"message","text":"I think you'll have to define a custom function that does something like\n```function custom_average(model)\n    U = AveragedField(model.velocities.u, dims=1)\n    compute!(U)    \n    U_slice_averaged = mean(U.data[1, 20:50, 1:<http://grid.Nz|grid.Nz>], dims=2)\n    return U_slice_averaged\nend```\nbut this is pretty hacky...","user":"UEP056STX","ts":"1613592912.053900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bI7lB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think you'll have to define a custom function that does something like\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function custom_average(model)\n    U = AveragedField(model.velocities.u, dims=1)\n    compute!(U)    \n    U_slice_averaged = mean(U.data[1, 20:50, 1:grid.Nz], dims=2)\n    return U_slice_averaged\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"but this is pretty hacky..."}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"54813d33-7ad6-459a-93dc-e35105d80011","type":"message","text":"`custom_average` can be passed to a `JLD2OutputWriter` or a `NetCDFOutputWriter` (but you probably have to specify the dimensions manually for NetCDF).","user":"UEP056STX","ts":"1613592957.054100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KGH1d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"custom_average","style":{"code":true}},{"type":"text","text":" can be passed to a "},{"type":"text","text":"JLD2OutputWriter","style":{"code":true}},{"type":"text","text":" or a "},{"type":"text","text":"NetCDFOutputWriter","style":{"code":true}},{"type":"text","text":" (but you probably have to specify the dimensions manually for NetCDF)."}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"d79eb3d1-fa86-4e25-84c9-abbc913ac115","type":"message","text":"Yeah, I guess we didn't really anticipate `AveragedField` and `FieldSlicer` being used together so a warning or a note in the docstring could be useful.","user":"UEP056STX","ts":"1613593002.054300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5xbX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, I guess we didn't really anticipate "},{"type":"text","text":"AveragedField","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"FieldSlicer","style":{"code":true}},{"type":"text","text":" being used together so a warning or a note in the docstring could be useful."}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"f983b427-0f04-4dc6-b37d-3d4490a827cd","type":"message","text":"I see. Thanks for the suggestion!","user":"U01E0U2RJJ2","ts":"1613593010.054500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"C186","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I see. Thanks for the suggestion!"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"996ee691-7c24-4d2e-a78a-2c3b73c591c8","type":"message","text":"Late to the party!","user":"UMZQBQU67","ts":"1613600475.055100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"D9hVC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Late to the party!"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"cb79b788-a9c0-41c4-9186-e6027d0d9d2b","type":"message","text":"I think `WindowedField` would be pretty neat. But the primary reason to make something a “Field” is so that it can be used in other operations. Thus `WindowedField` makes the most sense if we need to do complex / heavy operations but only want to perform them on part of some huge model domain. So I think we’ll eventually want this for massive GPU runs. For Tomas’ case though I think a custom averaging function makes more sense. The “windowed spatial average” doesn’t need to be used in any subsequent operations right?","user":"UMZQBQU67","ts":"1613600587.055300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vwn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think "},{"type":"text","text":"WindowedField","style":{"code":true}},{"type":"text","text":" would be pretty neat. But the primary reason to make something a “Field” is so that it can be used in other operations. Thus "},{"type":"text","text":"WindowedField","style":{"code":true}},{"type":"text","text":" makes the most sense if we need to do complex / heavy operations but only want to perform them on part of some huge model domain. So I think we’ll eventually want this for massive GPU runs. For Tomas’ case though I think a custom averaging function makes more sense. The “windowed spatial average” doesn’t need to be used in any subsequent operations right?"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"eb3a0c62-2cd3-4ca8-a40f-ae29593adfb9","type":"message","text":"We designed the time averaging feature so that it can time-average any kind of output; so it can average both fields and output of functions (if those functions return arrays). However, field slicer will not work anymore because it can only work on fields.","user":"UMZQBQU67","ts":"1613600622.055500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"loMX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We designed the time averaging feature so that it can time-average any kind of output; so it can average both fields and output of functions (if those functions return arrays). However, field slicer will not work anymore because it can only work on fields."}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"5827bc6a-691a-408a-bdb0-06e9a1842432","type":"message","text":"I'm considering taking a crack at this. Any tips as to where to start?","user":"U01E0U2RJJ2","ts":"1613758097.056800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uyir","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm considering taking a crack at this. Any tips as to where to start?"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"51430c56-c2ff-488b-9f50-b2fe63366fc8","type":"message","text":"I was thinking start from AveragedField and build something called WindowedAveragedField from it in combination with FieldSlicer","user":"U01E0U2RJJ2","ts":"1613758149.057000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FI2s","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I was thinking start from AveragedField and build something called WindowedAveragedField from it in combination with FieldSlicer"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"},{"client_msg_id":"92e77cc8-c89d-4897-9c8a-6c37d46c8834","type":"message","text":"<@U01E0U2RJJ2> I wonder if `WindowedField` is the place to start? It could be created from a `Field` + a `FieldSlicer`:\n```u_window = WindowedField(model.velocities.u, field_slicer=FieldSlicer(j=20:50))```\nand we could make sure that\n```AveragedField(u_window, dims=(1, 2))```\ndoes the right thing by averaging all of x and y from j=20:50?","user":"UEP056STX","ts":"1613764807.057200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bzldk","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U01E0U2RJJ2"},{"type":"text","text":" I wonder if "},{"type":"text","text":"WindowedField","style":{"code":true}},{"type":"text","text":" is the place to start? It could be created from a "},{"type":"text","text":"Field","style":{"code":true}},{"type":"text","text":" + a "},{"type":"text","text":"FieldSlicer","style":{"code":true}},{"type":"text","text":":\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"u_window = WindowedField(model.velocities.u, field_slicer=FieldSlicer(j=20:50))"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"and we could make sure that\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"AveragedField(u_window, dims=(1, 2))"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"does the right thing by averaging all of x and y from j=20:50?"}]}]}],"thread_ts":"1613592512.049200","parent_user_id":"UEP056STX"}]