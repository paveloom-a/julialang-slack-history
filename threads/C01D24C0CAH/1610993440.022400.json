[{"client_msg_id":"d3bfefcc-9242-44ba-a121-776adebd1b71","type":"message","text":"Ah interesting. I intuitively would have thought that the stability of your quasi-2D simulation wouldn't have mattered on Δx since no advection was really happening and that it was like solving ODEs in the x-direction if that makes sense (only time stepper accuracy?).","user":"UEP056STX","ts":"1610993440.022400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"H/C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah interesting. I intuitively would have thought that the stability of your quasi-2D simulation wouldn't have mattered on Δx since no advection was really happening and that it was like solving ODEs in the x-direction if that makes sense (only time stepper accuracy?)."}]}]}],"thread_ts":"1610993440.022400","reply_count":28,"reply_users_count":3,"latest_reply":"1611193849.000500","reply_users":["U01E0U2RJJ2","UEP056STX","UMZQBQU67"],"subscribed":false},{"client_msg_id":"aa1f2514-0a32-410d-a273-f6743d428e34","type":"message","text":"I haven't run any rigorous tests, but I did run the simulation with Δx=Δy and results were correct","user":"U01E0U2RJJ2","ts":"1610993933.025200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WpR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I haven't run any rigorous tests, but I did run the simulation with Δx=Δy and results were correct"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"a0df971b-870b-4a84-ae46-5285a434399b","type":"message","text":"But setting the exact same simulation with Δx=10*Δy already resulted in some errors","user":"U01E0U2RJJ2","ts":"1610993966.025400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XP69a","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But setting the exact same simulation with Δx=10*Δy already resulted in some errors"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"162d91a2-2bce-4773-93c7-83faf355f626","type":"message","text":"Ah did the `TimeStepWizard` use larger steps with Δx=10Δy?","user":"UEP056STX","ts":"1610993992.025600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GDvg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah did the "},{"type":"text","text":"TimeStepWizard","style":{"code":true}},{"type":"text","text":" use larger steps with Δx=10Δy?"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"69856b55-21b3-466b-bb51-aaeb7c45a6dc","type":"message","text":"It doesn't treat flat dimensions any differently so could do weird things.","user":"UEP056STX","ts":"1610994115.025800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cxK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It doesn't treat flat dimensions any differently so could do weird things."}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"0a362ecf-9477-44ac-aa64-e0bc91c6cc05","type":"message","text":"Yeah, the steps taken were 10 times larger, which was expected","user":"U01E0U2RJJ2","ts":"1610994733.026200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1xT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, the steps taken were 10 times larger, which was expected"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"93683a95-807a-45c9-aa0f-867e825105fa","type":"message","text":"Ah so maybe it thought it was okay to take larger time steps but that led to significant errors (indicating that the leading source of error is not CFL)?","user":"UEP056STX","ts":"1610996801.029100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"k8Wz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah so maybe it thought it was okay to take larger time steps but that led to significant errors (indicating that the leading source of error is not CFL)?"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"c40a1e87-2b36-45ed-b095-9e61aa21c437","type":"message","text":"That makes sense to me","user":"U01E0U2RJJ2","ts":"1611008211.029300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CCu+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That makes sense to me"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"d983ce5f-7318-4b07-a1ff-1eafb028cfcd","type":"message","text":"Perhaps the diffusive CFL?","user":"U01E0U2RJJ2","ts":"1611008227.029500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"w=V","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Perhaps the diffusive CFL?"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"425edf1a-00ac-4df2-82b9-585001f0ce94","type":"message","text":"Ah that might be possible","user":"UEP056STX","ts":"1611067353.029900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Opm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah that might be possible"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"2741b4c7-6d3b-4ac1-a4a8-1f4d2dd152c6","type":"message","text":"I think you can set a limit for the diffusive CFL for the `TimeStepWizard`","user":"UEP056STX","ts":"1611067412.030100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Lm9/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think you can set a limit for the diffusive CFL for the "},{"type":"text","text":"TimeStepWizard","style":{"code":true}}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"a04b038b-c3a1-4ea8-8e0e-22ffa310db73","type":"message","text":"Docstring needs updating but there's a `diffusive_cfl` keyword argument: <https://github.com/CliMA/Oceananigans.jl/blob/bb49707eff055faade2514da88fe090db46083da/src/Simulations/time_step_wizard.jl#L23>","user":"UEP056STX","ts":"1611067428.030300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gL41M","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Docstring needs updating but there's a "},{"type":"text","text":"diffusive_cfl","style":{"code":true}},{"type":"text","text":" keyword argument: "},{"type":"link","url":"https://github.com/CliMA/Oceananigans.jl/blob/bb49707eff055faade2514da88fe090db46083da/src/Simulations/time_step_wizard.jl#L23"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"e8b0ee8c-4303-4a97-a4b6-41aefabb28d8","type":"message","text":"A uniform velocity in a flattened dimension is dynamically inert, right? Isn’t it better to omit that?","user":"UMZQBQU67","ts":"1611073200.031900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qrSbT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"A uniform velocity in a flattened dimension is dynamically inert, right? Isn’t it better to omit that?"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"31b828b5-7213-4395-88a6-580e90000589","type":"message","text":"I just checked and I was actually setting the diffusive CFL to 0.8 as well!","user":"U01E0U2RJJ2","ts":"1611117233.032500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"B0xEK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I just checked and I was actually setting the diffusive CFL to 0.8 as well!"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"dd2a276c-ffd0-4c4e-9bee-a91fbd806fab","type":"message","text":"<@UMZQBQU67> That velocity has to be actiave because we're running a \"2.5 dimensions set-up\"","user":"U01E0U2RJJ2","ts":"1611117258.032700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TZJG","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UMZQBQU67"},{"type":"text","text":" That velocity has to be actiave because we're running a \"2.5 dimensions set-up\""}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"02157de6-b03f-4157-8733-b30e3cbd1ed3","type":"message","text":"<@U01E0U2RJJ2> ah yes. You can still subtract the domain-mean in such a scenario, but if its just a mean horizontal velocity that’s causing issues then you’ve got to keep it. So the velocity field is only uniform in the horizontal direction, but might be a function of z (for example?)","user":"UMZQBQU67","ts":"1611144762.032900","team":"T68168MUP","edited":{"user":"UMZQBQU67","ts":"1611144805.000000"},"blocks":[{"type":"rich_text","block_id":"p/T78","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U01E0U2RJJ2"},{"type":"text","text":" ah yes. You can still subtract the domain-mean in such a scenario, but if its just a mean horizontal velocity that’s causing issues then you’ve got to keep it. So the velocity field is only uniform in the horizontal direction, but might be a function of z (for example?)"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"a0f225dc-b1a8-4385-ac8e-98841c79e45c","type":"message","text":"I'll try something liek that. The velocity is a function of both y and z and it changes as the simulation progresses, so it's not super straightforward","user":"U01E0U2RJJ2","ts":"1611153100.033300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oO+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'll try something liek that. The velocity is a function of both y and z and it changes as the simulation progresses, so it's not super straightforward"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"792fb373-3580-4122-a73c-4faabd36c193","type":"message","text":"Hmm yeah, if there isn’t a large mean component then this won’t help much.","user":"UMZQBQU67","ts":"1611153586.033500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1Va","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm yeah, if there isn’t a large mean component then this won’t help much."}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"d10a0214-f0d1-4aae-bd5c-83dfcaa106bf","type":"message","text":"It would be great to figure out how to use `Flat` dimensions…","user":"UMZQBQU67","ts":"1611153613.033700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6oa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It would be great to figure out how to use "},{"type":"text","text":"Flat","style":{"code":true}},{"type":"text","text":" dimensions…"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"387989ae-d8fe-43b4-b991-01f101f9df69","type":"message","text":"issue here: <https://github.com/CliMA/Oceananigans.jl/issues/1309>","user":"UMZQBQU67","ts":"1611153908.033900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hHa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"issue here: "},{"type":"link","url":"https://github.com/CliMA/Oceananigans.jl/issues/1309"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"5728765c-f93e-45a1-b8f3-dd9a22ba16a4","type":"message","text":"`Flat` still isn’t fully functional, but at least it can do _something_ in this case.","user":"UMZQBQU67","ts":"1611153933.034100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TX8zE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Flat","style":{"code":true}},{"type":"text","text":" still isn’t fully functional, but at least it can do "},{"type":"text","text":"something","style":{"italic":true}},{"type":"text","text":" in this case."}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"8118bc29-4201-4d43-8f10-9503e01993ed","type":"message","text":"I've been discouraged from using `Flat` dimensions for now though","user":"U01E0U2RJJ2","ts":"1611155979.034300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"V5n5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I've been discouraged from using "},{"type":"text","text":"Flat","style":{"code":true}},{"type":"text","text":" dimensions for now though"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"a0a8243c-2440-426a-85bd-45943218c928","type":"message","text":"I think someone mentioned at some point that there might be errors since it's not yet fully funcional","user":"U01E0U2RJJ2","ts":"1611155995.034500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7Ab+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think someone mentioned at some point that there might be errors since it's not yet fully funcional"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"3d4e38f1-bdf7-44f8-a8ae-dd7975b6e066","type":"message","text":"True: <https://github.com/CliMA/Oceananigans.jl/issues/1023>\n\nSo, I guess we really do need to figure out what’s wrong with <https://github.com/CliMA/Oceananigans.jl/pull/1024>\n\nI guess a simple hack would give the flat dimension a super large grid spacing, so it doesn’t trigger CFL ? For example, if the box were horizontally square but with Nx=1, Ny=256 I imagine you might avoid triggering CFL due to x-velocities, esp if you have rotation?","user":"UMZQBQU67","ts":"1611160253.034700","team":"T68168MUP","edited":{"user":"UMZQBQU67","ts":"1611160262.000000"},"blocks":[{"type":"rich_text","block_id":"Iqi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"True: "},{"type":"link","url":"https://github.com/CliMA/Oceananigans.jl/issues/1023"},{"type":"text","text":"\n\nSo, I guess we really do need to figure out what’s wrong with "},{"type":"link","url":"https://github.com/CliMA/Oceananigans.jl/pull/1024"},{"type":"text","text":"\n\nI guess a simple hack would give the flat dimension a super large grid spacing, so it doesn’t trigger CFL ? For example, if the box were horizontally square but with Nx=1, Ny=256 I imagine you might avoid triggering CFL due to x-velocities, esp if you have rotation?"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"1726017f-bae4-4658-a924-4d8f7f6f7e46","type":"message","text":"Yeah, that's what I tried at first, but for some reason I got errors that looked like the model blowing up","user":"U01E0U2RJJ2","ts":"1611166160.035000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9kLE2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, that's what I tried at first, but for some reason I got errors that looked like the model blowing up"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"05a945cd-899c-401f-a68f-a1bd4339b10f","type":"message","text":"Very weird","user":"U01E0U2RJJ2","ts":"1611166161.035200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nVZx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Very weird"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"61769ddc-ceb2-49ed-9420-4cdf985dc483","type":"message","text":"Something is fishy! Can you share the setup?","user":"UMZQBQU67","ts":"1611192468.000100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7x0Q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Something is fishy! Can you share the setup?"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"f6d61ce1-85c8-4ed6-b053-49a4bbd3faf6","type":"message","text":"I kinda switched from it already, but I can try to recover it","user":"U01E0U2RJJ2","ts":"1611193809.000300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OFXD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I kinda switched from it already, but I can try to recover it"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"},{"client_msg_id":"dc8b7807-e59e-46c9-96f1-dcbc157da2fb","type":"message","text":"It was basically an interior jet in thermal wind balance","user":"U01E0U2RJJ2","ts":"1611193849.000500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tKSAy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It was basically an interior jet in thermal wind balance"}]}]}],"thread_ts":"1610993440.022400","parent_user_id":"UEP056STX"}]