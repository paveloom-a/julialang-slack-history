[{"client_msg_id":"00c393c0-eef5-4e1b-b468-d4eff9947727","type":"message","text":"Are there mass-conserving smoothing packages out there? (I thought maybe this is a good question to ask here.)\n\n*More details*: I have a 3D array `s` that represents localized sources of some tracer in the ocean. That is, `s` is mostly zeros, with a only select few indices (locations on the global ocean) for which `s` is non-zero. I would like to smooth `s` in 3D (or just horizontally) in a way that conserves mass. That is, if I have an individual source \"pixel\" or \"grid cell\", surrounded by no other sources, where, e.g., `s == 1 kg  m⁻³ s⁻¹` , I would like to spread it across 1 cell in each direction, similarly to how you would apply a blurrying kernel to an image, but in such a way that after smoothing, the integrated source over these neighboring cells remains the same as for the original `s`. So a sort of mass-preserving blur.\n\nAdditional hurdle, because of the topography, `s` is also full of `NaN`s where there is land. The blur should take these `NaN`s into account, i.e., *not* propagate them, and ensure that if there is a neighboring `NaN` cell of a source cell (index `i`) that gets smoothed, then that `NaN` cell remains a `NaN` and whatever quantity it would have gotten from smoothing is attributed to the other, non-`NaN` nieghboring cells of the `i` cell.","user":"UB197FRCL","ts":"1614562999.012800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vipTR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Are there mass-conserving smoothing packages out there? (I thought maybe this is a good question to ask here.)\n\n"},{"type":"text","text":"More details","style":{"bold":true}},{"type":"text","text":": I have a 3D array "},{"type":"text","text":"s","style":{"code":true}},{"type":"text","text":" that represents localized sources of some tracer in the ocean. That is, "},{"type":"text","text":"s","style":{"code":true}},{"type":"text","text":" is mostly zeros, with a only select few indices (locations on the global ocean) for which "},{"type":"text","text":"s","style":{"code":true}},{"type":"text","text":" is non-zero. I would like to smooth "},{"type":"text","text":"s","style":{"code":true}},{"type":"text","text":" in 3D (or just horizontally) in a way that conserves mass. That is, if I have an individual source \"pixel\" or \"grid cell\", surrounded by no other sources, where, e.g., "},{"type":"text","text":"s == 1 kg  m⁻³ s⁻¹","style":{"code":true}},{"type":"text","text":" , I would like to spread it across 1 cell in each direction, similarly to how you would apply a blurrying kernel to an image, but in such a way that after smoothing, the integrated source over these neighboring cells remains the same as for the original "},{"type":"text","text":"s","style":{"code":true}},{"type":"text","text":". So a sort of mass-preserving blur.\n\nAdditional hurdle, because of the topography, "},{"type":"text","text":"s","style":{"code":true}},{"type":"text","text":" is also full of "},{"type":"text","text":"NaN","style":{"code":true}},{"type":"text","text":"s where there is land. The blur should take these "},{"type":"text","text":"NaN","style":{"code":true}},{"type":"text","text":"s into account, i.e., "},{"type":"text","text":"not","style":{"bold":true}},{"type":"text","text":" propagate them, and ensure that if there is a neighboring "},{"type":"text","text":"NaN","style":{"code":true}},{"type":"text","text":" cell of a source cell (index "},{"type":"text","text":"i","style":{"code":true}},{"type":"text","text":") that gets smoothed, then that "},{"type":"text","text":"NaN","style":{"code":true}},{"type":"text","text":" cell remains a "},{"type":"text","text":"NaN","style":{"code":true}},{"type":"text","text":" and whatever quantity it would have gotten from smoothing is attributed to the other, non-"},{"type":"text","text":"NaN","style":{"code":true}},{"type":"text","text":" nieghboring cells of the "},{"type":"text","text":"i","style":{"code":true}},{"type":"text","text":" cell."}]}]}],"thread_ts":"1614562999.012800","reply_count":1,"reply_users_count":1,"latest_reply":"1614563021.012900","reply_users":["UB197FRCL"],"subscribed":false},{"client_msg_id":"d19154c5-ef40-48ca-9ed9-22f393cb084b","type":"message","text":"Sorry if unclear BTW, I'd be happy to elaborate/clarify anything :slightly_smiling_face:","user":"UB197FRCL","ts":"1614563021.012900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CPM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Sorry if unclear BTW, I'd be happy to elaborate/clarify anything "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1614562999.012800","parent_user_id":"UB197FRCL"}]