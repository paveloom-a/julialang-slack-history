[{"client_msg_id":"158bc378-3c11-421b-a308-c2d77905e799","type":"message","text":"<@UC81ESVH6> How did you handle say the version checks in the test suite by the way? Just curious since I am currently squirming a bit over the idea of either disabling them or swapping in the version numbers provided by Nixpkgs.","user":"U677R5Q5A","ts":"1617498906.059000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gz0","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UC81ESVH6"},{"type":"text","text":" How did you handle say the version checks in the test suite by the way? Just curious since I am currently squirming a bit over the idea of either disabling them or swapping in the version numbers provided by Nixpkgs."}]}]}],"thread_ts":"1617498906.059000","reply_count":14,"reply_users_count":2,"latest_reply":"1617601110.082900","reply_users":["UC81ESVH6","U677R5Q5A"],"is_locked":false,"subscribed":false},{"client_msg_id":"a29a56aa-611b-4592-9a7f-4e794baf92cb","type":"message","text":"Yes, I also found it a bit odd that they would enforce exact version numbers. I will probably not handle them at all since I don't think anyone (or any automated process) will be running the test suite since it takes too long. My only concern is the blas linalg tests failing since that indicates an actual problem users might hit.","user":"UC81ESVH6","ts":"1617502169.059300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ALrq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, I also found it a bit odd that they would enforce exact version numbers. I will probably not handle them at all since I don't think anyone (or any automated process) will be running the test suite since it takes too long. My only concern is the blas linalg tests failing since that indicates an actual problem users might hit."}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"},{"client_msg_id":"fb5e4a0f-0636-4f9f-94be-d1845dd3ad34","type":"message","text":"Yeah, I will probably patch them to be skipped as I do want the test suite to run when building. It really is not that slow if you change it to run in parallel. Here is a dirty hack to enable it in the non-networed Nix  sandbox: `sed -i -e 's/if net_on/if true/' test/runtests.jl`.","user":"U677R5Q5A","ts":"1617506877.059800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4Avzq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, I will probably patch them to be skipped as I do want the test suite to run when building. It really is not that slow if you change it to run in parallel. Here is a dirty hack to enable it in the non-networed Nix  sandbox: "},{"type":"text","text":"sed -i -e 's/if net_on/if true/' test/runtests.jl","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"},{"client_msg_id":"7ecd345d-b2c1-4873-92f6-43668aa2b2e2","type":"message","text":"All of my current issues – from what I can tell – stem from issues symlinking system libraries and I have no bleedin’ clue how you do not fall victim to the same thing as I see no workaround for say `libnghttp2` that I would need for example.","user":"U677R5Q5A","ts":"1617506984.060000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vIS0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"All of my current issues – from what I can tell – stem from issues symlinking system libraries and I have no bleedin’ clue how you do not fall victim to the same thing as I see no workaround for say "},{"type":"text","text":"libnghttp2","style":{"code":true}},{"type":"text","text":" that I would need for example."}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"},{"client_msg_id":"0ab4fa31-bc8d-464c-987c-43f700c8882d","type":"message","text":"I don't think http2 is actually a direct dependency, it is only used by curl.","user":"UC81ESVH6","ts":"1617510757.060200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2ruw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't think http2 is actually a direct dependency, it is only used by curl."}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"},{"client_msg_id":"9a430b15-ffc2-40e9-a8f0-d83df2a475d5","type":"message","text":"Also that PR you linked above is missing `USE_SYSTEM_CSL` and possibly a few others.","user":"UC81ESVH6","ts":"1617510903.060400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JYm2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also that PR you linked above is missing "},{"type":"text","text":"USE_SYSTEM_CSL","style":{"code":true}},{"type":"text","text":" and possibly a few others."}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"},{"client_msg_id":"b0002a32-3f71-422b-a58c-7f89e71a1566","type":"message","text":"Yeah, that expression really has some bad lineage. I am trying to base my current one one my clean v1.0.5 version. I mean, the expression in the PR even has flags that do not exist and one that is misspelt I think.","user":"U677R5Q5A","ts":"1617511038.060600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CWRL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, that expression really has some bad lineage. I am trying to base my current one one my clean v1.0.5 version. I mean, the expression in the PR even has flags that do not exist and one that is misspelt I think."}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"},{"client_msg_id":"e1397ad5-b0c9-4181-ba90-ea632d111086","type":"message","text":"I think the issue is that the JLLs expect a certain naming that clashes with what Nixpkgs uses. So I will just try to patch the JLLs and see if that gets rid of the last few issues.","user":"U677R5Q5A","ts":"1617511086.060800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"29t","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think the issue is that the JLLs expect a certain naming that clashes with what Nixpkgs uses. So I will just try to patch the JLLs and see if that gets rid of the last few issues."}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"},{"client_msg_id":"bb291f2b-8682-4c2b-a4b7-dc6d4c56a720","type":"message","text":"Building LLVM from scratch over and over is sooo bloody painful though.","user":"U677R5Q5A","ts":"1617511118.061000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4cZS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Building LLVM from scratch over and over is sooo bloody painful though."}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"},{"client_msg_id":"ac05a0be-e586-46da-aabe-456e64214427","type":"message","text":"Wish I could help you with BLAS, but I have PTSD from ATLAS, GotoBLAS, and OpenBLAS back when I was a PhD student and all the errors I had.","user":"U677R5Q5A","ts":"1617511180.061200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b8t=J","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Wish I could help you with BLAS, but I have PTSD from ATLAS, GotoBLAS, and OpenBLAS back when I was a PhD student and all the errors I had."}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A","reactions":[{"name":"laughing","users":["UC81ESVH6"],"count":1}]},{"client_msg_id":"92d804cd-070b-4af6-a9e6-38ebbf6ccd76","type":"message","text":"Is there any reason why Nix doesn't have `USE_SYSTEM_LLVM`? It seems stable enough, though I haven't gotten to that portion of the tests yet.","user":"UC81ESVH6","ts":"1617557118.063500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"662","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there any reason why Nix doesn't have "},{"type":"text","text":"USE_SYSTEM_LLVM","style":{"code":true}},{"type":"text","text":"? It seems stable enough, though I haven't gotten to that portion of the tests yet."}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"},{"client_msg_id":"495bb099-c336-487e-aa8e-2b08b4082094","type":"message","text":"I think Nix would want more `USE_SYSTEM_...` flags, there are a few more in Make.inc now.","user":"UC81ESVH6","ts":"1617557192.063700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0ovd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think Nix would want more "},{"type":"text","text":"USE_SYSTEM_...","style":{"code":true}},{"type":"text","text":" flags, there are a few more in Make.inc now."}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"},{"type":"message","subtype":"thread_broadcast","text":"Julia has a **serious** set of patches applied to LLVM and it is pretty much a fork at this point. The same for libuv, and libm, openlibm, and utf8proc are projects driven by Julia devs primarily for the purpose of Julia itself. Thus I am inclined to say that vendoring is the only sane thing to do for these dependencies.\n\nFrom the side of the Julia devs, there is a reason why they refuse to link to any packaged Julia versions on the downloads page these days. I mean, imagine that there is an issue with LLVM, it is highly likely that this could escape the Julia test suite and unlike the Julia devs themselves third-party package managers never for example run tests over the whole package system. There is a balance to be struck here and I frankly would have opted for the official binaries if it was not for the fact that Nix forces my hand here as we will need patches. '^^","user":"U677R5Q5A","ts":"1617600964.082400","thread_ts":"1617498906.059000","root":{"client_msg_id":"158bc378-3c11-421b-a308-c2d77905e799","type":"message","text":"<@UC81ESVH6> How did you handle say the version checks in the test suite by the way? Just curious since I am currently squirming a bit over the idea of either disabling them or swapping in the version numbers provided by Nixpkgs.","user":"U677R5Q5A","ts":"1617498906.059000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gz0","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UC81ESVH6"},{"type":"text","text":" How did you handle say the version checks in the test suite by the way? Just curious since I am currently squirming a bit over the idea of either disabling them or swapping in the version numbers provided by Nixpkgs."}]}]}],"thread_ts":"1617498906.059000","reply_count":14,"reply_users_count":2,"latest_reply":"1617601110.082900","reply_users":["UC81ESVH6","U677R5Q5A"],"is_locked":false,"subscribed":false},"blocks":[{"type":"rich_text","block_id":"Ipi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Julia has a *"},{"type":"text","text":"serious","style":{"bold":true}},{"type":"text","text":"* set of patches applied to LLVM and it is pretty much a fork at this point. The same for libuv, and libm, openlibm, and utf8proc are projects driven by Julia devs primarily for the purpose of Julia itself. Thus I am inclined to say that vendoring is the only sane thing to do for these dependencies.\n\nFrom the side of the Julia devs, there is a reason why they refuse to link to any packaged Julia versions on the downloads page these days. I mean, imagine that there is an issue with LLVM, it is highly likely that this could escape the Julia test suite and unlike the Julia devs themselves third-party package managers never for example run tests over the whole package system. There is a balance to be struck here and I frankly would have opted for the official binaries if it was not for the fact that Nix forces my hand here as we will need patches. '^^"}]}]}],"client_msg_id":"012f3830-c7ff-43d8-afaf-83feb5805ae4"},{"client_msg_id":"abfe4f6e-0937-4d98-9836-0d7a9be500b9","type":"message","text":"Sorry for the slow response by the way. Slack is awful and always shows that I have unread threads so if there is a message in a thread I may miss it. &gt;.&lt;","user":"U677R5Q5A","ts":"1617601000.082700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=B9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Sorry for the slow response by the way. Slack is awful and always shows that I have unread threads so if there is a message in a thread I may miss it. >.<"}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"},{"client_msg_id":"8e9af431-a292-4511-ae52-2b452b5fd5ce","type":"message","text":"For the LTS, this is pretty much as far as I would consider to be “sane” for non-vendoring: <https://github.com/NixOS/nixpkgs/blob/e64ad6803780cf45bc25a20fdcaf34d8e6353d95/pkgs/development/compilers/julia/lts.nix#L101-L126>","user":"U677R5Q5A","ts":"1617601110.082900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lfx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For the LTS, this is pretty much as far as I would consider to be “sane” for non-vendoring: "},{"type":"link","url":"https://github.com/NixOS/nixpkgs/blob/e64ad6803780cf45bc25a20fdcaf34d8e6353d95/pkgs/development/compilers/julia/lts.nix#L101-L126"}]}]}],"thread_ts":"1617498906.059000","parent_user_id":"U677R5Q5A"}]