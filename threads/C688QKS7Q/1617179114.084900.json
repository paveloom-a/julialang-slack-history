[{"client_msg_id":"5a857734-ac2e-4305-ba68-e688a5fc4375","type":"message","text":"<@U6740K1SP>: Why does broadcasting over a 0-dimensional array produce a scalar? Thank you!\n```julia&gt; identity.(fill(1))\n1```\nCC <@U67431ELR>","user":"U8JAMQGQY","ts":"1617179114.084900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XC2o","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U6740K1SP"},{"type":"text","text":": Why does broadcasting over a 0-dimensional array produce a scalar? Thank you!\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> identity.(fill(1))\n1"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"CC "},{"type":"user","user_id":"U67431ELR"}]}]}],"thread_ts":"1617179114.084900","reply_count":5,"reply_users_count":3,"latest_reply":"1617193624.086400","reply_users":["U66SGEWAC","U8JAMQGQY","U6740K1SP"],"is_locked":false,"subscribed":false},{"client_msg_id":"68e1a894-9b44-4c55-98fb-6a8b2b793a5f","type":"message","text":"I think because the broadcast machinery defines 0 dimensional arrays as scalars, which is also used to wrap arrays and treat them as scalars:\n```julia&gt; length(Ref(1))\n1\njulia&gt; size(Ref(1))\n()\njulia&gt; length(fill(1))\n1\njulia&gt; size(fill(1))\n() ```","user":"U66SGEWAC","ts":"1617179831.085000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3Onq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think because the broadcast machinery defines 0 dimensional arrays as scalars, which is also used to wrap arrays and treat them as scalars:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> length(Ref(1))\n1\njulia> size(Ref(1))\n()\njulia> length(fill(1))\n1\njulia> size(fill(1))\n() "}]}]}],"thread_ts":"1617179114.084900","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"6eedaad8-6ea5-40f3-b29e-51a3a5b37df4","type":"message","text":"I think there are two separate things:\n• how do you treat 0-dimensional object for determining the broadcasted result value (i.e. to broadcast value over some dimension); and here I agree\n• to determine what should be the type of the produced result\nAFAICT these two decisions are handled orthogonally in broadcasting mechanics. And I am asking about the second (i.e. decision about the type of the produced container). Specifically I mean this:\n```julia&gt; Base.Broadcast.BroadcastStyle(typeof(fill(1)))\nBase.Broadcast.DefaultArrayStyle{0}()\n\nhelp?&gt; Base.Broadcast.DefaultArrayStyle\n  Broadcast.DefaultArrayStyle{N}() is a BroadcastStyle indicating that an object behaves as an N-dimensional array for broadcasting. Specifically, DefaultArrayStyle is used for any AbstractArray type that hasn't defined a specialized style, and in the absence of overrides\n  from other broadcast arguments the resulting output type is Array. When there are multiple inputs to broadcast, DefaultArrayStyle \"loses\" to any other Broadcast.ArrayStyle.```\nSo we see that `DefaultArrayStyle` promises to produce an `Array`. and broadcast style for `fill(1)` is `DefaultArrayStyle`, but it produces a scalar.","user":"U8JAMQGQY","ts":"1617182926.085200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NoLY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think there are two separate things:\n"}]},{"type":"rich_text_list","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"how do you treat 0-dimensional object for determining the broadcasted result value (i.e. to broadcast value over some dimension); and here I agree"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"to determine what should be the type of the produced result"}]}],"style":"bullet","indent":0},{"type":"rich_text_section","elements":[{"type":"text","text":"AFAICT these two decisions are handled orthogonally in broadcasting mechanics. And I am asking about the second (i.e. decision about the type of the produced container). Specifically I mean this:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> Base.Broadcast.BroadcastStyle(typeof(fill(1)))\nBase.Broadcast.DefaultArrayStyle{0}()\n\nhelp?> Base.Broadcast.DefaultArrayStyle\n  Broadcast.DefaultArrayStyle{N}() is a BroadcastStyle indicating that an object behaves as an N-dimensional array for broadcasting. Specifically, DefaultArrayStyle is used for any AbstractArray type that hasn't defined a specialized style, and in the absence of overrides\n  from other broadcast arguments the resulting output type is Array. When there are multiple inputs to broadcast, DefaultArrayStyle \"loses\" to any other Broadcast.ArrayStyle."}]},{"type":"rich_text_section","elements":[{"type":"text","text":"So we see that "},{"type":"text","text":"DefaultArrayStyle","style":{"code":true}},{"type":"text","text":" promises to produce an "},{"type":"text","text":"Array","style":{"code":true}},{"type":"text","text":". and broadcast style for "},{"type":"text","text":"fill(1)","style":{"code":true}},{"type":"text","text":" is "},{"type":"text","text":"DefaultArrayStyle","style":{"code":true}},{"type":"text","text":", but it produces a scalar."}]}]}],"thread_ts":"1617179114.084900","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"8fe2c866-c697-493b-8207-1b3dae7cefe4","type":"message","text":"However indeed also:\n```julia&gt; Base.Broadcast.BroadcastStyle(typeof(Ref(1)))\nBase.Broadcast.DefaultArrayStyle{0}()```\nas you note, which means that maybe the contract for `DefaultArrayStyle` should be updated in the docstring.","user":"U8JAMQGQY","ts":"1617183003.085400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FSN5L","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"However indeed also:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> Base.Broadcast.BroadcastStyle(typeof(Ref(1)))\nBase.Broadcast.DefaultArrayStyle{0}()"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"as you note, which means that maybe the contract for "},{"type":"text","text":"DefaultArrayStyle","style":{"code":true}},{"type":"text","text":" should be updated in the docstring."}]}]}],"thread_ts":"1617179114.084900","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"90892069-aac3-446e-a6ef-3d2d90d7ae92","type":"message","text":"the other approach would be to make a difference between broadcast style for `Ref` and for 0-dimensional array as:\n```julia&gt; Ref &lt;: AbstractArray\nfalse```","user":"U8JAMQGQY","ts":"1617183102.085600","team":"T68168MUP","edited":{"user":"U8JAMQGQY","ts":"1617183202.000000"},"blocks":[{"type":"rich_text","block_id":"XG4TA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the other approach would be to make a difference between broadcast style for "},{"type":"text","text":"Ref","style":{"code":true}},{"type":"text","text":" and for 0-dimensional array as:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> Ref <: AbstractArray\nfalse"}]}]}],"thread_ts":"1617179114.084900","parent_user_id":"U8JAMQGQY"},{"client_msg_id":"27A4B34B-7FF2-4BDC-8E88-0A32334F32F0","type":"message","text":"<https://github.com/JuliaLang/julia/issues/28866|https://github.com/JuliaLang/julia/issues/28866>","user":"U6740K1SP","ts":"1617193624.086400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YuF5","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/JuliaLang/julia/issues/28866","text":"https://github.com/JuliaLang/julia/issues/28866"}]}]}],"thread_ts":"1617179114.084900","parent_user_id":"U8JAMQGQY"}]