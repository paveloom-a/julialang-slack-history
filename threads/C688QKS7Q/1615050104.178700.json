[{"client_msg_id":"26f0c804-5b44-413a-b546-7c3cffdb7a82","type":"message","text":"For a julia process occupying 225 MB I see\n```julia&gt; Base.format_bytes.(Base.summarysize.([Main, Base, Core]))\n3-element Vector{String}:\n \"56.181 MiB\"\n \"56.179 MiB\"\n \"17.228 MiB\"```\nSo Main + Core leaves 65% of memory uncounted.\nIs there anything that can be done to make this reporting more accurate?\nI’m guessing the main mismatch is in Core?\n\nI saw this TODO, could the stacks of Tasks not being counted be significant? <https://github.com/JuliaLang/julia/blob/5fab42ac868f70d1edc6fe85b65a2df6442722b7/base/summarysize.jl#L177>","user":"U8MPCDJAY","ts":"1615050104.178700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BuN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For a julia process occupying 225 MB I see\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> Base.format_bytes.(Base.summarysize.([Main, Base, Core]))\n3-element Vector{String}:\n \"56.181 MiB\"\n \"56.179 MiB\"\n \"17.228 MiB\""}]},{"type":"rich_text_section","elements":[{"type":"text","text":"So Main + Core leaves 65% of memory uncounted.\nIs there anything that can be done to make this reporting more accurate?\nI’m guessing the main mismatch is in Core?\n\nI saw this TODO, could the stacks of Tasks not being counted be significant? "},{"type":"link","url":"https://github.com/JuliaLang/julia/blob/5fab42ac868f70d1edc6fe85b65a2df6442722b7/base/summarysize.jl#L177"}]}]}],"thread_ts":"1615050104.178700","reply_count":19,"reply_users_count":2,"latest_reply":"1615068140.182700","reply_users":["U6A0PD8CR","U8MPCDJAY"],"subscribed":false},{"client_msg_id":"70b3c1c5-ea7b-4aec-a76e-bfe50d016d8f","type":"message","text":"How big is your sysimage on disk?","user":"U6A0PD8CR","ts":"1615050559.178800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"08d2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How big is your sysimage on disk?"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"52ab24a8-ddd6-48f8-86b6-dfc282b1aa39","type":"message","text":"Stupid question.. but which is the default sysimage file? I don’t see any `.so` files in the julia repo after build","user":"U8MPCDJAY","ts":"1615051006.179000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"N7b","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Stupid question.. but which is the default sysimage file? I don’t see any "},{"type":"text","text":".so","style":{"code":true}},{"type":"text","text":" files in the julia repo after build"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"182211ca-56f5-4bed-9a4b-6879a5493f70","type":"message","text":"`usr/lib/julia/sys.so`","user":"U6A0PD8CR","ts":"1615051041.179200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ij45","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"usr/lib/julia/sys.so","style":{"code":true}}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"b907f095-c6cd-4a55-985c-b0d7b377a6de","type":"message","text":"My sysimage is 152MB on disk","user":"U6A0PD8CR","ts":"1615051069.179400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qBQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"My sysimage is 152MB on disk"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"c537c2d3-d986-447d-881a-cdeab406d4dc","type":"message","text":"145MB","user":"U8MPCDJAY","ts":"1615051076.179600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vMNVM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"145MB"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"f849dc05-fd7e-4544-9fff-4a46c0c0b9ea","type":"message","text":"ok.. so that plus Main + Core gets close","user":"U8MPCDJAY","ts":"1615051095.179800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6wJ/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ok.. so that plus Main + Core gets close"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"e02f1b82-ffc5-4a60-a5c6-f26afcb650a2","type":"message","text":"I'm pretty sure Main and Core come from the sysimage too","user":"U6A0PD8CR","ts":"1615051142.180000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"En6v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm pretty sure Main and Core come from the sysimage too"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"b1579e06-51b9-40cd-aa31-3e75cee52172","type":"message","text":"So everything else is things like BLAS buffers, stacks, and runtime heap allocations, I would guess","user":"U6A0PD8CR","ts":"1615051166.180200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"e50","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So everything else is things like BLAS buffers, stacks, and runtime heap allocations, I would guess"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"7b660e0b-2da2-4b76-b15c-b2e6d1b681cc","type":"message","text":"I see","user":"U8MPCDJAY","ts":"1615051187.180400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"V1rDE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I see"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"fcb7f1e9-8691-45d8-950a-2dd9325f6776","type":"message","text":"Although I'm not sure everything shows up to the OS as resident memory, because we mmap things","user":"U6A0PD8CR","ts":"1615051215.180600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hYxZM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Although I'm not sure everything shows up to the OS as resident memory, because we mmap things"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"8dc78a5e-d64a-4cdc-a004-ebc0920ea244","type":"message","text":"ah ok","user":"U8MPCDJAY","ts":"1615051225.180800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1eu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ah ok"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"1b429da4-320f-4aa0-86eb-a9898a0b692f","type":"message","text":"For context, I’m trying to track down where a whole load of untracked memory is being used in the vscode language process <https://github.com/julia-vscode/julia-vscode/pull/2001>","user":"U8MPCDJAY","ts":"1615051277.181000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"loW5h","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For context, I’m trying to track down where a whole load of untracked memory is being used in the vscode language process "},{"type":"link","url":"https://github.com/julia-vscode/julia-vscode/pull/2001"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"53731623-1c74-481b-b4a5-47d9a89ff3b3","type":"message","text":"trying to double check that it’s not just a memory leak","user":"U8MPCDJAY","ts":"1615051302.181200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/ForH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"trying to double check that it’s not just a memory leak"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"1c797909-780f-482f-a063-040a781faa0f","type":"message","text":"If you're on Linux, you could check `/proc/PID/maps`. It might give you some extra insight","user":"U6A0PD8CR","ts":"1615051486.181400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vWbX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you're on Linux, you could check "},{"type":"text","text":"/proc/PID/maps","style":{"code":true}},{"type":"text","text":". It might give you some extra insight"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"type":"message","text":"thanks for the tip. I found this python script for converting the memory addresses into readable sizes.\n\nThis is the top few lines. Perhaps those large anonymous lines are mmaps?","files":[{"id":"F01R4CM1R6C","created":1615066393,"timestamp":1615066393,"name":"Untitled.txt","title":"Untitled","mimetype":"text/plain","filetype":"text","pretty_type":"Plain Text","user":"U8MPCDJAY","editable":true,"size":1035,"mode":"snippet","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01R4CM1R6C/Untitled.txt","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01R4CM1R6C/download/Untitled.txt","permalink":"https://julialang.slack.com/files/U8MPCDJAY/F01R4CM1R6C/Untitled.txt","permalink_public":"https://slack-files.com/T68168MUP-F01R4CM1R6C-593a0434da","edit_link":"https://julialang.slack.com/files/U8MPCDJAY/F01R4CM1R6C/Untitled.txt/edit","preview":"ian@parallels:~/$ python ProcMapsSizeDump.py < /proc/6490/maps\n00400000-00401000             4096           4.00Kb r-xp 00000000 08:01 2105064 /home/parallels/Downloads/julia-88c0e25bce/bin/julia\n00600000-00601000             4096           4.00Kb r--p 00000000 08:01 2105064 /home/parallels/Downloads/julia-88c0e25bce/bin/julia\n00601000-00602000             4096           4.00Kb rw-p 00001000 08:01 2105064 /home/parallels/Downloads/julia-88c0e25bce/bin/julia\n00c9c000-278da000        650371072         620.00Mb rw-p 00000000 00:00 0 [heap]","preview_highlight":"<div class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\">\n<div class=\"CodeMirror-code\">\n<div><pre>ian@parallels:~/$ python ProcMapsSizeDump.py &lt; /proc/6490/maps</pre></div>\n<div><pre>00400000-00401000             4096           4.00Kb r-xp 00000000 08:01 2105064 /home/parallels/Downloads/julia-88c0e25bce/bin/julia</pre></div>\n<div><pre>00600000-00601000             4096           4.00Kb r--p 00000000 08:01 2105064 /home/parallels/Downloads/julia-88c0e25bce/bin/julia</pre></div>\n<div><pre>00601000-00602000             4096           4.00Kb rw-p 00001000 08:01 2105064 /home/parallels/Downloads/julia-88c0e25bce/bin/julia</pre></div>\n<div><pre>00c9c000-278da000        650371072         620.00Mb rw-p 00000000 00:00 0 [heap]</pre></div>\n</div>\n</div>\n","lines":12,"lines_more":7,"preview_is_truncated":true,"is_starred":false,"has_rich_preview":false}],"upload":true,"blocks":[{"type":"rich_text","block_id":"5H5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks for the tip. I found this python script for converting the memory addresses into readable sizes.\n\nThis is the top few lines. Perhaps those large anonymous lines are mmaps?"}]}]}],"user":"U8MPCDJAY","display_as_bot":false,"ts":"1615066396.181600","client_msg_id":"f6922640-ee8d-4595-8cd7-69be87166329","thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"8dea929c-0da2-4068-8828-89177f049335","type":"message","text":"Is there a way to get a list of all mmap-ed files from within a julia session?","user":"U8MPCDJAY","ts":"1615067232.182100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"08m","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a way to get a list of all mmap-ed files from within a julia session?"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"a63c206e-791b-49d8-8aa4-8e1e25573562","type":"message","text":"I would guess not, since mmap mappings are handled by the kernel, and I don't see any logic in Julia that tracks file-backed or anonymous mappings","user":"U6A0PD8CR","ts":"1615067868.182300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/ne","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I would guess not, since mmap mappings are handled by the kernel, and I don't see any logic in Julia that tracks file-backed or anonymous mappings"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"41e2090a-f173-4c1d-82cd-9e06e2b2df9f","type":"message","text":"But I think those last few entries probably are mmap'd","user":"U6A0PD8CR","ts":"1615067888.182500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/Rg2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But I think those last few entries probably are mmap'd"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"},{"client_msg_id":"1a625e9b-7ae5-42a6-907f-c547ed9be4eb","type":"message","text":"yeah ok. I’m trying out monitoring VSCode with MacOS’s <http://Instruments.app|Instruments.app>","user":"U8MPCDJAY","ts":"1615068140.182700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rFgo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah ok. I’m trying out monitoring VSCode with MacOS’s Instruments.app"}]}]}],"thread_ts":"1615050104.178700","parent_user_id":"U8MPCDJAY"}]