[{"client_msg_id":"a62093c4-4ffa-49ce-aae7-cf8bf193ffeb","type":"message","text":"I recently came across <@U67BJLYCS>'s trick for receiving callbacks and data from non-Julia threads by sticking to types that are `isbits &amp;&amp; isimmutable`, and I'm wondering if there is a reason this approach could not be generalized or further documented:\n<https://github.com/JuliaGPU/OpenCL.jl/blame/master/src/event.jl#L97-L142>","user":"USU9FRPEU","ts":"1616003526.010000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nGQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I recently came across "},{"type":"user","user_id":"U67BJLYCS"},{"type":"text","text":"'s trick for receiving callbacks and data from non-Julia threads by sticking to types that are "},{"type":"text","text":"isbits && isimmutable","style":{"code":true}},{"type":"text","text":", and I'm wondering if there is a reason this approach could not be generalized or further documented:\n"},{"type":"link","url":"https://github.com/JuliaGPU/OpenCL.jl/blame/master/src/event.jl#L97-L142"}]}]}],"thread_ts":"1616003526.010000","reply_count":16,"reply_users_count":3,"latest_reply":"1616013119.013300","reply_users":["USU9FRPEU","U67BJLYCS","U67BXBF99"],"subscribed":false},{"client_msg_id":"1907a292-c1e7-4cf2-a53f-7d8cc7bdc218","type":"message","text":"I could imagine a paragraph on this technique in this section of the docs:\n<https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/#Thread-safety>","user":"USU9FRPEU","ts":"1616003580.010100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sEq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I could imagine a paragraph on this technique in this section of the docs:\n"},{"type":"link","url":"https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/#Thread-safety"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"5c752d88-cd3d-41cf-9ce9-355d9eba300a","type":"message","text":"Don't spill my dark secrets","user":"U67BJLYCS","ts":"1616003882.010300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lGi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Don't spill my dark secrets"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"8f056661-f8d7-47f0-abb8-8d96b7a6dabc","type":"message","text":"I signed a deal with the devil :slightly_smiling_face:","user":"U67BJLYCS","ts":"1616003897.010500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dBTl2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I signed a deal with the devil "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU","reactions":[{"name":"vtjnash","users":["U67BJLYCS","USU9FRPEU","UB7JS9CHF"],"count":3}]},{"client_msg_id":"23bb242d-ba47-4cb6-973e-d3da683b9c24","type":"message","text":"Perhaps that's the root of the question. Is this a dark secret that isn't guaranteed to work in the future and thus should not be documented?","user":"USU9FRPEU","ts":"1616004027.010800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mw9G","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Perhaps that's the root of the question. Is this a dark secret that isn't guaranteed to work in the future and thus should not be documented?"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"e2fea5e9-ed24-4d81-aed2-4ac8c3377161","type":"message","text":"Your response implies that is the case :slightly_smiling_face:","user":"USU9FRPEU","ts":"1616004044.011000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"y3x","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Your response implies that is the case "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"723ce1cf-6bb0-43ac-82f5-3838937553b2","type":"message","text":"Maybe I should ask the devil himself. <@U67BXBF99>, any comment?","user":"USU9FRPEU","ts":"1616004149.011300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ermBm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe I should ask the devil himself. "},{"type":"user","user_id":"U67BXBF99"},{"type":"text","text":", any comment?"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"b41ca796-f8ca-4431-8390-2be13e2c6c24","type":"message","text":"Such tricks are notoriously unreliable. We take special pains sometimes to keep the ones we know about working, but often break any that we aren’t aware of.","user":"U67BXBF99","ts":"1616009271.011500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BJP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Such tricks are notoriously unreliable. We take special pains sometimes to keep the ones we know about working, but often break any that we aren’t aware of."}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"6be32f06-39a6-424c-9077-2d1f41135dfc","type":"message","text":"Some day in the future, we’ll have thread support though, and the restrictions will vanish","user":"U67BXBF99","ts":"1616009301.011700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fNyb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Some day in the future, we’ll have thread support though, and the restrictions will vanish"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"1b02abc3-1480-44c1-836a-8d8b95088a32","type":"message","text":"&gt; Some day in the future\n5years and counting :wink:","user":"U67BJLYCS","ts":"1616009345.011900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xsVx","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"Some day in the future"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n5years and counting "},{"type":"emoji","name":"wink"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"3b17def6-63c0-42d3-a533-b50b0a3eddcc","type":"message","text":"Thanks <@U67BXBF99>. You're an angel.","user":"USU9FRPEU","ts":"1616009848.012100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=vD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks "},{"type":"user","user_id":"U67BXBF99"},{"type":"text","text":". You're an angel."}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"0d2a2dc2-aa24-4e36-9457-d44aeae29054","type":"message","text":"I was thinking that the real solution would look something like this from Java Native Access:\n<https://java-native-access.github.io/jna/4.2.1/com/sun/jna/CallbackThreadInitializer.html>","user":"USU9FRPEU","ts":"1616009914.012300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"y0HC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I was thinking that the real solution would look something like this from Java Native Access:\n"},{"type":"link","url":"https://java-native-access.github.io/jna/4.2.1/com/sun/jna/CallbackThreadInitializer.html"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"464ebb99-71e5-45c2-b93d-667be39b59dd","type":"message","text":"Only 5?","user":"U67BXBF99","ts":"1616012136.012500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"i8DXy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Only 5?"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"791d3158-3408-427f-a13a-930567d670a1","type":"message","text":"Since I started counting","user":"U67BJLYCS","ts":"1616012156.012700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yb4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Since I started counting"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"c1cdb02b-af42-4866-af39-19718cbe8c3d","type":"message","text":"maybe 7 now","user":"U67BJLYCS","ts":"1616012160.012900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1PavP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"maybe 7 now"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"aa7d6776-96f3-4c6a-aead-1f04d7c215dd","type":"message","text":"Yeah, that JNA seems potentially similar","user":"U67BXBF99","ts":"1616012176.013100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/Q=L","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, that JNA seems potentially similar"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"},{"client_msg_id":"0bb26b47-538f-40f0-a720-fd7ff1f440f4","type":"message","text":"It calls <https://docs.oracle.com/en/java/javase/16/docs/specs/jni/invocation.html#attachcurrentthread> in JNI. I guess this is what is currently missing for Julia: a way to attach foreign threads","user":"USU9FRPEU","ts":"1616013119.013300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/ZiFn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It calls "},{"type":"link","url":"https://docs.oracle.com/en/java/javase/16/docs/specs/jni/invocation.html#attachcurrentthread"},{"type":"text","text":" in JNI. I guess this is what is currently missing for Julia: a way to attach foreign threads"}]}]}],"thread_ts":"1616003526.010000","parent_user_id":"USU9FRPEU"}]