[{"client_msg_id":"ff815565-4613-4d0a-9b98-1f33794fb2ce","type":"message","text":"<@U674T3KB3> i know this is against the very name and nature of the object, but how can I inspect what an opaque closure is doing?\nI want to know if the optimizer is eliminating/moving the work that I want it to.","user":"U6A936746","ts":"1615990344.005900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cYWwW","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U674T3KB3"},{"type":"text","text":" i know this is against the very name and nature of the object, but how can I inspect what an opaque closure is doing?\nI want to know if the optimizer is eliminating/moving the work that I want it to."}]}]}],"thread_ts":"1615990344.005900","reply_count":5,"reply_users_count":2,"latest_reply":"1615990828.007200","reply_users":["U6A936746","U674T3KB3"],"is_locked":false,"subscribed":false},{"client_msg_id":"5c11f7a9-7dac-472e-9f8e-046adc76eb48","type":"message","text":"It kind of looks like it is not doing the thing I really want it to.\nWhich is to move calls to `size` outside of the closure, if that would let it not capture the thing having it’s `size` measured.\n\n```julia&gt; make_sz(x) = @opaque ()-&gt;size(x)\nmake_sz (generic function with 1 method)\n\njulia&gt; sz = make_sz(ones(5,5))\n()::Tuple{Int64, Int64}-&gt;◌\n\njulia&gt; sz.captures\n([1.0 1.0 … 1.0 1.0; 1.0 1.0 … 1.0 1.0; … ; 1.0 1.0 … 1.0 1.0; 1.0 1.0 … 1.0 1.0],)```\nI really want the reference to the thing having its sized measured to be dropped.\nSince that should (in many case) let the memory be freed.","user":"U6A936746","ts":"1615990549.006000","team":"T68168MUP","edited":{"user":"U6A936746","ts":"1615990602.000000"},"blocks":[{"type":"rich_text","block_id":"jjv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It kind of looks like it is not doing the thing I really want it to.\nWhich is to move calls to "},{"type":"text","text":"size","style":{"code":true}},{"type":"text","text":" outside of the closure, if that would let it not capture the thing having it’s "},{"type":"text","text":"size","style":{"code":true}},{"type":"text","text":" measured.\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> make_sz(x) = @opaque ()->size(x)\nmake_sz (generic function with 1 method)\n\njulia> sz = make_sz(ones(5,5))\n()::Tuple{Int64, Int64}->◌\n\njulia> sz.captures\n([1.0 1.0 … 1.0 1.0; 1.0 1.0 … 1.0 1.0; … ; 1.0 1.0 … 1.0 1.0; 1.0 1.0 … 1.0 1.0],)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nI really want the reference to the thing having its sized measured to be dropped.\nSince that should (in many case) let the memory be freed."}]}]}],"thread_ts":"1615990344.005900","parent_user_id":"U6A936746"},{"client_msg_id":"e3842057-0af0-4d1d-81dc-2e7f52c307b5","type":"message","text":"Yes, that part of the optimization is not implemented yet","user":"U674T3KB3","ts":"1615990632.006400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iPKD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, that part of the optimization is not implemented yet"}]}]}],"thread_ts":"1615990344.005900","parent_user_id":"U6A936746","reactions":[{"name":"+1","users":["U6A936746"],"count":1}]},{"client_msg_id":"ba843d57-e9a1-4252-b107-3b166c42ceb2","type":"message","text":"ok, I thought with the big PR  being closed that had gotten in.\nFair enough.","user":"U6A936746","ts":"1615990654.006600","team":"T68168MUP","edited":{"user":"U6A936746","ts":"1615990743.000000"},"blocks":[{"type":"rich_text","block_id":"30adi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ok, I thought with the big PR  being closed that had gotten in.\nFair enough."}]}]}],"thread_ts":"1615990344.005900","parent_user_id":"U6A936746"},{"client_msg_id":"9c398aeb-ef2a-4206-98a8-5ba0d9bf78ef","type":"message","text":"The big PR had a toy version of it just to play with the concept, but I don't really need it yet, so I'd rather do the full version eventually, rather than something fragile now","user":"U674T3KB3","ts":"1615990790.007000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WidQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The big PR had a toy version of it just to play with the concept, but I don't really need it yet, so I'd rather do the full version eventually, rather than something fragile now"}]}]}],"thread_ts":"1615990344.005900","parent_user_id":"U6A936746"},{"client_msg_id":"b3dcbc40-4c8d-4a86-98d8-895d002d4dd6","type":"message","text":"One can always fix these cases manually anyway.","user":"U6A936746","ts":"1615990828.007200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Yohgo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"One can always fix these cases manually anyway."}]}]}],"thread_ts":"1615990344.005900","parent_user_id":"U6A936746"}]