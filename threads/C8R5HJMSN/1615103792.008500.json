[{"client_msg_id":"84acb5d0-2091-4fc3-a418-e96b1a6e865c","type":"message","text":"I noticed that RigidBodyDynamics have some examples of using symbolic manipulation using sympy for the dynamic equations of mechanical systems.\n<https://juliarobotics.org/RigidBodyDynamics.jl/stable/generated/6.%20Symbolics%20using%20SymPy/6.%20Symbolics%20using%20SymPy/>\nWe do this a lot, using sympy and python, but have the following problem:\n- for a robot with 2DOF, you can derive the equations by hand\n- for 3DOF the calculations are very, very long\n- for 4DOF sympy is happy to do them for you\n- 5DOF takes a very long time\n- 6DOF takes a weekend\n- 7DOF forget about it\n\nI would really like to be able to manipulate those equations using Symbolics.jl and use them inside MTK models,  but I find that I never get very far when I about once every second month try it out, I always stumble on something trivial and fail to interpret the error message. Are there any examples of manipulating such equations using Symbolics.jl and simulating them?","user":"UJ7DVTVQ8","ts":"1615103792.008500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"z4Cy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I noticed that RigidBodyDynamics have some examples of using symbolic manipulation using sympy for the dynamic equations of mechanical systems.\n"},{"type":"link","url":"https://juliarobotics.org/RigidBodyDynamics.jl/stable/generated/6.%20Symbolics%20using%20SymPy/6.%20Symbolics%20using%20SymPy/"},{"type":"text","text":"\nWe do this a lot, using sympy and python, but have the following problem:\n- for a robot with 2DOF, you can derive the equations by hand\n- for 3DOF the calculations are very, very long\n- for 4DOF sympy is happy to do them for you\n- 5DOF takes a very long time\n- 6DOF takes a weekend\n- 7DOF forget about it\n\nI would really like to be able to manipulate those equations using Symbolics.jl and use them inside MTK models,  but I find that I never get very far when I about once every second month try it out, I always stumble on something trivial and fail to interpret the error message. Are there any examples of manipulating such equations using Symbolics.jl and simulating them?"}]}]}],"thread_ts":"1615103792.008500","reply_count":15,"reply_users_count":3,"latest_reply":"1615116114.011400","reply_users":["UJ7DVTVQ8","U69BL50BF","U013L06JN15"],"subscribed":false},{"client_msg_id":"05ae590f-5f11-4055-b901-5252793ab400","type":"message","text":"To clarify, I'm talking about equations like this\n```τ = M(q)q̈ + C(q,q̇)q̇ + g(q) + F(q̇)```\nforming an inverse model of a mechanical system where `τ` are the joint torques and `M` is the inertia matrix etc.","user":"UJ7DVTVQ8","ts":"1615103941.008600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sjga","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"To clarify, I'm talking about equations like this\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"τ = M(q)q̈ + C(q,q̇)q̇ + g(q) + F(q̇)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"forming an inverse model of a mechanical system where "},{"type":"text","text":"τ","style":{"code":true}},{"type":"text","text":" are the joint torques and "},{"type":"text","text":"M","style":{"code":true}},{"type":"text","text":" is the inertia matrix etc."}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"78663656-0ec5-4abc-9e71-8c55dc891505","type":"message","text":"it's just a DAE?","user":"U69BL50BF","ts":"1615104129.008800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4xs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it's just a DAE?"}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"ac5dd921-91fc-447e-98b1-00f5eec59eb6","type":"message","text":"yep","user":"UJ7DVTVQ8","ts":"1615104203.009000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pr/Wc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yep"}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"4d2f6fa3-c203-4cfc-8859-cbd8497b37c9","type":"message","text":"but the terms in M are very complicated","user":"UJ7DVTVQ8","ts":"1615104223.009200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5ko0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but the terms in M are very complicated"}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"453c5b15-fdc1-4e74-86bf-64fba03a166d","type":"message","text":"here they are for two joints\n<https://juliarobotics.org/RigidBodyDynamics.jl/stable/generated/6.%20Symbolics%20using%20SymPy/6.%20Symbolics%20using%20SymPy/#Compute-dynamical-quantities-in-symbolic-form>","user":"UJ7DVTVQ8","ts":"1615104240.009400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WDI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"here they are for two joints\n"},{"type":"link","url":"https://juliarobotics.org/RigidBodyDynamics.jl/stable/generated/6.%20Symbolics%20using%20SymPy/6.%20Symbolics%20using%20SymPy/#Compute-dynamical-quantities-in-symbolic-form"}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"dd6a541e-8a80-4d02-9a7d-c9df15c52418","type":"message","text":"I don't know if it'll be super relevant, but if you're looking for an example of doing manipulations of MTK symbolic models and then simulating them, I do some things like generate augmented systems from existing astrodynamics models and their equations of motion in OrbitalTrajectories.jl. (e.g. simulate a system together with its Jacobian as a set of variational equations) <https://github.com/dpad/OrbitalTrajectories.jl/tree/master/src/dynamics>","user":"U013L06JN15","ts":"1615104767.009600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UIAL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't know if it'll be super relevant, but if you're looking for an example of doing manipulations of MTK symbolic models and then simulating them, I do some things like generate augmented systems from existing astrodynamics models and their equations of motion in OrbitalTrajectories.jl. (e.g. simulate a system together with its Jacobian as a set of variational equations) "},{"type":"link","url":"https://github.com/dpad/OrbitalTrajectories.jl/tree/master/src/dynamics"}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"9fe2319f-9b2d-4166-ae32-7148c1a4b4f8","type":"message","text":"I also use some work-in-progress code from an open PR in Symbolics that does common subexpression elimination (i.e. automatically removing common terms in the resulting equations to improve the performance by only computing them once)","user":"U013L06JN15","ts":"1615104887.009800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"84MRw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I also use some work-in-progress code from an open PR in Symbolics that does common subexpression elimination (i.e. automatically removing common terms in the resulting equations to improve the performance by only computing them once)"}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"4c0db3fc-2b86-4ffd-b24e-6c96e42e39be","type":"message","text":"So maybe those might be helpful?","user":"U013L06JN15","ts":"1615104904.010000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kVR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So maybe those might be helpful?"}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"18b84aac-d210-43e4-877e-7d86dfe5c449","type":"message","text":"Post an example in the issues and we'll use it to expand the `ODESystem` . I know what you'd be running into. It's that right now it requires a semi-explicit ODE, though we have the `dae_index_lowering` transform that would not require it.","user":"U69BL50BF","ts":"1615105128.010200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GPUxt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Post an example in the issues and we'll use it to expand the "},{"type":"text","text":"ODESystem","style":{"code":true}},{"type":"text","text":" . I know what you'd be running into. It's that right now it requires a semi-explicit ODE, though we have the "},{"type":"text","text":"dae_index_lowering","style":{"code":true}},{"type":"text","text":" transform that would not require it."}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"cebf1b4b-ce69-4071-89c2-ae1dcd2cbba5","type":"message","text":"we just need to handle the mass matrix a bit more automatically.","user":"U69BL50BF","ts":"1615105141.010400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OoO7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"we just need to handle the mass matrix a bit more automatically."}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"fe012aa4-ba42-4ef0-b3aa-c8f519b0f406","type":"message","text":"<@U013L06JN15> thanks for the links, I'll have a look and see if I can gain any insight on how to use MTK in the wild :slightly_smiling_face:\n\n<@U69BL50BF> my dream would be to specify a model using MKT and then automatically generate the required dynamics functions to run, e.g., a particle filter on it for state estimation. The issue in robotics is that you need to use a lot of tricks to make the estimator run in &gt;1kHz, such as using your domain knowledge to perform some simplifications. One typical example is to use the same mass matrix for all particles at a particular time instant, even tough the mass matrix technically is a function of a state variable. If you have thousands of particles, it's nowhere near feasible to calculate the mass matrix for each of them in each time step.","user":"UJ7DVTVQ8","ts":"1615106264.010600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dxP9","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U013L06JN15"},{"type":"text","text":" thanks for the links, I'll have a look and see if I can gain any insight on how to use MTK in the wild "},{"type":"emoji","name":"slightly_smiling_face"},{"type":"text","text":"\n\n"},{"type":"user","user_id":"U69BL50BF"},{"type":"text","text":" my dream would be to specify a model using MKT and then automatically generate the required dynamics functions to run, e.g., a particle filter on it for state estimation. The issue in robotics is that you need to use a lot of tricks to make the estimator run in >1kHz, such as using your domain knowledge to perform some simplifications. One typical example is to use the same mass matrix for all particles at a particular time instant, even tough the mass matrix technically is a function of a state variable. If you have thousands of particles, it's nowhere near feasible to calculate the mass matrix for each of them in each time step."}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"efb2309f-6e27-4ccc-ace6-471161efefee","type":"message","text":"open an example of what you're trying to do. We just did some mass matrix improvements last night, but I don't think it covers what you're looking for, but it is in our targets.","user":"U69BL50BF","ts":"1615106668.010800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3XtY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"open an example of what you're trying to do. We just did some mass matrix improvements last night, but I don't think it covers what you're looking for, but it is in our targets."}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"177e12d5-fd88-47f7-b91c-9419a516f666","type":"message","text":"I'll write something up, but might have to share it privately","user":"UJ7DVTVQ8","ts":"1615115749.011000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EuW+Q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'll write something up, but might have to share it privately"}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"e286d472-48a5-4c27-b9ef-049057789c80","type":"message","text":"okay","user":"U69BL50BF","ts":"1615116105.011200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hCN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"okay"}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"},{"client_msg_id":"6d249a3a-2bb2-4d3e-9c88-fb5b8945aae8","type":"message","text":"I think this is something where <@U018N4DE8GM> could probably help as well.","user":"U69BL50BF","ts":"1615116114.011400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=dNST","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think this is something where "},{"type":"user","user_id":"U018N4DE8GM"},{"type":"text","text":" could probably help as well."}]}]}],"thread_ts":"1615103792.008500","parent_user_id":"UJ7DVTVQ8"}]