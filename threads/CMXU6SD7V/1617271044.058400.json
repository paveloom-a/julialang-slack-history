[{"client_msg_id":"f19aa169-c917-4e86-9a04-0d39bcca76dc","type":"message","text":"I wanted to share this new Kepler solver <https://arxiv.org/abs/2103.15829> but I see <@U8442MDS6> is already on it :smile: i feel like a Julia implementation would be pretty fast (especially using `sincos`), but I believe this method is also way more expensive than <https://link.springer.com/article/10.1007/BF00691917> (and the fact that they don't mention Markley's solver makes me think they don't know it)","user":"UDB26738Q","ts":"1617271044.058400","team":"T68168MUP","edited":{"user":"UDB26738Q","ts":"1617271857.000000"},"attachments":[{"service_name":"Celestial Mechanics and Dynamical Astronomy","title":"Kepler Equation solver","title_link":"https://link.springer.com/article/10.1007/BF00691917","text":"Kepler's Equation is solved over the entire range of elliptic motion by a fifth-order refinement of the solution of a cubic equation. This method is not iterative, and requires only four transcendental function evaluations: a square root, a cube root, and two trigonometric functions. The maximum relative error of the algorithm is less than one part in 1018, exceeding the capability of double-precision computer arithmetic. Roundoff errors in double-precision implementation of the algorithm are addressed, and procedures to avoid them are developed.","fallback":"Celestial Mechanics and Dynamical Astronomy: Kepler Equation solver","thumb_url":"https://media.springernature.com/w200/springer-static/cover/journal/10569.jpg","from_url":"https://link.springer.com/article/10.1007/BF00691917","thumb_width":200,"thumb_height":304,"id":1,"original_url":"https://link.springer.com/article/10.1007/BF00691917"}],"blocks":[{"type":"rich_text","block_id":"6cZ5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I wanted to share this new Kepler solver "},{"type":"link","url":"https://arxiv.org/abs/2103.15829"},{"type":"text","text":" but I see "},{"type":"user","user_id":"U8442MDS6"},{"type":"text","text":" is already on it "},{"type":"emoji","name":"smile"},{"type":"text","text":" i feel like a Julia implementation would be pretty fast (especially using "},{"type":"text","text":"sincos","style":{"code":true}},{"type":"text","text":"), but I believe this method is also way more expensive than "},{"type":"link","url":"https://link.springer.com/article/10.1007/BF00691917"},{"type":"text","text":" (and the fact that they don't mention Markley's solver makes me think they don't know it)"}]}]}],"thread_ts":"1617271044.058400","reply_count":50,"reply_users_count":2,"latest_reply":"1617304384.075400","reply_users":["UL4JREGCV","UDB26738Q"],"is_locked":false,"subscribed":false},{"client_msg_id":"3E45ECBC-8EA0-4804-998A-A23008C9695F","type":"message","text":"I implemented this yesterday in my Julia orbit solver! I got a 3-4x speed improvement over my already optimized implementation, and reduced allocations to zero","user":"UL4JREGCV","ts":"1617299911.062100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"x6E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I implemented this yesterday in my Julia orbit solver! I got a 3-4x speed improvement over my already optimized implementation, and reduced allocations to zero"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"533C82B0-1439-40AA-8CF1-C003D541CFA0","type":"message","text":"Plus it plays nicely with auto diff and I can remove dependence on ChainRulesCore","user":"UL4JREGCV","ts":"1617299967.063400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vS2QZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Plus it plays nicely with auto diff and I can remove dependence on ChainRulesCore"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"b8fb3563-3d39-4a6a-a947-3e85034d1991","type":"message","text":"oh, I'm surprised that you could reduce allocations to 0, as I see a few allocations","user":"UDB26738Q","ts":"1617299969.063600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Eke=C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh, I'm surprised that you could reduce allocations to 0, as I see a few allocations"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"11BFA8EF-CD12-40EB-9521-6B146D3F5078","type":"message","text":"Thanks for that other solver reference. I’ll try that as well to compare.","user":"UL4JREGCV","ts":"1617300035.064300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"s34z4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks for that other solver reference. I’ll try that as well to compare."}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"56366a25-9530-417d-b281-7459b3800062","type":"message","text":"it's already implemented in `AstroLib`: <http://juliaastro.github.io/AstroLib.jl/stable/ref.html#AstroLib.kepler_solver-Tuple{Real,Real}>","user":"UDB26738Q","ts":"1617300074.064700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uTIsp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it's already implemented in "},{"type":"text","text":"AstroLib","style":{"code":true}},{"type":"text","text":": "},{"type":"link","url":"http://juliaastro.github.io/AstroLib.jl/stable/ref.html#AstroLib.kepler_solver-Tuple{Real,Real}"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"DFA8BF24-A05E-48F5-9743-E00D5C88B793","type":"message","text":"Here’s my version of the new algorithm: <https://github.com/sefffal/DirectOrbits.jl/blob/52cc30d21f7f5689241fbd2b21b172791f7a8263/src/DirectOrbits.jl#L394|https://github.com/sefffal/DirectOrbits.jl/blob/52cc30d21f7f5689241fbd2b21b172791f7a8263/src/DirectOrbits.jl#L394>","user":"UL4JREGCV","ts":"1617300088.065200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OeO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Here’s my version of the new algorithm: "},{"type":"link","url":"https://github.com/sefffal/DirectOrbits.jl/blob/52cc30d21f7f5689241fbd2b21b172791f7a8263/src/DirectOrbits.jl#L394","text":"https://github.com/sefffal/DirectOrbits.jl/blob/52cc30d21f7f5689241fbd2b21b172791f7a8263/src/DirectOrbits.jl#L394"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"927AA22F-6418-4489-BDBB-A1F5343EF0EE","type":"message","text":"Nice, thanks!","user":"UL4JREGCV","ts":"1617300094.065600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MwjUv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Nice, thanks!"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"ff221b27-7cfd-450c-b8f0-103733c7c2ba","type":"message","text":"Markley's method is pretty straightforward, non-iterative, very few trascendental functions evaluations, precise in the entire range `[0, 1]` (my understanding is that the new methods excludes endpoints)","user":"UDB26738Q","ts":"1617300133.065800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RnhYt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Markley's method is pretty straightforward, non-iterative, very few trascendental functions evaluations, precise in the entire range "},{"type":"text","text":"[0, 1]","style":{"code":true}},{"type":"text","text":" (my understanding is that the new methods excludes endpoints)"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"4C9F8CBB-7B93-4B49-93E3-F38EC1E374C1","type":"message","text":"Yes it does, but 0 at least has a trivial solution ","user":"UL4JREGCV","ts":"1617300268.067000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SuY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes it does, but 0 at least has a trivial solution "}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"782a5c09-1f30-40fe-8a1a-b269edbffd2f","type":"message","text":"right","user":"UDB26738Q","ts":"1617300297.067200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"P2z8u","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"right"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"6b454a11-1815-46dd-91ed-f994034b547e","type":"message","text":"```julia&gt; using AstroLib, DirectOrbits, BenchmarkTools\n\njulia&gt; @btime kepler_solver(0.5, 0.5)\n  100.795 ns (0 allocations: 0 bytes)\n0.8878622115708661\n\njulia&gt; @btime DirectOrbits.eccentric_anomaly(0.5, 0.5)\n  1.664 μs (22 allocations: 2.17 KiB)\n0.8878622115708661```","user":"UDB26738Q","ts":"1617300606.067400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zaX0","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> using AstroLib, DirectOrbits, BenchmarkTools\n\njulia> @btime kepler_solver(0.5, 0.5)\n  100.795 ns (0 allocations: 0 bytes)\n0.8878622115708661\n\njulia> @btime DirectOrbits.eccentric_anomaly(0.5, 0.5)\n  1.664 μs (22 allocations: 2.17 KiB)\n0.8878622115708661"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"2e3f4241-3c57-45e8-a3ea-bdc77c7fa5f2","type":"message","text":"What about eccentric_anomaly_goat, the new algorithm?","user":"UL4JREGCV","ts":"1617300636.067600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lxw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What about eccentric_anomaly_goat, the new algorithm?"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"08cfd212-7173-43c2-95aa-1aa0d7003ca0","type":"message","text":"right, wrong method :sweat_smile:\n```julia&gt; @btime DirectOrbits.eccentric_anomaly_goat(0.5, 0.5)\n  764.184 ns (0 allocations: 0 bytes)\n0.9067476042322102```","user":"UDB26738Q","ts":"1617300671.067800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jZcR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"right, wrong method "},{"type":"emoji","name":"sweat_smile"},{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime DirectOrbits.eccentric_anomaly_goat(0.5, 0.5)\n  764.184 ns (0 allocations: 0 bytes)\n0.9067476042322102"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"9b3550b0-5cc5-4cfb-8ee3-07a5c5fde4c1","type":"message","text":"Wow! That is an impressive improvement","user":"UL4JREGCV","ts":"1617300720.068000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"f6WX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Wow! That is an impressive improvement"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"badd01dd-874f-48f3-b17e-0c3de5a4df58","type":"message","text":"```julia&gt; @btime E .= kepler_solver.(M, 0.5) setup=(M=collect(range(-pi, pi; length=1_000_000)); E=similar(M));\n  108.081 ms (0 allocations: 0 bytes)\n\njulia&gt; @btime E .= DirectOrbits.eccentric_anomaly_goat.(M, 0.5) setup=(M=collect(range(-pi, pi; length=1_000_000)); E=similar(M));\n  807.748 ms (0 allocations: 0 bytes)```","user":"UDB26738Q","ts":"1617300797.068200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EVJW","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime E .= kepler_solver.(M, 0.5) setup=(M=collect(range(-pi, pi; length=1_000_000)); E=similar(M));\n  108.081 ms (0 allocations: 0 bytes)\n\njulia> @btime E .= DirectOrbits.eccentric_anomaly_goat.(M, 0.5) setup=(M=collect(range(-pi, pi; length=1_000_000)); E=similar(M));\n  807.748 ms (0 allocations: 0 bytes)"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"57ba89a6-c7cb-4040-bce2-bbb56780f3e9","type":"message","text":"I think I miss the point of their method :grimacing:","user":"UDB26738Q","ts":"1617300806.068400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Idsk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think I miss the point of their method "},{"type":"emoji","name":"grimacing"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"15deb193-8a45-40e6-9c65-ffeedaef59d6","type":"message","text":"Well it is still much better than the usual methods I see discussed in the literature","user":"UL4JREGCV","ts":"1617300846.068600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nzp4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well it is still much better than the usual methods I see discussed in the literature"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"d54c4d9a-4c26-46a8-8ba4-2d919f671d85","type":"message","text":"Seems like the one you've pointed us to is a hidden gem","user":"UL4JREGCV","ts":"1617300868.068800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yHv0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Seems like the one you've pointed us to is a hidden gem"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"aa6fa1e2-b572-4d16-a5ba-ee00858d678f","type":"message","text":"I didn't know it was hidden :sweat_smile:","user":"UDB26738Q","ts":"1617300890.069000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rKH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I didn't know it was hidden "},{"type":"emoji","name":"sweat_smile"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"480acbdb-ff21-457e-a81e-71806eb9a0ba","type":"message","text":"I found it in other Python packages as well","user":"UDB26738Q","ts":"1617300907.069200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oae79","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I found it in other Python packages as well"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"569e795f-53c4-46d7-b68a-dea8149af54e","type":"message","text":"`exoplanet` for example uses it (but coded in C++ because, you know): <https://github.com/exoplanet-dev/exoplanet/blob/4c1f15eb179faa7641feb05be9c39dd0dfa67494/src/exoplanet/theano_ops/lib/include/exoplanet/kepler.h>","user":"UDB26738Q","ts":"1617300996.069400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aorM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"exoplanet","style":{"code":true}},{"type":"text","text":" for example uses it (but coded in C++ because, you know): "},{"type":"link","url":"https://github.com/exoplanet-dev/exoplanet/blob/4c1f15eb179faa7641feb05be9c39dd0dfa67494/src/exoplanet/theano_ops/lib/include/exoplanet/kepler.h"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"18ce5e8d-3a73-48e7-b5a3-447d8bfe3759","type":"message","text":"I don't see it here <https://github.com/sblunt/orbitize/blob/main/orbitize/kepler.py>","user":"UL4JREGCV","ts":"1617301132.069600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kXy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't see it here "},{"type":"link","url":"https://github.com/sblunt/orbitize/blob/main/orbitize/kepler.py"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"d29fe2ec-5d52-45ab-abd2-6aab6c3108f2","type":"message","text":"This is great, that was one of the bottlenecks in my orbit fitting code","user":"UL4JREGCV","ts":"1617301175.069800","team":"T68168MUP","edited":{"user":"UL4JREGCV","ts":"1617301201.000000"},"blocks":[{"type":"rich_text","block_id":"jXMSe","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is great, that was one of the bottlenecks in my orbit fitting code"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"8a2952aa-d03c-4154-baf3-6c27e9f34fad","type":"message","text":"if I remember correctly, the bottleneck in Markley is the cube root: <https://github.com/JuliaAstro/AstroLib.jl/blob/fbf023c2949636a4e57914c954c4ffd6e2f203aa/src/kepler_solver.jl#L21>","user":"UDB26738Q","ts":"1617301393.070100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RhLs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if I remember correctly, the bottleneck in Markley is the cube root: "},{"type":"link","url":"https://github.com/JuliaAstro/AstroLib.jl/blob/fbf023c2949636a4e57914c954c4ffd6e2f203aa/src/kepler_solver.jl#L21"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"2bdefaa7-e027-4613-8cc1-f5a1f2baceb6","type":"message","text":"but the rest is very straightforward","user":"UDB26738Q","ts":"1617301415.070300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CRO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but the rest is very straightforward"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"54a76f9d-93f7-4555-9c7c-acea7ec0d551","type":"message","text":"Without yet reading the article, is this actually a (very good) approximation?","user":"UL4JREGCV","ts":"1617301456.070500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zRf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Without yet reading the article, is this actually a (very good) approximation?"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"5fd62c0c-d601-419e-aea8-583d01092627","type":"message","text":"he claims it's double-precision accurate","user":"UDB26738Q","ts":"1617301478.070700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"m6zCY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"he claims it's double-precision accurate"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"61f81134-8ec2-4ebc-b8bf-7fc049b71a06","type":"message","text":"Maybe the new method can be solved to greater accuracy if desired? Otherwise I'm not sure","user":"UL4JREGCV","ts":"1617301479.070900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SOSX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe the new method can be solved to greater accuracy if desired? Otherwise I'm not sure"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"b41a918b-31e1-4ae9-a26a-81178af214ed","type":"message","text":"yes, one limitation of Markley is that it has a fixed accuracy, not being iterative","user":"UDB26738Q","ts":"1617301506.071100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+7QX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yes, one limitation of Markley is that it has a fixed accuracy, not being iterative"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"0784b1c2-20a9-4d93-a147-e7746380914a","type":"message","text":"so if you use `BigFloat` you don't gain anything, for example","user":"UDB26738Q","ts":"1617301525.071300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Jxhbq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so if you use "},{"type":"text","text":"BigFloat","style":{"code":true}},{"type":"text","text":" you don't gain anything, for example"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"f4805ffa-1bea-494d-9f1d-14787174c8f4","type":"message","text":"```julia&gt; using AstroLib, DirectOrbits\n\njulia&gt; M = collect(range(-pi, pi; length=1_000_000));\n\njulia&gt; ecc = 0.5\n0.5\n\njulia&gt; E_goat = DirectOrbits.eccentric_anomaly_goat.(M, ecc);\n\njulia&gt; E_markley = kepler_solver.(M, ecc);\n\njulia&gt; extrema(abs.(M .- rem2pi.(E_markley .- 0.5 .* sin.(E_markley), RoundNearest)))\n(0.0, 4.440892098500626e-16)\n\njulia&gt; extrema(abs.(M .- rem2pi.(E_goat .- 0.5 .* sin.(E_goat), RoundNearest)))\n(1.453948073049105e-12, 3.137922125546848)```\nthe error looks pretty bad :confused:","user":"UDB26738Q","ts":"1617301899.071500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7a3d","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> using AstroLib, DirectOrbits\n\njulia> M = collect(range(-pi, pi; length=1_000_000));\n\njulia> ecc = 0.5\n0.5\n\njulia> E_goat = DirectOrbits.eccentric_anomaly_goat.(M, ecc);\n\njulia> E_markley = kepler_solver.(M, ecc);\n\njulia> extrema(abs.(M .- rem2pi.(E_markley .- 0.5 .* sin.(E_markley), RoundNearest)))\n(0.0, 4.440892098500626e-16)\n\njulia> extrema(abs.(M .- rem2pi.(E_goat .- 0.5 .* sin.(E_goat), RoundNearest)))\n(1.453948073049105e-12, 3.137922125546848)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"the error looks pretty bad "},{"type":"emoji","name":"confused"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"ad51f79f-a84b-440b-b2e6-700fecc07d88","type":"message","text":"FYI `eccentric_anomaly_goat` accepts arguments in the opposite order. e then MA","user":"UL4JREGCV","ts":"1617301944.071700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Znox","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"FYI "},{"type":"text","text":"eccentric_anomaly_goat","style":{"code":true}},{"type":"text","text":" accepts arguments in the opposite order. e then MA"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"7f259756-3eca-4349-8126-6f58aa4ad2ed","type":"message","text":":picard_facepalm:","user":"UDB26738Q","ts":"1617301951.071900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=oG","elements":[{"type":"rich_text_section","elements":[{"type":"emoji","name":"picard_facepalm"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"ec3d20db-a970-4fc5-99b5-4d21c167a2e4","type":"message","text":"sorry!\n```julia&gt; E_goat = DirectOrbits.eccentric_anomaly_goat.(ecc, M);\n\njulia&gt; extrema(abs.(M .- rem2pi.(E_goat .- 0.5 .* sin.(E_goat), RoundNearest)))\n(0.0, 6.281953674070294)```","user":"UDB26738Q","ts":"1617301980.072100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"npJf6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"sorry!\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> E_goat = DirectOrbits.eccentric_anomaly_goat.(ecc, M);\n\njulia> extrema(abs.(M .- rem2pi.(E_goat .- 0.5 .* sin.(E_goat), RoundNearest)))\n(0.0, 6.281953674070294)"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"12e69ba5-52e0-4c0d-a9ba-7294730597fa","type":"message","text":"median of the absolute errors:\n```julia&gt; median(abs.(M .- rem2pi.(E_markley .- 0.5 .* sin.(E_markley), RoundNearest)))\n0.0\n\njulia&gt; median(abs.(M .- rem2pi.(E_goat .- 0.5 .* sin.(E_goat), RoundNearest)))\n0.03024525363151853```\n","user":"UDB26738Q","ts":"1617302062.072300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PWm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"median of the absolute errors:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> median(abs.(M .- rem2pi.(E_markley .- 0.5 .* sin.(E_markley), RoundNearest)))\n0.0\n\njulia> median(abs.(M .- rem2pi.(E_goat .- 0.5 .* sin.(E_goat), RoundNearest)))\n0.03024525363151853"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"20fd9bc9-feb4-4e3d-a225-a97820b778b2","type":"message","text":"I may be doing something wrong again :grimacing:","user":"UDB26738Q","ts":"1617302076.072500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oII","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I may be doing something wrong again "},{"type":"emoji","name":"grimacing"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"efab89cb-0fcd-43bd-ac27-48e2f8ecefec","type":"message","text":"Could be I set the iterations too low","user":"UL4JREGCV","ts":"1617302102.072700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+qx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Could be I set the iterations too low"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"f3110c41-65bf-4d7a-8554-38060519a0a1","type":"message","text":"I'm running their example:\n```% ./kepler \nN_ell = 1000000\ne = 0.50\ntolerance = 1.00e-12\nComputed Newton-Raphson estimate in 4 steps after 136.4 ms with mean-error 9.33e-17\nComputed Danby estimate in 2 steps after 104.4 ms with mean-error 1.40e-16\nComputed series estimate in 47 steps after 266.1 ms with mean-error 8.84e-13\nComputed contour estimate in 7 steps after 56.8 ms with mean-error 9.67e-13```\ntheir error doesn't look great either","user":"UDB26738Q","ts":"1617302269.073000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dXWx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm running their example:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"% ./kepler \nN_ell = 1000000\ne = 0.50\ntolerance = 1.00e-12\nComputed Newton-Raphson estimate in 4 steps after 136.4 ms with mean-error 9.33e-17\nComputed Danby estimate in 2 steps after 104.4 ms with mean-error 1.40e-16\nComputed series estimate in 47 steps after 266.1 ms with mean-error 8.84e-13\nComputed contour estimate in 7 steps after 56.8 ms with mean-error 9.67e-13"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"their error doesn't look great either"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"0d53b54a-5ba8-49c8-80cc-cfa104a3ebb7","type":"message","text":"the mean error with markley is three orders of magnitude smaller:\n```julia&gt; mean(abs.(M .- rem2pi.(E_markley .- 0.5 .* sin.(E_markley), RoundNearest)))\n1.0174368118842647e-16```","user":"UDB26738Q","ts":"1617302301.073200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VOvik","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the mean error with markley is three orders of magnitude smaller:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> mean(abs.(M .- rem2pi.(E_markley .- 0.5 .* sin.(E_markley), RoundNearest)))\n1.0174368118842647e-16"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"a2bf0820-6c41-41ec-8a53-872fa63956b2","type":"message","text":"well, closer to 4","user":"UDB26738Q","ts":"1617302426.073400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LEyb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"well, closer to 4"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"bea151bc-a269-42ab-9900-59fac1c4eaaf","type":"message","text":"Interesting, using forward diff with `kepler_solver` leads to a stack overflow","user":"UL4JREGCV","ts":"1617303513.073600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=iYy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Interesting, using forward diff with "},{"type":"text","text":"kepler_solver","style":{"code":true}},{"type":"text","text":" leads to a stack overflow"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"b44967d8-377c-48f6-9333-5a30206c0d18","type":"message","text":"uhm, maybe because ForwardDiff doesn't like methods with `AbstractFloat`","user":"UDB26738Q","ts":"1617303556.073800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sCQL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"uhm, maybe because ForwardDiff doesn't like methods with "},{"type":"text","text":"AbstractFloat","style":{"code":true}}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"4b1f9008-5c48-4d85-ae12-65e3e1959e00","type":"message","text":"Zygote works but `@scalar_rule kepler_solver(MA, e) @setup(u = 1 - e*cos(Ω)) (1 / u, sin(Ω) / u)`  make it a lot happier","user":"UL4JREGCV","ts":"1617303890.074000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1gzZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Zygote works but "},{"type":"text","text":"@scalar_rule kepler_solver(MA, e) @setup(u = 1 - e*cos(Ω)) (1 / u, sin(Ω) / u)","style":{"code":true}},{"type":"text","text":"  make it a lot happier"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"71a8699c-94ff-4fec-8f50-8798735806f5","type":"message","text":"let me see if I can simplify the method without sacrificing type-stability","user":"UDB26738Q","ts":"1617303989.074200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"t=Xvy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"let me see if I can simplify the method without sacrificing type-stability"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"6036ea9a-d9df-4afc-8766-c330ed66e8ee","type":"message","text":"(I also wrote the code about 5 years ago :sweat_smile:)","user":"UDB26738Q","ts":"1617304011.074400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Z8fRi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(I also wrote the code about 5 years ago "},{"type":"emoji","name":"sweat_smile"},{"type":"text","text":")"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"b06890a1-6e3e-432c-bb14-debb891ea3dd","type":"message","text":"Any interest in adding that @scalar_rule to the code?","user":"UL4JREGCV","ts":"1617304026.074600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ABc+Z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Any interest in adding that @scalar_rule to the code?"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"fa4fbe2c-4b56-4172-838e-6d67b8ca0894","type":"message","text":"does it mean I need to add a dependency? :grimacing:","user":"UDB26738Q","ts":"1617304059.074800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b5x","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"does it mean I need to add a dependency? "},{"type":"emoji","name":"grimacing"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"10968ac8-f319-4b5d-8e52-0ef29c7a2ee7","type":"message","text":"Only ChainRulesCore :slightly_smiling_face:","user":"UL4JREGCV","ts":"1617304068.075000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mOl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Only ChainRulesCore "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"a38c179c-990a-42a0-a779-b1465723391c","type":"message","text":"I doubt anyone but me is solving orbits with autodiff though  :wink:","user":"UL4JREGCV","ts":"1617304097.075200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QbSJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I doubt anyone but me is solving orbits with autodiff though  "},{"type":"emoji","name":"wink"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"},{"client_msg_id":"09bccc50-d145-4c2d-911e-9942eda60064","type":"message","text":"<https://github.com/JuliaAstro/AstroLib.jl/pull/68>","user":"UDB26738Q","ts":"1617304384.075400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dMe","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/JuliaAstro/AstroLib.jl/pull/68"}]}]}],"thread_ts":"1617271044.058400","parent_user_id":"UDB26738Q"}]