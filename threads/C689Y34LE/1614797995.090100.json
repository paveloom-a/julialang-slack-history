[{"client_msg_id":"c0a8ec57-5608-46e5-a6d6-474f28700608","type":"message","text":"Hi, I am broadcasting a `CuArray` over a function that has some trig functions in it and I am seeing\n```┌ Warning: calls to Base intrinsics might be GPU incompatible\n│   exception =\n│    You called sin(x::T) where T&lt;:Union{Float32, Float64} in Base.Math at special/trig.jl:29, maybe you intended to call sin(x::Float32) in CUDA at /home/aleonard31/.julia/packages/CUDA/wTQsK/src/device/intrinsics/math.jl:13 instead?\n│    Stacktrace:\n│     [1] sin at special/trig.jl:29\n│     [2] broadcast_kernel at /home/aleonard31/.julia/packages/GPUArrays/WV76E/src/host/broadcast.jl:59```\nis there a way to handle this without changing the sin/cos to CUDA.sin/CUDA.cos?","user":"U0178LR5K7F","ts":"1614797995.090100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2al","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi, I am broadcasting a "},{"type":"text","text":"CuArray","style":{"code":true}},{"type":"text","text":" over a function that has some trig functions in it and I am seeing\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"┌ Warning: calls to Base intrinsics might be GPU incompatible\n│   exception =\n│    You called sin(x::T) where T<:Union{Float32, Float64} in Base.Math at special/trig.jl:29, maybe you intended to call sin(x::Float32) in CUDA at /home/aleonard31/.julia/packages/CUDA/wTQsK/src/device/intrinsics/math.jl:13 instead?\n│    Stacktrace:\n│     [1] sin at special/trig.jl:29\n│     [2] broadcast_kernel at /home/aleonard31/.julia/packages/GPUArrays/WV76E/src/host/broadcast.jl:59"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"is there a way to handle this without changing the sin/cos to CUDA.sin/CUDA.cos?"}]}]}],"thread_ts":"1614797995.090100","reply_count":11,"reply_users_count":3,"latest_reply":"1614802890.092800","reply_users":["U0178LR5K7F","U6A0PD8CR","U68A3ASP9"],"subscribed":false},{"client_msg_id":"f3a387cb-c8a5-4e8b-a00f-868b18e6ed5c","type":"message","text":"specifically, the function being broadcasted over does not hold the sin/cos, but rather an inlined function that is called. Additionally, calling `sin.(x)` over `x` the CuArray throws no errors","user":"U0178LR5K7F","ts":"1614798148.090200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6wAW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"specifically, the function being broadcasted over does not hold the sin/cos, but rather an inlined function that is called. Additionally, calling "},{"type":"text","text":"sin.(x)","style":{"code":true}},{"type":"text","text":" over "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" the CuArray throws no errors"}]}]}],"thread_ts":"1614797995.090100","parent_user_id":"U0178LR5K7F"},{"client_msg_id":"4be35ff8-1539-4416-9b5a-988b87efb026","type":"message","text":"At the current moment, not really, without using KernelAbstractions instead","user":"U6A0PD8CR","ts":"1614798459.090600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sPSC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"At the current moment, not really, without using KernelAbstractions instead"}]}]}],"thread_ts":"1614797995.090100","parent_user_id":"U0178LR5K7F"},{"client_msg_id":"5541f91b-167c-4802-8cba-88bf3a3661f3","type":"message","text":"We're still waiting on method overwriting to work in GPUCompiler, which will allow us to do the replacement anywhere","user":"U6A0PD8CR","ts":"1614798487.090800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VD0dX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We're still waiting on method overwriting to work in GPUCompiler, which will allow us to do the replacement anywhere"}]}]}],"thread_ts":"1614797995.090100","parent_user_id":"U0178LR5K7F"},{"client_msg_id":"73272353-da5a-47b8-89d9-1d13c8030ffe","type":"message","text":"It's pretty close, I may have a solution in the next weeks","user":"U68A3ASP9","ts":"1614799140.091000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cj0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It's pretty close, I may have a solution in the next weeks"}]}]}],"thread_ts":"1614797995.090100","parent_user_id":"U0178LR5K7F","reactions":[{"name":"heart","users":["U6A0PD8CR","U014A5E6L3V"],"count":2}]},{"client_msg_id":"5db7857e-8e83-4ce7-9cd5-182ecb96c092","type":"message","text":"For now, the rewrite only happens for the function you're broadcasting, and not any function it calls","user":"U68A3ASP9","ts":"1614799166.091300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+A=U+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For now, the rewrite only happens for the function you're broadcasting, and not any function it calls"}]}]}],"thread_ts":"1614797995.090100","parent_user_id":"U0178LR5K7F"},{"client_msg_id":"8406c255-8b1f-4ae9-8380-44f2f8b81797","type":"message","text":"But sin is actually gpu compatible nowadays, so the warning should be safe to ignore.","user":"U68A3ASP9","ts":"1614799198.091500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"g797U","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But sin is actually gpu compatible nowadays, so the warning should be safe to ignore."}]}]}],"thread_ts":"1614797995.090100","parent_user_id":"U0178LR5K7F","reactions":[{"name":"+1","users":["U0178LR5K7F"],"count":1}]},{"client_msg_id":"23ba9028-a81c-4bb5-a943-10461f48fbdb","type":"message","text":"So I have tried KernelAbstractions, but am having issues as well....\n\nI have a function in my kernel that returns a 3-element StaticArray/NTuple and when I read the third element I get the error 700, illegal memory error...?","user":"U0178LR5K7F","ts":"1614799203.091700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vDM+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So I have tried KernelAbstractions, but am having issues as well....\n\nI have a function in my kernel that returns a 3-element StaticArray/NTuple and when I read the third element I get the error 700, illegal memory error...?"}]}]}],"thread_ts":"1614797995.090100","parent_user_id":"U0178LR5K7F"},{"client_msg_id":"0ec4857e-4a07-4619-b0dc-90d97c19601e","type":"message","text":"accessing the first and second element have no problems. They are Float32's","user":"U0178LR5K7F","ts":"1614799281.092000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uFF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"accessing the first and second element have no problems. They are Float32's"}]}]}],"thread_ts":"1614797995.090100","parent_user_id":"U0178LR5K7F"},{"client_msg_id":"3bf77a5b-5552-45a1-95b8-d6706abaac95","type":"message","text":"for full clarity, I am stuck with this\n```┌ Warning: Your Tesla K40c GPU does not meet the minimal required compute capability (3.5.0 &lt; 5.0).\n│ Some functionality might not work. For a fully-supported set-up, please use an older version of CUDA.jl```\n=/","user":"U0178LR5K7F","ts":"1614799425.092200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oj8tV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"for full clarity, I am stuck with this\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"┌ Warning: Your Tesla K40c GPU does not meet the minimal required compute capability (3.5.0 < 5.0).\n│ Some functionality might not work. For a fully-supported set-up, please use an older version of CUDA.jl"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"=/"}]}]}],"thread_ts":"1614797995.090100","parent_user_id":"U0178LR5K7F"},{"client_msg_id":"4b53cd24-4e27-45c8-92b3-3faf7449b499","type":"message","text":"looks like some NaNs snuck in...","user":"U0178LR5K7F","ts":"1614802762.092600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CU878","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"looks like some NaNs snuck in..."}]}]}],"thread_ts":"1614797995.090100","parent_user_id":"U0178LR5K7F","reactions":[{"name":"nan","users":["UGU761DU2"],"count":1}]},{"client_msg_id":"33f028bc-8392-4360-89bf-978ad6105080","type":"message","text":"but I don't think that was the root problem, as the 1st, 2nd elements where also NaNs. along the line the third element was passed through `mod2pi` ...which seems to return a non-NaN. Not sure if there is an issue there","user":"U0178LR5K7F","ts":"1614802890.092800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Kvk+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but I don't think that was the root problem, as the 1st, 2nd elements where also NaNs. along the line the third element was passed through "},{"type":"text","text":"mod2pi","style":{"code":true}},{"type":"text","text":" ...which seems to return a non-NaN. Not sure if there is an issue there"}]}]}],"thread_ts":"1614797995.090100","parent_user_id":"U0178LR5K7F"}]