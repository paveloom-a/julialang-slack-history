[{"client_msg_id":"ae904fff-be15-4cdf-a9b3-c99cd7e49b44","type":"message","text":"Might any of you know if there's a standard formulation for approximating `exp(x)` that avoids overflow issues by switching to the Taylor approximation or something like that for `x` big enough?","user":"U91Q3595Y","ts":"1611935792.010600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Jsush","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Might any of you know if there's a standard formulation for approximating "},{"type":"text","text":"exp(x)","style":{"code":true}},{"type":"text","text":" that avoids overflow issues by switching to the Taylor approximation or something like that for "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" big enough?"}]}]}],"thread_ts":"1611935792.010600","reply_count":15,"reply_users_count":4,"latest_reply":"1612024909.019500","reply_users":["U677NAWV8","U91Q3595Y","U6CJRSR63","U67G3QRJM"],"subscribed":false},{"client_msg_id":"f9e8c6f4-95c5-47df-8983-d4df37c38699","type":"message","text":"I don't remember the details, but in general the approach to computing special functions is first \"range reduction\", which is to rescale x to a restricted domain, and then compute an accurate approximation in that restricted domain. Typically people use Padé approximants or similar for that accurate computation and it is tailored to guarantee some maximum error across the entire domain","user":"U677NAWV8","ts":"1611940704.010700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"m8ycr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't remember the details, but in general the approach to computing special functions is first \"range reduction\", which is to rescale x to a restricted domain, and then compute an accurate approximation in that restricted domain. Typically people use Padé approximants or similar for that accurate computation and it is tailored to guarantee some maximum error across the entire domain"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"},{"client_msg_id":"7da5fbdc-fe4e-4068-b5a9-502ab586aba3","type":"message","text":"For more complicated functions you have to chop up the domain more carefully","user":"U677NAWV8","ts":"1611940716.010900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ZUy8O","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For more complicated functions you have to chop up the domain more carefully"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"},{"client_msg_id":"4d1ed8bc-7526-4b22-af6f-4bfba4614635","type":"message","text":"have a look at the Handbook of Floating Point Arithmetic for details","user":"U677NAWV8","ts":"1611940729.011100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Wu7H","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"have a look at the Handbook of Floating Point Arithmetic for details"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"},{"client_msg_id":"7BBDFAFB-2618-45FC-81A9-1544B8FFE77A","type":"message","text":"Thank you!","user":"U91Q3595Y","ts":"1611941059.011400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xWR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thank you!"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y","reactions":[{"name":"smile","users":["U677NAWV8"],"count":1}]},{"client_msg_id":"E4E9911C-2D63-41C2-B774-E5238C2ABAEE","type":"message","text":"Well, it overflows because if you input a larger x then exp(x) is larger than the largest floating point","user":"U6CJRSR63","ts":"1611942460.013300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fdfh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well, it overflows because if you input a larger x then exp(x) is larger than the largest floating point"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y","reactions":[{"name":"point_up","users":["U6A936746"],"count":1}]},{"client_msg_id":"C3707B08-9B1E-4308-8DE3-76FD026C9505","type":"message","text":"What do you want to do ? If its something like log sum exp you can do stuff like subtracting a constant on the inside and adding it on the outside such that you convert it to an underflow issue instead","user":"U6CJRSR63","ts":"1611942527.015400","team":"T68168MUP","edited":{"user":"U6CJRSR63","ts":"1611942548.000000"},"blocks":[{"type":"rich_text","block_id":"kUSM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What do you want to do ? If its something like log sum exp you can do stuff like subtracting a constant on the inside and adding it on the outside such that you convert it to an underflow issue instead"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"},{"client_msg_id":"d50f4adb-dabd-4951-8e61-79583f9f251a","type":"message","text":"unfortunately not logsumexp... Just trying to debug an unstable function eval in an ODE solver","user":"U91Q3595Y","ts":"1611942663.015700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nx5d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"unfortunately not logsumexp... Just trying to debug an unstable function eval in an ODE solver"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"},{"client_msg_id":"bfa4ce50-bcf5-46fa-84fc-193841e50196","type":"message","text":"the function has the form `c / (exp( c* g(x) ) - 1)`  (w a constant `c`)","user":"U91Q3595Y","ts":"1611942690.015900","team":"T68168MUP","edited":{"user":"U91Q3595Y","ts":"1611942728.000000"},"blocks":[{"type":"rich_text","block_id":"uQp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the function has the form "},{"type":"text","text":"c / (exp( c* g(x) ) - 1)","style":{"code":true}},{"type":"text","text":"  (w a constant "},{"type":"text","text":"c","style":{"code":true}},{"type":"text","text":")"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"},{"client_msg_id":"3b5f65b1-88de-4495-b648-cf006277ac09","type":"message","text":"Julia's exp(x) already does range reduction etc. I don't think there's any point in trying to do anything more clever than <@U6CJRSR63>'s suggestion","user":"U67G3QRJM","ts":"1611961162.016200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Eu9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Julia's exp(x) already does range reduction etc. I don't think there's any point in trying to do anything more clever than "},{"type":"user","user_id":"U6CJRSR63"},{"type":"text","text":"'s suggestion"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y","reactions":[{"name":"+1","users":["U91Q3595Y","U6CJRSR63"],"count":2},{"name":"white_check_mark","users":["U677NAWV8"],"count":1}]},{"client_msg_id":"c2c53f58-def7-4fdc-9bf9-2471bf6a40e0","type":"message","text":"(deleted two messages, had misplaced a `)` :slightly_smiling_face:","user":"U6CJRSR63","ts":"1611993937.017800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/rW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(deleted two messages, had misplaced a "},{"type":"text","text":")","style":{"code":true}},{"type":"text","text":" "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"},{"client_msg_id":"4efdd13c-1ba5-4cf6-90ec-7e5ee7db712b","type":"message","text":"Okay, so if `c*g(x)&lt;0` you can use your formula above, but if it's positive then you have a chance of overflow and you could calculate `k=exp(-c*g(x))` and calculate it as `c*k/(1-k)` ?","user":"U6CJRSR63","ts":"1611994087.018000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jhrmH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Okay, so if "},{"type":"text","text":"c*g(x)<0","style":{"code":true}},{"type":"text","text":" you can use your formula above, but if it's positive then you have a chance of overflow and you could calculate "},{"type":"text","text":"k=exp(-c*g(x))","style":{"code":true}},{"type":"text","text":" and calculate it as "},{"type":"text","text":"c*k/(1-k)","style":{"code":true}},{"type":"text","text":" ?"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"},{"client_msg_id":"558f8aee-4011-4314-a337-805faab2d64c","type":"message","text":"haha amusingly enough `c*k/(1-k)` was the original form and I moved to the other one thinking it'd be more numerically stable :rolling_on_the_floor_laughing:","user":"U91Q3595Y","ts":"1612019354.018200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"j1O2o","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"haha amusingly enough "},{"type":"text","text":"c*k/(1-k)","style":{"code":true}},{"type":"text","text":" was the original form and I moved to the other one thinking it'd be more numerically stable "},{"type":"emoji","name":"rolling_on_the_floor_laughing"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"},{"client_msg_id":"a9e4da88-41b6-48a9-8016-141047f2a7d7","type":"message","text":"I'll see if it improves things. Thanks :slightly_smiling_face:","user":"U91Q3595Y","ts":"1612019370.018400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fvdAs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'll see if it improves things. Thanks "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"},{"client_msg_id":"ef51d951-eef6-4892-b7fb-e07ee86947b3","type":"message","text":"what's the usecase?","user":"U6CJRSR63","ts":"1612019978.018600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tAe","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what's the usecase?"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"},{"client_msg_id":"8E64EABE-F2CF-4CDA-8DD1-28388D0A36C5","type":"message","text":"Solving unstable ode systems (for auction eqs)","user":"U91Q3595Y","ts":"1612024909.019500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hI3um","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Solving unstable ode systems (for auction eqs)"}]}]}],"thread_ts":"1611935792.010600","parent_user_id":"U91Q3595Y"}]