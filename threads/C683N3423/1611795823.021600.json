[{"client_msg_id":"9465394e-3710-40d5-9157-3b4add54a913","type":"message","text":"```using Sockets, HTTP, JSON\n\nconst ROUTER = HTTP.Router()\n\nfunction counter(io::HTTP.Stream)\n    x = 0\n    for _ in 1:5\n        sleep(1.0)\n        write(io, x)\n        x += 1\n    end\n    close(io)\nend\n\nHTTP.@register(ROUTER, \"GET\", \"/api/counter\", counter)\nHTTP.@register(ROUTER, \"/api/counter2\", counter)\n\nip = Sockets.getipaddr()\nport = 8080\nserver = Sockets.listen(ip, port)\n\n@info \"Try:\"\n@info \"$ip:$port/api/counter\"\n@info \"$ip:$port/api/counter2\"\n\n@async HTTP.serve(ROUTER, ip, port; verbose = false, server = server)```\nTrying both routes in browser gives me error:\n```┌ Error: error handling request\n│   exception =\n│    MethodError: no method matching counter(::HTTP.Messages.Request)\n│    Closest candidates are:\n│      counter(::HTTP.Streams.Stream) at c:\\Users\\user\\.julia\\dev\\test_web.jl:5\n│    Stacktrace:\n│     [1] handle(::HTTP.Handlers.RequestHandlerFunction{typeof(counter)}, ::HTTP.Messages.Request) at C:\\Users\\user\\.julia\\packages\\HTTP\\IAI92\\src\\Handlers.jl:253\n│     [2] handle(::HTTP.Handlers.RequestHandlerFunction{typeof(counter)}, ::HTTP.Streams.Stream{HTTP.Messages.Request,HTTP.ConnectionPool.Transaction{TCPSocket}}) at C:\\Users\\user\\.julia\\packages\\HTTP\\IAI92\\src\\Handlers.jl:276\n│     [3] handle(::HTTP.Handlers.Router{Symbol(\"##253\")}, ::HTTP.Streams.Stream{HTTP.Messages.Request,HTTP.ConnectionPool.Transaction{TCPSocket}}) at C:\\Users\\user\\.julia\\packages\\HTTP\\IAI92\\src\\Handlers.jl:466\n│     [4] #4 at C:\\Users\\user\\.julia\\packages\\HTTP\\IAI92\\src\\Handlers.jl:345 [inlined]\n│     [5] macro expansion at C:\\Users\\user\\.julia\\packages\\HTTP\\IAI92\\src\\Servers.jl:367 [inlined]\n│     [6] (::HTTP.Servers.var\"#13#14\"{HTTP.Handlers.var\"#4#5\"{HTTP.Handlers.Router{Symbol(\"##253\")}},HTTP.ConnectionPool.Transaction{TCPSocket},HTTP.Streams.Stream{HTTP.Messages.Request,HTTP.ConnectionPool.Transaction{TCPSocket}}})() at .\\task.jl:356```\n","user":"UB2QSHWPN","ts":"1611795823.021600","team":"T68168MUP","edited":{"user":"UB2QSHWPN","ts":"1611795842.000000"},"blocks":[{"type":"rich_text","block_id":"driP","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using Sockets, HTTP, JSON\n\nconst ROUTER = HTTP.Router()\n\nfunction counter(io::HTTP.Stream)\n    x = 0\n    for _ in 1:5\n        sleep(1.0)\n        write(io, x)\n        x += 1\n    end\n    close(io)\nend\n\nHTTP.@register(ROUTER, \"GET\", \"/api/counter\", counter)\nHTTP.@register(ROUTER, \"/api/counter2\", counter)\n\nip = Sockets.getipaddr()\nport = 8080\nserver = Sockets.listen(ip, port)\n\n@info \"Try:\"\n@info \"$ip:$port/api/counter\"\n@info \"$ip:$port/api/counter2\"\n\n@async HTTP.serve(ROUTER, ip, port; verbose = false, server = server)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nTrying both routes in browser gives me error:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"┌ Error: error handling request\n│   exception =\n│    MethodError: no method matching counter(::HTTP.Messages.Request)\n│    Closest candidates are:\n│      counter(::HTTP.Streams.Stream) at c:\\Users\\user\\.julia\\dev\\test_web.jl:5\n│    Stacktrace:\n│     [1] handle(::HTTP.Handlers.RequestHandlerFunction{typeof(counter)}, ::HTTP.Messages.Request) at C:\\Users\\user\\.julia\\packages\\HTTP\\IAI92\\src\\Handlers.jl:253\n│     [2] handle(::HTTP.Handlers.RequestHandlerFunction{typeof(counter)}, ::HTTP.Streams.Stream{HTTP.Messages.Request,HTTP.ConnectionPool.Transaction{TCPSocket}}) at C:\\Users\\user\\.julia\\packages\\HTTP\\IAI92\\src\\Handlers.jl:276\n│     [3] handle(::HTTP.Handlers.Router{Symbol(\"##253\")}, ::HTTP.Streams.Stream{HTTP.Messages.Request,HTTP.ConnectionPool.Transaction{TCPSocket}}) at C:\\Users\\user\\.julia\\packages\\HTTP\\IAI92\\src\\Handlers.jl:466\n│     [4] #4 at C:\\Users\\user\\.julia\\packages\\HTTP\\IAI92\\src\\Handlers.jl:345 [inlined]\n│     [5] macro expansion at C:\\Users\\user\\.julia\\packages\\HTTP\\IAI92\\src\\Servers.jl:367 [inlined]\n│     [6] (::HTTP.Servers.var\"#13#14\"{HTTP.Handlers.var\"#4#5\"{HTTP.Handlers.Router{Symbol(\"##253\")}},HTTP.ConnectionPool.Transaction{TCPSocket},HTTP.Streams.Stream{HTTP.Messages.Request,HTTP.ConnectionPool.Transaction{TCPSocket}}})() at .\\task.jl:356"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1611795823.021600","reply_count":2,"reply_users_count":1,"latest_reply":"1611796769.022200","reply_users":["UB2QSHWPN"],"subscribed":false},{"client_msg_id":"3b00381f-a703-4a04-ba7c-0753f5fda9a4","type":"message","text":"Get it working with this code (but in browser I only get output updated once at the end):\n```function counter(io::HTTP.Stream)\n    x = 0\n    for _ in 1:5\n        sleep(1.0)\n        write(io, \"$x\")\n        x += 1\n    end\nend\n\nHTTP.@register(ROUTER, \"GET\", \"/api/counter\", HTTP.StreamHandlerFunction(counter))```","user":"UB2QSHWPN","ts":"1611796316.021800","team":"T68168MUP","edited":{"user":"UB2QSHWPN","ts":"1611796402.000000"},"blocks":[{"type":"rich_text","block_id":"GhR5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Get it working with this code (but in browser I only get output updated once at the end):\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function counter(io::HTTP.Stream)\n    x = 0\n    for _ in 1:5\n        sleep(1.0)\n        write(io, \"$x\")\n        x += 1\n    end\nend\n\nHTTP.@register(ROUTER, \"GET\", \"/api/counter\", HTTP.StreamHandlerFunction(counter))"}]}]}],"thread_ts":"1611795823.021600","parent_user_id":"UB2QSHWPN"},{"client_msg_id":"a39a9928-0ff7-499a-9fd6-3da50e98a10b","type":"message","text":"Even if I wrap it with startwrite - closewrite, in browser I see document pending without any individual chunks being received until it is finished:\n```function counter(io::HTTP.Stream)\n    startwrite(io)\n    x = 0\n    for _ in 1:5\n        sleep(1.0)\n        write(io, \"$x \")\n        x += 1\n    end\n    closewrite(io)\nend```","user":"UB2QSHWPN","ts":"1611796769.022200","team":"T68168MUP","edited":{"user":"UB2QSHWPN","ts":"1611797179.000000"},"blocks":[{"type":"rich_text","block_id":"HxeA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Even if I wrap it with startwrite - closewrite, in browser I see document pending without any individual chunks being received until it is finished:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function counter(io::HTTP.Stream)\n    startwrite(io)\n    x = 0\n    for _ in 1:5\n        sleep(1.0)\n        write(io, \"$x \")\n        x += 1\n    end\n    closewrite(io)\nend"}]}]}],"thread_ts":"1611795823.021600","parent_user_id":"UB2QSHWPN"}]