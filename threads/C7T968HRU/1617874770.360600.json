[{"client_msg_id":"baed136e-ce7e-451d-b0ce-9889814a2e25","type":"message","text":"not quite","user":"U69BL50BF","ts":"1617874770.360600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=88jB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"not quite"}]}]}],"thread_ts":"1617874770.360600","reply_count":47,"reply_users_count":3,"latest_reply":"1618106839.464100","reply_users":["U015TQ8C7U5","U69BL50BF","U6788D83U"],"is_locked":false,"subscribed":false},{"client_msg_id":"b442d9da-0d13-4b3c-913e-a696c4b5360e","type":"message","text":"Ah, ok, so more or less just play around and see what works/","user":"U015TQ8C7U5","ts":"1617885747.360800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HICBZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah, ok, so more or less just play around and see what works/"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"80270a60-5f42-452c-ab8e-4aa4b175c766","type":"message","text":"yeah, it's not all quite there yet. We need a bit more tools for controls.","user":"U69BL50BF","ts":"1617885775.361000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HoJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, it's not all quite there yet. We need a bit more tools for controls."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"19a280b5-58a4-4e15-aee2-b90e386d0311","type":"message","text":"But please open issues. It's what I want to start doing a lot of over the summer. But there's a few other releases to do first.","user":"U69BL50BF","ts":"1617887071.361200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3r6TL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But please open issues. It's what I want to start doing a lot of over the summer. But there's a few other releases to do first."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"ba16fdbb-bae6-4227-b983-85f70187e6e6","type":"message","text":"Just as a toy obvious way to try and get started, I tried doing\n```prob = ODEProblem(structural_simplify(fol_separate), [x=&gt;[0.0,1.0]], (0.0,10.0), [tau=&gt;3])```\nin the composing differential equations example, but  the verner integrator wasn't able to initialize its caches (`zero` for vectors of floats doesn't exist). Is there a way to work around this, or am I misusing the interface?","user":"U015TQ8C7U5","ts":"1617943665.369200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6+3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Just as a toy obvious way to try and get started, I tried doing\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"prob = ODEProblem(structural_simplify(fol_separate), [x=>[0.0,1.0]], (0.0,10.0), [tau=>3])"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"in the composing differential equations example, but  the verner integrator wasn't able to initialize its caches ("},{"type":"text","text":"zero","style":{"code":true}},{"type":"text","text":" for vectors of floats doesn't exist). Is there a way to work around this, or am I misusing the interface?"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"ec93ef2a-e012-40c1-8ccb-048a873a60ea","type":"message","text":"I'll need to see the runnable example to get what you're talking about","user":"U69BL50BF","ts":"1617971402.372800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Zws8W","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'll need to see the runnable example to get what you're talking about"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"31ffe618-c528-4c8e-8904-79ee92e39002","type":"message","text":"Ah, sure\n```using ModelingToolkit\n\n@variables t x(t) RHS(t) \n@parameters τ       \nD = Differential(t) \n\n# your first ODE, consisting of a single equation, indicated by ~\n@named fol_separate = ODESystem([ RHS  ~ (1 - x)/τ,\n                                  D(x) ~ RHS ])\n\nusing DifferentialEquations: solve\n\nprob = ODEProblem(structural_simplify(fol_separate), [x =&gt; [0.0, 0.0]], (0.0,10.0), [τ =&gt; 3.0])```","user":"U015TQ8C7U5","ts":"1617973500.385000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"y5Tjr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah, sure\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using ModelingToolkit\n\n@variables t x(t) RHS(t) \n@parameters τ       \nD = Differential(t) \n\n# your first ODE, consisting of a single equation, indicated by ~\n@named fol_separate = ODESystem([ RHS  ~ (1 - x)/τ,\n                                  D(x) ~ RHS ])\n\nusing DifferentialEquations: solve\n\nprob = ODEProblem(structural_simplify(fol_separate), [x => [0.0, 0.0]], (0.0,10.0), [τ => 3.0])"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"554a87fe-72ae-4c81-92fa-3e94b307255f","type":"message","text":"`x` is a scalar and you gave it an array","user":"U69BL50BF","ts":"1617973744.385700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b74L","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" is a scalar and you gave it an array"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"1374a749-ae72-445c-9d65-6a09e786d563","type":"message","text":"Is there somewhere to specify that `x` is an array? At least to a superficial analysis, nothing that's done to `x` should require that it's a scalar.","user":"U015TQ8C7U5","ts":"1617973924.385900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jMtd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there somewhere to specify that "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" is an array? At least to a superficial analysis, nothing that's done to "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" should require that it's a scalar."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"154ba0b9-7b9f-47ed-8d50-6413c90b51af","type":"message","text":"`x` is a symbolic scalar, or it's supposed to be","user":"U69BL50BF","ts":"1617974108.386600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ZhU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" is a symbolic scalar, or it's supposed to be"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"add60ddf-9fca-4dc1-aad1-f22f36dd3409","type":"message","text":"you should be doing `x[1:2](t)` if you wanted a symbolic vector.","user":"U69BL50BF","ts":"1617974118.386800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vjN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you should be doing "},{"type":"text","text":"x[1:2](t)","style":{"code":true}},{"type":"text","text":" if you wanted a symbolic vector."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"77ee3e85-db93-4072-9dd2-37f3d9b4fd64","type":"message","text":"Ah, okay, this was why I was wondering about an example, as I didn't find any information on this in the documentation.","user":"U015TQ8C7U5","ts":"1617974196.387000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uMsZy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah, okay, this was why I was wondering about an example, as I didn't find any information on this in the documentation."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"0ea69b39-e421-4135-b85e-8a2a87b6d883","type":"message","text":"open an issue for us to document that.","user":"U69BL50BF","ts":"1617974294.387200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TXcU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"open an issue for us to document that."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"72d90c48-7395-4a1f-ba9c-dc8eaf6bbd5c","type":"message","text":"we are in the middle of changing and improving the array symbolics though, so it'll likely get more docs after that's all done.","user":"U69BL50BF","ts":"1617974405.387400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ci7i","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"we are in the middle of changing and improving the array symbolics though, so it'll likely get more docs after that's all done."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"52546362-7c2c-441d-b7d3-1373198e606a","type":"message","text":"It would probably be easiest to use if it could be caught before it reaches solver cache initialization? The error message that one gets is very unclear","user":"U015TQ8C7U5","ts":"1617974407.387600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=g5m","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It would probably be easiest to use if it could be caught before it reaches solver cache initialization? The error message that one gets is very unclear"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"0e13c533-a46f-490d-843a-3767cffb3803","type":"message","text":"Makes sense.","user":"U015TQ8C7U5","ts":"1617974410.387800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VnDG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Makes sense."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"3cf804ae-3e97-47ef-90f6-edda94e94011","type":"message","text":"yeah it should get caught earlier","user":"U69BL50BF","ts":"1617974449.388000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=VN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah it should get caught earlier"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"9c8e9e77-7c67-4980-9bd7-fee5ba04176a","type":"message","text":"<@U68907M46> total hype dropping this at the same time: <https://github.com/JuliaSymbolics/SymbolicArrays.jl>","user":"U69BL50BF","ts":"1617974458.388200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0Kj","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U68907M46"},{"type":"text","text":" total hype dropping this at the same time: "},{"type":"link","url":"https://github.com/JuliaSymbolics/SymbolicArrays.jl"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"150dfdc5-527c-4b57-9e44-9849d250d61d","type":"message","text":"In a probably similar case, I'm getting the following when I try to create the system\n```julia&gt; @named fol_separate = ODESystem([ RHS  .~ (1 .- x)/τ,\n                                         D.(x) .~ RHS ])\nERROR: type Array has no field lhs\nStacktrace:\n [1] getproperty(x::Vector{Equation}, f::Symbol)\n   @ Base .\\Base.jl:33\n [2] ODESystem(eqs::Vector{Vector{Equation}}, iv::Nothing; kwargs::Base.Iterators.Pairs{Symbol, Symbol, Tuple{Symbol}, NamedTuple{(:name,), Tuple{Symbol}}})\n   @ ModelingToolkit ~\\.julia\\packages\\ModelingToolkit\\PysRU\\src\\systems\\diffeqs\\odesystem.jl:148\n [3] top-level scope\n   @ REPL[40]:1```","user":"U015TQ8C7U5","ts":"1617974473.388400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8P5IN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"In a probably similar case, I'm getting the following when I try to create the system\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @named fol_separate = ODESystem([ RHS  .~ (1 .- x)/τ,\n                                         D.(x) .~ RHS ])\nERROR: type Array has no field lhs\nStacktrace:\n [1] getproperty(x::Vector{Equation}, f::Symbol)\n   @ Base .\\Base.jl:33\n [2] ODESystem(eqs::Vector{Vector{Equation}}, iv::Nothing; kwargs::Base.Iterators.Pairs{Symbol, Symbol, Tuple{Symbol}, NamedTuple{(:name,), Tuple{Symbol}}})\n   @ ModelingToolkit ~\\.julia\\packages\\ModelingToolkit\\PysRU\\src\\systems\\diffeqs\\odesystem.jl:148\n [3] top-level scope\n   @ REPL[40]:1"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"6f2de377-5369-4ab2-b339-b2c6ebafcec9","type":"message","text":"```[ RHS  .~ (1 .- x)/τ;D.(x) .~ RHS ])```","user":"U69BL50BF","ts":"1617974513.388600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1j7Ig","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"[ RHS  .~ (1 .- x)/τ;D.(x) .~ RHS ])"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"57ee68cd-84bd-4cd2-ae17-0779d23f4c38","type":"message","text":"Full runnable example\n```using ModelingToolkit\n@variables t x[1:2](t) RHS[1:2](t) \n@parameters τ       \nD = Differential(t) \n# your first ODE, consisting of a single equation, indicated by ~\n@named @named fol_separate = ODESystem([ RHS  .~ (1 .- x)/τ,\n                                         D.(x) .~ RHS ])\nusing DifferentialEquations: solve\nprob = ODEProblem(structural_simplify(fol_separate), [x =&gt; [0.0, 0.0]], (0.0,10.0), [τ =&gt; 3.0])```","user":"U015TQ8C7U5","ts":"1617974528.388800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BUf8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Full runnable example\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using ModelingToolkit\n@variables t x[1:2](t) RHS[1:2](t) \n@parameters τ       \nD = Differential(t) \n# your first ODE, consisting of a single equation, indicated by ~\n@named @named fol_separate = ODESystem([ RHS  .~ (1 .- x)/τ,\n                                         D.(x) .~ RHS ])\nusing DifferentialEquations: solve\nprob = ODEProblem(structural_simplify(fol_separate), [x => [0.0, 0.0]], (0.0,10.0), [τ => 3.0])"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"b0f8b078-0568-47ee-b597-99d6f392facf","type":"message","text":"Duh, ok","user":"U015TQ8C7U5","ts":"1617974542.389000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DCj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Duh, ok"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"27ca85cd-9484-4af9-8eb2-736939b7f80a","type":"message","text":"Hmm, same complaint, actually.","user":"U015TQ8C7U5","ts":"1617974561.389200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oZ=2n","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm, same complaint, actually."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"5f408e6b-a2f6-4614-950d-e092999867ef","type":"message","text":"Oops, missed the D.(x) somehow, forgot to broadcst","user":"U015TQ8C7U5","ts":"1617974635.389400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2QY1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oops, missed the D.(x) somehow, forgot to broadcst"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"b3901dd5-2943-4048-8a52-b0bccf431679","type":"message","text":"Okay, and that made the example work. I'll submit the bug.","user":"U015TQ8C7U5","ts":"1617974765.389600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2Z=n=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Okay, and that made the example work. I'll submit the bug."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"35b37a42-adf6-4a5f-af87-7b5c3437032c","type":"message","text":"Ah, okay, I see why I had problems finding the documentation for @variables; the notation is documented in the docstring but since it's part of Symbolics.jl and not ModelingToolkit.jl it doesn't show up in the latter's documentation. I'm not sure if this is actually a documentation issue, then?","user":"U015TQ8C7U5","ts":"1617975308.389800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"c2V","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah, okay, I see why I had problems finding the documentation for @variables; the notation is documented in the docstring but since it's part of Symbolics.jl and not ModelingToolkit.jl it doesn't show up in the latter's documentation. I'm not sure if this is actually a documentation issue, then?"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"a0287e87-1180-4a78-b3f4-c050a125c6ca","type":"message","text":"that's still an MTK documentation issue IMO. We should make it easier to learn about the CAS as it's important for MTK","user":"U69BL50BF","ts":"1617975351.390000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8+5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's still an MTK documentation issue IMO. We should make it easier to learn about the CAS as it's important for MTK"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"3ae5ac87-b230-4732-b200-b7188de3ac93","type":"message","text":"we don't signal it enough right now.","user":"U69BL50BF","ts":"1617975355.390200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Lwbnj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"we don't signal it enough right now."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"31282274-10e4-49fe-b3d9-5d532758bf78","type":"message","text":"It kind of assumes you know Symbolics.jl, which will be okay in 10 years, but not this year.","user":"U69BL50BF","ts":"1617975370.390400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nRhxy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It kind of assumes you know Symbolics.jl, which will be okay in 10 years, but not this year."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"47a6c89f-793c-4f2d-8d5b-c9d4b2db08da","type":"message","text":"Ok, I submitted <https://github.com/SciML/ModelingToolkit.jl/issues/956>.","user":"U015TQ8C7U5","ts":"1617975934.390800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"807ca","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ok, I submitted "},{"type":"link","url":"https://github.com/SciML/ModelingToolkit.jl/issues/956"},{"type":"text","text":"."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"c232c841-8798-4be7-ab79-56ccee9fb7f0","type":"message","text":"<@U6788D83U> I just wanted to follow up on the closure of the aforementioned issue, since it seems like a discussion of whether it's warranted is needed.","user":"U015TQ8C7U5","ts":"1618040495.457100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xGkfc","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U6788D83U"},{"type":"text","text":" I just wanted to follow up on the closure of the aforementioned issue, since it seems like a discussion of whether it's warranted is needed."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"cde15c61-17a2-404d-bb90-be191300079d","type":"message","text":"I'd generally suggest that it would be helpful for the documentation to describe how to define vectors of symbolic variables, and for the error messages when you attempt to use a vector in place of a scalar to guide the user towards a solution (as, right now, and as called out in the issue, the error message arises from the integrator's cache initialization which... is not that helpful).","user":"U015TQ8C7U5","ts":"1618040603.457300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tK=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'd generally suggest that it would be helpful for the documentation to describe how to define vectors of symbolic variables, and for the error messages when you attempt to use a vector in place of a scalar to guide the user towards a solution (as, right now, and as called out in the issue, the error message arises from the integrator's cache initialization which... is not that helpful)."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"21f0767d-34fb-408e-ac4d-7541a9a52935","type":"message","text":"Is the example in the issue fixable? Sure, and I found a solution (see up in this thread), but at the same time, that solution is difficult for the user to discover from the ModelingToolkit documentation or by examining the error message when you misuse the library.","user":"U015TQ8C7U5","ts":"1618040695.457500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Za11","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is the example in the issue fixable? Sure, and I found a solution (see up in this thread), but at the same time, that solution is difficult for the user to discover from the ModelingToolkit documentation or by examining the error message when you misuse the library."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"2C7C911B-A116-4356-9336-39E9287C3225","type":"message","text":"I don’t see how this is confusing. You just need to know a little bit of Julia programming to find the bug.","user":"U6788D83U","ts":"1618040949.459700","team":"T68168MUP","edited":{"user":"U6788D83U","ts":"1618040971.000000"},"blocks":[{"type":"rich_text","block_id":"04rH6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don’t see how this is confusing. You just need to know a little bit of Julia programming to find the bug."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"08f70e73-7e73-4b29-a8e6-cb05219d1cf3","type":"message","text":"What I find confusing about it is that the stack trace given is to\n```  [2] alg_cache(alg::OrdinaryDiffEq.Vern9, u::Vector{Vector{Float64}}, rate_prototype::Vector{Vector{Float64}}, uEltypeNoUnits::Type, uBottomEltypeNoUnits::Type, tTypeNoUnits::Type, uprev::Vector{Vector{Float64}}, uprev2::Vector{Vector{Float64}}, f::WARNING: both SymbolicUtils and LinearAlgebra export \"cond\"; uses of it in module Symbolics must be qualified\nODEFunction{true, ModelingToolkit.var\"#f#140\"{RuntimeGeneratedFunctions.RuntimeGeneratedFunction{(Symbol(\"##arg#257\"), Symbol(\"##arg#258\"), :t), ModelingToolkit.var\"#_RGF_ModTag\", ModelingToolkit.var\"#_RGF_ModTag\", (0x9d679005, 0xf9e93d3d, 0xde33153c, 0x87232e20, 0xd9de51d2)}, RuntimeGeneratedFunctions.RuntimeGeneratedFunction{(Symbol(\"##out#259\"), Symbol(\"##arg#257\"), Symbol(\"##arg#258\"), :t), ModelingToolkit.var\"#_RGF_ModTag\", ModelingToolkit.var\"#_RGF_ModTag\", (0x3159e5b6, 0xdb5210ba, 0x212b43ea, 0x1f3d7d71, 0xb1165cc1)}}, LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Vector{Symbol}, Symbol, ModelingToolkit.var\"#generated_observed#145\"{ODESystem, Dict{Any, Any}}, Nothing}, t::Float64, dt::Float64, reltol::Float64, p::Vector{Float64}, calck::Bool, #unused#::Val{true})\n    @ OrdinaryDiffEq ~\\.julia\\packages\\OrdinaryDiffEq\\5egkj\\src\\caches\\verner_caches.jl:153```","user":"U015TQ8C7U5","ts":"1618041044.460000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2r7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What I find confusing about it is that the stack trace given is to\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"  [2] alg_cache(alg::OrdinaryDiffEq.Vern9, u::Vector{Vector{Float64}}, rate_prototype::Vector{Vector{Float64}}, uEltypeNoUnits::Type, uBottomEltypeNoUnits::Type, tTypeNoUnits::Type, uprev::Vector{Vector{Float64}}, uprev2::Vector{Vector{Float64}}, f::WARNING: both SymbolicUtils and LinearAlgebra export \"cond\"; uses of it in module Symbolics must be qualified\nODEFunction{true, ModelingToolkit.var\"#f#140\"{RuntimeGeneratedFunctions.RuntimeGeneratedFunction{(Symbol(\"##arg#257\"), Symbol(\"##arg#258\"), :t), ModelingToolkit.var\"#_RGF_ModTag\", ModelingToolkit.var\"#_RGF_ModTag\", (0x9d679005, 0xf9e93d3d, 0xde33153c, 0x87232e20, 0xd9de51d2)}, RuntimeGeneratedFunctions.RuntimeGeneratedFunction{(Symbol(\"##out#259\"), Symbol(\"##arg#257\"), Symbol(\"##arg#258\"), :t), ModelingToolkit.var\"#_RGF_ModTag\", ModelingToolkit.var\"#_RGF_ModTag\", (0x3159e5b6, 0xdb5210ba, 0x212b43ea, 0x1f3d7d71, 0xb1165cc1)}}, LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Vector{Symbol}, Symbol, ModelingToolkit.var\"#generated_observed#145\"{ODESystem, Dict{Any, Any}}, Nothing}, t::Float64, dt::Float64, reltol::Float64, p::Vector{Float64}, calck::Bool, #unused#::Val{true})\n    @ OrdinaryDiffEq ~\\.julia\\packages\\OrdinaryDiffEq\\5egkj\\src\\caches\\verner_caches.jl:153"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"d9ae10f5-5f66-4ffd-b17d-60ef37d63012","type":"message","text":"This is part of the DifferentialEquations integrator. Since the problem is created without error, this then implies that model is fine, but that the issue is in problem definition or in the initialization/use of the integrator","user":"U015TQ8C7U5","ts":"1618041095.460200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qMB=d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is part of the DifferentialEquations integrator. Since the problem is created without error, this then implies that model is fine, but that the issue is in problem definition or in the initialization/use of the integrator"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"0c36059b-6179-49b7-9c12-0fee82adc23d","type":"message","text":"Moreover, I would note that, again, the solution in the Github issue isn't actually a solution to the problem. What I was trying to do, as mentioned in said issue, was use vectors in ModelingToolkit, which making `x`  notably does not solve","user":"U015TQ8C7U5","ts":"1618041196.460400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Cxy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Moreover, I would note that, again, the solution in the Github issue isn't actually a solution to the problem. What I was trying to do, as mentioned in said issue, was use vectors in ModelingToolkit, which making "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":"  notably does not solve"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"3fe4609a-756a-4ad9-9525-bc2f5615d7ef","type":"message","text":"The solution to the specific functional issue in the thread is\n```using ModelingToolkit\n@variables t x[1:2](t) RHS[1:2](t) \n@parameters τ       \nD = Differential(t) \n# your first ODE, consisting of a single equation, indicated by ~\n@named @named fol_separate = ODESystem([ RHS  .~ (1 .- x)/τ,\n                                         D.(x) .~ RHS ])\nusing DifferentialEquations: solve\nprob = ODEProblem(structural_simplify(fol_separate), x .=&gt; [0.0, 0.0], (0.0,10.0), [τ =&gt; 3.0])\nsolve(prob) ```\nHowever, as noted in the thread, I have a functional solution to my problem; the issue is not one of correct functionality, but that the documentation and the error messages do not aim one in the right direction.","user":"U015TQ8C7U5","ts":"1618041242.460600","team":"T68168MUP","edited":{"user":"U015TQ8C7U5","ts":"1618041397.000000"},"blocks":[{"type":"rich_text","block_id":"I=D3x","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The solution to the specific functional issue in the thread is\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using ModelingToolkit\n@variables t x[1:2](t) RHS[1:2](t) \n@parameters τ       \nD = Differential(t) \n# your first ODE, consisting of a single equation, indicated by ~\n@named @named fol_separate = ODESystem([ RHS  .~ (1 .- x)/τ,\n                                         D.(x) .~ RHS ])\nusing DifferentialEquations: solve\nprob = ODEProblem(structural_simplify(fol_separate), x .=> [0.0, 0.0], (0.0,10.0), [τ => 3.0])\nsolve(prob) "}]},{"type":"rich_text_section","elements":[{"type":"text","text":"However, as noted in the thread, I have a functional solution to my problem; the issue is not one of correct functionality, but that the documentation and the error messages do not aim one in the right direction."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"0d5663a3-43c5-4967-9caf-1ce3e3a6b3b9","type":"message","text":"I would suggest, then, that the fact that this desired fix wasn't clear is something that points towards the error message not being particularly helpful when trying to identify the source of the problem.","user":"U015TQ8C7U5","ts":"1618041318.460800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FVy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I would suggest, then, that the fact that this desired fix wasn't clear is something that points towards the error message not being particularly helpful when trying to identify the source of the problem."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"bbdf4ae4-addd-4718-b4ca-37c6ff067adc","type":"message","text":"I'm generally fairly familiar, even, with DiffEq's internals, and spent a while looking into why initialization was failing, nor realizing that the issue was not in solver initialization but instead in problem definition.","user":"U015TQ8C7U5","ts":"1618041454.461300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"i0wgC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm generally fairly familiar, even, with DiffEq's internals, and spent a while looking into why initialization was failing, nor realizing that the issue was not in solver initialization but instead in problem definition."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"cf7779c2-8b09-484f-b4ed-76d93065d917","type":"message","text":"Knowing that the issue is really that DiffEq is expecting all variables to be scalars, and that you can fix this by using a different form of the @variable macro, requires that one understand not only a bit of Julia, but also fairly extensive knowledge of the preconditions built into the associated libraries.\n\nWhile I would agree that this is a failing in my own knowledgebase, this is also something that could be fairly easily addressed in documentation and/or pointed at in error messages. Ideally, when a vector is passed in place of a scalar, it should produce an error message that says that this is invalid, not try to initialize the solver and then error out when trying to figure out what a zero element for an arbitrary vector looks like.","user":"U015TQ8C7U5","ts":"1618041777.461500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mJF2L","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Knowing that the issue is really that DiffEq is expecting all variables to be scalars, and that you can fix this by using a different form of the @variable macro, requires that one understand not only a bit of Julia, but also fairly extensive knowledge of the preconditions built into the associated libraries.\n\nWhile I would agree that this is a failing in my own knowledgebase, this is also something that could be fairly easily addressed in documentation and/or pointed at in error messages. Ideally, when a vector is passed in place of a scalar, it should produce an error message that says that this is invalid, not try to initialize the solver and then error out when trying to figure out what a zero element for an arbitrary vector looks like."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"79d8ba3d-16f4-4c38-b719-d5f7b16d061f","type":"message","text":"When I saw that error message, I thought that I needed to somehow provide my own zero initializer for the internal caches somehow, not that DiffEq needed me to unroll the vector. Again, this is a failing on my part, but it's one that I would argue could be fairly easily avoided with a short example.","user":"U015TQ8C7U5","ts":"1618041825.461700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3Alb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"When I saw that error message, I thought that I needed to somehow provide my own zero initializer for the internal caches somehow, not that DiffEq needed me to unroll the vector. Again, this is a failing on my part, but it's one that I would argue could be fairly easily avoided with a short example."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"14a18c3c-0172-47de-a7d3-89cc5e26f3ed","type":"message","text":"If it would make it easier, I can submit a pull request against the documentation with the simple control system (attitude control for a quadcopter) that I'm working on. It illustrates the use of symbolic vectors in a fairly small and simple example.","user":"U015TQ8C7U5","ts":"1618042394.461900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=Jb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If it would make it easier, I can submit a pull request against the documentation with the simple control system (attitude control for a quadcopter) that I'm working on. It illustrates the use of symbolic vectors in a fairly small and simple example."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"35139d24-72b6-49c4-ac53-f06b8bca8b24","type":"message","text":"I think it's an issue that we don't mention the vector form at all in the documentation. It should go somewhere.","user":"U69BL50BF","ts":"1618051583.462400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FNqM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think it's an issue that we don't mention the vector form at all in the documentation. It should go somewhere."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"df0cf85c-d7c2-4cb3-94b3-fa81a9b34109","type":"message","text":"Also, it's a bit interesting that we allow mapping vectors to the scalar symbolic variables.","user":"U69BL50BF","ts":"1618051601.462600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"C6E3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also, it's a bit interesting that we allow mapping vectors to the scalar symbolic variables."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"e6016780-a737-40c2-beaa-e1c2ecfc45ad","type":"message","text":"That's something we should check for, especially as we move down the line towards really enforcing types for array symbolics.","user":"U69BL50BF","ts":"1618051622.462800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Im6v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That's something we should check for, especially as we move down the line towards really enforcing types for array symbolics."}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"6293030c-d682-4543-a31a-4ba12c47e52a","type":"message","text":"If interested, here's the toy LQR controller\n```using ModelingToolkit\nusing LinearAlgebra\nusing DifferentialEquations\nusing ControlSystems\n\n@variables t yaw thrust[1:4](t) omega[1:3](t) qbi[1:3](t)\nD = Differential(t)\n\nprop_pos = [[1.0,1.0,0.0],[1.0,-1.0,0.0],[-1.0,1.0,0.0],[-1.0,-1.0,0.0]]\nI = [1.0 0 0; 0 1 0; 0 0 1]\nI_inv = inv(I)\n\n@named dynamics = ODESystem([ \n\tD.(omega) .~ I_inv * (sum(cross(prop_pos[i], thrust[i]*[0.0,0.0,1.0]) for i=1:4) .- cross(omega, I*omega) .+ [0.0,0.0, yaw]);\n    D.(qbi) .~ 0.25 * ((1-sum(qbi .^ 2)) * omega - 2 * cross(omega, qbi) + 2*dot(omega,qbi)*qbi) ])\n\n#get the indices\ncontrols = indexin([thrust; yaw], states(dynamics))\ndyn_states = indexin([qbi; omega], states(dynamics))\n\n#linearize to a state-space system\njac_fun = eval(generate_jacobian(dynamics)[2])\nnum_jac = Array{Float64}(UndefInitializer(), length(equations(dynamics)), length(states(dynamics)))\nlinearization_point = Array{Float64}(UndefInitializer(), length(states(dynamics)))\nfor (k,v) in [indexin(thrust,states(dynamics)) .=&gt; 1.0;\n\t\t\t  indexin(yaw, states(dynamics)) .=&gt; 0.0 \n\t\t\t  indexin(qbi,states(dynamics)) .=&gt; [0.0, 0.0, 0.0]; \n\t\t\t  indexin(omega,states(dynamics)) .=&gt; [0.0, 0.0, 0.0]]\n\tlinearization_point[k] = v\nend\njac_fun(reshape(num_jac, :), linearization_point, [], 0.0)\n\nA = num_jac[dyn_states, dyn_states]\nB = num_jac[dyn_states, controls]\nC = zeros(0, size(A)[2])\nDm = zeros(0, size(B)[2])\n\n# linearized state-space model\nssm = ss(A,B,C,Dm)\nL = lqr(ssm, UniformScaling(1.0), UniformScaling(1.0))\n\n# setup the controlled dynamic system \n@named dynamics_controlled = ODESystem([ \n\tstates(dynamics)[controls] .~ -L*states(dynamics)[dyn_states];\n\tD.(omega) .~ I_inv * (sum(cross(prop_pos[i], thrust[i]*[0.0,0.0,1.0]) for i=1:4) .- cross(omega, I*omega) .+ [0.0,0.0, yaw]);\n    D.(qbi) .~ 0.25 * ((1-sum(qbi .^ 2)) * omega - 2 * cross(omega, qbi) + 2*dot(omega,qbi)*qbi) ])\n\n\nprob = ODEProblem(structural_simplify(dynamics_controlled), [omega .=&gt; [0.1,0.1,0.1]; qbi .=&gt; [0.0,0.0,0.0]], (0.0,10.0), [])\nsolve(prob)```","user":"U015TQ8C7U5","ts":"1618106807.463900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"k0e","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If interested, here's the toy LQR controller\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using ModelingToolkit\nusing LinearAlgebra\nusing DifferentialEquations\nusing ControlSystems\n\n@variables t yaw thrust[1:4](t) omega[1:3](t) qbi[1:3](t)\nD = Differential(t)\n\nprop_pos = [[1.0,1.0,0.0],[1.0,-1.0,0.0],[-1.0,1.0,0.0],[-1.0,-1.0,0.0]]\nI = [1.0 0 0; 0 1 0; 0 0 1]\nI_inv = inv(I)\n\n@named dynamics = ODESystem([ \n\tD.(omega) .~ I_inv * (sum(cross(prop_pos[i], thrust[i]*[0.0,0.0,1.0]) for i=1:4) .- cross(omega, I*omega) .+ [0.0,0.0, yaw]);\n    D.(qbi) .~ 0.25 * ((1-sum(qbi .^ 2)) * omega - 2 * cross(omega, qbi) + 2*dot(omega,qbi)*qbi) ])\n\n#get the indices\ncontrols = indexin([thrust; yaw], states(dynamics))\ndyn_states = indexin([qbi; omega], states(dynamics))\n\n#linearize to a state-space system\njac_fun = eval(generate_jacobian(dynamics)[2])\nnum_jac = Array{Float64}(UndefInitializer(), length(equations(dynamics)), length(states(dynamics)))\nlinearization_point = Array{Float64}(UndefInitializer(), length(states(dynamics)))\nfor (k,v) in [indexin(thrust,states(dynamics)) .=> 1.0;\n\t\t\t  indexin(yaw, states(dynamics)) .=> 0.0 \n\t\t\t  indexin(qbi,states(dynamics)) .=> [0.0, 0.0, 0.0]; \n\t\t\t  indexin(omega,states(dynamics)) .=> [0.0, 0.0, 0.0]]\n\tlinearization_point[k] = v\nend\njac_fun(reshape(num_jac, :), linearization_point, [], 0.0)\n\nA = num_jac[dyn_states, dyn_states]\nB = num_jac[dyn_states, controls]\nC = zeros(0, size(A)[2])\nDm = zeros(0, size(B)[2])\n\n# linearized state-space model\nssm = ss(A,B,C,Dm)\nL = lqr(ssm, UniformScaling(1.0), UniformScaling(1.0))\n\n# setup the controlled dynamic system \n@named dynamics_controlled = ODESystem([ \n\tstates(dynamics)[controls] .~ -L*states(dynamics)[dyn_states];\n\tD.(omega) .~ I_inv * (sum(cross(prop_pos[i], thrust[i]*[0.0,0.0,1.0]) for i=1:4) .- cross(omega, I*omega) .+ [0.0,0.0, yaw]);\n    D.(qbi) .~ 0.25 * ((1-sum(qbi .^ 2)) * omega - 2 * cross(omega, qbi) + 2*dot(omega,qbi)*qbi) ])\n\n\nprob = ODEProblem(structural_simplify(dynamics_controlled), [omega .=> [0.1,0.1,0.1]; qbi .=> [0.0,0.0,0.0]], (0.0,10.0), [])\nsolve(prob)"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"},{"client_msg_id":"3bbc8148-276f-4542-b762-8b2d92d315cd","type":"message","text":"Is there a cleaner way of writing that for loop? Having to do all that indexin isn't as clean as I'd like","user":"U015TQ8C7U5","ts":"1618106839.464100","team":"T68168MUP","edited":{"user":"U015TQ8C7U5","ts":"1618106858.000000"},"blocks":[{"type":"rich_text","block_id":"xkFrA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a cleaner way of writing that for loop? Having to do all that indexin isn't as clean as I'd like"}]}]}],"thread_ts":"1617874770.360600","parent_user_id":"U69BL50BF"}]