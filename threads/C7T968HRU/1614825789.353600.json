[{"client_msg_id":"201eac53-5560-4976-bf07-93572a03b8cb","type":"message","text":"<@U6788D83U> Thanks for helping, I need to rewrite the problem since I call this ODE in Turing and consequently the ODE solution is in Dual type which could not be applied to Symmetric().","user":"U01Q398M3QB","ts":"1614825789.353600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SCruQ","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U6788D83U"},{"type":"text","text":" Thanks for helping, I need to rewrite the problem since I call this ODE in Turing and consequently the ODE solution is in Dual type which could not be applied to Symmetric()."}]}]}],"thread_ts":"1614825789.353600","reply_count":3,"reply_users_count":2,"latest_reply":"1615300440.000700","reply_users":["UQEDP1Q5V","U01Q398M3QB"],"subscribed":false},{"client_msg_id":"af02f64d-7461-4c8f-aec4-087d2bf09dc3","type":"message","text":"What is the issue with Dual numbers and Symmetric?\n```using ForwardDiff\nusing LinearAlgebra\nusing Distributions\nfunction test(x)\n    A = [1.0 x+eps(x);x 1.0]\n    MvNormal(A)\n    y = det(A)\nend\nx = 0.0\ntest(x)\nForwardDiff.derivative(test,x)\n\nfunction test2(x)\n    A = [1.0 x+eps(x);x 1.0]\n    A = Symmetric(A)\n    MvNormal(A)\n    y = det(A)\nend\nx = 0.0\ntest2(x)\nForwardDiff.derivative(test2,x)```\n","user":"UQEDP1Q5V","ts":"1614865353.354700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nYGmo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What is the issue with Dual numbers and Symmetric?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using ForwardDiff\nusing LinearAlgebra\nusing Distributions\nfunction test(x)\n    A = [1.0 x+eps(x);x 1.0]\n    MvNormal(A)\n    y = det(A)\nend\nx = 0.0\ntest(x)\nForwardDiff.derivative(test,x)\n\nfunction test2(x)\n    A = [1.0 x+eps(x);x 1.0]\n    A = Symmetric(A)\n    MvNormal(A)\n    y = det(A)\nend\nx = 0.0\ntest2(x)\nForwardDiff.derivative(test2,x)"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1614825789.353600","parent_user_id":"U01Q398M3QB"},{"type":"message","text":"<@UQEDP1Q5V> Hi! Arno. Thanks a lot and so sorry for a pause. I wrote the code in Turing MCMC function. This Turing will automatically change Float64 type number into ForwarDdiff.dual type. Like in the test 2, I could not call Symmetric(A) while A is ForwardDiff.dual type and this will raise the issue. I also tried GenericLinearAlgebra.Symmetric() from other helpers in <#C6G240ENA|autodiff> . However, it still raise the same error message.","files":[{"id":"F01QL7C6JJF","created":1615248473,"timestamp":1615248473,"name":"using_GenericLinearAlgebra_and_no_ProximalOperators (1).pdf","title":"using_GenericLinearAlgebra_and_no_ProximalOperators (1).pdf","mimetype":"application/pdf","filetype":"pdf","pretty_type":"PDF","user":"U01Q398M3QB","editable":false,"size":51723,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01QL7C6JJF/using_genericlinearalgebra_and_no_proximaloperators__1_.pdf","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01QL7C6JJF/download/using_genericlinearalgebra_and_no_proximaloperators__1_.pdf","thumb_pdf":"https://files.slack.com/files-tmb/T68168MUP-F01QL7C6JJF-3e289e3cc5/using_genericlinearalgebra_and_no_proximaloperators__1__thumb_pdf.png","thumb_pdf_w":935,"thumb_pdf_h":1210,"permalink":"https://julialang.slack.com/files/U01Q398M3QB/F01QL7C6JJF/using_genericlinearalgebra_and_no_proximaloperators__1_.pdf","permalink_public":"https://slack-files.com/T68168MUP-F01QL7C6JJF-548b51c02c","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"D3i8","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UQEDP1Q5V"},{"type":"text","text":" Hi! Arno. Thanks a lot and so sorry for a pause. I wrote the code in Turing MCMC function. This Turing will automatically change Float64 type number into ForwarDdiff.dual type. Like in the test 2, I could not call Symmetric(A) while A is ForwardDiff.dual type and this will raise the issue. I also tried GenericLinearAlgebra.Symmetric() from other helpers in "},{"type":"channel","channel_id":"C6G240ENA"},{"type":"text","text":" . However, it still raise the same error message."}]}]}],"user":"U01Q398M3QB","display_as_bot":false,"ts":"1615248592.059300","thread_ts":"1614825789.353600","parent_user_id":"U01Q398M3QB"},{"client_msg_id":"1821a7fb-50a9-453b-bb66-419467cc1a90","type":"message","text":"I don't think it has anything to do with `Symmetric.` I think `eigen` might not be compatible with `ForwardDiff`.\n<https://discourse.julialang.org/t/automatic-differentiation-of-f-x-constructed-by-decomposition-of-a-matrix-m-x/33061>\n```using Turing\nusing LinearAlgebra\nusing PDMats\nusing Random\n\nRandom.seed!(1)\n@model tester(y) = begin\n    a ~ Normal(10.0,0.1)\n    E = [a 0.0;eps(0.0) a]\n    y ~ MvNormal(E)\nend\ny = [0.01, -0.01]\nsample(tester(y), NUTS(0.65),100)\n\nRandom.seed!(1)\n@model tester(y) = begin\n    a ~ Normal(10.0,0.1)\n    E = [a 0.0;eps(0.0) a]\n    y ~ MvNormal(Symmetric(E))\nend\ny = [0.01, -0.01]\nsample(tester(y), NUTS(0.65),100)\n\nRandom.seed!(1)\n@model tester(y) = begin\n    a ~ truncated(Normal(10.0,0.1),8.0,12.0)\n    E = [a 0.0;eps(0.0) a]\n    y ~ MvNormal(Symmetric(E))\nend\ny = [0.01, -0.01]\nsample(tester(y), NUTS(0.65),100)\n\nRandom.seed!(1)\n@model tester(y) = begin\n    a ~ truncated(Normal(10.0,0.1),8.0,12.0)\n    E = [a 0.0;eps(0.0) a]\n    eigen(E)\n    y ~ MvNormal(Symmetric(E))\nend\ny = [0.01, -0.01]\nsample(tester(y), NUTS(0.65),100)```\n","user":"UQEDP1Q5V","ts":"1615300440.000700","team":"T68168MUP","attachments":[{"service_name":"JuliaLang","title":"Automatic differentiation of f(x) constructed by decomposition of a matrix M(x)","title_link":"https://discourse.julialang.org/t/automatic-differentiation-of-f-x-constructed-by-decomposition-of-a-matrix-m-x/33061","text":"I have some objective function f(x), e.g. some type of error function for which I want to calculate its gradient and hessian. To construct f(x), I need the eigenvectors of a certain matrix \\textbf{M}(x). I have tried both forward from (ForwardDiff.jl) and reverse AD from (Flux.jl) with different decomposition methods (eigen, eigs, svd, svdl) and all of them fail for different reasons. Here is a minimum working example: using ForwardDiff, LinearAlgebra, Arpack, IterativeSolvers, Flux function...","fallback":"JuliaLang: Automatic differentiation of f(x) constructed by decomposition of a matrix M(x)","thumb_url":"https://aws1.discourse-cdn.com/business5/uploads/julialang/original/2X/1/12829a7ba92b924d4ce81099cbf99785bee9b405.png","fields":[{"title":"Reading time","value":"2 mins :clock2:","short":true},{"title":"Likes","value":"4 :heart:","short":true}],"ts":1578401644,"from_url":"https://discourse.julialang.org/t/automatic-differentiation-of-f-x-constructed-by-decomposition-of-a-matrix-m-x/33061","thumb_width":408,"thumb_height":263,"service_icon":"https://aws1.discourse-cdn.com/business5/uploads/julialang/optimized/2X/6/6ca888e296f59ca2a599807f7d5edd489e3d1829_2_180x180.png","id":1,"original_url":"https://discourse.julialang.org/t/automatic-differentiation-of-f-x-constructed-by-decomposition-of-a-matrix-m-x/33061"}],"blocks":[{"type":"rich_text","block_id":"eo=D","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't think it has anything to do with "},{"type":"text","text":"Symmetric.","style":{"code":true}},{"type":"text","text":" I think "},{"type":"text","text":"eigen","style":{"code":true}},{"type":"text","text":" might not be compatible with "},{"type":"text","text":"ForwardDiff","style":{"code":true}},{"type":"text","text":".\n"},{"type":"link","url":"https://discourse.julialang.org/t/automatic-differentiation-of-f-x-constructed-by-decomposition-of-a-matrix-m-x/33061"},{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using Turing\nusing LinearAlgebra\nusing PDMats\nusing Random\n\nRandom.seed!(1)\n@model tester(y) = begin\n    a ~ Normal(10.0,0.1)\n    E = [a 0.0;eps(0.0) a]\n    y ~ MvNormal(E)\nend\ny = [0.01, -0.01]\nsample(tester(y), NUTS(0.65),100)\n\nRandom.seed!(1)\n@model tester(y) = begin\n    a ~ Normal(10.0,0.1)\n    E = [a 0.0;eps(0.0) a]\n    y ~ MvNormal(Symmetric(E))\nend\ny = [0.01, -0.01]\nsample(tester(y), NUTS(0.65),100)\n\nRandom.seed!(1)\n@model tester(y) = begin\n    a ~ truncated(Normal(10.0,0.1),8.0,12.0)\n    E = [a 0.0;eps(0.0) a]\n    y ~ MvNormal(Symmetric(E))\nend\ny = [0.01, -0.01]\nsample(tester(y), NUTS(0.65),100)\n\nRandom.seed!(1)\n@model tester(y) = begin\n    a ~ truncated(Normal(10.0,0.1),8.0,12.0)\n    E = [a 0.0;eps(0.0) a]\n    eigen(E)\n    y ~ MvNormal(Symmetric(E))\nend\ny = [0.01, -0.01]\nsample(tester(y), NUTS(0.65),100)"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1614825789.353600","parent_user_id":"U01Q398M3QB"}]