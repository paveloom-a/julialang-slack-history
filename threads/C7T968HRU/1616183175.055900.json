[{"client_msg_id":"bd107717-ff0f-436a-9a13-b8568834af64","type":"message","text":"I’m starting to play with ODE solvers, but as I’m a Julia newbie I’m struggling with some basic errors.\n\nI’d like to solve the following super simple ODE:\n```function MB!(∂MB, params, t)\n    T_melt = 0.0\n    α, μ, P, T  = params\n    ∂MB = α*P - μ*max(T-T_melt, 0.0)\nend```\nThen I’m defining the parameters and trying to solve the ODE:\n```tspan = (0.0f0,10.0f0)\nMB₀ = 0.0f0\np = Float32[1.3, 3.5, 10.0, 8.0]\nprob = ODEProblem(MB!, MB₀, tspan, p)\n\nsolution = solve(prob, Vern7())```\nBut I’m getting the following error:\n```ERROR: LoadError: MethodError: no method matching similar(::Float32, ::Type{Float32})```\nWhat’s actually going on here? Moreover, function MB! appears as a “generic function with 2 methods”. Why are there two methods?\n\nThanks a lot in advance!","user":"U01QV28FEHL","ts":"1616183175.055900","team":"T68168MUP","edited":{"user":"U01QV28FEHL","ts":"1616183315.000000"},"blocks":[{"type":"rich_text","block_id":"Otqm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m starting to play with ODE solvers, but as I’m a Julia newbie I’m struggling with some basic errors.\n\nI’d like to solve the following super simple ODE:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function MB!(∂MB, params, t)\n    T_melt = 0.0\n    α, μ, P, T  = params\n    ∂MB = α*P - μ*max(T-T_melt, 0.0)\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Then I’m defining the parameters and trying to solve the ODE:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"tspan = (0.0f0,10.0f0)\nMB₀ = 0.0f0\np = Float32[1.3, 3.5, 10.0, 8.0]\nprob = ODEProblem(MB!, MB₀, tspan, p)\n\nsolution = solve(prob, Vern7())"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"But I’m getting the following error:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"ERROR: LoadError: MethodError: no method matching similar(::Float32, ::Type{Float32})"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nWhat’s actually going on here? Moreover, function MB! appears as a “generic function with 2 methods”. Why are there two methods?\n\nThanks a lot in advance!"}]}]}],"thread_ts":"1616183175.055900","reply_count":20,"reply_users_count":3,"latest_reply":"1616185012.071800","reply_users":["UM8JUNJG7","US4A6G6B0","U01QV28FEHL"],"subscribed":false},{"client_msg_id":"103ab6e7-34f7-484d-8619-b1f6433edfed","type":"message","text":"one thing i noticed was you have `MB!(du, p, t)`  but this should have 4 arguments","user":"UM8JUNJG7","ts":"1616183268.056300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hoRo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"one thing i noticed was you have "},{"type":"text","text":"MB!(du, p, t) ","style":{"code":true}},{"type":"text","text":" but this should have 4 arguments"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"3e7b3bfe-5756-4b1a-9fbc-8fd2e5b1333c","type":"message","text":"<https://diffeq.sciml.ai/stable/basics/problem/#In-place-vs-Out-of-Place-Function-Definition-Forms|it looks like inplace vs out of place >","user":"UM8JUNJG7","ts":"1616183311.057400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Qpik","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://diffeq.sciml.ai/stable/basics/problem/#In-place-vs-Out-of-Place-Function-Definition-Forms","text":"it looks like inplace vs out of place "}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"0D4E185A-BE5E-458E-B277-0FB9DA64A79D","type":"message","text":"Also, your input needs to be a vector, even if it’s just one element.\n\nEdit: for inplace functions, that is","user":"US4A6G6B0","ts":"1616183333.058000","team":"T68168MUP","edited":{"user":"US4A6G6B0","ts":"1616183895.000000"},"blocks":[{"type":"rich_text","block_id":"wBrW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also, your input needs to be a vector, even if it’s just one element.\n\nEdit: for inplace functions, that is"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL","reactions":[{"name":"+1","users":["UM8JUNJG7"],"count":1}]},{"client_msg_id":"D2743FCC-6ECD-45D7-922C-F98571BEDDED","type":"message","text":"And are you sure the dynamics don’t depend on the state variable, too? The way it’s set up here, the return of your function is just going be the same static value every time. So your integration will just give you a constant slope output.","user":"US4A6G6B0","ts":"1616183584.061200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7xG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And are you sure the dynamics don’t depend on the state variable, too? The way it’s set up here, the return of your function is just going be the same static value every time. So your integration will just give you a constant slope output."}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"type":"message","text":"Yes, I’ve tried using the initial value as a vector, but the output makes no sense:","files":[{"id":"F01S2SPHWUU","created":1616183573,"timestamp":1616183573,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"U01QV28FEHL","editable":false,"size":49759,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01S2SPHWUU/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01S2SPHWUU/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01S2SPHWUU-a8290a66d0/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01S2SPHWUU-a8290a66d0/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01S2SPHWUU-a8290a66d0/image_360.png","thumb_360_w":360,"thumb_360_h":241,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01S2SPHWUU-a8290a66d0/image_480.png","thumb_480_w":480,"thumb_480_h":321,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01S2SPHWUU-a8290a66d0/image_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01S2SPHWUU-a8290a66d0/image_720.png","thumb_720_w":720,"thumb_720_h":482,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01S2SPHWUU-a8290a66d0/image_800.png","thumb_800_w":800,"thumb_800_h":535,"original_w":876,"original_h":586,"thumb_tiny":"AwAgADDSzz0paTv1zS0AFFFFAAelNyd4FOPSm/8ALQfSgBe/TFLSGj/PWgBaKT/PWjNACnpTf4x9KU9KafvZHpQB/9k=","permalink":"https://julialang.slack.com/files/U01QV28FEHL/F01S2SPHWUU/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01S2SPHWUU-c8c7a8bfbb","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"Zfy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, I’ve tried using the initial value as a vector, but the output makes no sense:"}]}]}],"user":"U01QV28FEHL","display_as_bot":false,"ts":"1616183593.061400","thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"b9cef677-e66a-4d3b-81c9-7e525fc1f33e","type":"message","text":"post the full code","user":"UM8JUNJG7","ts":"1616183643.061800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gEl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"post the full code"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"55a8e05c-1e94-46c0-9709-4e3ede1ea086","type":"message","text":"This another issue that I’d like to deal with later. To begin with, I’m not even sure if using an ODE solver for this problem is a good idea for this problem. The thing is that 2 of the parameters (P and T) change in time. Parameters cannot change in the ODE solver, so I have no idea on how to represent that here.","user":"U01QV28FEHL","ts":"1616183773.062000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"AxYUZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This another issue that I’d like to deal with later. To begin with, I’m not even sure if using an ODE solver for this problem is a good idea for this problem. The thing is that 2 of the parameters (P and T) change in time. Parameters cannot change in the ODE solver, so I have no idea on how to represent that here."}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"ac093dae-e4d8-4812-8957-a4a40b778df4","type":"message","text":"if they change with time they are variables","user":"UM8JUNJG7","ts":"1616183802.062200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MlMI6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if they change with time they are variables"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"0ff0f73a-a3bf-4ce8-bff8-435210ee985e","type":"message","text":"so where should they be represented? the only thing changing here is tspan","user":"U01QV28FEHL","ts":"1616183892.062400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"a4Lq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so where should they be represented? the only thing changing here is tspan"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"e880e075-0da6-4304-aae5-f727ad937552","type":"message","text":"```function f!(du, u, p, t)\n    P, T = u\n    α, μ, T_melt = p\n    du = α*P - μ*max(T-T_melt, 0.0)\nend```","user":"UM8JUNJG7","ts":"1616183947.063400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oV7V","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function f!(du, u, p, t)\n    P, T = u\n    α, μ, T_melt = p\n    du = α*P - μ*max(T-T_melt, 0.0)\nend"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"c46d3be6-4eb3-486d-848a-d9c73a138222","type":"message","text":"something like this","user":"UM8JUNJG7","ts":"1616183952.063800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Shf5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"something like this"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"B3AFC950-6A6B-43D0-8D0A-CD3CF10DA8DF","type":"message","text":"Well in what way do they change with time? Are they just a function of time? Or are they updated with the derivative function?","user":"US4A6G6B0","ts":"1616184009.065100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qIOkC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well in what way do they change with time? Are they just a function of time? Or are they updated with the derivative function?"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"b2621a54-83fb-46a8-83fe-6513770a0a56","type":"message","text":"my post is wrong, du needs to be length 2 as well","user":"UM8JUNJG7","ts":"1616184024.065300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NMUVp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"my post is wrong, du needs to be length 2 as well"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"08C01BC9-B485-493F-9427-75013FA20A51","type":"message","text":"(<@UM8JUNJG7> don’t forget to do `.=` instead of `=` )","user":"US4A6G6B0","ts":"1616184090.066900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"stEyU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"("},{"type":"user","user_id":"UM8JUNJG7"},{"type":"text","text":" don’t forget to do "},{"type":"text","text":".=","style":{"code":true}},{"type":"text","text":" instead of "},{"type":"text","text":"=","style":{"code":true}},{"type":"text","text":" )"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"5c523a76-4751-46b6-8cf3-9d3c7237f767","type":"message","text":"that still wouldn't work for him. the rhs of du = ... returns a scalar","user":"UM8JUNJG7","ts":"1616184110.067100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SXrGq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that still wouldn't work for him. the rhs of du = ... returns a scalar"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"B605AAB4-C282-4B7F-9758-2232D415A695","type":"message","text":"Oh, that’s true. There needs to be dynamics for both state variables. Unless they are just regular functions of time.","user":"US4A6G6B0","ts":"1616184185.068800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"N=Ia","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh, that’s true. There needs to be dynamics for both state variables. Unless they are just regular functions of time."}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"43b7ccdd-57f6-4ae9-b1c3-f6596c084a1e","type":"message","text":"The thing is that P and T do not depend on time nor the derivative. That’s why I’m not even sure using an ODE solver for this is a good idea. The whole point of this was to then train an UDE in order to optimize the alpha and mu parameters based on training data, with P and T as input data and MB as target data.","user":"U01QV28FEHL","ts":"1616184233.069000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jgGVm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The thing is that P and T do not depend on time nor the derivative. That’s why I’m not even sure using an ODE solver for this is a good idea. The whole point of this was to then train an UDE in order to optimize the alpha and mu parameters based on training data, with P and T as input data and MB as target data."}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"89C7B7F6-6671-432D-9A40-2E97FA802BCB","type":"message","text":"Ah, I see. So what does your training data look like? Do P and T have some trajectory over time or are they just static values? ","user":"US4A6G6B0","ts":"1616184413.071400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ulEz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah, I see. So what does your training data look like? Do P and T have some trajectory over time or are they just static values? "}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"e1779fbb-65ac-4f3a-b2a9-1e88df77d587","type":"message","text":"P is basically precipitation data, integrated within a certain timestep (hourly, daily…) and T is the average temperature for that timestep","user":"U01QV28FEHL","ts":"1616184471.071600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PPNro","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"P is basically precipitation data, integrated within a certain timestep (hourly, daily…) and T is the average temperature for that timestep"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"},{"client_msg_id":"c8cb8777-72ed-486a-a07d-87c51ef9646e","type":"message","text":"i would find it very helpful if you're able to send this code or post it somewhere.\nhave you checked out <http://diffeqflux.sciml.ai|diffeqflux.sciml.ai>","user":"UM8JUNJG7","ts":"1616185012.071800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9Th","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"i would find it very helpful if you're able to send this code or post it somewhere.\nhave you checked out "},{"type":"link","url":"http://diffeqflux.sciml.ai","text":"diffeqflux.sciml.ai"}]}]}],"thread_ts":"1616183175.055900","parent_user_id":"U01QV28FEHL"}]