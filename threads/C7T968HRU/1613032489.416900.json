[{"client_msg_id":"c3260474-cac6-410e-b2d3-09356360d5c5","type":"message","text":"Ugh, sorry, that error was also with an older-than-I-realized version of ComponentArrays. Here's the correct error:\n```julia&gt; prob = ODEProblem(f,u0,tspan)\nODEProblem with uType ComponentVector{Float64,typename(SArray)...} and tType Float64. In-place: false\ntimespan: (0.0, 1.0)\nu0: (x = 1.0, y = 2.0)\n\njulia&gt; sol = solve(prob, Rodas5())\nERROR: TypeError: in setfield!, expected ComponentVector{Float64,typename(SArray)...}, got a value of type ComponentVector{Float64,typename(MArray)...}```\nwith\n```(test) pkg&gt; st\n      Status `~/work/test/Project.toml`\n  [b0b7db55] ComponentArrays v0.8.15\n  [1dea7af3] OrdinaryDiffEq v5.50.2\n  [90137ffa] StaticArrays v1.0.1```","user":"UUMJUCYRK","ts":"1613032489.416900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kWhzT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ugh, sorry, that error was also with an older-than-I-realized version of ComponentArrays. Here's the correct error:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> prob = ODEProblem(f,u0,tspan)\nODEProblem with uType ComponentVector{Float64,typename(SArray)...} and tType Float64. In-place: false\ntimespan: (0.0, 1.0)\nu0: (x = 1.0, y = 2.0)\n\njulia> sol = solve(prob, Rodas5())\nERROR: TypeError: in setfield!, expected ComponentVector{Float64,typename(SArray)...}, got a value of type ComponentVector{Float64,typename(MArray)...}"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"with\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"(test) pkg> st\n      Status `~/work/test/Project.toml`\n  [b0b7db55] ComponentArrays v0.8.15\n  [1dea7af3] OrdinaryDiffEq v5.50.2\n  [90137ffa] StaticArrays v1.0.1"}]}]}],"thread_ts":"1613032489.416900","reply_count":10,"reply_users_count":2,"latest_reply":"1613034989.419600","reply_users":["U01H36BUDJB","UUMJUCYRK"],"subscribed":false},{"client_msg_id":"6c579dda-deca-40a7-878b-0dc3720f6716","type":"message","text":"Could you post the full stack trace?","user":"U01H36BUDJB","ts":"1613032553.417500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2LJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Could you post the full stack trace?"}]}]}],"thread_ts":"1613032489.416900","parent_user_id":"UUMJUCYRK"},{"type":"message","text":"","files":[{"id":"F01MS9W8MLK","created":1613032580,"timestamp":1613032580,"name":"Untitled","title":"Untitled","mimetype":"text/plain","filetype":"text","pretty_type":"Plain Text","user":"UUMJUCYRK","editable":true,"size":9626,"mode":"snippet","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01MS9W8MLK/untitled","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01MS9W8MLK/download/untitled","permalink":"https://julialang.slack.com/files/UUMJUCYRK/F01MS9W8MLK/untitled","permalink_public":"https://slack-files.com/T68168MUP-F01MS9W8MLK-eca2322fdd","edit_link":"https://julialang.slack.com/files/UUMJUCYRK/F01MS9W8MLK/untitled/edit","preview":"julia> sol = solve(prob, Rodas5())\nERROR: TypeError: in setfield!, expected ComponentVector{Float64,typename(SArray)...}, got a value of type ComponentVector{Float64,typename(MArray)...}\nStacktrace:\n  [1] setproperty!\n    @ ./Base.jl:34 [inlined]","preview_highlight":"<div class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\">\n<div class=\"CodeMirror-code\">\n<div><pre>julia&gt; sol = solve(prob, Rodas5())</pre></div>\n<div><pre>ERROR: TypeError: in setfield!, expected ComponentVector{Float64,typename(SArray)...}, got a value of type ComponentVector{Float64,typename(MArray)...}</pre></div>\n<div><pre>Stacktrace:</pre></div>\n<div><pre>  [1] setproperty!</pre></div>\n<div><pre>    @ ./Base.jl:34 [inlined]</pre></div>\n</div>\n</div>\n","lines":30,"lines_more":25,"preview_is_truncated":true,"is_starred":false,"has_rich_preview":false}],"upload":true,"user":"UUMJUCYRK","display_as_bot":false,"ts":"1613032582.417700","client_msg_id":"784afd3a-15ee-4add-81fe-2231f25930c6","thread_ts":"1613032489.416900","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"48843058-dc5e-4564-b698-9774ec3826e0","type":"message","text":"Hmm. Hard to parse the stack trace fully, but it *looks* like it has to do with the mutability issue, and that something is trying to turn it into `MArray` to be able to mutate it. Have you tried using `MVector` directly? It won't be as fast... but...","user":"U01H36BUDJB","ts":"1613032816.418100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xL24k","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm. Hard to parse the stack trace fully, but it "},{"type":"text","text":"looks","style":{"bold":true}},{"type":"text","text":" like it has to do with the mutability issue, and that something is trying to turn it into "},{"type":"text","text":"MArray","style":{"code":true}},{"type":"text","text":" to be able to mutate it. Have you tried using "},{"type":"text","text":"MVector","style":{"code":true}},{"type":"text","text":" directly? It won't be as fast... but..."}]}]}],"thread_ts":"1613032489.416900","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"843c9ec8-11db-45e5-9f34-dc59054ccf71","type":"message","text":"I haven't, I'm mainly after the stack allocation, but I guess I hadnt realized MArrays are also stack allocated...","user":"UUMJUCYRK","ts":"1613033645.418300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JiT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I haven't, I'm mainly after the stack allocation, but I guess I hadnt realized MArrays are also stack allocated..."}]}]}],"thread_ts":"1613032489.416900","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"35c7dc50-2a97-4172-81fb-6a0718869d15","type":"message","text":"Wait no, nevermind (duh) theyre a mutable struct.","user":"UUMJUCYRK","ts":"1613034076.418500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"e4nz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Wait no, nevermind (duh) theyre a mutable struct."}]}]}],"thread_ts":"1613032489.416900","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"50e263d3-0468-4dd3-898c-f8f0316829e9","type":"message","text":"Yeah no, sadly they are not.","user":"U01H36BUDJB","ts":"1613034563.418700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+pP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah no, sadly they are not."}]}]}],"thread_ts":"1613032489.416900","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"63986e7f-3937-45f6-a7c2-20c7b3f0ab0e","type":"message","text":"Unfortunately I don't think you can do stack-allocated when mutation is also required.","user":"U01H36BUDJB","ts":"1613034593.418900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Brl8C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Unfortunately I don't think you can do stack-allocated when mutation is also required."}]}]}],"thread_ts":"1613032489.416900","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"be52596e-2f68-418d-aca1-dce16985af1a","type":"message","text":"Or at least I am not aware of a way to do it.","user":"U01H36BUDJB","ts":"1613034603.419100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1KqD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Or at least I am not aware of a way to do it."}]}]}],"thread_ts":"1613032489.416900","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"b99e217f-c41d-401d-89cc-8ec4411c6cbb","type":"message","text":"You can kind of fake it with Setfield like <https://discourse.julialang.org/t/possible-to-do-non-allocating-setfield-operations-on-offsetarray-staticvector/55031|here>, from what I can tell the compiler ends up optimizing everything away in the end","user":"UUMJUCYRK","ts":"1613034701.419300","team":"T68168MUP","attachments":[{"service_name":"JuliaLang","title":"Possible to do non-allocating Setfield operations on OffsetArray(::StaticVector)?","title_link":"https://discourse.julialang.org/t/possible-to-do-non-allocating-setfield-operations-on-offsetarray-staticvector/55031","text":"I have some code which initializes an array with a loop in a way where each element depends on the last element. I’m trying to make this work with StaticVectors so it can be non-allocating. I’ve found that I can use Setfield.@set!(since I need to depend on the previous elements) and that part seems to work fine, e.g. function foo(x₁) x = @SVector(zeros(Int,5)) @set! x[1] = x₁ for i=2:5 @set! x[i] = 2*x[i-1]+1 end x end @code_llvm foo(0) generates what to my naive ey...","fallback":"JuliaLang: Possible to do non-allocating Setfield operations on OffsetArray(::StaticVector)?","thumb_url":"https://aws1.discourse-cdn.com/business5/uploads/julialang/original/2X/1/12829a7ba92b924d4ce81099cbf99785bee9b405.png","ts":1612997082,"from_url":"https://discourse.julialang.org/t/possible-to-do-non-allocating-setfield-operations-on-offsetarray-staticvector/55031","thumb_width":408,"thumb_height":263,"service_icon":"https://aws1.discourse-cdn.com/business5/uploads/julialang/optimized/2X/6/6ca888e296f59ca2a599807f7d5edd489e3d1829_2_180x180.png","id":1,"original_url":"https://discourse.julialang.org/t/possible-to-do-non-allocating-setfield-operations-on-offsetarray-staticvector/55031"}],"blocks":[{"type":"rich_text","block_id":"rnQA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You can kind of fake it with Setfield like "},{"type":"link","url":"https://discourse.julialang.org/t/possible-to-do-non-allocating-setfield-operations-on-offsetarray-staticvector/55031","text":"here"},{"type":"text","text":", from what I can tell the compiler ends up optimizing everything away in the end"}]}]}],"thread_ts":"1613032489.416900","parent_user_id":"UUMJUCYRK"},{"client_msg_id":"011ddbf7-c29f-48b5-9255-ecf6b24bd783","type":"message","text":"Oh, ok, cool. I didn't know about that, so I guess I can't be of any further help here :sweat_smile:","user":"U01H36BUDJB","ts":"1613034989.419600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2UR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh, ok, cool. I didn't know about that, so I guess I can't be of any further help here "},{"type":"emoji","name":"sweat_smile"}]}]}],"thread_ts":"1613032489.416900","parent_user_id":"UUMJUCYRK"}]