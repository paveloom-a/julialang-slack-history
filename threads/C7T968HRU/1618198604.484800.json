[{"client_msg_id":"ef1bdca4-1079-4eeb-a8b7-200963f1c899","type":"message","text":"If I can find a student who really knows Julia, that’d be really useful for me too! \n\nI was interested in customizing broadcast to play nicer with @avx and multithreading, but since I’ve never even written a macro before, I figure I have some things to learn before writing anything fast and useful.","user":"U011LUQ182G","ts":"1618198604.484800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"grh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If I can find a student who really knows Julia, that’d be really useful for me too! \n\nI was interested in customizing broadcast to play nicer with @avx and multithreading, but since I’ve never even written a macro before, I figure I have some things to learn before writing anything fast and useful."}]}]}],"thread_ts":"1618198604.484800","reply_count":16,"reply_users_count":2,"latest_reply":"1618200244.000400","reply_users":["UM8JUNJG7","U011LUQ182G"],"is_locked":false,"subscribed":false},{"client_msg_id":"aafe44c8-d1d4-4c5b-8be8-4b7018e4301d","type":"message","text":"as in, broadcasting automatically tmaps?","user":"UM8JUNJG7","ts":"1618198632.485300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"X/z0x","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"as in, broadcasting automatically tmaps?"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"795a36d0-0364-41ee-a586-2a4569967e5d","type":"message","text":"huh, interesting - I haven’t seen tmap before","user":"U011LUQ182G","ts":"1618198669.485600","team":"T68168MUP","edited":{"user":"U011LUQ182G","ts":"1618198692.000000"},"blocks":[{"type":"rich_text","block_id":"MmO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"huh, interesting - I haven’t seen tmap before"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"59a91f8e-2540-40c7-92f6-46e886e2fc9a","type":"message","text":"its in scimlbase","user":"UM8JUNJG7","ts":"1618198680.485800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KNH=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"its in scimlbase"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"b44a8cc6-2a2a-47c0-895c-649c984e65d8","type":"message","text":"Gotcha, so not tmap in <https://github.com/jw3126/ThreadingTools.jl>?","user":"U011LUQ182G","ts":"1618198699.486100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"30N","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Gotcha, so not tmap in "},{"type":"link","url":"https://github.com/jw3126/ThreadingTools.jl"},{"type":"text","text":"?"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"2b866ac1-8cba-4d18-9e20-095cb90525f3","type":"message","text":"probably almost identical","user":"UM8JUNJG7","ts":"1618198710.486300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9p5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"probably almost identical"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G","reactions":[{"name":"+1","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"49cb71d8-43f0-487b-8be2-4b36922921a1","type":"message","text":"It seems really slow","user":"U011LUQ182G","ts":"1618199267.488600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Buk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It seems really slow"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G","reactions":[{"name":"sweat_smile","users":["UM8JUNJG7"],"count":1}]},{"client_msg_id":"296017c0-2011-4cc0-ac9e-ca047ffb4538","type":"message","text":"```import SciMLBase:tmap\nu,v = ntuple(x-&gt;randn(1000),2)\nU = StructArray((u=u,v=v))\nf(U) = exp(U.u)*sin(U.v)\n\n@btime f.($U); #   12.092 μs (2 allocations: 7.97 KiB)\n@btime tmap($f,$U); # 438.346 μs (1055 allocations: 3.97 MiB)```","user":"U011LUQ182G","ts":"1618199378.488900","team":"T68168MUP","edited":{"user":"U011LUQ182G","ts":"1618199409.000000"},"blocks":[{"type":"rich_text","block_id":"vm8u","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"import SciMLBase:tmap\nu,v = ntuple(x->randn(1000),2)\nU = StructArray((u=u,v=v))\nf(U) = exp(U.u)*sin(U.v)\n\n@btime f.($U); #   12.092 μs (2 allocations: 7.97 KiB)\n@btime tmap($f,$U); # 438.346 μs (1055 allocations: 3.97 MiB)"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"1567fa36-c1e7-41b6-81c1-7cc48f907d07","type":"message","text":"oh wow that doesn't look great. im not sure where tmap actually gets used","user":"UM8JUNJG7","ts":"1618199421.489200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LRI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh wow that doesn't look great. im not sure where tmap actually gets used"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"0b3e714d-bd1e-47cb-b356-e050fed44467","type":"message","text":"maybe open an issue? it could just be the overhead for spawn, right?","user":"UM8JUNJG7","ts":"1618199462.489600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1XAPV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"maybe open an issue? it could just be the overhead for spawn, right?"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G","reactions":[{"name":"+1","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"338946ad-d18b-42f9-a666-773c060ee54a","type":"message","text":"does it get better if you make the problem much bigger?","user":"UM8JUNJG7","ts":"1618199488.489900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"20v7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"does it get better if you make the problem much bigger?"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"0363d93f-e412-40f0-b23c-3f5f2e89faf4","type":"message","text":"let me check…","user":"U011LUQ182G","ts":"1618199570.490500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"080lO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"let me check…"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"e46660f0-69f9-48a3-9c89-b0a5bce0d8c1","type":"message","text":"for a 100k length vector,\n```  1.408 ms (3 allocations: 781.36 KiB) # broadcast f.(U)\n  97.911 ms (100118 allocations: 318.53 MiB) # tmap(f,U)```\nso I guess it got worse?","user":"U011LUQ182G","ts":"1618199707.491400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oLS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"for a 100k length vector,\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"  1.408 ms (3 allocations: 781.36 KiB) # broadcast f.(U)\n  97.911 ms (100118 allocations: 318.53 MiB) # tmap(f,U)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"so I guess it got worse?"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G","reactions":[{"name":"scream","users":["UM8JUNJG7"],"count":1}]},{"client_msg_id":"4097176d-ceab-4e91-bf4c-6142dc15fa5e","type":"message","text":"testing this version of tmap now <https://discourse.julialang.org/t/type-stable-threaded-map/24498/10?u=jlchan>","user":"U011LUQ182G","ts":"1618199713.491600","team":"T68168MUP","attachments":[{"service_name":"JuliaLang","title":"Type-stable threaded map?","title_link":"https://discourse.julialang.org/t/type-stable-threaded-map/24498/10?u=jlchan","text":"In Transducers.jl master you can do using Transducers using BangBang using StaticArrays tmap(f, xs) = reduce(append!!, Map(x -&gt; SVector(f(x))), xs; init=Union{}[]) to implement threaded map using mutate-or-widen strategy.","fallback":"JuliaLang: Type-stable threaded map?","thumb_url":"https://aws1.discourse-cdn.com/business5/uploads/julialang/original/2X/1/12829a7ba92b924d4ce81099cbf99785bee9b405.png","ts":1566330298,"from_url":"https://discourse.julialang.org/t/type-stable-threaded-map/24498/10?u=jlchan","thumb_width":408,"thumb_height":263,"service_icon":"https://aws1.discourse-cdn.com/business5/uploads/julialang/optimized/2X/6/6ca888e296f59ca2a599807f7d5edd489e3d1829_2_180x180.png","id":1,"original_url":"https://discourse.julialang.org/t/type-stable-threaded-map/24498/10?u=jlchan"}],"blocks":[{"type":"rich_text","block_id":"hBZ9Q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"testing this version of tmap now "},{"type":"link","url":"https://discourse.julialang.org/t/type-stable-threaded-map/24498/10?u=jlchan"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G","reactions":[{"name":"+1","users":["UM8JUNJG7"],"count":1}]},{"client_msg_id":"b0e37f03-b987-4cac-800a-c672a8ff9dd0","type":"message","text":"yeah, it’s slower than broadcast too.\n```  1.463 ms (3 allocations: 781.36 KiB) # f.(U)\n  2.375 ms (527 allocations: 5.04 MiB) # SciMLBase.tmap\n  3.673 ms (559 allocations: 5.04 MiB) # ktf Transducers tmap```","user":"U011LUQ182G","ts":"1618199845.493000","team":"T68168MUP","edited":{"user":"U011LUQ182G","ts":"1618199885.000000"},"blocks":[{"type":"rich_text","block_id":"YO3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, it’s slower than broadcast too.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"  1.463 ms (3 allocations: 781.36 KiB) # f.(U)\n  2.375 ms (527 allocations: 5.04 MiB) # SciMLBase.tmap\n  3.673 ms (559 allocations: 5.04 MiB) # ktf Transducers tmap"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G"},{"client_msg_id":"86dd0c5c-0805-4c68-ba47-a3e0498c5a47","type":"message","text":"it could be all those individual allocations, i thought i saw an inplace tmap somewhere, if that isn't faster asymptotically then its definitely an issue","user":"UM8JUNJG7","ts":"1618199991.496300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jadX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it could be all those individual allocations, i thought i saw an inplace tmap somewhere, if that isn't faster asymptotically then its definitely an issue"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G","reactions":[{"name":"+1","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"b2b3e3bd-7e35-4632-beab-3c1192376cf3","type":"message","text":"yeah, I wondered about that too. Couldn’t find `tmap!` in SciMLBase, but will look around online for it later","user":"U011LUQ182G","ts":"1618200244.000400","team":"T68168MUP","edited":{"user":"U011LUQ182G","ts":"1618200265.000000"},"blocks":[{"type":"rich_text","block_id":"cRIS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, I wondered about that too. Couldn’t find "},{"type":"text","text":"tmap!","style":{"code":true}},{"type":"text","text":" in SciMLBase, but will look around online for it later"}]}]}],"thread_ts":"1618198604.484800","parent_user_id":"U011LUQ182G","reactions":[{"name":"+1","users":["UM8JUNJG7"],"count":1}]}]