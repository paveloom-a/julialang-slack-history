[{"client_msg_id":"f85922a0-cd30-4171-8b0b-fe5ebbe70701","type":"message","text":"If you use IfElse you should be fine.","user":"U69BL50BF","ts":"1616619667.205100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"K9Y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you use IfElse you should be fine."}]}]}],"thread_ts":"1616619667.205100","reply_count":24,"reply_users_count":3,"latest_reply":"1616628302.211400","reply_users":["U01H36BUDJB","U69BL50BF","U6788D83U"],"is_locked":false,"subscribed":false,"reactions":[{"name":"+1","users":["U01H36BUDJB"],"count":1}]},{"client_msg_id":"4ed02c88-a492-4e19-8bf7-deb56a84b3af","type":"message","text":"so using `IfElse` worked, but it appears that the generated function is type unsafe when broadcasted","user":"U01H36BUDJB","ts":"1616626855.206000","team":"T68168MUP","edited":{"user":"U01H36BUDJB","ts":"1616627231.000000"},"blocks":[{"type":"rich_text","block_id":"YL9BG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so using "},{"type":"text","text":"IfElse","style":{"code":true}},{"type":"text","text":" worked, but it appears that the generated function is type unsafe when broadcasted"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"30b4b70b-81c2-4c1e-8fcc-32822bcb6a0e","type":"message","text":":thinking_face: MWE?","user":"U69BL50BF","ts":"1616626875.206200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LB5","elements":[{"type":"rich_text_section","elements":[{"type":"emoji","name":"thinking_face"},{"type":"text","text":" MWE?"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"10aaec54-6e6c-43e4-b1eb-1559baa75c74","type":"message","text":"This should do it:\n```F(T,θtot) = IfElse.ifelse(T&lt;=0.0,θtot*exp(-(T/0.1)^2),θtot)\n@variables T\nθtot = 0.8\n∂F∂T_expr = build_function(∂T(F(T,θtot)) |&gt; expand_derivatives,T)\n∂F∂T = eval(∂F∂T_expr)\nTs = randn(100)\ndFdT(Ts) = ∂F∂T.(Ts) # new function for testing broadcasting\n@code_warntype ∂F∂T(-0.5) # OK\n@code_warntype dFdT(Ts) # not OK```","user":"U01H36BUDJB","ts":"1616627172.206400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"U/I/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This should do it:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"F(T,θtot) = IfElse.ifelse(T<=0.0,θtot*exp(-(T/0.1)^2),θtot)\n@variables T\nθtot = 0.8\n∂F∂T_expr = build_function(∂T(F(T,θtot)) |> expand_derivatives,T)\n∂F∂T = eval(∂F∂T_expr)\nTs = randn(100)\ndFdT(Ts) = ∂F∂T.(Ts) # new function for testing broadcasting\n@code_warntype ∂F∂T(-0.5) # OK\n@code_warntype dFdT(Ts) # not OK"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"d1b6aeec-cb2a-4cfc-a710-f9228a314987","type":"message","text":"and I guess you need\n```using ModelingToolkit\nusing IfElse```","user":"U01H36BUDJB","ts":"1616627210.206600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"i5c","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and I guess you need\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using ModelingToolkit\nusing IfElse"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"d61da9e4-6a79-474a-823f-0afe2b1ed658","type":"message","text":"unrelated note, have you ever benchmarked `Symbolics.jl` generated derivatives vs `ForwardDiff` ? I would think that autodiff should theoretically be almost as fast.","user":"U01H36BUDJB","ts":"1616627391.206900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5DW2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"unrelated note, have you ever benchmarked "},{"type":"text","text":"Symbolics.jl","style":{"code":true}},{"type":"text","text":" generated derivatives vs "},{"type":"text","text":"ForwardDiff","style":{"code":true}},{"type":"text","text":" ? I would think that autodiff should theoretically be almost as fast."}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"b03e350b-af9c-4afe-8232-4e5de705ecea","type":"message","text":"it should be on dense but not sparse.","user":"U69BL50BF","ts":"1616627469.207100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cXYG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it should be on dense but not sparse."}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF","reactions":[{"name":"heavy_plus_sign","users":["U01H36BUDJB"],"count":1}]},{"client_msg_id":"31724bb9-029f-4ef0-990c-884ea1aadd8d","type":"message","text":"<@U6788D83U> how do you show all optimizations on `@code_warntype`? I think that's the issue here.","user":"U69BL50BF","ts":"1616627604.207400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CB0l","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U6788D83U"},{"type":"text","text":" how do you show all optimizations on "},{"type":"text","text":"@code_warntype","style":{"code":true}},{"type":"text","text":"? I think that's the issue here."}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"24806381-4430-4a63-88f7-48e4ca0b0784","type":"message","text":"Gotta use Cthulhu","user":"U6788D83U","ts":"1616627640.207600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NJx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Gotta use Cthulhu"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"b71853d9-8fc3-4c3d-a8d2-6470f32427d7","type":"message","text":"```ERROR: UndefVarError: ∂T not defined```\nCould you post a copy-paste-able example?","user":"U6788D83U","ts":"1616627758.207800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FVQW","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"ERROR: UndefVarError: ∂T not defined"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Could you post a copy-paste-able example?"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"57401342-4e53-42be-9221-98e8f92febe3","type":"message","text":"so just remove unicode chars?","user":"U01H36BUDJB","ts":"1616627808.208000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ROli","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so just remove unicode chars?"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"076b9a6b-e5c9-4dc4-98e0-929ef0394e91","type":"message","text":"```F(T,theta) = IfElse.ifelse(T&lt;=0.0,theta*exp(-(T/0.1)^2),theta)\n@variables T\ndT = Differential(T)\ntheta = 0.8\ndFdT_expr = build_function(dT(F(T,theta)) |&gt; expand_derivatives,T)\ndFdT1 = eval(dFdT_expr)\nTs = randn(100)\ndFdT2(Ts) = dFdT1.(Ts) # new function for testing broadcasting\n@code_warntype dFdT1(-0.5) # OK\n@code_warntype dFdT2(Ts) # not OK```","user":"U01H36BUDJB","ts":"1616627865.208200","team":"T68168MUP","edited":{"user":"U01H36BUDJB","ts":"1616628019.000000"},"blocks":[{"type":"rich_text","block_id":"e5uV","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"F(T,theta) = IfElse.ifelse(T<=0.0,theta*exp(-(T/0.1)^2),theta)\n@variables T\ndT = Differential(T)\ntheta = 0.8\ndFdT_expr = build_function(dT(F(T,theta)) |> expand_derivatives,T)\ndFdT1 = eval(dFdT_expr)\nTs = randn(100)\ndFdT2(Ts) = dFdT1.(Ts) # new function for testing broadcasting\n@code_warntype dFdT1(-0.5) # OK\n@code_warntype dFdT2(Ts) # not OK"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"6750c1b1-0434-421b-bc69-3917b4f8031a","type":"message","text":"`∂T` is not defined. I can copy-paste unicode.","user":"U6788D83U","ts":"1616627906.208500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XJ6GH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"∂T","style":{"code":true}},{"type":"text","text":" is not defined. I can copy-paste unicode."}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"f9f42e60-0cb0-4afa-b7df-55442595b60e","type":"message","text":"fixed, I think","user":"U01H36BUDJB","ts":"1616627920.208800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iodo=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"fixed, I think"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"b2a7e00e-e69f-4f2c-97a4-37a445073ab3","type":"message","text":"oof wait","user":"U01H36BUDJB","ts":"1616627934.209000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kyuS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oof wait"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"b8af4c54-2945-4e03-8e6e-ad67f778b1cd","type":"message","text":"oof","user":"U6788D83U","ts":"1616627937.209200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Q+d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oof"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"ab3efc1e-41fd-4231-86fe-9693f62086bd","type":"message","text":"try now","user":"U01H36BUDJB","ts":"1616627999.209500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4qB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"try now"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"4f2447a7-8157-46a5-a82e-0e1e38bb5539","type":"message","text":"I should really kill my REPL to test it haha","user":"U01H36BUDJB","ts":"1616628050.209800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GCMC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I should really kill my REPL to test it haha"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"541a39e3-fdf2-4db4-a3a1-44af04efb98c","type":"message","text":"Ah, of course it’s unstable. The `dFdT1` function a global variable","user":"U6788D83U","ts":"1616628117.210000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Q5C2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah, of course it’s unstable. The "},{"type":"text","text":"dFdT1","style":{"code":true}},{"type":"text","text":" function a global variable"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"31a55ff4-fde5-4a87-bb24-1731faa802cd","type":"message","text":"ahhh... I didn't think about that","user":"U01H36BUDJB","ts":"1616628149.210200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UM4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ahhh... I didn't think about that"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"3ec1ef95-d7dc-4a6f-9769-4d6a2e5a8225","type":"message","text":"not used to worrying about that with functions, but I guess here it's technically a variable?","user":"U01H36BUDJB","ts":"1616628166.210400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Jy5zN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"not used to worrying about that with functions, but I guess here it's technically a variable?"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"c431b19d-dfc6-4ae0-98dc-e5d9a3a5366e","type":"message","text":"```dFdT2_2 = let dFdT1=dFdT1; Ts -&gt; dFdT1.(Ts); end\n@code_warntype dFdT2_2(Ts) # OK```","user":"U6788D83U","ts":"1616628203.210600","team":"T68168MUP","edited":{"user":"U6788D83U","ts":"1616628209.000000"},"blocks":[{"type":"rich_text","block_id":"SlAj","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"dFdT2_2 = let dFdT1=dFdT1; Ts -> dFdT1.(Ts); end\n@code_warntype dFdT2_2(Ts) # OK"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF","reactions":[{"name":"raised_hands","users":["U01H36BUDJB"],"count":1}]},{"client_msg_id":"c9fd012e-dbfb-464a-8fa1-20f9ee750643","type":"message","text":"Or, you can make the function variable a const.","user":"U6788D83U","ts":"1616628266.210900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zp73","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Or, you can make the function variable a const."}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"bdeb7239-f54d-436d-9dc7-7f21de4e1be0","type":"message","text":"thanks!","user":"U01H36BUDJB","ts":"1616628292.211200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gll","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks!"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"},{"client_msg_id":"739b8545-f87d-41bd-b6b4-845b15016a21","type":"message","text":"No problem","user":"U6788D83U","ts":"1616628302.211400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xd902","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"No problem"}]}]}],"thread_ts":"1616619667.205100","parent_user_id":"U69BL50BF"}]