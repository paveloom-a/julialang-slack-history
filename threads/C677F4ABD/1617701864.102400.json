[{"client_msg_id":"72e23714-6a4b-4c65-9a03-b3e8aac076c9","type":"message","text":"I just learned a very valuable lesson about sparse arrays.. I hadn't realized that operating on `view(A, i, j)`  might be a bad idea and also `A(i,j)`  is quite expensive as it extracts a sparse matrix, having to recompute the CSC representation for the new indices... I get huge performance improvements if I just do `Matrix(view(A,i,j))`  when extracting the submatrix. It is super-important to avoid the intermediate step of computing a submatrix in sparse format by using the view. (Just wanted to share this as this was not obvious to me :grin:)","user":"U01L0RJC6FM","ts":"1617701864.102400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kYaLa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I just learned a very valuable lesson about sparse arrays.. I hadn't realized that operating on"},{"type":"text","text":" view(A, i, j)","style":{"code":true}},{"type":"text","text":"  might be a bad idea and also "},{"type":"text","text":"A(i,j)","style":{"code":true}},{"type":"text","text":"  is quite expensive as it extracts a sparse matrix, having to recompute the CSC representation for the new indices... I get huge performance improvements if I just do "},{"type":"text","text":"Matrix(view(A,i,j))","style":{"code":true}},{"type":"text","text":"  when extracting the submatrix. It is super-important to avoid the intermediate step of computing a submatrix in sparse format by using the view. (Just wanted to share this as this was not obvious to me "},{"type":"emoji","name":"grin"},{"type":"text","text":")"}]}]}],"thread_ts":"1617701864.102400","reply_count":10,"reply_users_count":3,"latest_reply":"1617734772.115000","reply_users":["U6A936746","U01L0RJC6FM","U67G3QRJM"],"is_locked":false,"subscribed":false},{"client_msg_id":"3ca4d8f7-b4e7-4105-bf9a-d604fbdfc673","type":"message","text":"A sparse matrix has to be really sparse before it starts to be faster than a dense matrix.\nI think it might be more common than one actually being sparse enough to be fast to just be too large to fit in memory to do dense.","user":"U6A936746","ts":"1617705894.102500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FiRF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"A sparse matrix has to be really sparse before it starts to be faster than a dense matrix.\nI think it might be more common than one actually being sparse enough to be fast to just be too large to fit in memory to do dense."}]}]}],"thread_ts":"1617701864.102400","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"fa2097f9-2a57-4011-9c55-83c5ef873b14","type":"message","text":"what I do not understand is that I do indeed have very sparse matrices, yet I get very sluggish performance","user":"U01L0RJC6FM","ts":"1617725075.112600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QJo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what I do not understand is that I do indeed have very sparse matrices, yet I get very sluggish performance"}]}]}],"thread_ts":"1617701864.102400","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"f8b770b5-9671-42bf-ba5e-e8900a54faf0","type":"message","text":"I have 21x69 matrices with 8 entries for instance.. this should be more than spare enough","user":"U01L0RJC6FM","ts":"1617725101.112800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"W1OQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have 21x69 matrices with 8 entries for instance.. this should be more than spare enough"}]}]}],"thread_ts":"1617701864.102400","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"7b0a46c5-1780-4320-b2a7-cc76d1ec0fca","type":"message","text":"I don’t think there’s any point in using sparse matrices for tiny matrices like that","user":"U67G3QRJM","ts":"1617725711.113000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hf5Lk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don’t think there’s any point in using sparse matrices for tiny matrices like that"}]}]}],"thread_ts":"1617701864.102400","parent_user_id":"U01L0RJC6FM","reactions":[{"name":"point_up","users":["U6A936746"],"count":1}]},{"client_msg_id":"054e34f3-2483-4e04-aa0f-f7a197903b59","type":"message","text":"I was actually surprised in how much slower that is..","user":"U01L0RJC6FM","ts":"1617725918.113200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b3sH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I was actually surprised in how much slower that is.."}]}]}],"thread_ts":"1617701864.102400","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"d356f7ac-1fb6-47f0-80a7-cd3e3c3729c9","type":"message","text":"but I guess it has to do with the CSC format","user":"U01L0RJC6FM","ts":"1617725950.113400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"w3xb9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but I guess it has to do with the CSC format"}]}]}],"thread_ts":"1617701864.102400","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"362c7956-dc38-4409-90f2-530dccdedd28","type":"message","text":"is there an experience value, where it starts to make sense?","user":"U01L0RJC6FM","ts":"1617725968.113600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ra9J","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is there an experience value, where it starts to make sense?"}]}]}],"thread_ts":"1617701864.102400","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"1ac73d44-0b62-4cd7-b8c1-ba96ead75293","type":"message","text":"```debug&gt; @time A[int1, bnd2]\n  0.000208 seconds (11 allocations: 3.002 MiB)\n21×69 SparseMatrixCSC{Float64, Int64} with 8 stored entries:\n⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n⠙⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n\ndebug&gt; @time Matrix(view(A, int1, bnd2))\n  0.000023 seconds (1 allocation: 11.500 KiB)\n21×69 Matrix{Float64}:```","user":"U01L0RJC6FM","ts":"1617725980.113800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Dc6","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"debug> @time A[int1, bnd2]\n  0.000208 seconds (11 allocations: 3.002 MiB)\n21×69 SparseMatrixCSC{Float64, Int64} with 8 stored entries:\n⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n⠙⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀\n\ndebug> @time Matrix(view(A, int1, bnd2))\n  0.000023 seconds (1 allocation: 11.500 KiB)\n21×69 Matrix{Float64}:"}]}]}],"thread_ts":"1617701864.102400","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"16b0606f-b9a5-4d75-b421-0bebb721e469","type":"message","text":"(my original matrix has millions of degrees of freedom)","user":"U01L0RJC6FM","ts":"1617726083.114000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tvMm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(my original matrix has millions of degrees of freedom)"}]}]}],"thread_ts":"1617701864.102400","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"451ab3f3-affc-4474-8806-5b2122fb7895","type":"message","text":"Use BenchmarkTools.jl for micro-benchmarks like this","user":"U67G3QRJM","ts":"1617734772.115000","team":"T68168MUP","edited":{"user":"U67G3QRJM","ts":"1617734790.000000"},"blocks":[{"type":"rich_text","block_id":"P46","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Use BenchmarkTools.jl for micro-benchmarks like this"}]}]}],"thread_ts":"1617701864.102400","parent_user_id":"U01L0RJC6FM"}]