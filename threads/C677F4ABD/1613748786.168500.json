[{"client_msg_id":"8329fcd7-80ed-47cb-bab8-3147d8504e33","type":"message","text":"I have a 2x2 * 2x1 block system, lets call it A * b, created with BlockArrays.jl. What is the recommended way of solving such systems? Even tho `A` holds SparseMatrixCSC blocks a dense solver is called if I `A \\ b`. Is this intended behavior?","user":"UUS6GL8BH","ts":"1613748786.168500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/Wn2a","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have a 2x2 * 2x1 block system, lets call it A * b, created with BlockArrays.jl. What is the recommended way of solving such systems? Even tho "},{"type":"text","text":"A","style":{"code":true}},{"type":"text","text":" holds SparseMatrixCSC blocks a dense solver is called if I "},{"type":"text","text":"A \\ b","style":{"code":true}},{"type":"text","text":". Is this intended behavior?"}]}]}],"thread_ts":"1613748786.168500","reply_count":8,"reply_users_count":2,"latest_reply":"1613774132.170400","reply_users":["UPNRULT51","UUS6GL8BH"],"subscribed":false},{"client_msg_id":"bf099bc3-f3d5-4726-81e6-623dad863705","type":"message","text":"I've never used BlockArrays.jl, so I have no idea what's in there. But if you want to roll something on your own, the Schur Complement can be really useful. (It might be perfect for your use case or totally useless. :grin:) <https://en.wikipedia.org/wiki/Schur_complement>","user":"UPNRULT51","ts":"1613750931.168600","team":"T68168MUP","attachments":[{"title":"Schur complement","title_link":"https://en.wikipedia.org/wiki/Schur_complement","from_url":"https://en.wikipedia.org/wiki/Schur_complement","author_name":"Wikipedia","author_link":"https://en.wikipedia.org/","text":"In linear algebra and the theory of matrices, the Schur complement of a block matrix is defined as follows.\nSuppose p, q are nonnegative integers, and suppose A, B, C, D are respectively p × p, p × q, q × p, and q × q matrices of complex numbers. Let\n\n  \n    \n      \n        M\n        =\n        \n          [\n          \n            \n              \n                \n                  A\n                \n                \n                  B\n                \n              \n              \n                \n                  C\n                \n                \n                  D\n                \n              \n            \n          \n          ]\n        \n      \n    \n    {\\displaystyle M=\\left[{\\begin{matrix}A&amp;B\\\\C&amp;D\\end{matrix}}\\right]}\n  so that M is a (p + q) × (p + q) matrix.\nIf D is invertible, then the Schur complement of the block D of the matrix M is the p × p matrix defined by\n\n  \n    \n      \n        M\n        \n          /\n        \n        D\n        :=\n        A\n        −\n        B\n        \n          D\n          \n            −\n            1\n          \n        \n        C\n        .\n      \n    \n    {\\displaystyle M/D:=A-BD^{-1}C.}\n  If A is invertible, the Schur complement of the block A of the matrix M is the q × q matrix defined by\n\n  \n    \n      \n        M\n        \n          /\n        \n        A\n        :=\n        D\n        −\n        C\n        \n          A\n          \n            −\n            1\n          \n        \n        B\n        .\n      \n    \n    {\\displaystyle M/A:=D-CA^{-1}B.}\n  In the case that A or D is singular, substituting a generalized inverse for the inverses on M/A and M/D yields the generalized Schur complement.\nThe Schur complement is named after Issai Schur who used it to prove Schur's lemma, although it had been used previously.  Emilie Virginia Haynsworth was the first to call it the Schur complement. The Schur complement is a key tool in the fields of numerical analysis, statistics, and matrix analysis.","fallback":"wikipedia: Schur complement","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/wikipedia.png","id":1,"original_url":"https://en.wikipedia.org/wiki/Schur_complement"}],"blocks":[{"type":"rich_text","block_id":"sq6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I've never used BlockArrays.jl, so I have no idea what's in there. But if you want to roll something on your own, the Schur Complement can be really useful. (It might be perfect for your use case or totally useless. "},{"type":"emoji","name":"grin"},{"type":"text","text":") "},{"type":"link","url":"https://en.wikipedia.org/wiki/Schur_complement"}]}]}],"thread_ts":"1613748786.168500","parent_user_id":"UUS6GL8BH"},{"client_msg_id":"572b4b27-2ad7-4ae1-9bcb-0420c8201a94","type":"message","text":"it is indeed very useful for this particular case, but I'd still appreciate some hints how to do it in a recommended way without additional allocs","user":"UUS6GL8BH","ts":"1613750993.168900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5vA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it is indeed very useful for this particular case, but I'd still appreciate some hints how to do it in a recommended way without additional allocs"}]}]}],"thread_ts":"1613748786.168500","parent_user_id":"UUS6GL8BH"},{"client_msg_id":"8cd10c97-56f8-4e6e-b237-5ca72aee4099","type":"message","text":"What sizes are your matrices roughly? Is it for one problem or do you need to solve it repeatedly with e.g. different `b`.","user":"UPNRULT51","ts":"1613755428.169200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RMlT2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What sizes are your matrices roughly? Is it for one problem or do you need to solve it repeatedly with e.g. different `b`."}]}]}],"thread_ts":"1613748786.168500","parent_user_id":"UUS6GL8BH"},{"client_msg_id":"d7a3d475-097f-4bab-9c74-c950c39f6304","type":"message","text":"The upper left block is four times the same, the offdiagonal holds a matrix that changes 4 times, the bottom right is always a zero block and `b` changes all 4 times. In a reference paper the Schur complement is recommended to use. But I mostly have a conceptual problem how to extract and invert the parts properly, because I wouldn't expect that `A \\ b` uses a dense solver if the blocks are sparse","user":"UUS6GL8BH","ts":"1613755739.169400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9DGU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The upper left block is four times the same, the offdiagonal holds a matrix that changes 4 times, the bottom right is always a zero block and "},{"type":"text","text":"b","style":{"code":true}},{"type":"text","text":" changes all 4 times. In a reference paper the Schur complement is recommended to use. But I mostly have a conceptual problem how to extract and invert the parts properly, because I wouldn't expect that "},{"type":"text","text":"A \\ b","style":{"code":true}},{"type":"text","text":" uses a dense solver if the blocks are sparse"}]}]}],"thread_ts":"1613748786.168500","parent_user_id":"UUS6GL8BH"},{"client_msg_id":"f2b0887b-cd14-4bbc-bf0f-6f817f8cf080","type":"message","text":"I obviously could do `A[Blockindex(something)]` but I'm not sure if this allocates or is suboptimal. This part of the code is somewhat performance critical","user":"UUS6GL8BH","ts":"1613756187.169600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CTM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I obviously could do "},{"type":"text","text":"A[Blockindex(something)]","style":{"code":true}},{"type":"text","text":" but I'm not sure if this allocates or is suboptimal. This part of the code is somewhat performance critical"}]}]}],"thread_ts":"1613748786.168500","parent_user_id":"UUS6GL8BH"},{"client_msg_id":"4018c4b2-3874-4d13-af4d-19b614b572ea","type":"message","text":"If `A` is a `BlockMatrix` with those 4 blocks you want, using `getblock(i,j)` returns a block without allocating.\nI'd look into computing a factorization for the top left block (since it can be reused). Furthermore, you should be able to simplify things by knowing that the bottom right block is zero. I doesn't seem like BlockArrays.jl will do any of the work needed for `A\\b` to be performant, you'll need to write specialized code to handle it.","user":"UPNRULT51","ts":"1613768820.169900","team":"T68168MUP","edited":{"user":"UPNRULT51","ts":"1613768846.000000"},"blocks":[{"type":"rich_text","block_id":"mwr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If "},{"type":"text","text":"A","style":{"code":true}},{"type":"text","text":" is a "},{"type":"text","text":"BlockMatrix","style":{"code":true}},{"type":"text","text":" with those 4 blocks you want, using "},{"type":"text","text":"getblock(i,j)","style":{"code":true}},{"type":"text","text":" returns a block without allocating.\nI'd look into computing a factorization for the top left block (since it can be reused). Furthermore, you should be able to simplify things by knowing that the bottom right block is zero. I doesn't seem like BlockArrays.jl will do any of the work needed for "},{"type":"text","text":"A\\b","style":{"code":true}},{"type":"text","text":" to be performant, you'll need to write specialized code to handle it."}]}]}],"thread_ts":"1613748786.168500","parent_user_id":"UUS6GL8BH"},{"client_msg_id":"f706d4d2-cf97-43eb-96b7-88646b5cf203","type":"message","text":"I just get rid of BlockMatrices and use the Schur complement :slightly_smiling_face: works well so far","user":"UUS6GL8BH","ts":"1613774124.170200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TyVh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I just get rid of BlockMatrices and use the Schur complement "},{"type":"emoji","name":"slightly_smiling_face"},{"type":"text","text":" works well so far"}]}]}],"thread_ts":"1613748786.168500","parent_user_id":"UUS6GL8BH"},{"client_msg_id":"98f77ad1-fa09-4493-8701-8ed7f80bd43c","type":"message","text":"thanks for your time and your help :slightly_smiling_face:","user":"UUS6GL8BH","ts":"1613774132.170400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cHeZA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks for your time and your help "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1613748786.168500","parent_user_id":"UUS6GL8BH"}]