[{"client_msg_id":"05b7f8a3-2daa-430c-9b6a-6891c223e73f","type":"message","text":"You can’t really overload serialization for bitstypes.\n<https://github.com/JuliaLang/julia/blob/4996445df37e526dac2772e333caf82f1ea987f0/stdlib/Serialization/src/Serialization.jl#L272>","user":"U6A936746","ts":"1617988623.304600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MkzNH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You can’t really overload serialization for bitstypes.\n"},{"type":"link","url":"https://github.com/JuliaLang/julia/blob/4996445df37e526dac2772e333caf82f1ea987f0/stdlib/Serialization/src/Serialization.jl#L272"}]}]}],"thread_ts":"1617988623.304600","reply_count":22,"reply_users_count":3,"latest_reply":"1617993097.310100","reply_users":["UH24GRBLL","U6A936746","U687RKK0E"],"is_locked":false,"subscribed":false},{"client_msg_id":"acb300c0-83e4-4f96-87b7-5ff31a065c59","type":"message","text":"eh?","user":"UH24GRBLL","ts":"1617988949.304700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Rr+6r","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"eh?"}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"9128ee25-65ca-4df9-8333-0670cf51098a","type":"message","text":"for non-Bool, that just ends up calling `write(s, a)`, with `a` being an array","user":"UH24GRBLL","ts":"1617988987.304900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BT+w","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"for non-Bool, that just ends up calling "},{"type":"text","text":"write(s, a)","style":{"code":true}},{"type":"text","text":", with "},{"type":"text","text":"a","style":{"code":true}},{"type":"text","text":" being an array"}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"0a5cf967-f23a-4403-975f-e516926ac853","type":"message","text":"Correct.\nWhich does *not* ever call `serialize(s::AbstractSerializer, ::MyType)`\nfor an `Array{MyType}`","user":"U6A936746","ts":"1617989058.305100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2FnhZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Correct.\nWhich does "},{"type":"text","text":"not","style":{"bold":true}},{"type":"text","text":" ever call "},{"type":"text","text":"serialize(s::AbstractSerializer, ::MyType)","style":{"code":true}},{"type":"text","text":"\nfor an "},{"type":"text","text":"Array{MyType}","style":{"code":true}}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"738fbe75-5c18-4e08-95ab-06d6843a73c3","type":"message","text":"I see","user":"UH24GRBLL","ts":"1617989136.305300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"arkyQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I see"}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"ca86a9c1-2eb0-434e-bf81-7baca00aceab","type":"message","text":"that should be fixable though","user":"UH24GRBLL","ts":"1617989164.305500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Bpn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that should be fixable though"}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"d16f4376-8f4f-46f4-aedf-5224f696b2a8","type":"message","text":"Julia is Turing Complete, so yes.","user":"U6A936746","ts":"1617989186.305700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cxJR/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Julia is Turing Complete, so yes."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746","reactions":[{"name":"laughing","users":["U687RKK0E"],"count":1}]},{"client_msg_id":"8ac6afd6-8ff1-46e1-92c3-62de09297531","type":"message","text":"you know what I mean...","user":"UH24GRBLL","ts":"1617989308.305900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SjI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you know what I mean..."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"4aa1fa30-21c5-4be9-8b5e-a8765dc9b18c","type":"message","text":"idk, <@U687RKK0E> said he has a good reason for it being the way it was, when this came up in triage a while back.","user":"U6A936746","ts":"1617989727.306100","team":"T68168MUP","edited":{"user":"U6A936746","ts":"1617989738.000000"},"blocks":[{"type":"rich_text","block_id":"xnb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"idk, "},{"type":"user","user_id":"U687RKK0E"},{"type":"text","text":" said he has a good reason for it being the way it was, when this came up in triage a while back."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"4c1fa4ad-e61b-4297-a886-e0e2bce5b3ad","type":"message","text":"Performance.","user":"U687RKK0E","ts":"1617990387.306500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7c=lJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Performance."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746","reactions":[{"name":"sonic","users":["U6A936746","U6795JH6H"],"count":2}]},{"client_msg_id":"8c0f8a00-fb9f-48e5-b84d-2c5c0c2ab29e","type":"message","text":"We would have to do some trick like checking whether a custom method exists, or a trait.","user":"U687RKK0E","ts":"1617990416.306700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HN+9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We would have to do some trick like checking whether a custom method exists, or a trait."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"4cd6ad78-1b1b-4148-973f-a7a53bd68324","type":"message","text":"I am also not entirely sure one should be able to overwrite this.\nIt often feels like the wrong solution to the problem (including in my TimeZone case)\n\nOTOH, stuff like run-length encoding for `Vector{Bool}` indicates that there is a legit use case.","user":"U6A936746","ts":"1617990878.307000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KccTI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I am also not entirely sure one should be able to overwrite this.\nIt often feels like the wrong solution to the problem (including in my TimeZone case)\n\nOTOH, stuff like run-length encoding for "},{"type":"text","text":"Vector{Bool}","style":{"code":true}},{"type":"text","text":" indicates that there is a legit use case."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"f6e47b92-fa11-477f-8ffb-204665d330ec","type":"message","text":"That could also be interpreted as an example on the other side: overloading Vector{Bool} is not the same as overloading Bool, and the fact that we don't have to call `serialize` for each Bool is what makes the compression possible.","user":"U687RKK0E","ts":"1617990993.307200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PsL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That could also be interpreted as an example on the other side: overloading Vector{Bool} is not the same as overloading Bool, and the fact that we don't have to call "},{"type":"text","text":"serialize","style":{"code":true}},{"type":"text","text":" for each Bool is what makes the compression possible."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746","reactions":[{"name":"+1","users":["U6A936746"],"count":1}]},{"client_msg_id":"542faaa2-10b6-4809-83ef-0107f4743215","type":"message","text":"but if i wanted to do the same thing for a StaticArray of Bools i couldn’t\nSince it wouldn’t work inside a Vector\n\n(.i.e. serializing a Vector of StaticArrays of Bools)","user":"U6A936746","ts":"1617991369.307400","team":"T68168MUP","edited":{"user":"U6A936746","ts":"1617991409.000000"},"blocks":[{"type":"rich_text","block_id":"5y2lK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but if i wanted to do the same thing for a StaticArray of Bools i couldn’t\nSince it wouldn’t work inside a Vector\n\n(.i.e. serializing a Vector of StaticArrays of Bools)"}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"a12664d0-a151-43b1-a5ad-ce63d6c48287","type":"message","text":"or if i wanted to do some run length encoding of a some kind of categorical array?","user":"U6A936746","ts":"1617991470.307700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5Ea8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"or if i wanted to do some run length encoding of a some kind of categorical array?"}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"1133b942-8327-4482-94ef-4fe4a90a246e","type":"message","text":"couldn't you overload `serialize(::SVector{Bool})`?","user":"UH24GRBLL","ts":"1617992669.308400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dNV1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"couldn't you overload "},{"type":"text","text":"serialize(::SVector{Bool})","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"59aa343b-1f3c-4c33-8b3e-ffd9676d5d38","type":"message","text":"But then `Vector{SVector{Bool}}` wouldn’t hit it.","user":"U6A936746","ts":"1617992807.308900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YQG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But then "},{"type":"text","text":"Vector{SVector{Bool}}","style":{"code":true}},{"type":"text","text":" wouldn’t hit it."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"873a861e-df30-4ba1-9809-db16ccfb29ab","type":"message","text":"Right, fair point.","user":"U687RKK0E","ts":"1617992868.309100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sZo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Right, fair point."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"dd61fc92-7bf3-4001-a862-07f38ec7bf23","type":"message","text":"In truth compression is probably not a good example either, since it should be done at a lower level of abstraction --- i.e. apply it to a whole byte buffer after serializing everything, before writing out to disk.","user":"U687RKK0E","ts":"1617992962.309300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WDs6C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"In truth compression is probably not a good example either, since it should be done at a lower level of abstraction --- i.e. apply it to a whole byte buffer after serializing everything, before writing out to disk."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"730bcc7c-8d6a-49ae-a99d-6d85dfc31177","type":"message","text":"But I think everyone probably agrees that it would be better to allow overloading serialize for everything *if* there were no performance cost.","user":"U687RKK0E","ts":"1617993002.309500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"luYYH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But I think everyone probably agrees that it would be better to allow overloading serialize for everything "},{"type":"text","text":"if","style":{"bold":true}},{"type":"text","text":" there were no performance cost."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"d2fb7c6a-9e05-4be8-9461-fb10053affc9","type":"message","text":"where does the performance cost come from here?","user":"UH24GRBLL","ts":"1617993048.309700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"T7a","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"where does the performance cost come from here?"}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"},{"client_msg_id":"1560f864-96ea-403a-99af-db7605973273","type":"message","text":"We have to recursively call serialize in a loop for every array element. We can't currently optimize that into a single block write operation.","user":"U687RKK0E","ts":"1617993090.309900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2bMPB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"We have to recursively call serialize in a loop for every array element. We can't currently optimize that into a single block write operation."}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746","reactions":[{"name":"+1","users":["U6A936746"],"count":1}]},{"client_msg_id":"daf65b1c-2265-4ed0-95ed-90eee3253e31","type":"message","text":"fair re: compression.\nWhich is exactly what JLSO does, compress before putting on disk.\n( and in theory for networked apparently the modern way to do that is with a compressing VPN)\n\nPossibly the special case for bool run length encoding should be removed at some point (to take a principled stance)","user":"U6A936746","ts":"1617993097.310100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iIM/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"fair re: compression.\nWhich is exactly what JLSO does, compress before putting on disk.\n( and in theory for networked apparently the modern way to do that is with a compressing VPN)\n\nPossibly the special case for bool run length encoding should be removed at some point (to take a principled stance)"}]}]}],"thread_ts":"1617988623.304600","parent_user_id":"U6A936746"}]