[{"client_msg_id":"d2d1a054-942b-4aec-9a7c-d29d9f29477a","type":"message","text":"hey guys, i’ve got a problem. i defined a method over an abstract type that calls a method implemented on its concrete types.\n```module QCMPS\nabstract type MPS end\n\nstruct LocalMPS{F &lt;: AbstractFloat} &lt;: MPS\n    A::Vector{MPT{F}} # MPT is another struct, irrelevant here\nend\n\napply!(psi::LocalMPS, H::Array{N,2}, target::Integer) where N &lt;: Number = ...\n\napply_all!(psi::MPS, H::Array{N,2}) where N &lt;: Number = foreach((i, x) -&gt; apply!(x, H, i), enumerate(psi.A))\nend```\ncalling `apply!` is alright but when calling `apply_all!` , i receive a `MethodError: no method matching (::QCMPS.var\"#3#4\"{Array{Int64,2}})(::Tuple{Int64,QCMPS.MPT{Float32}})` because it is trying to call `apply_all!(::LocalMPS{Float32}, ::Array{Int64,2})` , which is not defined. any suggestion?","user":"UGMLP4VB6","ts":"1611917829.082400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2bYXJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hey guys, i’ve got a problem. i defined a method over an abstract type that calls a method implemented on its concrete types.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"module QCMPS\nabstract type MPS end\n\nstruct LocalMPS{F <: AbstractFloat} <: MPS\n    A::Vector{MPT{F}} # MPT is another struct, irrelevant here\nend\n\napply!(psi::LocalMPS, H::Array{N,2}, target::Integer) where N <: Number = ...\n\napply_all!(psi::MPS, H::Array{N,2}) where N <: Number = foreach((i, x) -> apply!(x, H, i), enumerate(psi.A))\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"calling "},{"type":"text","text":"apply!","style":{"code":true}},{"type":"text","text":" is alright but when calling "},{"type":"text","text":"apply_all!","style":{"code":true}},{"type":"text","text":" , i receive a "},{"type":"text","text":"MethodError: no method matching (::QCMPS.var\"#3#4\"{Array{Int64,2}})(::Tuple{Int64,QCMPS.MPT{Float32}})","style":{"code":true}},{"type":"text","text":" because it is trying to call "},{"type":"text","text":"apply_all!(::LocalMPS{Float32}, ::Array{Int64,2})","style":{"code":true}},{"type":"text","text":" , which is not defined. any suggestion?"}]}]}],"thread_ts":"1611917829.082400","reply_count":25,"reply_users_count":2,"latest_reply":"1611921735.088900","reply_users":["UH24GRBLL","UGMLP4VB6"],"subscribed":false},{"client_msg_id":"39db58a3-9ce9-452f-a2bb-a3154d40bb64","type":"message","text":"do you have a full stacktrace?","user":"UH24GRBLL","ts":"1611920297.083800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qj1L","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"do you have a full stacktrace?"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"343e468b-3aa3-4fc0-9fbd-195db8e62fc6","type":"message","text":"the MethodError doesn't say anything about `apply_all!`","user":"UH24GRBLL","ts":"1611920316.084000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Y=ES","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the MethodError doesn't say anything about "},{"type":"text","text":"apply_all!","style":{"code":true}}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"eb966492-e380-4840-954d-68dc3f261aac","type":"message","text":"it's the destructuring in `(i,x) -&gt; ...`","user":"UH24GRBLL","ts":"1611920387.084200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KUi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it's the destructuring in "},{"type":"text","text":"(i,x) -> ...","style":{"code":true}}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"ccdc7044-78f7-480b-9c92-c8fc4dd6ab5a","type":"message","text":"try `((i,x)) -&gt; ...`","user":"UH24GRBLL","ts":"1611920397.084400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sMD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"try "},{"type":"text","text":"((i,x)) -> ...","style":{"code":true}}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"b9dea6dc-28f9-4dda-8a1b-f82815a74ce2","type":"message","text":"the former is defining a two argument anonymous function, while only a single tuple is passed in","user":"UH24GRBLL","ts":"1611920442.084600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tGcM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the former is defining a two argument anonymous function, while only a single tuple is passed in"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"4ce1c1d2-7cb9-43f3-aa8a-b034d0428dcd","type":"message","text":"the latter defines a one-argument function taking in a single tuple of 2 values, and destructures them","user":"UH24GRBLL","ts":"1611920461.084800","team":"T68168MUP","edited":{"user":"UH24GRBLL","ts":"1611920473.000000"},"blocks":[{"type":"rich_text","block_id":"IOwY6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the latter defines a one-argument function taking in a single tuple of 2 values, and destructures them"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"29be8591-f15b-4e69-b778-6ab21c9cd5f2","type":"message","text":"`enumerate` always returns a single tuple, so that's why you need the one-argument function","user":"UH24GRBLL","ts":"1611920504.085100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sI9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"enumerate","style":{"code":true}},{"type":"text","text":" always returns a single tuple, so that's why you need the one-argument function"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"f10af053-6413-4282-9b11-4d8dccb38b6e","type":"message","text":"i tried with `((i,x)) -&gt; …` but still the same error:\n```ERROR: MethodError: no method matching (::QCMPS.var\"#3#4\"{Array{Float64,2}})(::Tuple{Int64,QCMPS.MPT{Float32}})\nClosest candidates are:\n  #3(::Any, ::Any) at /Users/mofeing/Develop/QCMPS/src/MPS.jl:13\nStacktrace:\n [1] foreach(::QCMPS.var\"#3#4\"{Array{Float64,2}}, ::Base.Iterators.Enumerate{Array{QCMPS.MPT{Float32},1}}) at ./abstractarray.jl:2009\n [2] apply_all!(::LocalMPS{Float32}, ::Array{Float64,2}) at /Users/mofeing/Develop/QCMPS/src/MPS.jl:13\n [3] top-level scope at REPL[5]:1```","user":"UGMLP4VB6","ts":"1611920842.085400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SG4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"i tried with "},{"type":"text","text":"((i,x)) -> …","style":{"code":true}},{"type":"text","text":" but still the same error:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"ERROR: MethodError: no method matching (::QCMPS.var\"#3#4\"{Array{Float64,2}})(::Tuple{Int64,QCMPS.MPT{Float32}})\nClosest candidates are:\n  #3(::Any, ::Any) at /Users/mofeing/Develop/QCMPS/src/MPS.jl:13\nStacktrace:\n [1] foreach(::QCMPS.var\"#3#4\"{Array{Float64,2}}, ::Base.Iterators.Enumerate{Array{QCMPS.MPT{Float32},1}}) at ./abstractarray.jl:2009\n [2] apply_all!(::LocalMPS{Float32}, ::Array{Float64,2}) at /Users/mofeing/Develop/QCMPS/src/MPS.jl:13\n [3] top-level scope at REPL[5]:1"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"9cb96d8b-21ec-4d99-9eb5-89d781d73e03","type":"message","text":"`(x) -&gt; apply!(x[2], H, x[1])`?","user":"UH24GRBLL","ts":"1611920954.085600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0y1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(x) -> apply!(x[2], H, x[1])","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"87051c7f-5d46-444e-9af0-793eb247b0c3","type":"message","text":"from some testing, `((i,x)::Tuple) -&gt; ...` should also work","user":"UH24GRBLL","ts":"1611921073.085800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"L84f","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"from some testing, "},{"type":"text","text":"((i,x)::Tuple) -> ...","style":{"code":true}},{"type":"text","text":" should also work"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"2964496b-56fb-46c8-9543-b9d98a3a7e15","type":"message","text":"FYI, it's a known inconsistency <https://github.com/JuliaLang/julia/issues/36595>","user":"UH24GRBLL","ts":"1611921174.086000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"D4fy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"FYI, it's a known inconsistency "},{"type":"link","url":"https://github.com/JuliaLang/julia/issues/36595"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"2f18ab91-2858-4596-a2c5-8ee1d4544889","type":"message","text":"there's also `((i,x),) -&gt; ...` (note the trailing `,`!)","user":"UH24GRBLL","ts":"1611921199.086200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2u7Dt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"there's also "},{"type":"text","text":"((i,x),) -> ...","style":{"code":true}},{"type":"text","text":" (note the trailing "},{"type":"text","text":",","style":{"code":true}},{"type":"text","text":"!)"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"84e75357-b2c0-43e9-99b3-4885dbc39996","type":"message","text":"mmm the first one does not work because psi.A is an array and `x[1]` and `x[2]` are taking the elements from that array","user":"UGMLP4VB6","ts":"1611921204.086400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XhEn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"mmm the first one does not work because psi.A is an array and "},{"type":"text","text":"x[1]","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"x[2]","style":{"code":true}},{"type":"text","text":" are taking the elements from that array"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"f5dcf4a5-6b79-4979-aeab-d282ffe77642","type":"message","text":"`x[1]` == `psi.A[1]`","user":"UGMLP4VB6","ts":"1611921239.086600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YLXw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"x[1]","style":{"code":true}},{"type":"text","text":" == "},{"type":"text","text":"psi.A[1]","style":{"code":true}}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"98953d3d-b468-4ab8-832f-4d8b82624904","type":"message","text":"no, if it's passed the result of `enumerate` it'll be the first element of the tuple","user":"UH24GRBLL","ts":"1611921250.086800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2iG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"no, if it's passed the result of "},{"type":"text","text":"enumerate","style":{"code":true}},{"type":"text","text":" it'll be the first element of the tuple"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"f4cf33e8-caf8-4a79-b561-6af34f0880dd","type":"message","text":"```julia&gt; foreach(x -&gt; println(x[1], '-', x[2]), enumerate([[i] for i in 1:10]))\n1-[1]\n2-[2]\n3-[3]\n4-[4]\n5-[5]\n6-[6]\n7-[7]\n8-[8]\n9-[9]\n10-[10]```","user":"UH24GRBLL","ts":"1611921287.087000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Gvtdu","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> foreach(x -> println(x[1], '-', x[2]), enumerate([[i] for i in 1:10]))\n1-[1]\n2-[2]\n3-[3]\n4-[4]\n5-[5]\n6-[6]\n7-[7]\n8-[8]\n9-[9]\n10-[10]"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"39bcd623-a2b8-4c31-8db5-5772277913ac","type":"message","text":"```julia&gt; enumerate([[i] for i in 1:10]) |&gt; collect\n10-element Vector{Tuple{Int64, Vector{Int64}}}:\n (1, [1])\n (2, [2])\n (3, [3])\n (4, [4])\n (5, [5])\n (6, [6])\n (7, [7])\n (8, [8])\n (9, [9])\n (10, [10])```","user":"UH24GRBLL","ts":"1611921399.087200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PgeYl","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> enumerate([[i] for i in 1:10]) |> collect\n10-element Vector{Tuple{Int64, Vector{Int64}}}:\n (1, [1])\n (2, [2])\n (3, [3])\n (4, [4])\n (5, [5])\n (6, [6])\n (7, [7])\n (8, [8])\n (9, [9])\n (10, [10])"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"40071950-999e-434e-9fd8-b08223588934","type":"message","text":"this is what is iterated over in the `foreach` - it is _not_ destructured automatically unless you do `((i,x),) -&gt; ...` or `((i,x)::Tuple) -&gt; ...`","user":"UH24GRBLL","ts":"1611921436.087400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rHs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"this is what is iterated over in the "},{"type":"text","text":"foreach","style":{"code":true}},{"type":"text","text":" - it is "},{"type":"text","text":"not","style":{"italic":true}},{"type":"text","text":" destructured automatically unless you do "},{"type":"text","text":"((i,x),) -> ...","style":{"code":true}},{"type":"text","text":" or "},{"type":"text","text":"((i,x)::Tuple) -> ...","style":{"code":true}}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"0f9cfacf-cc2b-4fdc-8e4d-a8d42e1c7e8a","type":"message","text":"okay yes, if i do `for_each(((i,x)::Tuple) -&gt; println(i), enumerate(psi.A))` things are passed correctly","user":"UGMLP4VB6","ts":"1611921470.087600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"d9X","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"okay yes, if i do "},{"type":"text","text":"for_each(((i,x)::Tuple) -> println(i), enumerate(psi.A))","style":{"code":true}},{"type":"text","text":" things are passed correctly"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"eb47d021-1a22-483a-8288-6e156f38cb69","type":"message","text":"in `(x) -&gt; ...`, during each iteration, `x` will be the tuple containing bothe the index as well as the element","user":"UH24GRBLL","ts":"1611921474.087800","team":"T68168MUP","edited":{"user":"UH24GRBLL","ts":"1611921501.000000"},"blocks":[{"type":"rich_text","block_id":"22yl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"in "},{"type":"text","text":"(x) -> ...","style":{"code":true}},{"type":"text","text":", during each iteration, "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" will be the tuple containing bothe the index as well as the element"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"c68fb12f-66c1-42d1-8a5d-6debc7fb487a","type":"message","text":"but foreach(((i, x)::Tuple) -&gt; apply!(x, H, i), enumerate(Ψ.A)) gives me this stacktrace:\n```ERROR: MethodError: no method matching apply!(::QCMPS.MPT{Float32}, ::Array{Float64,2}, ::Int64)\nClosest candidates are:\n  apply!(::QCMPS.MPT, ::Array{N,2}) where N&lt;:Number at /Users/mofeing/Develop/QCMPS/src/MPT.jl:56\n  apply!(::LocalMPS, ::Array{N,2}, ::Integer) where N&lt;:Number at /Users/mofeing/Develop/QCMPS/src/LocalMPS.jl:9\n  apply!(::DistributedMPS, ::Array{N,2}, ::Integer) where N&lt;:Number at /Users/mofeing/Develop/QCMPS/src/DistributedMPS.jl:15\n  ...\nStacktrace:\n [1] (::QCMPS.var\"#21#22\"{Array{Float64,2}})(::Tuple{Int64,QCMPS.MPT{Float32}}) at /Users/mofeing/Develop/QCMPS/src/MPS.jl:13\n [2] foreach at ./abstractarray.jl:2009 [inlined]\n [3] apply_all!(::LocalMPS{Float32}, ::Array{Float64,2}) at /Users/mofeing/Develop/QCMPS/src/MPS.jl:13\n [4] top-level scope at REPL[11]:1```","user":"UGMLP4VB6","ts":"1611921557.088100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dzJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but foreach(((i, x)::Tuple) -> apply!(x, H, i), enumerate(Ψ.A)) gives me this stacktrace:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"ERROR: MethodError: no method matching apply!(::QCMPS.MPT{Float32}, ::Array{Float64,2}, ::Int64)\nClosest candidates are:\n  apply!(::QCMPS.MPT, ::Array{N,2}) where N<:Number at /Users/mofeing/Develop/QCMPS/src/MPT.jl:56\n  apply!(::LocalMPS, ::Array{N,2}, ::Integer) where N<:Number at /Users/mofeing/Develop/QCMPS/src/LocalMPS.jl:9\n  apply!(::DistributedMPS, ::Array{N,2}, ::Integer) where N<:Number at /Users/mofeing/Develop/QCMPS/src/DistributedMPS.jl:15\n  ...\nStacktrace:\n [1] (::QCMPS.var\"#21#22\"{Array{Float64,2}})(::Tuple{Int64,QCMPS.MPT{Float32}}) at /Users/mofeing/Develop/QCMPS/src/MPS.jl:13\n [2] foreach at ./abstractarray.jl:2009 [inlined]\n [3] apply_all!(::LocalMPS{Float32}, ::Array{Float64,2}) at /Users/mofeing/Develop/QCMPS/src/MPS.jl:13\n [4] top-level scope at REPL[11]:1"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"8accb7b2-c916-480b-a21b-30a5ac689bf4","type":"message","text":"okay, solved. the inner call to `apply!` is without the index value. :man-facepalming:","user":"UGMLP4VB6","ts":"1611921661.088300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Tvsd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"okay, solved. the inner call to "},{"type":"text","text":"apply!","style":{"code":true}},{"type":"text","text":" is without the index value. "},{"type":"emoji","name":"man-facepalming"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"892df931-b263-47a9-8f15-cea585ae86e4","type":"message","text":"thx <@UH24GRBLL>","user":"UGMLP4VB6","ts":"1611921674.088500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LPo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thx "},{"type":"user","user_id":"UH24GRBLL"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"d688826c-3e8b-45f7-8be7-cca92c6f373c","type":"message","text":"then you don't need the `enumerate` at all, right? you can just do `foreach(x -&gt; apply!(x, H), psi.A)`","user":"UH24GRBLL","ts":"1611921696.088700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OPJf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"then you don't need the "},{"type":"text","text":"enumerate","style":{"code":true}},{"type":"text","text":" at all, right? you can just do "},{"type":"text","text":"foreach(x -> apply!(x, H), psi.A)","style":{"code":true}}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6"},{"client_msg_id":"5663ee22-c108-4ed2-b7b8-28eee7a1df5f","type":"message","text":"you're welcome","user":"UH24GRBLL","ts":"1611921735.088900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QnOi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you're welcome"}]}]}],"thread_ts":"1611917829.082400","parent_user_id":"UGMLP4VB6","reactions":[{"name":"thumbsup_all","users":["UGMLP4VB6"],"count":1}]}]