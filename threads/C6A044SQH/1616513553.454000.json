[{"client_msg_id":"b486df51-a6b4-4493-9612-9462bf417476","type":"message","text":"Is there a way to get something similar to a `typeof(similar(array, T))`  at compile time? `similar`  actually allocates","user":"UPLCGPTS6","ts":"1616513553.454000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gKUWZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a way to get something similar to a "},{"type":"text","text":"typeof(similar(array, T))","style":{"code":true}},{"type":"text","text":"  at compile time? "},{"type":"text","text":"similar","style":{"code":true}},{"type":"text","text":"  actually allocates"}]}]}],"thread_ts":"1616513553.454000","reply_count":5,"reply_users_count":3,"latest_reply":"1616520299.467300","reply_users":["U7HAYKY9X","UD0NS8PDF","UPLCGPTS6"],"subscribed":false},{"client_msg_id":"0f16ebfa-4ec1-4064-b6b4-00780e51dceb","type":"message","text":"Not generically, no. Types can implement their own similar without giving clues as to which types it returns.","user":"U7HAYKY9X","ts":"1616517926.465800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VG++","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Not generically, no. Types can implement their own similar without giving clues as to which types it returns."}]}]}],"thread_ts":"1616513553.454000","parent_user_id":"UPLCGPTS6"},{"client_msg_id":"c48aaac1-73be-46ce-866b-d8ceaf707951","type":"message","text":"You can write `Core.Compiler.return_type(similar, Tuple{typeof(A), T})`, if you ignore all the warnings about this being inernal etc…","user":"UD0NS8PDF","ts":"1616518829.466300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"58e","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You can write "},{"type":"text","text":"Core.Compiler.return_type(similar, Tuple{typeof(A), T})","style":{"code":true}},{"type":"text","text":", if you ignore all the warnings about this being inernal etc…"}]}]}],"thread_ts":"1616513553.454000","parent_user_id":"UPLCGPTS6"},{"client_msg_id":"9906c8cc-cdfe-4e2a-a7b2-1c63fe981d1f","type":"message","text":"Or something like `typeof(similar(A, T, ntuple(_-&gt;0, ndims(A))))` to at least make a small allocation. Perhaps ideally call return-type &amp; if it gives you `Any`, fall back to trying it out.","user":"UD0NS8PDF","ts":"1616518871.466500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CRVm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Or something like "},{"type":"text","text":"typeof(similar(A, T, ntuple(_->0, ndims(A))))","style":{"code":true}},{"type":"text","text":" to at least make a small allocation. Perhaps ideally call return-type & if it gives you "},{"type":"text","text":"Any","style":{"code":true}},{"type":"text","text":", fall back to trying it out."}]}]}],"thread_ts":"1616513553.454000","parent_user_id":"UPLCGPTS6"},{"client_msg_id":"0ed4791a-9280-4dfd-b7f2-82fe8ba272c5","type":"message","text":"Thanks for answers! I ended up with writing my own `typeof_similar`  function. I implemented allocation free methods for built-in `AbstractArray` . In other cases it fallbacks to `typeof(similar())`","user":"UPLCGPTS6","ts":"1616520233.467100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LnT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks for answers! I ended up with writing my own "},{"type":"text","text":"typeof_similar","style":{"code":true}},{"type":"text","text":"  function. I implemented allocation free methods for built-in "},{"type":"text","text":"AbstractArray","style":{"code":true}},{"type":"text","text":" . In other cases it fallbacks to "},{"type":"text","text":"typeof(similar())","style":{"code":true}}]}]}],"thread_ts":"1616513553.454000","parent_user_id":"UPLCGPTS6"},{"client_msg_id":"edddbc9c-9ecd-4e68-9bd8-cc71f990c60c","type":"message","text":"```typeof_similar(::AbstractArray{T, N}, ::Type{L}) where { T, N, L } = Array{L, N}\ntypeof_similar(something, ::Type{L}) where { L } = typeof(similar(something, L))```","user":"UPLCGPTS6","ts":"1616520299.467300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ShdT","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"typeof_similar(::AbstractArray{T, N}, ::Type{L}) where { T, N, L } = Array{L, N}\ntypeof_similar(something, ::Type{L}) where { L } = typeof(similar(something, L))"}]}]}],"thread_ts":"1616513553.454000","parent_user_id":"UPLCGPTS6"}]