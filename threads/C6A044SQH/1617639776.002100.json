[{"client_msg_id":"86a42032-39b9-4c51-a949-07fe5b5c4823","type":"message","text":"Hi guys.. I have a question related to some of the questions I have asked here before. I have a code which produces a slight instability in one the outputs `Aii`  which is a `BlockMatrix{T, T11, T12, T21, T22}`  object:\n```Aii, .. = assemble_blocks(...)```\nI then generate functions at runtime\n```Lmul = (y, _, x) -&gt; y .= Aii\\(Aib*x)```\nwhich from my understanding is type-instable and also leads to compiling the function everytime anew as it is generated. However, I need to pass this function to another library `LowRankApprox.jl` , and I do not really have a choice on the function signature. In other words, i need to generate new functions for every new `Aii`  etc. that I compute.\n\nI tried to circumvent these problems as previously suggested here by introducing more function barriers as so:\n```function _gauss_transforms(Aii, Aib)\n  return (y, _, x) -&gt; y \nend```\nor\n```Lmul = (y, _, x) -&gt; _gauss_transform(Aii, Aib, y, x)```\nbut to no avail.\n\nAny suggestions on how to avoid this performance issue? I am at the end of my wisdom...\nAnother issue I have is that I do not know how to debug the generated functions. `@code_warntype Lmul(x)`  returns nothing at all.\n\nI am grateful for any help and suggestions :slightly_smiling_face:","user":"U01L0RJC6FM","ts":"1617639776.002100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KSnTn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi guys.. I have a question related to some of the questions I have asked here before. I have a code which produces a slight instability in one the outputs "},{"type":"text","text":"Aii","style":{"code":true}},{"type":"text","text":"  which is a "},{"type":"text","text":"BlockMatrix{T, T11, T12, T21, T22}","style":{"code":true}},{"type":"text","text":"  object:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"Aii, .. = assemble_blocks(...)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"I then generate functions at runtime\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"Lmul = (y, _, x) -> y .= Aii\\(Aib*x)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"which from my understanding is type-instable and also leads to compiling the function everytime anew as it is generated. However, I need to pass this function to another library "},{"type":"text","text":"LowRankApprox.jl","style":{"code":true}},{"type":"text","text":" , and I do not really have a choice on the function signature. In other words, i need to generate new functions for every new "},{"type":"text","text":"Aii","style":{"code":true}},{"type":"text","text":"  etc. that I compute.\n\nI tried to circumvent these problems as previously suggested here by introducing more function barriers as so:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function _gauss_transforms(Aii, Aib)\n  return (y, _, x) -> y \nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"or\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"Lmul = (y, _, x) -> _gauss_transform(Aii, Aib, y, x)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"but to no avail.\n\nAny suggestions on how to avoid this performance issue? I am at the end of my wisdom...\nAnother issue I have is that I do not know how to debug the generated functions. "},{"type":"text","text":"@code_warntype Lmul(x)","style":{"code":true}},{"type":"text","text":"  returns nothing at all.\n\nI am grateful for any help and suggestions "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617639776.002100","reply_count":10,"reply_users_count":2,"latest_reply":"1617650071.013300","reply_users":["U011LUQ182G","U01L0RJC6FM"],"is_locked":false,"subscribed":false},{"client_msg_id":"8ff2077b-2422-47d4-a8c9-6ea75db98648","type":"message","text":"I’m not familiar with the `_` argument in Lmul - what is that?","user":"U011LUQ182G","ts":"1617640753.003000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1pfO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m not familiar with the "},{"type":"text","text":"_","style":{"code":true}},{"type":"text","text":" argument in Lmul - what is that?"}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"1cac2edd-2bc0-49db-80c7-cb203c90a3e7","type":"message","text":"nvm - i see. It’s just a dummy placeholder for unneeded args.","user":"U011LUQ182G","ts":"1617640811.003300","team":"T68168MUP","edited":{"user":"U011LUQ182G","ts":"1617640820.000000"},"blocks":[{"type":"rich_text","block_id":"U4r/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"nvm - i see. It’s just a dummy placeholder for unneeded args."}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"9d4e8054-319b-41f3-9602-6fdf6c94ff95","type":"message","text":"try a function closure for generating these functions - e.g.,\n```function init_Lmul(Aii,Aib)\n    Lmul(y, _, x) = y .= Aii\\(Aib*x)\n    return Lmul\nend```","user":"U011LUQ182G","ts":"1617640931.003700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WEjH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"try a function closure for generating these functions - e.g.,\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function init_Lmul(Aii,Aib)\n    Lmul(y, _, x) = y .= Aii\\(Aib*x)\n    return Lmul\nend"}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"a7c996c4-c226-49a8-b785-7c32a268484c","type":"message","text":"this gives me type stable output from `@code_warntype Lmul(y,nothing,x)`","user":"U011LUQ182G","ts":"1617640947.003900","team":"T68168MUP","edited":{"user":"U011LUQ182G","ts":"1617640961.000000"},"blocks":[{"type":"rich_text","block_id":"G5M","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"this gives me type stable output from "},{"type":"text","text":"@code_warntype Lmul(y,nothing,x)","style":{"code":true}}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"19751c8a-fe6b-45d3-ad46-3e1c31e040fd","type":"message","text":"hi Jesse, thanks! it seems that the issue was lying further down the hole, I am now trying to resolve it :slightly_smiling_face:","user":"U01L0RJC6FM","ts":"1617648801.011900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2Et9Y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hi Jesse, thanks! it seems that the issue was lying further down the hole, I am now trying to resolve it "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM","reactions":[{"name":"+1","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"bff5e267-32e8-46f1-a6da-b9b6fb83e9d2","type":"message","text":"btw.. I saw that you had written a julia version for nodal-dg.. that's very cool","user":"U01L0RJC6FM","ts":"1617648824.012200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ZXY6/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"btw.. I saw that you had written a julia version for nodal-dg.. that's very cool"}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM","reactions":[{"name":"pray","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"5b2240bc-4f46-4cb8-a5be-f2341e6f2ea2","type":"message","text":"Hah, thanks! I need to refactor that - most of the functionality has moved into StartUpDG.jl and NodesAndModes.jl now","user":"U011LUQ182G","ts":"1617648942.012500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ltjv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hah, thanks! I need to refactor that - most of the functionality has moved into StartUpDG.jl and NodesAndModes.jl now"}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"d0d22bc7-49b7-41bc-9217-7539aa3a1e3e","type":"message","text":"it's very cool regardless.. I am quite familiar with nodal-dg, so it is super nice to see a julia-version of that","user":"U01L0RJC6FM","ts":"1617650005.012800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5F7Ib","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it's very cool regardless.. I am quite familiar with nodal-dg, so it is super nice to see a julia-version of that"}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM","reactions":[{"name":"+1","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"377f5a6d-8919-4fa4-afc8-660ccee79884","type":"message","text":"btw, if you ever want to write a CG-code based on that you might want to have a look at <https://github.com/bonevbs/nodal-dg-extension>","user":"U01L0RJC6FM","ts":"1617650030.013100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wPKB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"btw, if you ever want to write a CG-code based on that you might want to have a look at "},{"type":"link","url":"https://github.com/bonevbs/nodal-dg-extension"}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"d32e4a21-b1e2-445d-bf32-8239545eae4e","type":"message","text":"could be nice to have a StartUpCG.jl :smile:","user":"U01L0RJC6FM","ts":"1617650071.013300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tbRQ7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"could be nice to have a StartUpCG.jl "},{"type":"emoji","name":"smile"}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM"}]