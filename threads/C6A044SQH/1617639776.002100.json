[{"client_msg_id":"86a42032-39b9-4c51-a949-07fe5b5c4823","type":"message","text":"Hi guys.. I have a question related to some of the questions I have asked here before. I have a code which produces a slight instability in one the outputs `Aii`  which is a `BlockMatrix{T, T11, T12, T21, T22}`  object:\n```Aii, .. = assemble_blocks(...)```\nI then generate functions at runtime\n```Lmul = (y, _, x) -&gt; y .= Aii\\(Aib*x)```\nwhich from my understanding is type-instable and also leads to compiling the function everytime anew as it is generated. However, I need to pass this function to another library `LowRankApprox.jl` , and I do not really have a choice on the function signature. In other words, i need to generate new functions for every new `Aii`  etc. that I compute.\n\nI tried to circumvent these problems as previously suggested here by introducing more function barriers as so:\n```function _gauss_transforms(Aii, Aib)\n  return (y, _, x) -&gt; y \nend```\nor\n```Lmul = (y, _, x) -&gt; _gauss_transform(Aii, Aib, y, x)```\nbut to no avail.\n\nAny suggestions on how to avoid this performance issue? I am at the end of my wisdom...\nAnother issue I have is that I do not know how to debug the generated functions. `@code_warntype Lmul(x)`  returns nothing at all.\n\nI am grateful for any help and suggestions :slightly_smiling_face:","user":"U01L0RJC6FM","ts":"1617639776.002100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KSnTn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi guys.. I have a question related to some of the questions I have asked here before. I have a code which produces a slight instability in one the outputs "},{"type":"text","text":"Aii","style":{"code":true}},{"type":"text","text":"  which is a "},{"type":"text","text":"BlockMatrix{T, T11, T12, T21, T22}","style":{"code":true}},{"type":"text","text":"  object:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"Aii, .. = assemble_blocks(...)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"I then generate functions at runtime\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"Lmul = (y, _, x) -> y .= Aii\\(Aib*x)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"which from my understanding is type-instable and also leads to compiling the function everytime anew as it is generated. However, I need to pass this function to another library "},{"type":"text","text":"LowRankApprox.jl","style":{"code":true}},{"type":"text","text":" , and I do not really have a choice on the function signature. In other words, i need to generate new functions for every new "},{"type":"text","text":"Aii","style":{"code":true}},{"type":"text","text":"  etc. that I compute.\n\nI tried to circumvent these problems as previously suggested here by introducing more function barriers as so:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function _gauss_transforms(Aii, Aib)\n  return (y, _, x) -> y \nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"or\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"Lmul = (y, _, x) -> _gauss_transform(Aii, Aib, y, x)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"but to no avail.\n\nAny suggestions on how to avoid this performance issue? I am at the end of my wisdom...\nAnother issue I have is that I do not know how to debug the generated functions. "},{"type":"text","text":"@code_warntype Lmul(x)","style":{"code":true}},{"type":"text","text":"  returns nothing at all.\n\nI am grateful for any help and suggestions "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617639776.002100","reply_count":4,"reply_users_count":1,"latest_reply":"1617640947.003900","reply_users":["U011LUQ182G"],"is_locked":false,"subscribed":false},{"client_msg_id":"8ff2077b-2422-47d4-a8c9-6ea75db98648","type":"message","text":"I’m not familiar with the `_` argument in Lmul - what is that?","user":"U011LUQ182G","ts":"1617640753.003000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1pfO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’m not familiar with the "},{"type":"text","text":"_","style":{"code":true}},{"type":"text","text":" argument in Lmul - what is that?"}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"1cac2edd-2bc0-49db-80c7-cb203c90a3e7","type":"message","text":"nvm - i see. It’s just a dummy placeholder for unneeded args.","user":"U011LUQ182G","ts":"1617640811.003300","team":"T68168MUP","edited":{"user":"U011LUQ182G","ts":"1617640820.000000"},"blocks":[{"type":"rich_text","block_id":"U4r/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"nvm - i see. It’s just a dummy placeholder for unneeded args."}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"9d4e8054-319b-41f3-9602-6fdf6c94ff95","type":"message","text":"try a function closure for generating these functions - e.g.,\n```function init_Lmul(Aii,Aib)\n    Lmul(y, _, x) = y .= Aii\\(Aib*x)\n    return Lmul\nend```","user":"U011LUQ182G","ts":"1617640931.003700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WEjH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"try a function closure for generating these functions - e.g.,\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function init_Lmul(Aii,Aib)\n    Lmul(y, _, x) = y .= Aii\\(Aib*x)\n    return Lmul\nend"}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"a7c996c4-c226-49a8-b785-7c32a268484c","type":"message","text":"this gives me type stable output from `@code_warntype Lmul(y,nothing,x)`","user":"U011LUQ182G","ts":"1617640947.003900","team":"T68168MUP","edited":{"user":"U011LUQ182G","ts":"1617640961.000000"},"blocks":[{"type":"rich_text","block_id":"G5M","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"this gives me type stable output from "},{"type":"text","text":"@code_warntype Lmul(y,nothing,x)","style":{"code":true}}]}]}],"thread_ts":"1617639776.002100","parent_user_id":"U01L0RJC6FM"}]