[{"client_msg_id":"6f9b9b0b-9514-4b92-9625-bfaa81fc7207","type":"message","text":"Is there a way to make this work, perhaps using `Base.TwicePrecision`? i.e. to find the necessary ratio sufficiently accurately that repeated multiplication takes you to something `== hi`?\n```lo, hi, n = 1.0, 1000.0, 4\n\nrat = (hi/lo)^inv(n-1)\n\nhi == let\n    tmp = lo\n    for i in 2:n\n        tmp *= rat\n    end\n    tmp\nend # false```","user":"UD0NS8PDF","ts":"1609606239.037200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ZdVWH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a way to make this work, perhaps using "},{"type":"text","text":"Base.TwicePrecision","style":{"code":true}},{"type":"text","text":"? i.e. to find the necessary ratio sufficiently accurately that repeated multiplication takes you to something "},{"type":"text","text":"== hi","style":{"code":true}},{"type":"text","text":"?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"lo, hi, n = 1.0, 1000.0, 4\n\nrat = (hi/lo)^inv(n-1)\n\nhi == let\n    tmp = lo\n    for i in 2:n\n        tmp *= rat\n    end\n    tmp\nend # false"}]}]}],"thread_ts":"1609606239.037200","reply_count":13,"reply_users_count":3,"latest_reply":"1609665521.067000","reply_users":["UD0NS8PDF","UM30MT6RF","U0179G7FG4F"],"subscribed":false},{"client_msg_id":"334b8561-43e5-4b1e-b607-d247dbceef76","type":"message","text":"I guess `rat = Float64((big(hi)/big(lo))^inv(big(n-1)))` works here, but is there a smarter way?","user":"UD0NS8PDF","ts":"1609606467.037300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Wvcy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I guess "},{"type":"text","text":"rat = Float64((big(hi)/big(lo))^inv(big(n-1)))","style":{"code":true}},{"type":"text","text":" works here, but is there a smarter way?"}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"946a8aaa-27ab-4d52-b463-1b626d6a5b19","type":"message","text":"Maybe you could first compute it in double precision and then do a Newton step? May not be the most accurate though","user":"UM30MT6RF","ts":"1609607296.037600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"c/5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe you could first compute it in double precision and then do a Newton step? May not be the most accurate though"}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"6af1aba5-9130-484c-ad48-85247ed2308c","type":"message","text":"But if this is for what I think it is, I am not sure that approach will always be able to hit the endpoints","user":"UM30MT6RF","ts":"1609607378.037800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qMK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But if this is for what I think it is, I am not sure that approach will always be able to hit the endpoints"}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"1934a9f6-494f-4a7d-be33-81519d7a90a0","type":"message","text":"To see if I understand right, your idea is to run the recursion with the naiive ratio, check the error, and use that to compute a correction factor?","user":"UD0NS8PDF","ts":"1609607562.038000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"h+ox","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"To see if I understand right, your idea is to run the recursion with the naiive ratio, check the error, and use that to compute a correction factor?"}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"ccc8fc34-af15-4eb2-a2fa-e63918ea2e4c","type":"message","text":"one thing that might help is to implement a `rootn` function which is possible to make more accurate than `(hi/lo)^inv(n-1)`","user":"U0179G7FG4F","ts":"1609607620.038200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OE3W+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"one thing that might help is to implement a "},{"type":"text","text":"rootn","style":{"code":true}},{"type":"text","text":" function which is possible to make more accurate than "},{"type":"text","text":"(hi/lo)^inv(n-1)","style":{"code":true}}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"8d93dfe8-28bb-4bc6-9c7c-edd74a31cc76","type":"message","text":"Any clues on where to look for that?","user":"UD0NS8PDF","ts":"1609607714.038600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HSG/T","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Any clues on where to look for that?"}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"62293393-b189-423b-8ebe-ae11db359e61","type":"message","text":"&gt; To see if I understand right, your idea is to run the recursion with the naiive ratio, check the error, and use that to compute a correction factor?\n&gt; \nMy first comment was just regarding computing `x ^ inv(n-1)` more accurately","user":"UM30MT6RF","ts":"1609607723.038800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9=u","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"To see if I understand right, your idea is to run the recursion with the naiive ratio, check the error, and use that to compute a correction factor?\n"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"My first comment was just regarding computing "},{"type":"text","text":"x ^ inv(n-1)","style":{"code":true}},{"type":"text","text":" more accurately"}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"08140cb7-f5d0-4d0d-869e-23c4fb73524b","type":"message","text":"Oh ok, that’s simpler.","user":"UD0NS8PDF","ts":"1609607804.039000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rZ5t8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh ok, that’s simpler."}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"42270943-5719-427d-9666-d9ef30075c0c","type":"message","text":"I still think doing the range calculation in log space and then computing `exp` for each element is probably easier to make work reliably","user":"UM30MT6RF","ts":"1609607908.039200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mrto1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I still think doing the range calculation in log space and then computing "},{"type":"text","text":"exp","style":{"code":true}},{"type":"text","text":" for each element is probably easier to make work reliably"}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"c06b71f7-2ce9-4d00-ad08-6ad3f2fc518f","type":"message","text":"The other advantage is that then you can index the thing, instead of just iterating it.","user":"UD0NS8PDF","ts":"1609608069.039400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"orRR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The other advantage is that then you can index the thing, instead of just iterating it."}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"9793143c-6949-4f27-97e6-b0e82ae57adf","type":"message","text":"Here is my first attempt:\n```julia&gt; function _log(x)\n           l = log(x)\n           x_ = exp(l)\n           return l - Base.TwicePrecision(x_ - x) / x_\n       end\n_log (generic function with 1 method)\n\njulia&gt; function _exp(x::Base.TwicePrecision)\n           e = exp(x.hi)\n           return Float64(e - (log(e) - x) * e)\n       end\n_exp (generic function with 1 method)\n\njulia&gt; function logrange(lo, hi, n)\n           log_r = LinRange(_log(lo), _log(hi), n)\n           return (_exp(x) for x in log_r)\n       end\nlogrange (generic function with 2 methods)\n\njulia&gt; collect(logrange(1/8, 8., 7))\n7-element Array{Float64,1}:\n 0.125\n 0.24999999999999994\n 0.4999999999999999\n 1.0\n 1.9999999999999998\n 4.000000000000001\n 8.0```\nIt hits the endpoints at least, but still need to figure out how to make the steps in between more exact.","user":"UM30MT6RF","ts":"1609608188.039600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5Kip","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Here is my first attempt:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> function _log(x)\n           l = log(x)\n           x_ = exp(l)\n           return l - Base.TwicePrecision(x_ - x) / x_\n       end\n_log (generic function with 1 method)\n\njulia> function _exp(x::Base.TwicePrecision)\n           e = exp(x.hi)\n           return Float64(e - (log(e) - x) * e)\n       end\n_exp (generic function with 1 method)\n\njulia> function logrange(lo, hi, n)\n           log_r = LinRange(_log(lo), _log(hi), n)\n           return (_exp(x) for x in log_r)\n       end\nlogrange (generic function with 2 methods)\n\njulia> collect(logrange(1/8, 8., 7))\n7-element Array{Float64,1}:\n 0.125\n 0.24999999999999994\n 0.4999999999999999\n 1.0\n 1.9999999999999998\n 4.000000000000001\n 8.0"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"It hits the endpoints at least, but still need to figure out how to make the steps in between more exact."}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"612194ba-5976-460b-86dd-32f85e6a063a","type":"message","text":"Very nice, thanks!","user":"UD0NS8PDF","ts":"1609610933.040100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"s9Xu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Very nice, thanks!"}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF"},{"client_msg_id":"5044fa07-d1c7-4220-b311-bf1d52cf0d1c","type":"message","text":"Various ideas are collected here now: <https://gist.github.com/mcabbott/a40c784b4fd27656b581ad0dac09aae5>","user":"UD0NS8PDF","ts":"1609665521.067000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"usAc2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Various ideas are collected here now: "},{"type":"link","url":"https://gist.github.com/mcabbott/a40c784b4fd27656b581ad0dac09aae5"}]}]}],"thread_ts":"1609606239.037200","parent_user_id":"UD0NS8PDF","reactions":[{"name":"+1","users":["UM30MT6RF"],"count":1}]}]