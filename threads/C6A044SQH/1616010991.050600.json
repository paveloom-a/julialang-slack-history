[{"client_msg_id":"0ffcfc1d-db1c-4bf2-b38e-a9aa5db2e9e4","type":"message","text":"Is there any way to assert that an array or operation cannot mutate? Using Zygote I'm getting some confusing array mutation. In this case from simply matmul. EG:\n&gt; ERROR: LoadError: Mutating arrays is not supported\n&gt; Stacktrace:\n&gt;  [1] error(::String) at ./error.jl:33\n&gt;  [2] (::Zygote.var\"#372#373\")(::Nothing) at /home/rs/.julia/packages/Zygote/KpME9/src/lib/array.jl:58\n&gt;  [3] (::Zygote.var\"#2261#back#374\"{Zygote.var\"#372#373\"})(::Nothing) at /home/rs/.julia/packages/ZygoteRules/OjfTt/src/adjoint.jl:59\n&gt;  [4] _modify! at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/generic.jl:83 [inlined]\n&gt;  [5] (::typeof(∂(_modify!)))(::Nothing) at /home/rs/.julia/packages/Zygote/KpME9/src/compiler/interface2.jl:0\n&gt;  [6] _generic_matmatmul! at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:841 [inlined]\n&gt;  [7] (::typeof(∂(_generic_matmatmul!)))(::Array{Float64,2}) at /home/rs/.julia/packages/Zygote/KpME9/src/compiler/interface2.jl:0\n&gt;  [8] generic_matmatmul! at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:728 [inlined]\n&gt;  [9] (::typeof(∂(generic_matmatmul!)))(::Array{Float64,2}) at /home/rs/.julia/packages/Zygote/KpME9/src/compiler/interface2.jl:0\n&gt;  [10] mul! at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:411 [inlined]\n&gt;  [11] mul! at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:208 [inlined]\n&gt;  [12] * at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:153 [inlined]\n&gt;  [13] (::typeof(∂(*)))(::Array{Float64,2}) at /home/rs/.julia/packages/Zygote/KpME9/src/compiler/interface2.jl:0\n&gt;  [14] * at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:61 [inlined]\n&gt;  [15] (::typeof(∂(*)))(::Array{Float64,2}) at /home/rs/.julia/packages/Zygote/KpME9/src/compiler/interface2.jl:0\nSeems like multiplying transpose sometimes causes mutation, but testing a simple example like\n&gt;  gradient((x,y) -&gt; sum(x * y'), [1.0,2.0],[3.0,4.0]) \nworks fine.","user":"U0199BYTCDP","ts":"1616010991.050600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lT8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there any way to assert that an array or operation cannot mutate? Using Zygote I'm getting some confusing array mutation. In this case from simply matmul. EG:\n"}]},{"type":"rich_text_quote","elements":[{"type":"text","text":"ERROR: LoadError: Mutating arrays is not supported\nStacktrace:\n [1] error(::String) at ./error.jl:33\n [2] (::Zygote.var\"#372#373\")(::Nothing) at /home/rs/.julia/packages/Zygote/KpME9/src/lib/array.jl:58\n [3] (::Zygote.var\"#2261#back#374\"{Zygote.var\"#372#373\"})(::Nothing) at /home/rs/.julia/packages/ZygoteRules/OjfTt/src/adjoint.jl:59\n [4] _modify! at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/generic.jl:83 [inlined]\n [5] (::typeof(∂(_modify!)))(::Nothing) at /home/rs/.julia/packages/Zygote/KpME9/src/compiler/interface2.jl:0\n [6] _generic_matmatmul! at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:841 [inlined]\n [7] (::typeof(∂(_generic_matmatmul!)))(::Array{Float64,2}) at /home/rs/.julia/packages/Zygote/KpME9/src/compiler/interface2.jl:0\n [8] generic_matmatmul! at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:728 [inlined]\n [9] (::typeof(∂(generic_matmatmul!)))(::Array{Float64,2}) at /home/rs/.julia/packages/Zygote/KpME9/src/compiler/interface2.jl:0\n [10] mul! at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:411 [inlined]\n [11] mul! at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:208 [inlined]\n [12] * at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:153 [inlined]\n [13] (::typeof(∂(*)))(::Array{Float64,2}) at /home/rs/.julia/packages/Zygote/KpME9/src/compiler/interface2.jl:0\n [14] * at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.5/LinearAlgebra/src/matmul.jl:61 [inlined]\n [15] (::typeof(∂(*)))(::Array{Float64,2}) at /home/rs/.julia/packages/Zygote/KpME9/src/compiler/interface2.jl:0"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Seems like multiplying transpose sometimes causes mutation, but testing a simple example like\n"}]},{"type":"rich_text_quote","elements":[{"type":"text","text":" gradient((x,y) -> sum(x * y'), [1.0,2.0],[3.0,4.0]) "}]},{"type":"rich_text_section","elements":[{"type":"text","text":"works fine."}]}]}],"thread_ts":"1616010991.050600","reply_count":9,"reply_users_count":3,"latest_reply":"1616018851.065500","reply_users":["B01J9QZ4SP8","USU9FRPEU","U0199BYTCDP"],"subscribed":false,"reactions":[{"name":"bridge","users":["U0199BYTCDP"],"count":1}]},{"type":"message","subtype":"bot_message","text":"Can we cross post this publicly to <https://discourse.julialang.org|Discourse> for further visibility? React with :bridge: on the message above to approve. <https://github.com/JuliaCommunity/SlackBridge/blob/main/README.md#faq|More info here>","ts":"1616010993.050700","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1616010991.050600","parent_user_id":"U0199BYTCDP"},{"type":"message","subtype":"bot_message","text":"Success, it has been cross posted <https://discourse.julialang.org/t/57409| to Discourse>. Keep and eye out on Discourse for responses and please add an answer there once you are satisfied with the solution so others can benefit as well. Happy debugging!","ts":"1616011042.051000","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1616010991.050600","parent_user_id":"U0199BYTCDP"},{"client_msg_id":"aa359839-1f8a-4f0f-aa35-cdb6597715f2","type":"message","text":"<https://github.com/JuliaArrays/StaticArrays.jl> ?","user":"USU9FRPEU","ts":"1616015363.052900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dDlW","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/JuliaArrays/StaticArrays.jl"},{"type":"text","text":" ?"}]}]}],"thread_ts":"1616010991.050600","parent_user_id":"U0199BYTCDP"},{"client_msg_id":"63ddc165-eaa2-4744-b16f-2386dd9a2903","type":"message","text":"I had looked at that, but unfortunately as it says:\n&gt;  Note that here \"statically sized\" means that the size can be determined from the _type_, and \"static\" does *not* necessarily imply `immutable`.","user":"U0199BYTCDP","ts":"1616018059.063300","team":"T68168MUP","edited":{"user":"U0199BYTCDP","ts":"1616018258.000000"},"blocks":[{"type":"rich_text","block_id":"KRZMf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I had looked at that, but unfortunately as it says:\n"}]},{"type":"rich_text_quote","elements":[{"type":"text","text":" Note that here \"statically sized\" means that the size can be determined from the "},{"type":"text","text":"type","style":{"italic":true}},{"type":"text","text":", and \"static\" does "},{"type":"text","text":"not","style":{"bold":true}},{"type":"text","text":" necessarily imply "},{"type":"text","text":"immutable","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1616010991.050600","parent_user_id":"U0199BYTCDP"},{"client_msg_id":"f72bb96f-5fae-4cee-8620-d017b474f390","type":"message","text":"Right, so some of the types there are only static, but some of them are immutable.","user":"USU9FRPEU","ts":"1616018626.064700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JH5rQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Right, so some of the types there are only static, but some of them are immutable."}]}]}],"thread_ts":"1616010991.050600","parent_user_id":"U0199BYTCDP"},{"client_msg_id":"6749b9b1-beb3-4a1f-9842-666b1ec00236","type":"message","text":"<https://juliaarrays.github.io/StaticArrays.jl/stable/pages/api/>","user":"USU9FRPEU","ts":"1616018641.064900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kZHqn","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://juliaarrays.github.io/StaticArrays.jl/stable/pages/api/"}]}]}],"thread_ts":"1616010991.050600","parent_user_id":"U0199BYTCDP"},{"client_msg_id":"5ed49f61-d2ab-4dd1-8a7e-624089a59de1","type":"message","text":"&gt; The simplest static array is the type `SVector{N,T}`, which provides an immutable vector of fixed length `N` and type `T`.","user":"USU9FRPEU","ts":"1616018654.065100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7zcs","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"The simplest static array is the type "},{"type":"text","text":"SVector{N,T}","style":{"code":true}},{"type":"text","text":", which provides an immutable vector of fixed length "},{"type":"text","text":"N","style":{"code":true}},{"type":"text","text":" and type "},{"type":"text","text":"T","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1616010991.050600","parent_user_id":"U0199BYTCDP"},{"client_msg_id":"e8d57fa9-9bc8-4dff-b49a-25cde701e39e","type":"message","text":"Basically this is just wrapping the AbstractArray interface around a Tuple.","user":"USU9FRPEU","ts":"1616018768.065300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hZgd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Basically this is just wrapping the AbstractArray interface around a Tuple."}]}]}],"thread_ts":"1616010991.050600","parent_user_id":"U0199BYTCDP"},{"client_msg_id":"a3109038-a966-422b-bd63-cc67641c5255","type":"message","text":"Now there are mutable versions there that are just statically sized such as `MVector`","user":"USU9FRPEU","ts":"1616018851.065500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xlR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Now there are mutable versions there that are just statically sized such as "},{"type":"text","text":"MVector","style":{"code":true}}]}]}],"thread_ts":"1616010991.050600","parent_user_id":"U0199BYTCDP"}]