[{"client_msg_id":"6580da6a-2c71-4064-9d08-816d4ad49d1a","type":"message","text":"Hi,\n\nI would like to warp an image by the log-polar transform but I have troubles to make it work. Can someone give me a push please?\n\n```using CoordinateTransformations, ImageTransformations, StaticArrays\nstruct Retinotopy &lt;: Transformation; end\nstruct InvRetinotopy &lt;: Transformation; end\nfunction (::Retinotopy)(x)\n    length(x) == 2 || error(\"Polar transform takes a 2D coordinate\")\n\n    Polar(log(hypot(x[1], x[2])), atan(x[2], x[1]))\nend\n\nfunction (::InvRetinotopy)(x::Polar)\n    s,c = sincos(x.θ)\n    SVector(exp(x.r) * c, exp(x.r) * s)\nend\n(t::InvRetinotopy)(x) = t(Polar(x[1], x[2]))\nBase.inv(::Retinotopy) = InvRetinotopy()\n\ntfm = Retinotopy()\n# image\nimg = rand(256, 256)\nimgw = warp(img, tfm);```","user":"U7GQE9JP9","ts":"1608207486.346900","team":"T68168MUP","edited":{"user":"U7GQE9JP9","ts":"1608209782.000000"},"blocks":[{"type":"rich_text","block_id":"J/8gV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi,\n\nI would like to warp an image by the log-polar transform but I have troubles to make it work. Can someone give me a push please?\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using CoordinateTransformations, ImageTransformations, StaticArrays\nstruct Retinotopy <: Transformation; end\nstruct InvRetinotopy <: Transformation; end\nfunction (::Retinotopy)(x)\n    length(x) == 2 || error(\"Polar transform takes a 2D coordinate\")\n\n    Polar(log(hypot(x[1], x[2])), atan(x[2], x[1]))\nend\n\nfunction (::InvRetinotopy)(x::Polar)\n    s,c = sincos(x.θ)\n    SVector(exp(x.r) * c, exp(x.r) * s)\nend\n(t::InvRetinotopy)(x) = t(Polar(x[1], x[2]))\nBase.inv(::Retinotopy) = InvRetinotopy()\n\ntfm = Retinotopy()\n# image\nimg = rand(256, 256)\nimgw = warp(img, tfm);"}]}]}],"thread_ts":"1608207486.346900","reply_count":12,"reply_users_count":2,"latest_reply":"1608213662.349600","reply_users":["UMAJCM1DF","U7GQE9JP9"],"subscribed":false},{"client_msg_id":"23b0b9ff-748c-49c4-80df-828050446e1d","type":"message","text":"I think the transform functions expect `CartesianIndex.I` types.. looking at `ImageTransformations/src/warp.jl:87`\n```function warp!(out, img::AbstractExtrapolation, tform)\n    @inbounds for I in CartesianIndices(axes(out))\n        out[I] = _getindex(img, tform(SVector(I.I)))\n    end\n    out\nend```","user":"UMAJCM1DF","ts":"1608211498.347100","team":"T68168MUP","edited":{"user":"UMAJCM1DF","ts":"1608211526.000000"},"blocks":[{"type":"rich_text","block_id":"ia95","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think the transform functions expect "},{"type":"text","text":"CartesianIndex.I","style":{"code":true}},{"type":"text","text":" types.. looking at "},{"type":"text","text":"ImageTransformations/src/warp.jl:87","style":{"code":true}},{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function warp!(out, img::AbstractExtrapolation, tform)\n    @inbounds for I in CartesianIndices(axes(out))\n        out[I] = _getindex(img, tform(SVector(I.I)))\n    end\n    out\nend"}]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"337f410c-859c-4e98-b58f-59d5e57d9e6f","type":"message","text":"Thanks!! I made progress trying to get the polar coordinates working, not yet…\n```using CoordinateTransformations, ImageTransformations, StaticArrays, Plots, TestImages, Images,OffsetArrays\nstruct Retinotopy &lt;: Transformation; end\nstruct InvRetinotopy &lt;: Transformation; end\nfunction (::Retinotopy)(x)\n    length(x) == 2 || error(\"Polar transform takes a 2D coordinate\")\n\n    [(hypot(x[1], x[2])), atan(x[2], x[1])]\nend\n\nfunction (::InvRetinotopy)(x)\n    s,c = sincos(x[2])\n    SVector( (x[1]) * c,  (x[1]) * s)\nend\n\nBase.inv(::Retinotopy) = InvRetinotopy()\n\nimg = testimage(\"lighthouse\")\ntfm = recenter(Retinotopy(), [div.(size(img),2)...])\nimgw = warp(img, tfm);```","user":"U7GQE9JP9","ts":"1608211801.347400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Mvx0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks!! I made progress trying to get the polar coordinates working, not yet…\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using CoordinateTransformations, ImageTransformations, StaticArrays, Plots, TestImages, Images,OffsetArrays\nstruct Retinotopy <: Transformation; end\nstruct InvRetinotopy <: Transformation; end\nfunction (::Retinotopy)(x)\n    length(x) == 2 || error(\"Polar transform takes a 2D coordinate\")\n\n    [(hypot(x[1], x[2])), atan(x[2], x[1])]\nend\n\nfunction (::InvRetinotopy)(x)\n    s,c = sincos(x[2])\n    SVector( (x[1]) * c,  (x[1]) * s)\nend\n\nBase.inv(::Retinotopy) = InvRetinotopy()\n\nimg = testimage(\"lighthouse\")\ntfm = recenter(Retinotopy(), [div.(size(img),2)...])\nimgw = warp(img, tfm);"}]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"6532f09e-d50e-4c10-9d7e-04014b866102","type":"message","text":"figuring out how to do this is also on my to-do list.. at some point I need to transform a 3D image into spherical coordinates","user":"UMAJCM1DF","ts":"1608212209.347600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"C59eZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"figuring out how to do this is also on my to-do list.. at some point I need to transform a 3D image into spherical coordinates"}]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"e3995689-0e46-4e59-94a0-d975e5b2e59c","type":"message","text":"this seems to work\n```using Revise\nusing CoordinateTransformations, ImageTransformations, StaticArrays, Plots, TestImages, OffsetArrays\nstruct Retinotopy &lt;: Transformation; end\nstruct InvRetinotopy &lt;: Transformation; end\nfunction (::Retinotopy)(x)\n    length(x) == 2 || error(\"Polar transform takes a 2D coordinate\")\n\n    [(hypot(x[1], x[2])), atan(x[2], x[1])]\nend\n\nfunction (::InvRetinotopy)(x)\n    s,c = sincos(x[2])\n    SVector( (x[1]) * c,  (x[1]) * s)\nend\n\nBase.inv(::Retinotopy) = InvRetinotopy()\n\nimg = testimage(\"lighthouse\")\ntfm = Retinotopy()\nimgw = warp(img, tfm);\n\nheatmap(img)\nheatmap(imgw)\n\n\nimg0 = OffsetArray(img, -256:255, -384:383);  # origin near top of image\nimgw = warp(img0, tfm);\nheatmap(imgw)```","user":"U7GQE9JP9","ts":"1608212578.347800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mATM4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"this seems to work\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using Revise\nusing CoordinateTransformations, ImageTransformations, StaticArrays, Plots, TestImages, OffsetArrays\nstruct Retinotopy <: Transformation; end\nstruct InvRetinotopy <: Transformation; end\nfunction (::Retinotopy)(x)\n    length(x) == 2 || error(\"Polar transform takes a 2D coordinate\")\n\n    [(hypot(x[1], x[2])), atan(x[2], x[1])]\nend\n\nfunction (::InvRetinotopy)(x)\n    s,c = sincos(x[2])\n    SVector( (x[1]) * c,  (x[1]) * s)\nend\n\nBase.inv(::Retinotopy) = InvRetinotopy()\n\nimg = testimage(\"lighthouse\")\ntfm = Retinotopy()\nimgw = warp(img, tfm);\n\nheatmap(img)\nheatmap(imgw)\n\n\nimg0 = OffsetArray(img, -256:255, -384:383);  # origin near top of image\nimgw = warp(img0, tfm);\nheatmap(imgw)"}]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9","reactions":[{"name":"heart","users":["UMAJCM1DF"],"count":1}]},{"client_msg_id":"43f3198e-d1b6-4237-aa58-7bbdfdc1d964","type":"message","text":"I still dont get what this does not:\n``````","user":"U7GQE9JP9","ts":"1608212710.348100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"k5xO9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I still dont get what this does not:\n"}]},{"type":"rich_text_preformatted","elements":[]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"d7dcde58-355c-45f5-a505-47062ce4dc7b","type":"message","text":"```using Colors\nimg = Gray.([(cos(x - y)) for x in LinRange(0,5pi,512), y in LinRange(0,5pi,768)])img0 = OffsetArray(img, -256:255, -384:383);  # origin near top of image\nimgw = warp(img0, tfm);\nheatmap(imgw)```","user":"U7GQE9JP9","ts":"1608212730.348300","team":"T68168MUP","edited":{"user":"U7GQE9JP9","ts":"1608213221.000000"},"blocks":[{"type":"rich_text","block_id":"kRI","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using Colors\nimg = Gray.([(cos(x - y)) for x in LinRange(0,5pi,512), y in LinRange(0,5pi,768)])img0 = OffsetArray(img, -256:255, -384:383);  # origin near top of image\nimgw = warp(img0, tfm);\nheatmap(imgw)"}]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"3f14c456-f50a-4489-96c8-19ced217c4eb","type":"message","text":"I get\n```julia&gt; ┌ Warning: Output swatches are reduced due to the large size (494×341).\n│ Load the ImageShow package for large images.```\nwhereas for `img = testimage(\"lighthouse\")` , it worked fine","user":"U7GQE9JP9","ts":"1608213260.348600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BV3aC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I get\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> ┌ Warning: Output swatches are reduced due to the large size (494×341).\n│ Load the ImageShow package for large images."}]},{"type":"rich_text_section","elements":[{"type":"text","text":"whereas for "},{"type":"text","text":"img = testimage(\"lighthouse\")","style":{"code":true}},{"type":"text","text":" , it worked fine"}]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"417adcc3-0b54-4b4e-9986-7efc3a0f7b06","type":"message","text":"`N0f8` vs `Float64` ?","user":"UMAJCM1DF","ts":"1608213460.348800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Kca","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"N0f8","style":{"code":true}},{"type":"text","text":" vs "},{"type":"text","text":"Float64","style":{"code":true}},{"type":"text","text":" ?"}]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"64fb04d7-203a-497b-a8d2-83f0d68e1e80","type":"message","text":"I get `NaN` in `imgw` when I use `Float64`","user":"UMAJCM1DF","ts":"1608213489.349000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kbt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I get "},{"type":"text","text":"NaN","style":{"code":true}},{"type":"text","text":" in "},{"type":"text","text":"imgw","style":{"code":true}},{"type":"text","text":" when I use "},{"type":"text","text":"Float64","style":{"code":true}}]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"5b87cd99-64a6-4dd4-b8a4-b6d6d4f4842f","type":"message","text":"```img = reinterpret(RGB{Float64},testimage(\"lighthouse\"))```","user":"UMAJCM1DF","ts":"1608213536.349200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XCV","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"img = reinterpret(RGB{Float64},testimage(\"lighthouse\"))"}]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"6d8402fb-6406-41c5-a4b7-cd4a33956bf4","type":"message","text":"leads to an error","user":"UMAJCM1DF","ts":"1608213542.349400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ob3vW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"leads to an error"}]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"33e264b4-0b7e-49d9-9cfc-ded8fa544b0c","type":"message","text":"what a pain","user":"U7GQE9JP9","ts":"1608213662.349600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ypGi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what a pain"}]}]}],"thread_ts":"1608207486.346900","parent_user_id":"U7GQE9JP9"}]