[{"client_msg_id":"f1bc2e5a-7527-4a2a-a8e8-2adc301f69b6","type":"message","text":"Is there a way to call a `CodeInfo`? For example, can I use `code_typed(sin, Tuple{Int})` somehow to actually invoke the resulting code?","user":"U680THK2S","ts":"1616008911.041500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oZgN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a way to call a "},{"type":"text","text":"CodeInfo","style":{"code":true}},{"type":"text","text":"? For example, can I use "},{"type":"text","text":"code_typed(sin, Tuple{Int})","style":{"code":true}},{"type":"text","text":" somehow to actually invoke the resulting code?"}]}]}],"thread_ts":"1616008911.041500","reply_count":17,"reply_users_count":4,"latest_reply":"1616010922.049900","reply_users":["B01J9QZ4SP8","UM30MT6RF","U680THK2S","USU9FRPEU"],"is_locked":false,"subscribed":false,"reactions":[{"name":"call_me_hand","users":["UDB26738Q"],"count":1},{"name":"vscode","users":["UDB26738Q"],"count":1},{"name":"information_source","users":["UDB26738Q"],"count":1}]},{"type":"message","subtype":"bot_message","text":"Can we cross post this publicly to <https://discourse.julialang.org|Discourse> for further visibility? React with :bridge: on the message above to approve. <https://github.com/JuliaCommunity/SlackBridge/blob/main/README.md#faq|More info here>","ts":"1616008912.041600","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"92c3ca9b-0689-4a92-b71b-5b7b1f2cfac5","type":"message","text":"You do it by returning the CodeInfo from a generated function","user":"UM30MT6RF","ts":"1616008960.042300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/J/3n","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You do it by returning the CodeInfo from a generated function"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S","reactions":[{"name":"thinking_face","users":["U680THK2S"],"count":1}]},{"client_msg_id":"1991c6b0-72f9-4de9-80bb-c5ad8b5db161","type":"message","text":"So given a `CodeInfo`, I would need to wrap it in a new function definition using `@generated`, then call that?","user":"U680THK2S","ts":"1616009015.042600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GIur","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So given a "},{"type":"text","text":"CodeInfo","style":{"code":true}},{"type":"text","text":", I would need to wrap it in a new function definition using "},{"type":"text","text":"@generated","style":{"code":true}},{"type":"text","text":", then call that?"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"422d8b00-836a-41dc-9aaa-8c4d5d689487","type":"message","text":"For an example, see e.g. my answer here: <https://stackoverflow.com/questions/58612962/how-do-i-test-both-sides-of-a-if-generated/64794393#64794393>","user":"UM30MT6RF","ts":"1616009022.042800","team":"T68168MUP","attachments":[{"service_name":"Stack Overflow","title":"How do I test both sides of a `if @generated`?","title_link":"https://stackoverflow.com/questions/58612962/how-do-i-test-both-sides-of-a-if-generated/64794393#64794393","text":"Consider I might have some generated functions I want to test as below. Following recommendation of the manual I made them optionally generated. # This code is taken directly from Base. # https://","fallback":"Stack Overflow: How do I test both sides of a `if @generated`?","thumb_url":"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded","from_url":"https://stackoverflow.com/questions/58612962/how-do-i-test-both-sides-of-a-if-generated/64794393#64794393","thumb_width":316,"thumb_height":316,"service_icon":"https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a","id":1,"original_url":"https://stackoverflow.com/questions/58612962/how-do-i-test-both-sides-of-a-if-generated/64794393#64794393"}],"blocks":[{"type":"rich_text","block_id":"ht0il","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For an example, see e.g. my answer here: "},{"type":"link","url":"https://stackoverflow.com/questions/58612962/how-do-i-test-both-sides-of-a-if-generated/64794393#64794393"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"9089ba76-8e67-4d14-a0a9-e3ae75e47ce8","type":"message","text":"Yes.","user":"UM30MT6RF","ts":"1616009093.043300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TqEO0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes."}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"ba8c04d0-42c5-42aa-88c4-bc8dc7e0c008","type":"message","text":"```julia&gt; code, _ = only(code_typed(sin, Tuple{Int}))\nCodeInfo(\n1 ─ %1 = Base.sitofp(Float64, x)::Float64\n└──      goto #3 if not false\n2 ─      nothing::Nothing\n3 ┄ %4 = invoke Base.Math.sin(%1::Float64)::Float64\n└──      return %4\n) =&gt; Float64\n\njulia&gt; @generated thing(args...) = code\nthing (generic function with 2 methods)\n\njulia&gt; Base.invokelatest(thing, 1)\nCodeInfo(\n1 ─ %1 = Base.sitofp(Float64, x)::Float64\n└──      goto #3 if not false\n2 ─      nothing::Nothing\n3 ┄ %4 = invoke Base.Math.sin(%1::Float64)::Float64\n└──      return %4\n)```\nI think there's something I'm not understanding","user":"U680THK2S","ts":"1616009981.043600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qVaw","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> code, _ = only(code_typed(sin, Tuple{Int}))\nCodeInfo(\n1 ─ %1 = Base.sitofp(Float64, x)::Float64\n└──      goto #3 if not false\n2 ─      nothing::Nothing\n3 ┄ %4 = invoke Base.Math.sin(%1::Float64)::Float64\n└──      return %4\n) => Float64\n\njulia> @generated thing(args...) = code\nthing (generic function with 2 methods)\n\njulia> Base.invokelatest(thing, 1)\nCodeInfo(\n1 ─ %1 = Base.sitofp(Float64, x)::Float64\n└──      goto #3 if not false\n2 ─      nothing::Nothing\n3 ┄ %4 = invoke Base.Math.sin(%1::Float64)::Float64\n└──      return %4\n)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"I think there's something I'm not understanding"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"1784432c-c120-4c05-b57a-105ae8cbb63f","type":"message","text":"Maybe you want to do something with `code.code` ?\n\n```julia&gt; code.code\n3-element Array{Any,1}:\n :(Base.sitofp(Float64, _2))\n :($(Expr(:invoke, MethodInstance for sin(::Float64), :(Base.Math.sin), :(%1))))\n :(return %2)```","user":"USU9FRPEU","ts":"1616010184.043800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"h6os","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe you want to do something with "},{"type":"text","text":"code.code","style":{"code":true}},{"type":"text","text":" ?\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> code.code\n3-element Array{Any,1}:\n :(Base.sitofp(Float64, _2))\n :($(Expr(:invoke, MethodInstance for sin(::Float64), :(Base.Math.sin), :(%1))))\n :(return %2)"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"d5fa8ef6-dba3-417e-882c-14dd0762d2f9","type":"message","text":"You need the longform function defintion here I think. `@generated` is a bit buggy this way'","user":"UM30MT6RF","ts":"1616010362.045300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ho5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You need the longform function defintion here I think. "},{"type":"text","text":"@generated","style":{"code":true}},{"type":"text","text":" is a bit buggy this way'"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S","reactions":[{"name":"neutral_face","users":["U680THK2S"],"count":1}]},{"client_msg_id":"dfa56b81-616b-47d0-a27c-ee18e6dae4f9","type":"message","text":"```julia&gt; @generated function thing(args...)\n           return code\n       end\nthing (generic function with 2 methods)\n\njulia&gt; Base.invokelatest(thing, 1)\nCodeInfo(\n1 ─ %1 = Base.sitofp(Float64, x)::Float64\n└──      goto #3 if not false\n2 ─      nothing::Nothing\n3 ┄ %4 = invoke Base.Math.sin(%1::Float64)::Float64\n└──      return %4\n)```","user":"U680THK2S","ts":"1616010409.045600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Yu0hp","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @generated function thing(args...)\n           return code\n       end\nthing (generic function with 2 methods)\n\njulia> Base.invokelatest(thing, 1)\nCodeInfo(\n1 ─ %1 = Base.sitofp(Float64, x)::Float64\n└──      goto #3 if not false\n2 ─      nothing::Nothing\n3 ┄ %4 = invoke Base.Math.sin(%1::Float64)::Float64\n└──      return %4\n)"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"09425fd0-99a6-4f71-8fe8-0130f6c4fb2e","type":"message","text":"Also note that you need to match the slots of `sin`, so you can't splat unless you use `Meta.partially_inline!`","user":"UM30MT6RF","ts":"1616010438.045800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/v2c","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Also note that you need to match the slots of "},{"type":"text","text":"sin","style":{"code":true}},{"type":"text","text":", so you can't splat unless you use "},{"type":"text","text":"Meta.partially_inline!","style":{"code":true}}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"9ca0fc26-edcc-4d51-be5a-e984129f810f","type":"message","text":"Ah, okay, well that gets me a bit further: an unexpected error in runtime","user":"U680THK2S","ts":"1616010501.046200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"McvnV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah, okay, well that gets me a bit further: an unexpected error in runtime"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"d946dd4d-019c-4283-810d-facf2fda1645","type":"message","text":"But it returns the correct answer after emitting an error :joy: :thinking_face:","user":"U680THK2S","ts":"1616010525.046800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"654fD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But it returns the correct answer after emitting an error "},{"type":"emoji","name":"joy"},{"type":"text","text":" "},{"type":"emoji","name":"thinking_face"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"d771ccb5-0173-4abd-8924-2a1d3db7f4c7","type":"message","text":"See my message above","user":"UM30MT6RF","ts":"1616010546.047200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fXvo+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"See my message above"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"52aa2461-fe66-46b8-be2f-8e7ed9d93011","type":"message","text":"For context here, I redefined `thing` as `thing(x)` instead of `thing(args...)`","user":"U680THK2S","ts":"1616010575.047600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RkMC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"For context here, I redefined "},{"type":"text","text":"thing","style":{"code":true}},{"type":"text","text":" as "},{"type":"text","text":"thing(x)","style":{"code":true}},{"type":"text","text":" instead of "},{"type":"text","text":"thing(args...)","style":{"code":true}}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"82f7df8c-95a9-404b-a752-775071398313","type":"message","text":"Which I assumed addressed your comment, unless I misunderstood","user":"U680THK2S","ts":"1616010586.047800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"c7=/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Which I assumed addressed your comment, unless I misunderstood"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"e834753a-6fa2-4dc7-bd34-bd7f31c0a0ea","type":"message","text":"Yes, exactly","user":"UM30MT6RF","ts":"1616010596.048000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3sOKo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, exactly"}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"},{"client_msg_id":"eb2d8365-0418-4441-a744-10f05558fe26","type":"message","text":"Alternatively, you would do something like\n```Meta.partially_inline!(\n        code.code, [:($(Core.SlotNumber(1))[$i]) for i in 1:length(args)], Tuple{typeof(thing), args...}, Any[args...],\n        0, 0, :propagate,\n    )```\ninside `thing`","user":"UM30MT6RF","ts":"1616010922.049900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lyUr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Alternatively, you would do something like\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"Meta.partially_inline!(\n        code.code, [:($(Core.SlotNumber(1))[$i]) for i in 1:length(args)], Tuple{typeof(thing), args...}, Any[args...],\n        0, 0, :propagate,\n    )"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"inside "},{"type":"text","text":"thing","style":{"code":true}}]}]}],"thread_ts":"1616008911.041500","parent_user_id":"U680THK2S"}]