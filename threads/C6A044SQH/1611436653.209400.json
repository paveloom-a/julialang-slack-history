[{"client_msg_id":"3952d188-3bf0-448b-9e98-08f8b3eb856e","type":"message","text":"I am trying to see where most of my memory allocation happens and it seems to be (based on .mem file) a line that does\n`grid[ix, iy, iz] += Wx*Wy*Wz`\nwithin a loop. grid is an Array{Float64,3} and W-s are floats. Why does this line require memory allocation?","user":"UPK2KJ95Y","ts":"1611436653.209400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WCMH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I am trying to see where most of my memory allocation happens and it seems to be (based on .mem file) a line that does\n"},{"type":"text","text":"grid[ix, iy, iz] += Wx*Wy*Wz","style":{"code":true}},{"type":"text","text":"\nwithin a loop. grid is an Array{Float64,3} and W-s are floats. Why does this line require memory allocation?"}]}]}],"thread_ts":"1611436653.209400","reply_count":64,"reply_users_count":5,"latest_reply":"1611438865.225100","reply_users":["UH8A351DJ","U7HAYKY9X","UPK2KJ95Y","UH24GRBLL","U011LUQ182G"],"subscribed":false},{"client_msg_id":"627efd59-e1fd-4a33-93bb-4a2e44eed311","type":"message","text":"does `@view` improve here?","user":"UH8A351DJ","ts":"1611436733.209500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"C9mLV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"does "},{"type":"text","text":"@view","style":{"code":true}},{"type":"text","text":" improve here?"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"54ba116d-b9bc-4e45-9090-33d5cd90f7bc","type":"message","text":"That does not allocate, if the types are stable.","user":"U7HAYKY9X","ts":"1611436739.209700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DBZ/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That does not allocate, if the types are stable."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"c6637248-d312-48cf-9734-1a747ae56162","type":"message","text":"You mean Ws may not always be floats?","user":"UPK2KJ95Y","ts":"1611436816.209900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"moxfh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You mean Ws may not always be floats?"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"a6053a5c-5f39-4172-a822-e7583db9025d","type":"message","text":"(nvm I was being stupid, ix, iy, iz are just numbers, yeah there shouldn't be allocation)","user":"UH8A351DJ","ts":"1611436860.210100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qJXYE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(nvm I was being stupid, ix, iy, iz are just numbers, yeah there shouldn't be allocation)"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"eb4fe40a-3301-4f49-9fa8-7d2bad17f904","type":"message","text":"How do I check for type stability?","user":"UPK2KJ95Y","ts":"1611436904.210300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yZOhH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How do I check for type stability?"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"bddff3c2-a67f-461b-9273-7b35dfe849ea","type":"message","text":"`@code_warntype` the function in the REPL","user":"UH24GRBLL","ts":"1611437058.210500","team":"T68168MUP","edited":{"user":"UH24GRBLL","ts":"1611437063.000000"},"blocks":[{"type":"rich_text","block_id":"XLn30","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"@code_warntype","style":{"code":true}},{"type":"text","text":" the function in the REPL"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"77cac191-f82c-4615-9726-3b534d5f1df3","type":"message","text":"Thank you. I get `(Wx * Wy * Wz)::Union{Float64, Int64}`","user":"UPK2KJ95Y","ts":"1611437156.210800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WtE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thank you. I get "},{"type":"text","text":"(Wx * Wy * Wz)::Union{Float64, Int64}","style":{"code":true}}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"978fa560-3239-4fbb-81e2-6e11feabc1ae","type":"message","text":"How do I make this type stable? I know this will always be a float.","user":"UPK2KJ95Y","ts":"1611437190.211000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HT3E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How do I make this type stable? I know this will always be a float."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"cc12e246-0a93-4404-88ce-3ba4f37815b5","type":"message","text":"there is probably a line above where Wx,Wy, or Wz are set ambiguously","user":"U011LUQ182G","ts":"1611437203.211200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1jc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"there is probably a line above where Wx,Wy, or Wz are set ambiguously"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"c7ea13d1-b9a8-4afc-887b-124478465424","type":"message","text":"Still shouldn't allocate, if there are only two possible types","user":"U7HAYKY9X","ts":"1611437206.211400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"B8l8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Still shouldn't allocate, if there are only two possible types"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"7b8d0cba-90aa-43f4-ba07-525e10644daa","type":"message","text":"Just to make sure I understand the output in the .mem file correctly.","user":"UPK2KJ95Y","ts":"1611437304.211600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SQgw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Just to make sure I understand the output in the .mem file correctly."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"type":"message","text":"","files":[{"id":"F01KNUD2L1Z","created":1611437306,"timestamp":1611437306,"name":"image.png","title":"image.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"UPK2KJ95Y","editable":false,"size":44027,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01KNUD2L1Z/image.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01KNUD2L1Z/download/image.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01KNUD2L1Z-3b02ec3b1f/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01KNUD2L1Z-3b02ec3b1f/image_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01KNUD2L1Z-3b02ec3b1f/image_360.png","thumb_360_w":360,"thumb_360_h":244,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01KNUD2L1Z-3b02ec3b1f/image_480.png","thumb_480_w":480,"thumb_480_h":325,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01KNUD2L1Z-3b02ec3b1f/image_160.png","original_w":701,"original_h":475,"thumb_tiny":"AwAgADDPyc0DkfSk7mgUAO5pGznmlIGKacdjQAlFLSUAL3NJTs89qT60APBzSHJ7Cm5I6UbjQAfhRRRQB//Z","permalink":"https://julialang.slack.com/files/UPK2KJ95Y/F01KNUD2L1Z/image.png","permalink_public":"https://slack-files.com/T68168MUP-F01KNUD2L1Z-806b5662bd","is_starred":false,"has_rich_preview":false}],"upload":false,"user":"UPK2KJ95Y","display_as_bot":false,"ts":"1611437308.211800","thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"5b272e13-a971-4f09-a5e8-8ce6d91635f7","type":"message","text":"This means a lot of allocation on line 105, right?","user":"UPK2KJ95Y","ts":"1611437319.212200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b0vT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This means a lot of allocation on line 105, right?"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"5fef0399-2a6c-4441-b0f4-25f4fabd0718","type":"message","text":"~not really right? notice creation of this big matrix is already 1/5 of that allocation. wait no~ nvm, I can't align digits","user":"UH8A351DJ","ts":"1611437381.212400","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1611437430.000000"},"blocks":[{"type":"rich_text","block_id":"njj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"not really right? notice creation of this big matrix is already 1/5 of that allocation. wait no","style":{"strike":true}},{"type":"text","text":" nvm, I can't align digits"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"957d0531-6fe9-4a9d-b178-43ee28e6ccb8","type":"message","text":"Yeah... try to paste in the output of `@code_warntype` ?","user":"U7HAYKY9X","ts":"1611437402.212600","team":"T68168MUP","edited":{"user":"U7HAYKY9X","ts":"1611437419.000000"},"blocks":[{"type":"rich_text","block_id":"VaPj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah... try to paste in the output of "},{"type":"text","text":"@code_warntype","style":{"code":true}},{"type":"text","text":" ?"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"95ec212c-b627-484b-883c-0a3fc503a5d6","type":"message","text":"All of it?","user":"UPK2KJ95Y","ts":"1611437428.213000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8kZ6Y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"All of it?"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"674115e9-ac18-4e90-b8fc-8b24302b7415","type":"message","text":"you can use the `Create a snippet` function of Slack, click on the :lightning: below the chat box","user":"UH8A351DJ","ts":"1611437447.213300","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1611437463.000000"},"blocks":[{"type":"rich_text","block_id":"4Z1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can use the "},{"type":"text","text":"Create a snippet","style":{"code":true}},{"type":"text","text":" function of Slack, click on the "},{"type":"emoji","name":"lightning"},{"type":"text","text":" below the chat box"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"type":"message","text":"","files":[{"id":"F01KKKVN893","created":1611437559,"timestamp":1611437559,"name":"Untitled","title":"Untitled","mimetype":"text/plain","filetype":"text","pretty_type":"Plain Text","user":"UPK2KJ95Y","editable":true,"size":5138,"mode":"snippet","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01KKKVN893/untitled","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01KKKVN893/download/untitled","permalink":"https://julialang.slack.com/files/UPK2KJ95Y/F01KKKVN893/untitled","permalink_public":"https://slack-files.com/T68168MUP-F01KKKVN893-f269ef9e84","edit_link":"https://julialang.slack.com/files/UPK2KJ95Y/F01KKKVN893/untitled/edit","preview":"Variables\n  #self#::Core.Compiler.Const(grid_r, false)\n  Ngrid::Int64\n  x::Array{Float64,1}\n  y::Array{Float64,1}","preview_highlight":"<div class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\">\n<div class=\"CodeMirror-code\">\n<div><pre>Variables</pre></div>\n<div><pre>  #self#::Core.Compiler.Const(grid_r, false)</pre></div>\n<div><pre>  Ngrid::Int64</pre></div>\n<div><pre>  x::Array{Float64,1}</pre></div>\n<div><pre>  y::Array{Float64,1}</pre></div>\n</div>\n</div>\n","lines":142,"lines_more":137,"preview_is_truncated":true,"is_starred":false,"has_rich_preview":false}],"upload":true,"user":"UPK2KJ95Y","display_as_bot":false,"ts":"1611437560.213700","client_msg_id":"944382a5-6e28-4c3e-81b2-6bfa8aff6a95","thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"019aaf13-f493-455e-8bd6-2b14c0b047bc","type":"message","text":"looks like it's Unioned with `Nothing`, this hurts alot","user":"UH8A351DJ","ts":"1611437659.214100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zTAr/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"looks like it's Unioned with "},{"type":"text","text":"Nothing","style":{"code":true}},{"type":"text","text":", this hurts alot"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"bf040aaf-3b43-45b7-8870-7be1e760eed7","type":"message","text":"where?","user":"UPK2KJ95Y","ts":"1611437670.214300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Z=Jd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"where?"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"e0b25531-fb96-4dde-a87c-eb309216cf1e","type":"message","text":"Oh, I see.","user":"UPK2KJ95Y","ts":"1611437696.214500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JJp=W","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh, I see."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"5e8d44e5-20d4-48ec-9041-47ef33ed73cc","type":"message","text":"I may have an idea why that's the case","user":"UPK2KJ95Y","ts":"1611437758.214700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UUH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I may have an idea why that's the case"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"b8b90d8b-9f39-4c82-b5d5-7a578aa92334","type":"message","text":"Will check.","user":"UPK2KJ95Y","ts":"1611437765.214900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OtJ4R","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Will check."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"13c590af-18e1-4cea-b47c-1ccbbb47dfdd","type":"message","text":"&gt; `  Wx::Union{Nothing, Float64, Int64}`\nthat is one expensive thing!","user":"UH24GRBLL","ts":"1611437821.215100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RIz1","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"`  Wx::Union{Nothing, Float64, Int64}`"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nthat is one expensive thing!"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"e4bc61d2-fcfd-443c-a4d1-325d17034a2a","type":"message","text":"OK, what I thought would fix it does not fix it.","user":"UPK2KJ95Y","ts":"1611437838.215300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Fz5n","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"OK, what I thought would fix it does not fix it."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"c57d8b89-d990-4c3f-8c9b-3845eb8ad888","type":"message","text":"not only `::Nothing` will have to be checked, but also whether to promote types!","user":"UH24GRBLL","ts":"1611437842.215500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"h1Sm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"not only "},{"type":"text","text":"::Nothing","style":{"code":true}},{"type":"text","text":" will have to be checked, but also whether to promote types!"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"6710bd93-eac3-4f7d-929d-45084d7f0f33","type":"message","text":"This is a function that returns W:","user":"UPK2KJ95Y","ts":"1611437850.215700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/iG=Y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is a function that returns W:"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"type":"message","text":"","files":[{"id":"F01LCHW9JSU","created":1611437858,"timestamp":1611437858,"name":"Untitled","title":"Untitled","mimetype":"text/plain","filetype":"text","pretty_type":"Plain Text","user":"UPK2KJ95Y","editable":true,"size":633,"mode":"snippet","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01LCHW9JSU/untitled","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01LCHW9JSU/download/untitled","permalink":"https://julialang.slack.com/files/UPK2KJ95Y/F01LCHW9JSU/untitled","permalink_public":"https://slack-files.com/T68168MUP-F01LCHW9JSU-88ce2a5b00","edit_link":"https://julialang.slack.com/files/UPK2KJ95Y/F01LCHW9JSU/untitled/edit","preview":"function Weight(s, order)\n    if order == 1\n        if s < 1\n            return 1\n        else","preview_highlight":"<div class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\">\n<div class=\"CodeMirror-code\">\n<div><pre>function Weight(s, order)</pre></div>\n<div><pre>    if order == 1</pre></div>\n<div><pre>        if s &lt; 1</pre></div>\n<div><pre>            return 1</pre></div>\n<div><pre>        else</pre></div>\n</div>\n</div>\n","lines":35,"lines_more":30,"preview_is_truncated":false,"is_starred":false,"has_rich_preview":false}],"upload":true,"user":"UPK2KJ95Y","display_as_bot":false,"ts":"1611437859.215900","client_msg_id":"2a55795a-3528-41c5-8cd4-08d6eb4f0d40","thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"f0f4b045-2446-4b50-a875-941764f00d3a","type":"message","text":"`(Wx = Main.Weight(sx, order))`\n\nseems like this is unstable","user":"UH24GRBLL","ts":"1611437862.216300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RVme","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(Wx = Main.Weight(sx, order))","style":{"code":true}},{"type":"text","text":"\n\nseems like this is unstable"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"038fb652-b066-45ce-bc5e-47d73b8a1517","type":"message","text":"It seems to me that Weight could only result in a float or an int","user":"UPK2KJ95Y","ts":"1611437884.216500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Vd1JE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It seems to me that Weight could only result in a float or an int"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"ffbf6f92-6e7a-4837-97bb-e47d935bfe30","type":"message","text":"where's `order` from?","user":"UH24GRBLL","ts":"1611437976.216700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2OE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"where's "},{"type":"text","text":"order","style":{"code":true}},{"type":"text","text":" from?"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"ef97727d-e298-4b64-bdd5-ec0d6e42ef52","type":"message","text":"I explicitly provide it to the function when I call it.","user":"UPK2KJ95Y","ts":"1611437997.216900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"qz8Kn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I explicitly provide it to the function when I call it."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"ce5751e0-fac0-4a54-89d9-3f45841079a0","type":"message","text":"grid_r(Ngrid, x, y, z, order)","user":"UPK2KJ95Y","ts":"1611438007.217100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0Vn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"grid_r(Ngrid, x, y, z, order)"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"b38cc10c-771e-460a-9b4c-f76cefb77c62","type":"message","text":"and then pass it along to Weight(s, order)","user":"UPK2KJ95Y","ts":"1611438016.217300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KbZz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and then pass it along to Weight(s, order)"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"3c1b7b14-116b-4f1e-a732-42ae45ac5e92","type":"message","text":"yes, missed it","user":"UH24GRBLL","ts":"1611438049.217500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sz5jo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yes, missed it"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"030bf32d-5faa-48cb-886f-1fc35dc4eea7","type":"message","text":"can you paste/gist the code for the calling function? it's hard to follow the lowered code here","user":"UH24GRBLL","ts":"1611438067.217700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XE7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"can you paste/gist the code for the calling function? it's hard to follow the lowered code here"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"80d20640-aba9-47a9-a44b-f3505d543a1d","type":"message","text":"OK","user":"UPK2KJ95Y","ts":"1611438077.217900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DMC0p","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"OK"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"type":"message","text":"","files":[{"id":"F01L1BPN2EM","created":1611438119,"timestamp":1611438119,"name":"Untitled","title":"Untitled","mimetype":"text/plain","filetype":"text","pretty_type":"Plain Text","user":"UPK2KJ95Y","editable":true,"size":1198,"mode":"snippet","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01L1BPN2EM/untitled","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01L1BPN2EM/download/untitled","permalink":"https://julialang.slack.com/files/UPK2KJ95Y/F01L1BPN2EM/untitled","permalink_public":"https://slack-files.com/T68168MUP-F01L1BPN2EM-302c222012","edit_link":"https://julialang.slack.com/files/UPK2KJ95Y/F01L1BPN2EM/untitled/edit","preview":"function grid_r(Ngrid, x, y, z, order)\n\n    xmax = maximum(x)\n    xmin = minimum(x)\n    ymax = maximum(y)","preview_highlight":"<div class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\">\n<div class=\"CodeMirror-code\">\n<div><pre>function grid_r(Ngrid, x, y, z, order)</pre></div>\n<div><pre></pre></div>\n<div><pre>    xmax = maximum(x)</pre></div>\n<div><pre>    xmin = minimum(x)</pre></div>\n<div><pre>    ymax = maximum(y)</pre></div>\n</div>\n</div>\n","lines":50,"lines_more":45,"preview_is_truncated":true,"is_starred":false,"has_rich_preview":false}],"upload":true,"user":"UPK2KJ95Y","display_as_bot":false,"ts":"1611438120.218400","client_msg_id":"2ee8d43c-d9c7-4ccb-b6ef-eecd3c876d25","thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"type":"message","text":"","files":[{"id":"F01K7V9NKCP","created":1611438145,"timestamp":1611438145,"name":"Untitled","title":"Untitled","mimetype":"text/plain","filetype":"text","pretty_type":"Plain Text","user":"UPK2KJ95Y","editable":true,"size":149,"mode":"snippet","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01K7V9NKCP/untitled","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01K7V9NKCP/download/untitled","permalink":"https://julialang.slack.com/files/UPK2KJ95Y/F01K7V9NKCP/untitled","permalink_public":"https://slack-files.com/T68168MUP-F01K7V9NKCP-c24552b58f","edit_link":"https://julialang.slack.com/files/UPK2KJ95Y/F01K7V9NKCP/untitled/edit","preview":"function distance_to_grid(x, dL, index, Ngrid)\n    s = abs(x - (dL*index - dL/2))/dL\n    if s > Ngrid/2\n        s -= Ngrid/2\n    end","preview_highlight":"<div class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\">\n<div class=\"CodeMirror-code\">\n<div><pre>function distance_to_grid(x, dL, index, Ngrid)</pre></div>\n<div><pre>    s = abs(x - (dL*index - dL/2))/dL</pre></div>\n<div><pre>    if s &gt; Ngrid/2</pre></div>\n<div><pre>        s -= Ngrid/2</pre></div>\n<div><pre>    end</pre></div>\n</div>\n</div>\n","lines":7,"lines_more":2,"preview_is_truncated":false,"is_starred":false,"has_rich_preview":false}],"upload":true,"user":"UPK2KJ95Y","display_as_bot":false,"ts":"1611438146.219200","client_msg_id":"b246d550-1742-438d-b121-3c49ba4c72c9","thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"a90adfdd-a7e1-4b13-b69e-1ad6619c5156","type":"message","text":"the instability in `Weight` between float and int in itself is already bad, since it forces type conversions and lookups which function to call down the road","user":"UH24GRBLL","ts":"1611438189.219600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"64qf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the instability in "},{"type":"text","text":"Weight","style":{"code":true}},{"type":"text","text":" between float and int in itself is already bad, since it forces type conversions and lookups which function to call down the road"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"9a0d40a4-4bd0-4a37-8232-49d34a317982","type":"message","text":"I changed all numbers in there with explicit floats but it does not seem to help. Here is a new version:","user":"UPK2KJ95Y","ts":"1611438245.219800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"H/Zm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I changed all numbers in there with explicit floats but it does not seem to help. Here is a new version:"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"d814db3b-6597-4de4-8cb1-0b4cb4f98861","type":"message","text":"what is passed to `grid_r`?","user":"UH24GRBLL","ts":"1611438278.220300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Wjxnm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what is passed to "},{"type":"text","text":"grid_r","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"78521f31-bb14-448f-afa1-0fc2db133e65","type":"message","text":"sorry, I take that back.","user":"UPK2KJ95Y","ts":"1611438288.220500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"L4q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"sorry, I take that back."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"76b4222b-63b3-471e-87f4-a565bb1f1bbb","type":"message","text":"and `distance_to_grid`","user":"UH24GRBLL","ts":"1611438289.220700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Czg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and "},{"type":"text","text":"distance_to_grid","style":{"code":true}}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"9734e3c8-66dc-4882-b762-8ffb6f247ca0","type":"message","text":"This is a new version of Weight","user":"UPK2KJ95Y","ts":"1611438297.220900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9Wa8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is a new version of Weight"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"type":"message","text":"New weight","files":[{"id":"F01KFV8N8NS","created":1611438319,"timestamp":1611438319,"name":"Untitled","title":"Untitled","mimetype":"text/plain","filetype":"text","pretty_type":"Plain Text","user":"UPK2KJ95Y","editable":true,"size":669,"mode":"snippet","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01KFV8N8NS/untitled","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01KFV8N8NS/download/untitled","permalink":"https://julialang.slack.com/files/UPK2KJ95Y/F01KFV8N8NS/untitled","permalink_public":"https://slack-files.com/T68168MUP-F01KFV8N8NS-5f7a150903","edit_link":"https://julialang.slack.com/files/UPK2KJ95Y/F01KFV8N8NS/untitled/edit","preview":"function Weight(s, order)\n    if order == 1\n        if s < 1.0\n            return 1.0\n        else","preview_highlight":"<div class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\">\n<div class=\"CodeMirror-code\">\n<div><pre>function Weight(s, order)</pre></div>\n<div><pre>    if order == 1</pre></div>\n<div><pre>        if s &lt; 1.0</pre></div>\n<div><pre>            return 1.0</pre></div>\n<div><pre>        else</pre></div>\n</div>\n</div>\n","lines":35,"lines_more":30,"preview_is_truncated":false,"is_starred":false,"has_rich_preview":false}],"upload":true,"blocks":[{"type":"rich_text","block_id":"Xgejh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"New weight"}]}]}],"user":"UPK2KJ95Y","display_as_bot":false,"ts":"1611438322.221200","client_msg_id":"5c192abf-18b5-4681-9929-181c4596a516","thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"9306557c-b27d-46b2-b37a-131c12bf34ae","type":"message","text":"Now W? is marked as float everywhere","user":"UPK2KJ95Y","ts":"1611438358.221600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VGZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Now W? is marked as float everywhere"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"4b5a53c2-f60a-4e00-8bf9-93055e03a65f","type":"message","text":"This may fix the allocation problem./","user":"UPK2KJ95Y","ts":"1611438368.221800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EHD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This may fix the allocation problem./"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"fca84f90-4ddc-40a5-b123-432d295dba40","type":"message","text":"OK, thanks everyone.","user":"UPK2KJ95Y","ts":"1611438404.222000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+hot","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"OK, thanks everyone."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"7268bdc0-c297-4767-86b7-c06e104ae2cc","type":"message","text":"So what did I learn from this? Always put floating point numbers unless you really mean integer?","user":"UPK2KJ95Y","ts":"1611438429.222200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FvM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So what did I learn from this? Always put floating point numbers unless you really mean integer?"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"8aea77b2-6aae-49d6-a447-34a7e851f718","type":"message","text":"make sure not to mix return types","user":"UH24GRBLL","ts":"1611438524.222400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pTUI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"make sure not to mix return types"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y","reactions":[{"name":"point_up","users":["U011LUQ182G"],"count":1}]},{"client_msg_id":"fd46ba91-c54d-4b42-b3f1-bb2c46c7685c","type":"message","text":"or use fewer explicit return paths and do something like `return float(retValue)` at the end","user":"UH24GRBLL","ts":"1611438582.222600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nMcy8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"or use fewer explicit return paths and do something like "},{"type":"text","text":"return float(retValue)","style":{"code":true}},{"type":"text","text":" at the end"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"9ab10f57-6d2c-470f-a517-5961b5b33788","type":"message","text":"that also helps with not forgetting some branch","user":"UH24GRBLL","ts":"1611438606.222800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tJb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that also helps with not forgetting some branch"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"4a705fac-33c3-4778-b4c4-d918d2a1e629","type":"message","text":":+1:","user":"UPK2KJ95Y","ts":"1611438642.223000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"d5T","elements":[{"type":"rich_text_section","elements":[{"type":"emoji","name":"+1"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"733ae8b0-b446-4163-b326-aa5daba5f009","type":"message","text":"also, is there maybe some better/closed form of this? one that requires fewer branches to check maybe","user":"UH24GRBLL","ts":"1611438664.223200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"z8v1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"also, is there maybe some better/closed form of this? one that requires fewer branches to check maybe"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"55fdfb40-9709-4f51-8d8a-d26fcbb3cdaf","type":"message","text":"fewer branches generally lead to faster code (unless they can be compiled away by constant propagation, but that doesn't apply here)","user":"UH24GRBLL","ts":"1611438699.223500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=YYjG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"fewer branches generally lead to faster code (unless they can be compiled away by constant propagation, but that doesn't apply here)"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"acef34b8-d38e-4149-83f4-d64444ad884e","type":"message","text":"I am not sure. There may be but I don't see it immediately.","user":"UPK2KJ95Y","ts":"1611438729.223700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"35d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I am not sure. There may be but I don't see it immediately."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"f3a4c3be-539a-481c-b544-c00e4765ec7b","type":"message","text":"This may just be four different formulas that I combine in one function for convenience.","user":"UPK2KJ95Y","ts":"1611438744.223900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ab+1W","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This may just be four different formulas that I combine in one function for convenience."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"cebcc9c1-e993-425b-9773-0ba51f369265","type":"message","text":"If I split it into four separate functions would that make things faster?","user":"UPK2KJ95Y","ts":"1611438757.224100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oaY+5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If I split it into four separate functions would that make things faster?"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"a6bcf85f-1526-48fa-81bf-9e432c69a419","type":"message","text":"maybe not faster, but easier on the compiler to figure out","user":"UH24GRBLL","ts":"1611438772.224300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"n9Z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"maybe not faster, but easier on the compiler to figure out"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"657514e2-f084-4ce1-a4e3-aa8a2bd0e85a","type":"message","text":"I will only need one of them at any time I run the code.","user":"UPK2KJ95Y","ts":"1611438773.224500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bg9e","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I will only need one of them at any time I run the code."}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"5d9be7f7-ff2a-4d8b-b164-7f1f8e9d573f","type":"message","text":"OK","user":"UPK2KJ95Y","ts":"1611438776.224700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"54Xj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"OK"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"9450a73f-f04d-444f-966e-2e8d3c7f7682","type":"message","text":"sub-functions usually don't hurt performance","user":"UH24GRBLL","ts":"1611438785.224900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2Sp3/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"sub-functions usually don't hurt performance"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"},{"client_msg_id":"da88fa41-19c5-4887-bf6c-a908759fce3a","type":"message","text":"to the contrary, function barriers in loop are a good tool to use if the loop is inherently type unstable but you want fast code in the body itself - instead of dynamic dispatches everywhere in the loop, if you only dispatch once to a subfunction, the inner function will still be optimized for the actualy type","user":"UH24GRBLL","ts":"1611438865.225100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1G0","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"to the contrary, function barriers in loop are a good tool to use if the loop is inherently type unstable but you want fast code in the body itself - instead of dynamic dispatches everywhere in the loop, if you only dispatch once to a subfunction, the inner function will still be optimized for the actualy type"}]}]}],"thread_ts":"1611436653.209400","parent_user_id":"UPK2KJ95Y"}]