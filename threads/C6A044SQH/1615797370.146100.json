[{"client_msg_id":"bc5f52d6-dfef-4935-8b88-89dae460c983","type":"message","text":"Hi,\n\nI am trying @avx from LoopVectorization but it returns an error which I dont undertand:\n\n```function Fks1d(a, p)\n\t@unpack Δ, Δ2, λ, N, M = p\n\tout = 4 .* (Δ2 .* a)\n\tout .+= λ .* (Δ .* a)\n\t# if 1==1\n\t\t@avx for k in 1:N\n\t\t\tout[k] += @views 2λ * k * a[k] * sum(a[k+1:N])\n\t\t\tfor l = 1:k-1\n\t\t\t\tout[k] -= λ * k * a[l] * a[k-l]\n\t\t\tend\n\t\tend\n\t\t# out .+= λ .* coefficients((Fun(SinSpace(), a)^2)')[1:N]\n\t# else\n\t# \tupdateM!(M, a)\n\t# \tout .+= λ .* (M * a)\n\t# end\n\tout .*= -1\n\treturn out\nend\n\nrhs=rand(N)\nFks1d(rhs, par_ks)```\nreturns\n```julia&gt; Fks1d(rhs, par_ks)\nERROR: UndefVarError: k not defined\nStacktrace:\n [1] Fks1d(a::Vector{Float64}, p::NamedTuple{(:Δ, :Δ2, :λ, :N, :M), Tuple{Vector{Int64}, Vector{Int64}, Float64, Int64, BandedMatrix{Float64, Matrix{Float64}, Base.OneTo{Int64}}}})\n   @ Main ~/work/prog_gd/julia/continuationExamples/KS1d-cos.jl:30\n [2] top-level scope\n   @ none:1```\nCan someone give me a hand please?","user":"U7GQE9JP9","ts":"1615797370.146100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pvWis","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi,\n\nI am trying @avx from LoopVectorization but it returns an error which I dont undertand:\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function Fks1d(a, p)\n\t@unpack Δ, Δ2, λ, N, M = p\n\tout = 4 .* (Δ2 .* a)\n\tout .+= λ .* (Δ .* a)\n\t# if 1==1\n\t\t@avx for k in 1:N\n\t\t\tout[k] += @views 2λ * k * a[k] * sum(a[k+1:N])\n\t\t\tfor l = 1:k-1\n\t\t\t\tout[k] -= λ * k * a[l] * a[k-l]\n\t\t\tend\n\t\tend\n\t\t# out .+= λ .* coefficients((Fun(SinSpace(), a)^2)')[1:N]\n\t# else\n\t# \tupdateM!(M, a)\n\t# \tout .+= λ .* (M * a)\n\t# end\n\tout .*= -1\n\treturn out\nend\n\nrhs=rand(N)\nFks1d(rhs, par_ks)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"returns\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> Fks1d(rhs, par_ks)\nERROR: UndefVarError: k not defined\nStacktrace:\n [1] Fks1d(a::Vector{Float64}, p::NamedTuple{(:Δ, :Δ2, :λ, :N, :M), Tuple{Vector{Int64}, Vector{Int64}, Float64, Int64, BandedMatrix{Float64, Matrix{Float64}, Base.OneTo{Int64}}}})\n   @ Main ~/work/prog_gd/julia/continuationExamples/KS1d-cos.jl:30\n [2] top-level scope\n   @ none:1"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Can someone give me a hand please?"}]}]}],"thread_ts":"1615797370.146100","reply_count":7,"reply_users_count":4,"latest_reply":"1615895948.010400","reply_users":["B01J9QZ4SP8","U7HAYKY9X","U7GQE9JP9","UAUPJLBQX"],"subscribed":false},{"type":"message","subtype":"bot_message","text":"Can we cross post this publicly to <https://discourse.julialang.org|Discourse> for further visibility? React with :bridge: on the message above to approve. <https://github.com/JuliaCommunity/SlackBridge/blob/main/README.md#faq|More info here>","ts":"1615797372.146200","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1615797370.146100","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"818e48eb-4fdf-4a9a-9d82-6ba47b22338b","type":"message","text":"Does it work without LoopVectorization? If so, raise an issue on the LoopVectorization GitHub","user":"U7HAYKY9X","ts":"1615814536.147800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SAVc3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Does it work without LoopVectorization? If so, raise an issue on the LoopVectorization GitHub"}]}]}],"thread_ts":"1615797370.146100","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"7e55ce15-4b3c-40e8-b104-400e6abe1acb","type":"message","text":"Yes it does","user":"U7GQE9JP9","ts":"1615825898.160100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rcN2H","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes it does"}]}]}],"thread_ts":"1615797370.146100","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"50c4df95-7c4a-4bcf-8f95-7fc120223962","type":"message","text":"`@views 2λ * k * a[k] * sum(a[k+1:N])` isn't supported/understood by LoopVectorization currently","user":"UAUPJLBQX","ts":"1615895766.009800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ApC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"@views 2λ * k * a[k] * sum(a[k+1:N])","style":{"code":true}},{"type":"text","text":" isn't supported/understood by LoopVectorization currently"}]}]}],"thread_ts":"1615797370.146100","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"f09bd0ee-255a-4781-bd77-b9c1cc4c6c9f","type":"message","text":"I'd do something like evaluate `reverse(cumsum(reverse(a)))`  before hand and index into it.","user":"UAUPJLBQX","ts":"1615895872.010000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UaD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'd do something like evaluate "},{"type":"text","text":"reverse(cumsum(reverse(a)))","style":{"code":true}},{"type":"text","text":"  before hand and index into it."}]}]}],"thread_ts":"1615797370.146100","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"116c6ece-1900-4abf-a77f-48112df34300","type":"message","text":"you could do it more efficiently than that, of course, but aside from getting rid of the thing loopvectorization doesn't understand, it'd also be better to evaluate all the sums just once","user":"UAUPJLBQX","ts":"1615895931.010200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nhZd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you could do it more efficiently than that, of course, but aside from getting rid of the thing loopvectorization doesn't understand, it'd also be better to evaluate all the sums just once"}]}]}],"thread_ts":"1615797370.146100","parent_user_id":"U7GQE9JP9"},{"client_msg_id":"1e798446-7999-4437-96c2-0ee197fa0e1c","type":"message","text":"i.e., make that sum O(N) instead of O(N^2)","user":"UAUPJLBQX","ts":"1615895948.010400","team":"T68168MUP","edited":{"user":"UAUPJLBQX","ts":"1615895977.000000"},"blocks":[{"type":"rich_text","block_id":"eus1c","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"i.e., make that sum O(N) instead of O(N^2)"}]}]}],"thread_ts":"1615797370.146100","parent_user_id":"U7GQE9JP9"}]