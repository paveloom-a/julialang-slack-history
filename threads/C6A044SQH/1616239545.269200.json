[{"client_msg_id":"f4bfd098-3dcd-4ad8-bc68-1471368f47ab","type":"message","text":"Are there any rules on broadcasted assignments when the array is on both the left and the right side of the assignment? For example\n```\njulia&gt; x = Float64[2,3,4];\n\njulia&gt; x ./= (@view x[[1,1,1]])\n3-element Vector{Float64}:\n 1.0\n 1.5\n 2.0```\nseems to work as I would expect, but I could imagine that it could as well return `[1.0, 3.0, 4.0]`","user":"UBEF50B7C","ts":"1616239545.269200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FjK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Are there any rules on broadcasted assignments when the array is on both the left and the right side of the assignment? For example\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"\njulia> x = Float64[2,3,4];\n\njulia> x ./= (@view x[[1,1,1]])\n3-element Vector{Float64}:\n 1.0\n 1.5\n 2.0"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"seems to work as I would expect, but I could imagine that it could as well return "},{"type":"text","text":"[1.0, 3.0, 4.0]","style":{"code":true}}]}]}],"thread_ts":"1616239545.269200","reply_count":9,"reply_users_count":3,"latest_reply":"1616324888.293100","reply_users":["U012XER8K4M","UBEF50B7C","U6N6VQE30"],"subscribed":false},{"client_msg_id":"f2228f32-ef3a-4a00-bc68-ff678d718a4a","type":"message","text":"I don't understand why it would ever become [1.0, 3.0, 4.0]","user":"U012XER8K4M","ts":"1616240014.269300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"N/rDj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't understand why it would ever become [1.0, 3.0, 4.0]"}]}]}],"thread_ts":"1616239545.269200","parent_user_id":"UBEF50B7C"},{"client_msg_id":"5f1996eb-367e-4619-abd2-e4cb8a8c72ca","type":"message","text":"Because of the order of operations:\n\nIf `x[1]`  is assigned `x[1] \\ x[1] == 1.0`  and then this value is used to calculate\n`x[2] = x[2] \\ x[1]` , then `x[2]` would keep the value 3.0","user":"UBEF50B7C","ts":"1616240162.269500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"v7o","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Because of the order of operations:\n\nIf "},{"type":"text","text":"x[1]","style":{"code":true}},{"type":"text","text":"  is assigned "},{"type":"text","text":"x[1] \\ x[1] == 1.0","style":{"code":true}},{"type":"text","text":"  and then this value is used to calculate\n"},{"type":"text","text":"x[2] = x[2] \\ x[1]","style":{"code":true}},{"type":"text","text":" , then "},{"type":"text","text":"x[2]","style":{"code":true}},{"type":"text","text":" would keep the value 3.0"}]}]}],"thread_ts":"1616239545.269200","parent_user_id":"UBEF50B7C"},{"client_msg_id":"dbc8f986-d53e-4e43-b488-8f77231ca29a","type":"message","text":"I believe it copies when it aliases","user":"U6N6VQE30","ts":"1616240343.269700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iFf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I believe it copies when it aliases"}]}]}],"thread_ts":"1616239545.269200","parent_user_id":"UBEF50B7C"},{"client_msg_id":"2c7c31c6-5740-4dc6-8f52-70654e2d5783","type":"message","text":"so I guess the safest thing is probably to create the copy explicitly as otherwise  one might be in for some surprise when using a different collecting type","user":"UBEF50B7C","ts":"1616240775.269900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WkdeS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so I guess the safest thing is probably to create the copy explicitly as otherwise  one might be in for some surprise when using a different collecting type"}]}]}],"thread_ts":"1616239545.269200","parent_user_id":"UBEF50B7C"},{"client_msg_id":"90499f4f-eced-460c-8dd4-34de885093d8","type":"message","text":"I think it shouldn't be necessary, but it would do the same","user":"U6N6VQE30","ts":"1616241271.270100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"leAA2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think it shouldn't be necessary, but it would do the same"}]}]}],"thread_ts":"1616239545.269200","parent_user_id":"UBEF50B7C"},{"client_msg_id":"4655809b-67fb-4083-b919-6b097ab5c303","type":"message","text":"yeah, but what I am actually doing is more like\n```d = @view m[diagind(m)]\nm ./= sqrt.(d .* d')```\nfor some square matrix `m`, so there it is even less sure if evaluation happens in the right order","user":"UBEF50B7C","ts":"1616260532.276400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zjz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, but what I am actually doing is more like\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"d = @view m[diagind(m)]\nm ./= sqrt.(d .* d')"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"for some square matrix "},{"type":"text","text":"m","style":{"code":true}},{"type":"text","text":", so there it is even less sure if evaluation happens in the right order"}]}]}],"thread_ts":"1616239545.269200","parent_user_id":"UBEF50B7C"},{"client_msg_id":"056ebf1a-8f3d-4652-bf5e-33a7c8d29306","type":"message","text":"it'll detect the alias :upside_down_face:","user":"U6N6VQE30","ts":"1616324478.292700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"np8D","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it'll detect the alias "},{"type":"emoji","name":"upside_down_face"}]}]}],"thread_ts":"1616239545.269200","parent_user_id":"UBEF50B7C"},{"client_msg_id":"a22375f2-ca3e-4324-adc4-0620ff178588","type":"message","text":"it will make two copies of d, so it's not perfect, but it be safe from aliasing issues","user":"U6N6VQE30","ts":"1616324550.292900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EM5R","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it will make two copies of d, so it's not perfect, but it be safe from aliasing issues"}]}]}],"thread_ts":"1616239545.269200","parent_user_id":"UBEF50B7C"},{"client_msg_id":"4141d975-821c-4aa0-a8a5-944b96c41ebe","type":"message","text":"```julia&gt; using Debugger\n\njulia&gt; breakpoint(Base.unaliascopy)\n\njulia&gt; using LinearAlgebra\n\njulia&gt; function f(m)\n         d = @view m[diagind(m)]\n         m ./= d .* d'\n       end\n\njulia&gt; @run f(rand(10, 10))\nHit breakpoint:\nIn unaliascopy(V) at subarray.jl:103\n...\n1|julia&gt; V\n10-element view(::Vector{Float64}, 1:11:100) with eltype Float64:\n...\n1|debug&gt; c\nHit breakpoint:\nIn unaliascopy(A) at /home/harmen/julia-1.6.0-rc1/share/julia/stdlib/v1.6/LinearAlgebra/src/adjtrans.jl:99```\n","user":"U6N6VQE30","ts":"1616324888.293100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XnkH","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> using Debugger\n\njulia> breakpoint(Base.unaliascopy)\n\njulia> using LinearAlgebra\n\njulia> function f(m)\n         d = @view m[diagind(m)]\n         m ./= d .* d'\n       end\n\njulia> @run f(rand(10, 10))\nHit breakpoint:\nIn unaliascopy(V) at subarray.jl:103\n...\n1|julia> V\n10-element view(::Vector{Float64}, 1:11:100) with eltype Float64:\n...\n1|debug> c\nHit breakpoint:\nIn unaliascopy(A) at /home/harmen/julia-1.6.0-rc1/share/julia/stdlib/v1.6/LinearAlgebra/src/adjtrans.jl:99"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1616239545.269200","parent_user_id":"UBEF50B7C"}]