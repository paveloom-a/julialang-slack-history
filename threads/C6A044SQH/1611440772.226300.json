[{"client_msg_id":"7ec6cef3-55c1-48e2-9756-906278becd58","type":"message","text":"is it possible to make a view of a diagonal of a matrix, without allocations?\n```julia&gt; m = rand(5,5)\n5×5 Array{Float64,2}:\n 0.282656   0.816887  0.735667  0.253871  0.971765\n 0.530782   0.439614  0.572425  0.27668   0.289898\n 0.250067   0.126433  0.194755  0.256686  0.736393\n 0.0191476  0.371746  0.198432  0.601111  0.103933\n 0.884469   0.535445  0.386812  0.115343  0.977171\n\njulia&gt; @btime view($m, 1:6:length($m))\n  50.786 ns (2 allocations: 80 bytes)\n5-element view(::Array{Float64,1}, 1:6:25) with eltype Float64:\n 0.28265603807155815\n 0.43961413565679397\n 0.1947548601335103\n 0.6011110671791804\n 0.9771710404851319```\nIt allocates","user":"U01658MJH3P","ts":"1611440772.226300","team":"T68168MUP","edited":{"user":"U01658MJH3P","ts":"1611441329.000000"},"blocks":[{"type":"rich_text","block_id":"IM=l","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is it possible to make a view of a diagonal of a matrix, without allocations?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> m = rand(5,5)\n5×5 Array{Float64,2}:\n 0.282656   0.816887  0.735667  0.253871  0.971765\n 0.530782   0.439614  0.572425  0.27668   0.289898\n 0.250067   0.126433  0.194755  0.256686  0.736393\n 0.0191476  0.371746  0.198432  0.601111  0.103933\n 0.884469   0.535445  0.386812  0.115343  0.977171\n\njulia> @btime view($m, 1:6:length($m))\n  50.786 ns (2 allocations: 80 bytes)\n5-element view(::Array{Float64,1}, 1:6:25) with eltype Float64:\n 0.28265603807155815\n 0.43961413565679397\n 0.1947548601335103\n 0.6011110671791804\n 0.9771710404851319"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"It allocates"}]}]}],"thread_ts":"1611440772.226300","reply_count":4,"reply_users_count":2,"latest_reply":"1611459776.232100","reply_users":["U01CR62LAAD","U01658MJH3P"],"subscribed":false},{"client_msg_id":"9994ebb5-729a-4bf8-9438-a21073ec4631","type":"message","text":"Okay, maybe this?:\n```julia&gt; function get_diag_view(m)\n                         w = @view m[:,:]\n                         return @view w[1:size(w)[1]:end]\n                     end\nget_diag_view (generic function with 1 method)\n\njulia&gt; @btime get_diag_view($m)\n  50.505 ns (0 allocations: 0 bytes)\n5-element view(reshape(view(::Array{Float64,2}, :, :), 25), 1:5:21) with eltype Float64:\n 0.23766139616858917\n 0.43218952853633286\n 0.8676057049712413\n 0.025463591346061687\n 0.7102161776225269```","user":"U01CR62LAAD","ts":"1611453472.228500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yvp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Okay, maybe this?:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> function get_diag_view(m)\n                         w = @view m[:,:]\n                         return @view w[1:size(w)[1]:end]\n                     end\nget_diag_view (generic function with 1 method)\n\njulia> @btime get_diag_view($m)\n  50.505 ns (0 allocations: 0 bytes)\n5-element view(reshape(view(::Array{Float64,2}, :, :), 25), 1:5:21) with eltype Float64:\n 0.23766139616858917\n 0.43218952853633286\n 0.8676057049712413\n 0.025463591346061687\n 0.7102161776225269"}]}]}],"thread_ts":"1611440772.226300","parent_user_id":"U01658MJH3P"},{"client_msg_id":"92873c4d-8645-44c7-b7e4-be8843a9ecf3","type":"message","text":"I can’t say I know this stuff. I just decided to try things out to see if I learn some.","user":"U01CR62LAAD","ts":"1611453584.228700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VGkM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I can’t say I know this stuff. I just decided to try things out to see if I learn some."}]}]}],"thread_ts":"1611440772.226300","parent_user_id":"U01658MJH3P"},{"client_msg_id":"aca2a55e-7856-4e9e-bec3-66f9b56fc103","type":"message","text":"Or, better, the following one-liner\n```julia&gt; @btime @view $(@view m[:])[1:size($m)[1]:end]\n  24.159 ns (0 allocations: 0 bytes)\n5-element view(::Array{Float64,1}, 1:5:21) with eltype Float64:\n 0.6283006879224067\n 0.09877772512854466\n 0.06950902958831717\n 0.9318926351587544\n 0.8453253737866449```\nAnd if you are `using LinearAlgebra`, can simplify it with `@view $(@view m[:])[diagind($m)]`","user":"U01CR62LAAD","ts":"1611454604.230000","team":"T68168MUP","edited":{"user":"U01CR62LAAD","ts":"1611454883.000000"},"blocks":[{"type":"rich_text","block_id":"8Kx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Or, better, the following one-liner\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @btime @view $(@view m[:])[1:size($m)[1]:end]\n  24.159 ns (0 allocations: 0 bytes)\n5-element view(::Array{Float64,1}, 1:5:21) with eltype Float64:\n 0.6283006879224067\n 0.09877772512854466\n 0.06950902958831717\n 0.9318926351587544\n 0.8453253737866449"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"And if you are "},{"type":"text","text":"using LinearAlgebra","style":{"code":true}},{"type":"text","text":", can simplify it with "},{"type":"text","text":"@view $(@view m[:])[diagind($m)]","style":{"code":true}}]}]}],"thread_ts":"1611440772.226300","parent_user_id":"U01658MJH3P"},{"client_msg_id":"4228e7bf-aa62-4095-ba1f-fad98cecb111","type":"message","text":"thank you so much!","user":"U01658MJH3P","ts":"1611459776.232100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"l8hV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thank you so much!"}]}]}],"thread_ts":"1611440772.226300","parent_user_id":"U01658MJH3P","reactions":[{"name":"+1","users":["U01CR62LAAD"],"count":1}]}]