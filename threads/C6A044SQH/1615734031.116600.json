[{"client_msg_id":"2aa5be05-b72d-42bf-8a2b-c6237bc0c47a","type":"message","text":"Problem invoking `--bug-report=rr` in a docker image. I have the following packages installed in the Debian image:\n```      Status `~/.julia/environments/v1.6/Project.toml`\n  [bcf9a6e7] BugReporting v0.1.3\n  [7073ff75] IJulia v1.23.2\n  [c3e4b0f8] Pluto v0.12.21```\nIt’s 1.6 RC1 as RC2 is not yet available as  a docker image. I get this:\n```arthur@767b47f0c62f:~$ julia --bug-report=rr\n[ Info: Loading BugReporting package...\n[FATAL /workspace/srcdir/rr/src/util.cc:1267:running_under_rr() errno: EPERM] Unexpected result for rrcall_check_presence: -1\n=== Start rr backtrace:\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr(_ZN2rr13dump_rr_stackEv+0x28)[0x5a0fc8]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr(_ZN2rr15notifying_abortEv+0x47)[0x5a4e57]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x5c9a12]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr(_ZN2rr16running_under_rrEb+0xb9)[0x5a1a69]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x50caca]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x50d8d9]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x5c7028]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr(_ZN2rr17GdbCommandHandler16register_commandERNS_10GdbCommandE+0x2a)[0x4f45ca]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x4bdf12]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x4be006]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x4c0e69]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr(__libc_csu_init+0x45)[0x727e75]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0x7a)[0x7f7e3bccc02a]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x4c19ae]\n=== End rr backtrace\n[ Info: Preparing trace directory for upload (if your trace is large this may take a few minutes)```\nRr is installed:\n```arthur@767b47f0c62f:~$ rr --version\nrr version 5.4.0```\nInstalling `BugReporting` seemed to work when run in Dockerfile, but not when I tried it just from the command line. I’ll put the stack trace as a comment as it’s rather long.","user":"U01CQTKB86N","ts":"1615734031.116600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"f=P","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Problem invoking "},{"type":"text","text":"--bug-report=rr","style":{"code":true}},{"type":"text","text":" in a docker image. I have the following packages installed in the Debian image:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"      Status `~/.julia/environments/v1.6/Project.toml`\n  [bcf9a6e7] BugReporting v0.1.3\n  [7073ff75] IJulia v1.23.2\n  [c3e4b0f8] Pluto v0.12.21"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"It’s 1.6 RC1 as RC2 is not yet available as  a docker image. I get this:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"arthur@767b47f0c62f:~$ julia --bug-report=rr\n[ Info: Loading BugReporting package...\n[FATAL /workspace/srcdir/rr/src/util.cc:1267:running_under_rr() errno: EPERM] Unexpected result for rrcall_check_presence: -1\n=== Start rr backtrace:\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr(_ZN2rr13dump_rr_stackEv+0x28)[0x5a0fc8]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr(_ZN2rr15notifying_abortEv+0x47)[0x5a4e57]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x5c9a12]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr(_ZN2rr16running_under_rrEb+0xb9)[0x5a1a69]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x50caca]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x50d8d9]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x5c7028]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr(_ZN2rr17GdbCommandHandler16register_commandERNS_10GdbCommandE+0x2a)[0x4f45ca]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x4bdf12]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x4be006]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x4c0e69]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr(__libc_csu_init+0x45)[0x727e75]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0x7a)[0x7f7e3bccc02a]\n/home/arthur/.julia/artifacts/24f3eb6277df1f22a6de3755306d033449697322/bin/rr[0x4c19ae]\n=== End rr backtrace\n[ Info: Preparing trace directory for upload (if your trace is large this may take a few minutes)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Rr is installed:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"arthur@767b47f0c62f:~$ rr --version\nrr version 5.4.0"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Installing "},{"type":"text","text":"BugReporting","style":{"code":true}},{"type":"text","text":" seemed to work when run in Dockerfile, but not when I tried it just from the command line. I’ll put the stack trace as a comment as it’s rather long."}]}]}],"thread_ts":"1615734031.116600","reply_count":19,"reply_users_count":5,"latest_reply":"1615762339.127900","reply_users":["B01J9QZ4SP8","U01CQTKB86N","UM30MT6RF","U674T3KB3","UH24GRBLL"],"is_locked":false,"subscribed":false,"reactions":[{"name":"bridge","users":["U01CQTKB86N"],"count":1}]},{"type":"message","subtype":"bot_message","text":"Can we cross post this publicly to <https://discourse.julialang.org|Discourse> for further visibility? React with :bridge: on the message above to approve. <https://github.com/JuliaCommunity/SlackBridge/blob/main/README.md#faq|More info here>","ts":"1615734034.116700","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"ec976129-cd08-4094-ba95-9df867f7f34e","type":"message","text":"I’ll take the last sentence back as it does install from the command line normally as well. There was just the one time it failed with lots of errors.","user":"U01CQTKB86N","ts":"1615734225.117000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6fa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’ll take the last sentence back as it does install from the command line normally as well. There was just the one time it failed with lots of errors."}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"ec1fc076-33e4-48d2-8048-87bdd9d4e9bf","type":"message","text":"The image is available as `statisticalmice/julia-jupyter:1.6-buster-max` but without BugReporting.","user":"U01CQTKB86N","ts":"1615734398.117200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9ZD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The image is available as "},{"type":"text","text":"statisticalmice/julia-jupyter:1.6-buster-max","style":{"code":true}},{"type":"text","text":" but without BugReporting."}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"a96939ac-90fb-46c1-887d-e7061d80660a","type":"message","text":"Not sure rr is supported inside docker containers. <@U674T3KB3> might know more.","user":"UM30MT6RF","ts":"1615734912.117600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ChhIq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Not sure rr is supported inside docker containers. "},{"type":"user","user_id":"U674T3KB3"},{"type":"text","text":" might know more."}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"242ed615-8e71-474e-844f-4cbe36ac94b4","type":"message","text":"Docker filters unexpected syscalls. You can turn that off with privileged mode. We'd asked them for a passthrough, but they weren't super enthusiastic","user":"U674T3KB3","ts":"1615735054.117800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KDRe","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Docker filters unexpected syscalls. You can turn that off with privileged mode. We'd asked them for a passthrough, but they weren't super enthusiastic"}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"0a8c4ec9-7105-41e0-97fc-81121e17ae58","type":"message","text":"I’ll try..","user":"U01CQTKB86N","ts":"1615735152.118000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Fet","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’ll try.."}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"9fcea1b4-846e-44ee-86f7-99172829eac6","type":"message","text":"It starts, but there is a warning:\n```arthur@e35379ace3ae:~$ julia  --bug-report=rr\n[ Info: Loading BugReporting package...\nrr needs /proc/sys/kernel/perf_event_paranoid &lt;= 1, but it is 3.\nChange it to 1, or use 'rr record -n' (slow).\nConsider putting 'kernel.perf_event_paranoid = 1' in /etc/sysctl.conf.\nSee 'man 8 sysctl', 'man 5 sysctl.d' and 'man 5 sysctl.conf' for more details.\n[ Info: Preparing trace directory for upload (if your trace is large this may take a few minutes)```","user":"U01CQTKB86N","ts":"1615735349.118200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jRsQ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It starts, but there is a warning:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"arthur@e35379ace3ae:~$ julia  --bug-report=rr\n[ Info: Loading BugReporting package...\nrr needs /proc/sys/kernel/perf_event_paranoid <= 1, but it is 3.\nChange it to 1, or use 'rr record -n' (slow).\nConsider putting 'kernel.perf_event_paranoid = 1' in /etc/sysctl.conf.\nSee 'man 8 sysctl', 'man 5 sysctl.d' and 'man 5 sysctl.conf' for more details.\n[ Info: Preparing trace directory for upload (if your trace is large this may take a few minutes)"}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"c621a286-6a52-4fb3-9665-fefecbaaaaed","type":"message","text":"It tells you to change /proc/sys/kernel/perf_event_paranoid to 1","user":"UM30MT6RF","ts":"1615735462.118400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"j8FIS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It tells you to change /proc/sys/kernel/perf_event_paranoid to 1"}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"4f0d1623-d36a-48c0-9046-1529741ddda2","type":"message","text":"Yes, how do I do that? I can of course Google, but right away I don’t know.","user":"U01CQTKB86N","ts":"1615735613.118600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+Acw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, how do I do that? I can of course Google, but right away I don’t know."}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"b7f682b3-47bf-40ac-a59c-ec4081fb047e","type":"message","text":"It's just a file, so you can just open it in any editor with superuser privileges on the host OS","user":"UM30MT6RF","ts":"1615735791.118800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Abd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It's just a file, so you can just open it in any editor with superuser privileges on the host OS"}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"8987531a-cd0c-4962-969e-1d1d6fddcdc8","type":"message","text":"Ah, ok.","user":"U01CQTKB86N","ts":"1615736123.119100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tA91F","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah, ok."}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"357bf306-4839-4639-b073-a5fedf74278a","type":"message","text":"Running docker containers in privileged mode is a bad idea as is amply documented in the Internet land, so I’m not doing this.","user":"U01CQTKB86N","ts":"1615738274.119500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CW=FC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Running docker containers in privileged mode is a bad idea as is amply documented in the Internet land, so I’m not doing this."}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"2e08c10d-8ea9-4c3f-9082-5336bd66be71","type":"message","text":"I’ll put something in discourse.","user":"U01CQTKB86N","ts":"1615738281.119700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cdi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I’ll put something in discourse."}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"type":"message","subtype":"bot_message","text":"Success, it has been cross posted <https://discourse.julialang.org/t/57134| to Discourse>. Keep and eye out on Discourse for responses and please add an answer there once you are satisfied with the solution so others can benefit as well. Happy debugging!","ts":"1615738365.120000","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"154b0e5e-9a72-4e05-aa0b-d705b0322098","type":"message","text":"setting that is unfortunately required for rr to work at all","user":"UH24GRBLL","ts":"1615744774.122100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"X=6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"setting that is unfortunately required for rr to work at all"}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"5bacb6de-14c9-48c1-9be3-7a6573c320ba","type":"message","text":"I've had the same on a Arch server","user":"UH24GRBLL","ts":"1615744805.122300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NdGh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I've had the same on a Arch server"}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"type":"message","subtype":"bot_message","text":"Hey <@U01CQTKB86N>, if you were able to find an answer here on Slack, please cross post it to Discourse via the link above. Thank you! ","ts":"1615749168.124300","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"7b7bfab3-2565-4e9c-8a09-4b156bb8806b","type":"message","text":"<@UH24GRBLL> If I really, absolutely need it, I’ll have to run on GCP or similar, not on my laptop.","user":"U01CQTKB86N","ts":"1615762064.127700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"42px","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UH24GRBLL"},{"type":"text","text":" If I really, absolutely need it, I’ll have to run on GCP or similar, not on my laptop."}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"},{"client_msg_id":"f6a4da9c-d4e8-4242-a2eb-e9d80eea3d24","type":"message","text":"..which is a mac.","user":"U01CQTKB86N","ts":"1615762339.127900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+gM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"..which is a mac."}]}]}],"thread_ts":"1615734031.116600","parent_user_id":"U01CQTKB86N"}]