[{"client_msg_id":"580a039f-274a-4f4b-a42e-b6caca0998ae","type":"message","text":"Hi, a question on diagnosing memory issues... I have a code with some weird behavior. More precisely I have function `A`  which I execute on similar inputs of similiar size. The weird thing is that if I do this 4 times as much I would expect it to take 4 times as long but instead it takes 40 times longer. I know this thanks to `TimerOutputs.jl`  and I am not quite sure how to explain this behavior. I suspect memory and using Swap might be behind it. How could I test this hypothesis in Julia? My OS profiler doesn't reveal anything","user":"U01L0RJC6FM","ts":"1617796895.134900","team":"T68168MUP","edited":{"user":"U01L0RJC6FM","ts":"1617796941.000000"},"blocks":[{"type":"rich_text","block_id":"Ew+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi, a question on diagnosing memory issues... I have a code with some weird behavior. More precisely I have function "},{"type":"text","text":"A","style":{"code":true}},{"type":"text","text":"  which I execute on similar inputs of similiar size. The weird thing is that if I do this 4 times as much I would expect it to take 4 times as long but instead it takes 40 times longer. I know this thanks to "},{"type":"text","text":"TimerOutputs.jl","style":{"code":true}},{"type":"text","text":"  and I am not quite sure how to explain this behavior. I suspect memory and using Swap might be behind it. How could I test this hypothesis in Julia? My OS profiler doesn't reveal anything"}]}]}],"thread_ts":"1617796895.134900","reply_count":13,"reply_users_count":3,"latest_reply":"1617808170.152100","reply_users":["U011LUQ182G","U01PLQWQXPV","U01L0RJC6FM"],"is_locked":false,"subscribed":false},{"client_msg_id":"4F9217D1-1D2C-49DC-824A-8AF0CC674201","type":"message","text":"Do the allocations scale as 40x too? And does @btime give similar results?","user":"U011LUQ182G","ts":"1617801064.138300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hrmu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Do the allocations scale as 40x too? And does @btime give similar results?"}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"c4efee01-0087-48d5-96ff-292c1c003937","type":"message","text":"Given that it would be weird for the OS profiler not to notice memory swap usage, some questions first\n\n1. Is your function pure or does it produce side-effects?\n2. If you suspect it's a swap problem, did you try the same benchmark but with inputs that fit comfortably in your memory?","user":"U01PLQWQXPV","ts":"1617803541.144600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+Xbs","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Given that it would be weird for the OS profiler not to notice memory swap usage, some questions first\n\n"}]},{"type":"rich_text_list","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is your function pure or does it produce side-effects?"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"If you suspect it's a swap problem, did you try the same benchmark but with inputs that fit comfortably in your memory?"}]}],"style":"ordered","indent":0}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"3d1e88b6-a69d-4564-b6f0-4ef3e33c2c0c","type":"message","text":"hmm not sure whether i understand 1.","user":"U01L0RJC6FM","ts":"1617806993.149900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hrR/5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hmm not sure whether i understand 1."}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"f39b1ae0-0c51-48ba-a35d-0af876775a4b","type":"message","text":"if you mean whether it affects other tasks it should be pure","user":"U01L0RJC6FM","ts":"1617807009.150100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rkk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if you mean whether it affects other tasks it should be pure"}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM","reactions":[{"name":"thumbsup_all","users":["U01PLQWQXPV"],"count":1}]},{"client_msg_id":"66eb6153-b835-44d8-b284-f5a1da30816b","type":"message","text":"reg. 2 - yes the moment I wrote this I realized that and I think I can exclude the swap problem","user":"U01L0RJC6FM","ts":"1617807045.150300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1wBD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"reg. 2 - yes the moment I wrote this I realized that and I think I can exclude the swap problem"}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"fefbaa77-7d4f-4a0c-b146-fba070d65e81","type":"message","text":"however I suspect that it is the problem of matrix access  `A[i,j]`  scaling with the matrix itself","user":"U01L0RJC6FM","ts":"1617807079.150500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HAze5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"however I suspect that it is the problem of matrix access  "},{"type":"text","text":"A[i,j]","style":{"code":true}},{"type":"text","text":"  scaling with the matrix itself"}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"846589a9-5193-4df9-acac-01abe79d9454","type":"message","text":"while the subproblems don't really scale it seems that the access scales","user":"U01L0RJC6FM","ts":"1617807340.150800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Eanu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"while the subproblems don't really scale it seems that the access scales"}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"71dd4913-07ec-495c-8c33-032580026d11","type":"message","text":"Have you tried `@profile` ing and seeing where your program is stalling? Array lookup should be O(1) (for standard dense arrays, naturally)","user":"U01PLQWQXPV","ts":"1617807383.151000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"x3Bw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Have you tried "},{"type":"text","text":"@profile","style":{"code":true}},{"type":"text","text":" ing and seeing where your program is stalling? Array lookup should be O(1) (for standard dense arrays, naturally)"}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"5adfcead-faf7-46ec-8933-d8dfff508b0d","type":"message","text":"<https://docs.julialang.org/en/v1/manual/profile/>","user":"U01PLQWQXPV","ts":"1617807414.151200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zWiic","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://docs.julialang.org/en/v1/manual/profile/"}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"fe457548-e8c9-4436-a537-7ee67430b0af","type":"message","text":"If it ends up being on the lookup it may be due to smaller matrices fitting in the cache and lookups of larger matrices causing loads of cache misses","user":"U01PLQWQXPV","ts":"1617807571.151400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rLGG7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If it ends up being on the lookup it may be due to smaller matrices fitting in the cache and lookups of larger matrices causing loads of cache misses"}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"86906cb5-cd76-4fab-9548-6466f9d51617","type":"message","text":"oh right, I am talking about the access into a large sparse matrix `A`","user":"U01L0RJC6FM","ts":"1617807746.151600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"a=t","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh right, I am talking about the access into a large sparse matrix "},{"type":"text","text":"A","style":{"code":true}}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"980610cd-048d-4e33-b046-85400bfdba6a","type":"message","text":"I haven't tried @profile as I have to say the output is highly unreadable and I have lost quite some time not seeing the bigger picture","user":"U01L0RJC6FM","ts":"1617807829.151800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3jWz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I haven't tried @profile as I have to say the output is highly unreadable and I have lost quite some time not seeing the bigger picture"}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"48e9866d-0fff-4216-b968-20078e235a3a","type":"message","text":"TimerOutputs is clearly pointing the finger at matrix access though","user":"U01L0RJC6FM","ts":"1617808170.152100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"q/C3C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"TimerOutputs is clearly pointing the finger at matrix access though"}]}]}],"thread_ts":"1617796895.134900","parent_user_id":"U01L0RJC6FM"}]