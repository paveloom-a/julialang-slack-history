[{"client_msg_id":"274aa253-9bad-4cdf-86df-172e6724cd35","type":"message","text":"I'm having a problem with MonteCarloMeasurements.jl and I can't tell what I'm doing wrong. I noticed that between runs the values returned for mean() and std() for my particles vary wildly, no matter how many particles I use. Here's an example code:\n```function f()\n    m_multiplet1 = 0.545 + 0.065*Particles(MONTE_CARLO_NUM_SAMPLES)\n    b_multiplet1 = -5.69 + 0.076*Particles(MONTE_CARLO_NUM_SAMPLES)\n    m_multiplet2 = 0.442 + 0.036*Particles(MONTE_CARLO_NUM_SAMPLES)\n    b_multiplet2 = -6.4 + 0.11*Particles(MONTE_CARLO_NUM_SAMPLES)\n    y_values = vcat([m_multiplet1*x + b_multiplet1 for x in 1:30], [m_multiplet2*x + b_multiplet2 for x in 1:30])\n    y_median = @unsafe median(y_values)\n    x_multiplet1_median = (y_median - b_multiplet1)/m_multiplet1\n    x_multiplet2_median = (y_median - b_multiplet2)/m_multiplet2\n    Δ = @unsafe x_multiplet1_median &gt; x_multiplet2_median ? x_multiplet1_median - x_multiplet2_median : x_multiplet2_median - x_multiplet1_median\n    Δχ = 2.0722916666666669\n    Texc = 5040*Δχ/Δ\n    println(\"m_multiplet1: $m_multiplet1 b_multiplet1: $b_multiplet1\")\n    println(\"m_multiplet2: $m_multiplet2 b_multiplet2: $b_multiplet2\")\n    println(\"y_median: $y_median\")\n    println(\"x_multiplet1_median: $x_multiplet1_median\")\n    println(\"x_multiplet2_median: $x_multiplet2_median\")\n    println(\"Δ: $Δ\")\n    println(\"Δχ: $Δχ\")\n    println(\"Texc: $Texc\")\nend```\n(more in comment)","user":"U01K809EUQ7","ts":"1616875790.322200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Xyjfa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm having a problem with MonteCarloMeasurements.jl and I can't tell what I'm doing wrong. I noticed that between runs the values returned for mean() and std() for my particles vary wildly, no matter how many particles I use. Here's an example code:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function f()\n    m_multiplet1 = 0.545 + 0.065*Particles(MONTE_CARLO_NUM_SAMPLES)\n    b_multiplet1 = -5.69 + 0.076*Particles(MONTE_CARLO_NUM_SAMPLES)\n    m_multiplet2 = 0.442 + 0.036*Particles(MONTE_CARLO_NUM_SAMPLES)\n    b_multiplet2 = -6.4 + 0.11*Particles(MONTE_CARLO_NUM_SAMPLES)\n    y_values = vcat([m_multiplet1*x + b_multiplet1 for x in 1:30], [m_multiplet2*x + b_multiplet2 for x in 1:30])\n    y_median = @unsafe median(y_values)\n    x_multiplet1_median = (y_median - b_multiplet1)/m_multiplet1\n    x_multiplet2_median = (y_median - b_multiplet2)/m_multiplet2\n    Δ = @unsafe x_multiplet1_median > x_multiplet2_median ? x_multiplet1_median - x_multiplet2_median : x_multiplet2_median - x_multiplet1_median\n    Δχ = 2.0722916666666669\n    Texc = 5040*Δχ/Δ\n    println(\"m_multiplet1: $m_multiplet1 b_multiplet1: $b_multiplet1\")\n    println(\"m_multiplet2: $m_multiplet2 b_multiplet2: $b_multiplet2\")\n    println(\"y_median: $y_median\")\n    println(\"x_multiplet1_median: $x_multiplet1_median\")\n    println(\"x_multiplet2_median: $x_multiplet2_median\")\n    println(\"Δ: $Δ\")\n    println(\"Δχ: $Δχ\")\n    println(\"Texc: $Texc\")\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"(more in comment)"}]}]}],"thread_ts":"1616875790.322200","reply_count":7,"reply_users_count":2,"latest_reply":"1616879080.326900","reply_users":["U01K809EUQ7","U01RB7WR48H"],"is_locked":false,"subscribed":false},{"client_msg_id":"d489810f-2d97-4374-be5b-98cd969b291c","type":"message","text":"Here's the output of two runs:\n```julia&gt; f()\nm_multiplet1: 0.545 ± 0.065 b_multiplet1: -5.69 ± 0.076\nm_multiplet2: 0.442 ± 0.036 b_multiplet2: -6.4 ± 0.11\ny_median: 1.48 ± 0.54\nx_multiplet1_median: 13.2 ± 1.1\nx_multiplet2_median: 17.9 ± 1.2\nΔ: 4.63 ± 2.3\nΔχ: 2.072291666666667\nTexc: 1390.0 ± 750000.0\n\njulia&gt; f()\nm_multiplet1: 0.545 ± 0.065 b_multiplet1: -5.69 ± 0.076\nm_multiplet2: 0.442 ± 0.036 b_multiplet2: -6.4 ± 0.11\ny_median: 1.48 ± 0.54\nx_multiplet1_median: 13.2 ± 1.0\nx_multiplet2_median: 17.9 ± 1.2\nΔ: 4.63 ± 2.3\nΔχ: 2.072291666666667\nTexc: 2960.0 ± 300000.0```\n","user":"U01K809EUQ7","ts":"1616875842.322300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xQaX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Here's the output of two runs:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> f()\nm_multiplet1: 0.545 ± 0.065 b_multiplet1: -5.69 ± 0.076\nm_multiplet2: 0.442 ± 0.036 b_multiplet2: -6.4 ± 0.11\ny_median: 1.48 ± 0.54\nx_multiplet1_median: 13.2 ± 1.1\nx_multiplet2_median: 17.9 ± 1.2\nΔ: 4.63 ± 2.3\nΔχ: 2.072291666666667\nTexc: 1390.0 ± 750000.0\n\njulia> f()\nm_multiplet1: 0.545 ± 0.065 b_multiplet1: -5.69 ± 0.076\nm_multiplet2: 0.442 ± 0.036 b_multiplet2: -6.4 ± 0.11\ny_median: 1.48 ± 0.54\nx_multiplet1_median: 13.2 ± 1.0\nx_multiplet2_median: 17.9 ± 1.2\nΔ: 4.63 ± 2.3\nΔχ: 2.072291666666667\nTexc: 2960.0 ± 300000.0"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1616875790.322200","parent_user_id":"U01K809EUQ7"},{"client_msg_id":"47361aac-af5b-4861-804d-fe3880eba09f","type":"message","text":"with `MONTE_CARLO_NUM_SAMPLES = 1000000`","user":"U01K809EUQ7","ts":"1616875862.322500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4iC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"with "},{"type":"text","text":"MONTE_CARLO_NUM_SAMPLES = 1000000","style":{"code":true}}]}]}],"thread_ts":"1616875790.322200","parent_user_id":"U01K809EUQ7"},{"client_msg_id":"26bb53ff-1161-44ff-b5c6-16c7f1a489e3","type":"message","text":"less particles doesn't make a difference.","user":"U01K809EUQ7","ts":"1616875893.322700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M3qTc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"less particles doesn't make a difference."}]}]}],"thread_ts":"1616875790.322200","parent_user_id":"U01K809EUQ7"},{"client_msg_id":"c8d542bd-615b-4916-a753-a45def0d9d50","type":"message","text":"I suspect that this is a division by zero issue. I haven’t worked out the exact distribution of \\delta but it looks like p(\\delta == 0) is not infinitesimal. So then when you do the monte carlo simulation, it samples values arbitrarily close to 0, which then make texc arbitrarily large and affect the mean of texc","user":"U01RB7WR48H","ts":"1616876179.323400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OJ9/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I suspect that this is a division by zero issue. I haven’t worked out the exact distribution of \\delta but it looks like p(\\delta == 0) is not infinitesimal. So then when you do the monte carlo simulation, it samples values arbitrarily close to 0, which then make texc arbitrarily large and affect the mean of texc"}]}]}],"thread_ts":"1616875790.322200","parent_user_id":"U01K809EUQ7","reactions":[{"name":"thumbsup_all","users":["U01K809EUQ7"],"count":1},{"name":"bulb","users":["U01K809EUQ7"],"count":1}]},{"client_msg_id":"f724bcb9-2d4f-4bb2-93c2-8bef6cbd7c63","type":"message","text":"hm, yes, that makes sense. I was about to comment that forcing `Δ = 4.63 ± 2.3` makes the problem go away, so that might be it","user":"U01K809EUQ7","ts":"1616876259.323600","team":"T68168MUP","edited":{"user":"U01K809EUQ7","ts":"1616876315.000000"},"blocks":[{"type":"rich_text","block_id":"kNZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hm, yes, that makes sense. I was about to comment that forcing "},{"type":"text","text":"Δ = 4.63 ± 2.3","style":{"code":true}},{"type":"text","text":" makes the problem go away, so that might be it"}]}]}],"thread_ts":"1616875790.322200","parent_user_id":"U01K809EUQ7"},{"client_msg_id":"ac154c09-574a-4035-8ec4-eb94cf87e240","type":"message","text":"I'll investigate","user":"U01K809EUQ7","ts":"1616876264.323800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"F2P","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'll investigate"}]}]}],"thread_ts":"1616875790.322200","parent_user_id":"U01K809EUQ7"},{"client_msg_id":"9f3fa22f-4ee8-46cb-97ff-f562c845786f","type":"message","text":"Yup, that seems to be the problem :disappointed:","user":"U01K809EUQ7","ts":"1616879080.326900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"J5WHt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yup, that seems to be the problem "},{"type":"emoji","name":"disappointed"}]}]}],"thread_ts":"1616875790.322200","parent_user_id":"U01K809EUQ7"}]