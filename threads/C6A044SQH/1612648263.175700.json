[{"client_msg_id":"e9acabd8-79dc-4667-a113-47c54d3c4065","type":"message","text":"I found that the `sendfile()` system call is available via the un-exported, un-documented `Base.Filesystem.sendfile()` function.  Is there a better way to access this very useful system call?","user":"U01FKQQ7J0J","ts":"1612648263.175700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lPN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I found that the "},{"type":"text","text":"sendfile()","style":{"code":true}},{"type":"text","text":" system call is available via the un-exported, un-documented "},{"type":"text","text":"Base.Filesystem.sendfile()","style":{"code":true}},{"type":"text","text":" function.  Is there a better way to access this very useful system call?"}]}]}],"thread_ts":"1612648263.175700","reply_count":9,"reply_users_count":4,"latest_reply":"1612663410.190900","reply_users":["B01J9QZ4SP8","UH8A351DJ","U01FKQQ7J0J","UBTLBECD7"],"subscribed":false,"reactions":[{"name":"bridge","users":["U01FKQQ7J0J"],"count":1}]},{"type":"message","subtype":"bot_message","text":"Can we cross post this publicly to <https://discourse.julialang.org|Discourse> for further visibility? React with :bridge: on the message above to approve. <https://github.com/JuliaCommunity/SlackBridge/blob/main/README.md#faq|More info here>","ts":"1612648265.175800","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1612648263.175700","parent_user_id":"U01FKQQ7J0J"},{"type":"message","subtype":"bot_message","text":"Success, it has been cross posted <https://discourse.julialang.org/t/54758| to Discourse>. Keep and eye out on Discourse for responses and please add an answer there once you are satisfied with the solution so others can benefit as well. Happy debugging!","ts":"1612648283.176100","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1612648263.175700","parent_user_id":"U01FKQQ7J0J"},{"client_msg_id":"52d0d59f-49d3-4777-b58d-45b465447007","type":"message","text":"<https://github.com/JuliaLang/julia/blob/3ee63a68df11ca3875885723be5084ca74bcfa6e/base/file.jl#L360>\n\njust use `cp`?","user":"UH8A351DJ","ts":"1612655465.177200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bpPh","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/JuliaLang/julia/blob/3ee63a68df11ca3875885723be5084ca74bcfa6e/base/file.jl#L360"},{"type":"text","text":"\n\njust use "},{"type":"text","text":"cp","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1612648263.175700","parent_user_id":"U01FKQQ7J0J"},{"client_msg_id":"f621f320-0735-4fd2-9ef4-98fb0449849e","type":"message","text":"`cp` is good for a copying entire named files, but it doesn't allow for specifying just an offset/length subset of the src  (and the src/dst must be named files, i.e. can't be sockets or already opened files)","user":"U01FKQQ7J0J","ts":"1612657160.177400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oe8mw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"cp","style":{"code":true}},{"type":"text","text":" is good for a copying entire named files, but it doesn't allow for specifying just an offset/length subset of the src  (and the src/dst must be named files, i.e. can't be sockets or already opened files)"}]}]}],"thread_ts":"1612648263.175700","parent_user_id":"U01FKQQ7J0J"},{"client_msg_id":"f46ecb0c-a092-4418-a29f-d11bae77664e","type":"message","text":"I could use `ccall()`, but `sendfile()` is non-standardized (though common) so that would get tricky to generalize.  That's why I am hoping for an existing wrapper to this very handy functionality.  It seems like most/all of the hard part has already been done.","user":"U01FKQQ7J0J","ts":"1612657749.177800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ha5O","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I could use "},{"type":"text","text":"ccall()","style":{"code":true}},{"type":"text","text":", but "},{"type":"text","text":"sendfile()","style":{"code":true}},{"type":"text","text":" is non-standardized (though common) so that would get tricky to generalize.  That's why I am hoping for an existing wrapper to this very handy functionality.  It seems like most/all of the hard part has already been done."}]}]}],"thread_ts":"1612648263.175700","parent_user_id":"U01FKQQ7J0J"},{"type":"message","subtype":"bot_message","text":"Hey <@U01FKQQ7J0J>, if you were able to find an answer here on Slack, please cross post it to Discourse via the link above. Thank you! ","ts":"1612659085.178000","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1612648263.175700","parent_user_id":"U01FKQQ7J0J"},{"client_msg_id":"a6c6ab56-0265-4bd0-9d6e-56dfebbb540a","type":"message","text":"Base.Filesystem.sendfile() calls jl_fs_sendfile, which calls uv_fs_sendfile.   The advantage of this over calling sendfile directly is that it is portable (libuv implemented it on Windows, albeit using manual reads and writes).","user":"UBTLBECD7","ts":"1612662667.184800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Gqy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Base.Filesystem.sendfile() calls jl_fs_sendfile, which calls uv_fs_sendfile.   The advantage of this over calling sendfile directly is that it is portable (libuv implemented it on Windows, albeit using manual reads and writes)."}]}]}],"thread_ts":"1612648263.175700","parent_user_id":"U01FKQQ7J0J"},{"client_msg_id":"caaf05c5-0573-461c-b375-778c180ecb35","type":"message","text":"That's exactly where I am right now: trying to use `ccall` to call  `jl_fs_sendfile` :sweat_smile:","user":"U01FKQQ7J0J","ts":"1612662774.186800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"m5zAK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That's exactly where I am right now: trying to use "},{"type":"text","text":"ccall","style":{"code":true}},{"type":"text","text":" to call  "},{"type":"text","text":"jl_fs_sendfile","style":{"code":true}},{"type":"text","text":" "},{"type":"emoji","name":"sweat_smile"}]}]}],"thread_ts":"1612648263.175700","parent_user_id":"U01FKQQ7J0J"},{"client_msg_id":"55237cfa-0ca3-41e2-b410-8424573ac85b","type":"message","text":"This seems to work, but I'm not sure if it's ideal:\n```function sendfile(dst::Int, src::Int, src_offset::Int64, bytes::Int)\n    while bytes &gt; 0\n        result = ccall(:jl_fs_sendfile, Int32, (Int32, Int32, Int64, Csize_t),\n                       Int32(src), Int32(dst), src_offset, bytes)\n        Base.uv_error(\"sendfile\", result)\n        nsent = result\n        bytes -= nsent\n        src_offset += nsent\n    end\n    nothing\nend\n\nsendfile(dst::Int, src, src_offset::Int64, bytes::Int) = sendfile(dst, fd(src), src_offset, bytes)\nsendfile(dst, src::Int, src_offset::Int64, bytes::Int) = sendfile(fd(dst), src, src_offset, bytes)\nsendfile(dst, src, src_offset::Int64, bytes::Int) = sendfile(fd(dst), fd(src), src_offset, bytes)```","user":"U01FKQQ7J0J","ts":"1612663410.190900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aRWNP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This seems to work, but I'm not sure if it's ideal:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function sendfile(dst::Int, src::Int, src_offset::Int64, bytes::Int)\n    while bytes > 0\n        result = ccall(:jl_fs_sendfile, Int32, (Int32, Int32, Int64, Csize_t),\n                       Int32(src), Int32(dst), src_offset, bytes)\n        Base.uv_error(\"sendfile\", result)\n        nsent = result\n        bytes -= nsent\n        src_offset += nsent\n    end\n    nothing\nend\n\nsendfile(dst::Int, src, src_offset::Int64, bytes::Int) = sendfile(dst, fd(src), src_offset, bytes)\nsendfile(dst, src::Int, src_offset::Int64, bytes::Int) = sendfile(fd(dst), src, src_offset, bytes)\nsendfile(dst, src, src_offset::Int64, bytes::Int) = sendfile(fd(dst), fd(src), src_offset, bytes)"}]}]}],"thread_ts":"1612648263.175700","parent_user_id":"U01FKQQ7J0J"}]