[{"client_msg_id":"52813df7-85ad-4dd4-b76c-94871fe96829","type":"message","text":"Is there a function to check if a `IO` has enough bytes available?  I'm trying to fix a parser I have to deal with errors.  For example I know the next block should have say 500 bytes, but what is a function to verify if that is the case that is generic enough to work for a `IOStream` or a `IOBuffer`.  For example `filesize` works if it's from a file, but doesn't work for an `IOBuffer`.","user":"U7CTYCM4H","ts":"1611261519.110300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XpnQp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a function to check if a "},{"type":"text","text":"IO","style":{"code":true}},{"type":"text","text":" has enough bytes available?  I'm trying to fix a parser I have to deal with errors.  For example I know the next block should have say 500 bytes, but what is a function to verify if that is the case that is generic enough to work for a "},{"type":"text","text":"IOStream","style":{"code":true}},{"type":"text","text":" or a "},{"type":"text","text":"IOBuffer","style":{"code":true}},{"type":"text","text":".  For example "},{"type":"text","text":"filesize","style":{"code":true}},{"type":"text","text":" works if it's from a file, but doesn't work for an "},{"type":"text","text":"IOBuffer","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1611261519.110300","reply_count":20,"reply_users_count":3,"latest_reply":"1611262964.117700","reply_users":["UH8A351DJ","UH24GRBLL","U7CTYCM4H"],"subscribed":false},{"client_msg_id":"1098a2de-f172-4417-b93e-a790a86b4d18","type":"message","text":"there was a semi-related thread: <https://julialang.slack.com/archives/C6A044SQH/p1610669509053900>","user":"UH8A351DJ","ts":"1611261601.110400","team":"T68168MUP","attachments":[{"from_url":"https://julialang.slack.com/archives/C6A044SQH/p1610669509053900","fallback":"[January 14th, 2021 4:11 PM] ararslan: Is there a nice way to get the total number of bytes in a file?","ts":"1610669509.053900","author_id":"U680THK2S","author_subname":"Alex Arslan","channel_id":"C6A044SQH","channel_name":"helpdesk","is_msg_unfurl":true,"is_thread_root_unfurl":true,"text":"Is there a nice way to get the total number of bytes in a file?","author_name":"Alex Arslan","author_link":"https://julialang.slack.com/team/U680THK2S","author_icon":"https://avatars.slack-edge.com/2017-07-11/211144716931_dbc7d4b1a3b3ac9afa2d_48.jpg","mrkdwn_in":["text"],"id":1,"original_url":"https://julialang.slack.com/archives/C6A044SQH/p1610669509053900","footer":"Thread in #helpdesk"}],"blocks":[{"type":"rich_text","block_id":"P1U6m","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"there was a semi-related thread: "},{"type":"link","url":"https://julialang.slack.com/archives/C6A044SQH/p1610669509053900"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"8fb7dd7d-1e28-4a76-a886-a5c7cb1ab945","type":"message","text":"`bytesavailable`?","user":"UH24GRBLL","ts":"1611261937.111200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aNzal","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"bytesavailable","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"b6a0725a-fce4-4ced-b07a-3abb1317f8bd","type":"message","text":"It doesn't work for an `IOStream`, as it only returns the bytes in the buffer before it would block to read more from the OS.","user":"U7CTYCM4H","ts":"1611262047.111400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"c2Jk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It doesn't work for an "},{"type":"text","text":"IOStream","style":{"code":true}},{"type":"text","text":", as it only returns the bytes in the buffer before it would block to read more from the OS."}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"714b5fff-b1ad-4181-a4ea-97cc0335ad98","type":"message","text":"well that's the point of the IOStream though, no?","user":"UH24GRBLL","ts":"1611262137.111600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Lit","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"well that's the point of the IOStream though, no?"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"69b9f458-e223-45e9-b9e2-000603950547","type":"message","text":"there just may not be more bytes available yet","user":"UH24GRBLL","ts":"1611262145.111800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SA+5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"there just may not be more bytes available yet"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"279ec974-d609-452e-bd3c-ed371036fb9e","type":"message","text":"unfortunate that it represents files as well though :/","user":"UH24GRBLL","ts":"1611262163.112000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XL+h5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"unfortunate that it represents files as well though :/"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"85fc2f41-f32f-4287-a3e6-ff01167cbbb3","type":"message","text":"I think it depends on the OS.  At least on windows it seems to buffer 32Kb at a time.  I know how to handle both `IOBuffer` and `IOStream` , but there doesn't appear to be a function that handles both.  I realize it's also complicated by the fact that this could be a network stream where you won't know the total length.","user":"U7CTYCM4H","ts":"1611262316.112500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DD96e","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think it depends on the OS.  At least on windows it seems to buffer 32Kb at a time.  I know how to handle both "},{"type":"text","text":"IOBuffer","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"IOStream","style":{"code":true}},{"type":"text","text":" , but there doesn't appear to be a function that handles both.  I realize it's also complicated by the fact that this could be a network stream where you won't know the total length."}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"5d921b2e-0a8d-4275-bb19-2ce9f80adb07","type":"message","text":"yes, the network stream was what I was thinking of","user":"UH24GRBLL","ts":"1611262337.112700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"flZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yes, the network stream was what I was thinking of"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"bbe57890-6088-4cbe-a80f-12b46549d016","type":"message","text":"Basically, something like `haslength(io) &amp;&amp; bytesavailable(io) &gt; nbytes`","user":"U7CTYCM4H","ts":"1611262423.112900","team":"T68168MUP","edited":{"user":"U7CTYCM4H","ts":"1611262436.000000"},"blocks":[{"type":"rich_text","block_id":"Ct=u","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Basically, something like "},{"type":"text","text":"haslength(io) && bytesavailable(io) > nbytes","style":{"code":true}}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"46afa9b0-72b3-4f2e-8628-7fdac67dcad4","type":"message","text":"I don't think that exists in a generic way","user":"UH24GRBLL","ts":"1611262439.113200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kus","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't think that exists in a generic way"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"dcd22b49-5d95-4b3f-b1f2-b68b2c12e10d","type":"message","text":"the question you'd really need to ask is \"do we have 500 right now and if not, could there possibly be more?\"","user":"UH24GRBLL","ts":"1611262471.113700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EYmG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the question you'd really need to ask is \"do we have 500 right now and if not, could there possibly be more?\""}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"322bd774-45d8-4a30-a9c4-560e16de2fcc","type":"message","text":"I suppose this is one of the arguments for traits","user":"U7CTYCM4H","ts":"1611262473.114000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"SU+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I suppose this is one of the arguments for traits"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"8cd36236-1187-48c1-9360-a705080ff246","type":"message","text":"Yes, stating it that way is really what I want.  Can I get 500 bytes before eof","user":"U7CTYCM4H","ts":"1611262514.114800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oOsm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, stating it that way is really what I want.  Can I get 500 bytes before eof"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"f3543968-ad04-4ed0-85b8-5292d5e55165","type":"message","text":"I suppose if it's IOBuffer the answer is deterministic, since you can check `iswritable`","user":"UH24GRBLL","ts":"1611262577.115300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9Unt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I suppose if it's IOBuffer the answer is deterministic, since you can check "},{"type":"text","text":"iswritable","style":{"code":true}}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"84c3e995-9c32-44a4-940d-16e228cd437b","type":"message","text":"not that easy with IOStream though","user":"UH24GRBLL","ts":"1611262586.115500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CfNy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"not that easy with IOStream though"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"060bb003-c3b7-4aee-99ba-09bda22fcb84","type":"message","text":"hmm, even the file doesn't necessarily have more bytes available, come to think of it","user":"UH24GRBLL","ts":"1611262638.115900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3BlpG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hmm, even the file doesn't necessarily have more bytes available, come to think of it"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"2246c3a4-8a27-45fd-b16a-f645b9c29182","type":"message","text":"the file could sit on some NAS, and even though you have the information how large it should be locally, you can't know if the read will fail until you try","user":"UH24GRBLL","ts":"1611262668.116100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=Rpw4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the file could sit on some NAS, and even though you have the information how large it should be locally, you can't know if the read will fail until you try"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"9e7f6e01-0ded-4d15-ac07-9dd0ffeeb3e1","type":"message","text":"so IOStream very much makes sense here - even without the NAS, reading from disk can in theory always fail","user":"UH24GRBLL","ts":"1611262708.116300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"H=O","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so IOStream very much makes sense here - even without the NAS, reading from disk can in theory always fail"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"674ee11d-6f45-4881-8c70-610b0c600c87","type":"message","text":"yeah, I think you have to deal with the failure - or wrap the IOStream and guarantee some minimum number of bytes until eof that way","user":"UH24GRBLL","ts":"1611262909.117200","team":"T68168MUP","edited":{"user":"UH24GRBLL","ts":"1611262915.000000"},"blocks":[{"type":"rich_text","block_id":"FPCCV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, I think you have to deal with the failure - or wrap the IOStream and guarantee some minimum number of bytes until eof that way"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"},{"client_msg_id":"ea3a55d0-c648-4a64-bd53-c724dc8adeae","type":"message","text":"which strikes me as a good design, since it nicely decouples the reading of the stream from the processing of data","user":"UH24GRBLL","ts":"1611262964.117700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0bNZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"which strikes me as a good design, since it nicely decouples the reading of the stream from the processing of data"}]}]}],"thread_ts":"1611261519.110300","parent_user_id":"U7CTYCM4H"}]