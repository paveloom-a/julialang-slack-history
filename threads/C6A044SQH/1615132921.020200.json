[{"client_msg_id":"c6d7dd7f-d481-4352-8001-ede56c63ddd7","type":"message","text":"I have a function where I would like to move something from runtime to compile-time. It looks similar to this\n```function foo(x::Int, y::Val{Z}) where Z\n    table = calc_table(Z)\n    bar(table, x)\nend```\nI would like to move the `calc_table` to compile time, since the computation only depends on compile time constants. But the table allocates an array, filling it in, before converting it the returned tuple. I think somehow the allocation means the code is not side-effect free, and so the compiler will not move it to compile time.\nHow can I tell the compiler \"you can consider this a pure function, just go ahead and constant fold it\"?","user":"U7HAYKY9X","ts":"1615132921.020200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DgO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have a function where I would like to move something from runtime to compile-time. It looks similar to this\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function foo(x::Int, y::Val{Z}) where Z\n    table = calc_table(Z)\n    bar(table, x)\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"I would like to move the "},{"type":"text","text":"calc_table","style":{"code":true}},{"type":"text","text":" to compile time, since the computation only depends on compile time constants. But the table allocates an array, filling it in, before converting it the returned tuple. I think somehow the allocation means the code is not side-effect free, and so the compiler will not move it to compile time.\nHow can I tell the compiler \"you can consider this a pure function, just go ahead and constant fold it\"?"}]}]}],"thread_ts":"1615132921.020200","reply_count":8,"reply_users_count":3,"latest_reply":"1615143752.024600","reply_users":["B01J9QZ4SP8","U7HAYKY9X","UM30MT6RF"],"subscribed":false,"reactions":[{"name":"bridge","users":["U7HAYKY9X"],"count":1}]},{"type":"message","subtype":"bot_message","text":"Can we cross post this publicly to <https://discourse.julialang.org|Discourse> for further visibility? React with :bridge: on the message above to approve. <https://github.com/JuliaCommunity/SlackBridge/blob/main/README.md#faq|More info here>","ts":"1615132923.020300","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1615132921.020200","parent_user_id":"U7HAYKY9X"},{"type":"message","subtype":"bot_message","text":"Success, it has been cross posted <https://discourse.julialang.org/t/56681| to Discourse>. Keep and eye out on Discourse for responses and please add an answer there once you are satisfied with the solution so others can benefit as well. Happy debugging!","ts":"1615132948.020600","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1615132921.020200","parent_user_id":"U7HAYKY9X"},{"client_msg_id":"ebeeac21-2df4-479f-9cc4-8b4130fd9723","type":"message","text":"Right now I'm solving it by having `foo` return an expression with the calculated table interpolated in as a literal, and that does constant fold, but it's much less pleasant to work with expressions than with values","user":"U7HAYKY9X","ts":"1615133078.020800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MGzDL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Right now I'm solving it by having "},{"type":"text","text":"foo","style":{"code":true}},{"type":"text","text":" return an expression with the calculated table interpolated in as a literal, and that does constant fold, but it's much less pleasant to work with expressions than with values"}]}]}],"thread_ts":"1615132921.020200","parent_user_id":"U7HAYKY9X"},{"client_msg_id":"cc26b519-5a9a-4fa0-97a8-0dfa886b5d24","type":"message","text":"This is not something that is possible to communicate to the compiler, but you could use a generated function.","user":"UM30MT6RF","ts":"1615133118.021000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"bR6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is not something that is possible to communicate to the compiler, but you could use a generated function."}]}]}],"thread_ts":"1615132921.020200","parent_user_id":"U7HAYKY9X"},{"client_msg_id":"580937c1-b078-4f60-9360-29004ad0f5bc","type":"message","text":"Maybe that's precisely what I'm looking for, actually. Never understood generated functions, I'll read about them now. Thanks for the input","user":"U7HAYKY9X","ts":"1615133237.021400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2jEOL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe that's precisely what I'm looking for, actually. Never understood generated functions, I'll read about them now. Thanks for the input"}]}]}],"thread_ts":"1615132921.020200","parent_user_id":"U7HAYKY9X"},{"client_msg_id":"6227f481-3a14-493d-8a6c-11d682e414ec","type":"message","text":"You can also try adding more aggressive inlining annotations to `calc_table`, but this may or may not help","user":"UM30MT6RF","ts":"1615133252.021600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9YWL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You can also try adding more aggressive inlining annotations to "},{"type":"text","text":"calc_table","style":{"code":true}},{"type":"text","text":", but this may or may not help"}]}]}],"thread_ts":"1615132921.020200","parent_user_id":"U7HAYKY9X"},{"client_msg_id":"e5a963ee-d509-4ea6-a441-fe0fab3f89df","type":"message","text":"It looks like I had accidentally manually implemented generated functions, just in a worse way :sweat_smile: thank you!","user":"U7HAYKY9X","ts":"1615133664.021800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GxG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It looks like I had accidentally manually implemented generated functions, just in a worse way "},{"type":"emoji","name":"sweat_smile"},{"type":"text","text":" thank you!"}]}]}],"thread_ts":"1615132921.020200","parent_user_id":"U7HAYKY9X"},{"type":"message","subtype":"bot_message","text":"Hey <@U7HAYKY9X>, if you were able to find an answer here on Slack, please cross post it to Discourse via the link above. Thank you! ","ts":"1615143752.024600","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1615132921.020200","parent_user_id":"U7HAYKY9X"}]