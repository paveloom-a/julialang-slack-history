[{"client_msg_id":"81065a5b-735d-47d6-9007-78dbec34f2ca","type":"message","text":"What’s the best way to find the *two* largest elements in a vector?","user":"U67G3QRJM","ts":"1610227020.174000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"W1Ro9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What’s the best way to find the "},{"type":"text","text":"two","style":{"bold":true}},{"type":"text","text":" largest elements in a vector?"}]}]}],"thread_ts":"1610227020.174000","reply_count":15,"reply_users_count":5,"latest_reply":"1610238070.188600","reply_users":["U7HAYKY9X","U0179G7FG4F","U67G3QRJM","UH24GRBLL","UB2QRMQPN"],"subscribed":false},{"client_msg_id":"52511275-3c22-43eb-9753-ffbae1f168f3","type":"message","text":"Manual loop, I think. For N largest, use a heap.","user":"U7HAYKY9X","ts":"1610227137.174100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ipdO7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Manual loop, I think. For N largest, use a heap."}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM","reactions":[{"name":"confused","users":["U67G3QRJM"],"count":1}]},{"client_msg_id":"321f1582-c836-4d6b-8590-a10cf463e680","type":"message","text":"partialsort","user":"U0179G7FG4F","ts":"1610227211.174600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TP5Fa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"partialsort"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM","reactions":[{"name":"point_up","users":["U7HAYKY9X","UH8A351DJ"],"count":2},{"name":"+1","users":["U67G3QRJM"],"count":1}]},{"client_msg_id":"a30d02f3-2359-481e-b0af-c89833ec64c2","type":"message","text":"I don’t seem to be understanding how to use `partialsort`","user":"U67G3QRJM","ts":"1610227287.175100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=7q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don’t seem to be understanding how to use "},{"type":"text","text":"partialsort","style":{"code":true}}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM"},{"client_msg_id":"ba37c92f-5cc6-4765-ab0a-e3acb6bce03f","type":"message","text":"```julia&gt; v = [1, 2, 3, 4, 7, 2.5];\n\njulia&gt; partialsort(v, 1:2)\n2-element view(::Vector{Float64}, 1:2) with eltype Float64:\n 1.0\n 2.0```","user":"U67G3QRJM","ts":"1610227306.175300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"drwr","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> v = [1, 2, 3, 4, 7, 2.5];\n\njulia> partialsort(v, 1:2)\n2-element view(::Vector{Float64}, 1:2) with eltype Float64:\n 1.0\n 2.0"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM"},{"client_msg_id":"c3e63409-be4f-4ca9-8294-1971836de325","type":"message","text":"Ah I need rev=true","user":"U67G3QRJM","ts":"1610227340.175500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wGX4L","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah I need rev=true"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM"},{"client_msg_id":"afd47b52-774b-48fa-92de-f476c4652b1a","type":"message","text":"Thanks!","user":"U67G3QRJM","ts":"1610227361.175700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xxA6T","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks!"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM"},{"client_msg_id":"c7b72a78-462a-494b-96ff-7b339f9b5837","type":"message","text":"DataStructures has a `nlargest` which uses a heap internally","user":"UH24GRBLL","ts":"1610228208.176300","team":"T68168MUP","edited":{"user":"UH24GRBLL","ts":"1610228219.000000"},"blocks":[{"type":"rich_text","block_id":"m3R","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"DataStructures has a "},{"type":"text","text":"nlargest","style":{"code":true}},{"type":"text","text":" which uses a heap internally"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM"},{"client_msg_id":"9946859a-da19-4127-985f-279a3cc463ec","type":"message","text":"In my experience, it's much faster to roll a custom `foldl` - see <https://discourse.julialang.org/t/finding-index-and-value-of-largest-two-elements-in-a-cuarray/52110>","user":"UB2QRMQPN","ts":"1610236257.184400","team":"T68168MUP","attachments":[{"service_name":"JuliaLang","title":"Finding index and value of largest two elements in a CuArray","title_link":"https://discourse.julialang.org/t/finding-index-and-value-of-largest-two-elements-in-a-cuarray/52110","text":"I need to find the indices and values of the two largest elements in a 2D array. I whipped up a foldl-based solution for the CPU that’s much faster than Base.findmax and Base.partialsortperm, but it runs like molasses on the GPU compared to CUDA.findmax. function findmax2(prev, curr) i, v = curr v &gt; prev.first.v &amp;&amp; return (first=(; i, v), second=prev.first) v &gt; prev.second.v &amp;&amp; return (first=prev.first, second=(; i, v)) return prev end julia&gt; dA = CUDA.rand(512, 512); cA = Arra...","fallback":"JuliaLang: Finding index and value of largest two elements in a CuArray","thumb_url":"https://aws1.discourse-cdn.com/business5/uploads/julialang/original/2X/1/12829a7ba92b924d4ce81099cbf99785bee9b405.png","fields":[{"title":"Reading time","value":"3 mins :clock2:","short":true},{"title":"Likes","value":"9 :heart:","short":true}],"ts":1608416181,"from_url":"https://discourse.julialang.org/t/finding-index-and-value-of-largest-two-elements-in-a-cuarray/52110","thumb_width":408,"thumb_height":263,"service_icon":"https://aws1.discourse-cdn.com/business5/uploads/julialang/optimized/2X/6/6ca888e296f59ca2a599807f7d5edd489e3d1829_2_180x180.png","id":1,"original_url":"https://discourse.julialang.org/t/finding-index-and-value-of-largest-two-elements-in-a-cuarray/52110"}],"blocks":[{"type":"rich_text","block_id":"VSrH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"In my experience, it's much faster to roll a custom "},{"type":"text","text":"foldl","style":{"code":true}},{"type":"text","text":" - see "},{"type":"link","url":"https://discourse.julialang.org/t/finding-index-and-value-of-largest-two-elements-in-a-cuarray/52110"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM"},{"client_msg_id":"f1f159ef-bf56-43ca-83a1-895b158b7be4","type":"message","text":"```julia&gt; function max2(prev, curr)\n           curr &gt; prev.first &amp;&amp; return (first = curr, second = prev.first)\n           curr &gt; prev.second &amp;&amp; return (first = prev.first, second = curr)\n           return prev\n       end\n\njulia&gt; foldmax2(v::Vector{T}) where {T} = foldl(max2, v, init=(first=typemin(T), second=typemin(T)))\nfoldmax2 (generic function with 1 method)```\n```julia&gt; v = zeros(512^2); v[begin] = 1; v[end] = 0.5;\n\njulia&gt; @btime partialsort($v, 1:2, rev=true)\n  727.300 μs (4 allocations: 2.00 MiB)\n2-element view(::Vector{Float64}, 1:2) with eltype Float64:\n 1.0\n 0.5\n\njulia&gt; @btime nlargest(2, $v)\n  534.100 μs (2 allocations: 192 bytes)\n2-element Vector{Float64}:\n 1.0\n 0.5\n\njulia&gt; @btime foldmax2($v)\n  216.300 μs (0 allocations: 0 bytes)\n(first = 1.0, second = 0.5)```","user":"UB2QRMQPN","ts":"1610236888.186800","team":"T68168MUP","edited":{"user":"UB2QRMQPN","ts":"1610236924.000000"},"blocks":[{"type":"rich_text","block_id":"Oedh","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> function max2(prev, curr)\n           curr > prev.first && return (first = curr, second = prev.first)\n           curr > prev.second && return (first = prev.first, second = curr)\n           return prev\n       end\n\njulia> foldmax2(v::Vector{T}) where {T} = foldl(max2, v, init=(first=typemin(T), second=typemin(T)))\nfoldmax2 (generic function with 1 method)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> v = zeros(512^2); v[begin] = 1; v[end] = 0.5;\n\njulia> @btime partialsort($v, 1:2, rev=true)\n  727.300 μs (4 allocations: 2.00 MiB)\n2-element view(::Vector{Float64}, 1:2) with eltype Float64:\n 1.0\n 0.5\n\njulia> @btime nlargest(2, $v)\n  534.100 μs (2 allocations: 192 bytes)\n2-element Vector{Float64}:\n 1.0\n 0.5\n\njulia> @btime foldmax2($v)\n  216.300 μs (0 allocations: 0 bytes)\n(first = 1.0, second = 0.5)"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM","reactions":[{"name":"+1","users":["U0179G7FG4F"],"count":1}]},{"client_msg_id":"3bac1d4e-88a2-44f9-b5ea-2399b6e8ff92","type":"message","text":"I think it was noted in that thread that at about n=15 the `nlargest` is faster because of the algorithmic advantage","user":"UH24GRBLL","ts":"1610237119.187600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"F0u","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think it was noted in that thread that at about n=15 the "},{"type":"text","text":"nlargest","style":{"code":true}},{"type":"text","text":" is faster because of the algorithmic advantage"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM"},{"client_msg_id":"982b3f3a-7c76-420b-beac-a654dde6bc4e","type":"message","text":"```julia&gt; v = zeros(15); v[begin] = 1; v[end] = 0.5;\n\njulia&gt; @btime foldmax2($v)\n  13.113 ns (0 allocations: 0 bytes)\n(first = 1.0, second = 0.5)\n\njulia&gt; @btime nlargest(2, $v)\n  118.886 ns (2 allocations: 192 bytes)\n2-element Vector{Float64}:\n 1.0\n 0.5```","user":"UB2QRMQPN","ts":"1610237308.187800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"IERW","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> v = zeros(15); v[begin] = 1; v[end] = 0.5;\n\njulia> @btime foldmax2($v)\n  13.113 ns (0 allocations: 0 bytes)\n(first = 1.0, second = 0.5)\n\njulia> @btime nlargest(2, $v)\n  118.886 ns (2 allocations: 192 bytes)\n2-element Vector{Float64}:\n 1.0\n 0.5"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM"},{"client_msg_id":"96f1225f-d2fd-4a10-bed3-da8064aecde3","type":"message","text":"yes, that's the two largest, with n=15 I was talking about e.g. the 15 largest","user":"UH24GRBLL","ts":"1610237458.188000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5Tj83","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yes, that's the two largest, with n=15 I was talking about e.g. the 15 largest"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM"},{"client_msg_id":"af9a5688-b94d-4af5-84a7-561e69ae98f3","type":"message","text":"Ahh, yep, and you wouldn't want to hand-roll for anything close to that many","user":"UB2QRMQPN","ts":"1610237537.188200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"s1U9d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ahh, yep, and you wouldn't want to hand-roll for anything close to that many"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM"},{"client_msg_id":"42243d07-6eb0-4593-9d69-bdb99bb151db","type":"message","text":"yes","user":"UH24GRBLL","ts":"1610238043.188400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WfLEM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yes"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM"},{"client_msg_id":"2e15019c-3e1e-4c78-936e-e8dec5c38ae0","type":"message","text":"I'd usually even go the other way round, use `nlargest` by default and only if it's identified to be a performance bottleneck, handroll it for the specific case","user":"UH24GRBLL","ts":"1610238070.188600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6JorK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'd usually even go the other way round, use "},{"type":"text","text":"nlargest","style":{"code":true}},{"type":"text","text":" by default and only if it's identified to be a performance bottleneck, handroll it for the specific case"}]}]}],"thread_ts":"1610227020.174000","parent_user_id":"U67G3QRJM","reactions":[{"name":"+1","users":["U67G3QRJM"],"count":1}]}]