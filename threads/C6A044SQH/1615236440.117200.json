[{"client_msg_id":"93594641-a747-4751-be04-4768c6c1b1fb","type":"message","text":"I have a script that is about 1500 lines, all functions, no consts, no globals, and nothing being evaluated in the REPL. The time to include this script is about ~1 minute!\n```julia&gt; @time include(\"model.jl\")\n[ Info:   Gnuplot version: 5.2.0\n 58.871149 seconds (98.60 M allocations: 5.410 GiB, 3.78% gc time)\nplot_comb_gp (generic function with 1 method)```\nGetting rid of *all* the code, but only leaving the `using` statements in, the time is only marginally reduced so I am guessing the majority of the time is spent importing packages.\n```using DifferentialEquations\nusing Parameters\nusing Gnuplot\nusing CSV\nusing DataFrames\nusing LinearAlgebra\nusing ForwardDiff\nusing ProgressMeter\nusing DelimitedFiles\nusing Distributions\nusing Bootstrap\nusing JLD2\nusing FileIO\nusing Interpolations\nusing RCall\n\njulia&gt; @time include(\"model.jl\")\n[ Info:   Gnuplot version: 5.2.0\n 50.817761 seconds (84.15 M allocations: 4.665 GiB, 4.12% gc time)```\nIs there a way to fix this? This can take upwards of 10 minutes if I do `@everywhere include(\"model.jl\")` on about 300 worker processes","user":"U6Z8377N2","ts":"1615236440.117200","team":"T68168MUP","edited":{"user":"U6Z8377N2","ts":"1615236488.000000"},"blocks":[{"type":"rich_text","block_id":"OBHV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have a script that is about 1500 lines, all functions, no consts, no globals, and nothing being evaluated in the REPL. The time to include this script is about ~1 minute!\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @time include(\"model.jl\")\n[ Info:   Gnuplot version: 5.2.0\n 58.871149 seconds (98.60 M allocations: 5.410 GiB, 3.78% gc time)\nplot_comb_gp (generic function with 1 method)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Getting rid of "},{"type":"text","text":"all","style":{"bold":true}},{"type":"text","text":" the code, but only leaving the "},{"type":"text","text":"using","style":{"code":true}},{"type":"text","text":" statements in, the time is only marginally reduced so I am guessing the majority of the time is spent importing packages.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using DifferentialEquations\nusing Parameters\nusing Gnuplot\nusing CSV\nusing DataFrames\nusing LinearAlgebra\nusing ForwardDiff\nusing ProgressMeter\nusing DelimitedFiles\nusing Distributions\nusing Bootstrap\nusing JLD2\nusing FileIO\nusing Interpolations\nusing RCall\n\njulia> @time include(\"model.jl\")\n[ Info:   Gnuplot version: 5.2.0\n 50.817761 seconds (84.15 M allocations: 4.665 GiB, 4.12% gc time)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a way to fix this? This can take upwards of 10 minutes if I do "},{"type":"text","text":"@everywhere include(\"model.jl\")","style":{"code":true}},{"type":"text","text":" on about 300 worker processes"}]}]}],"thread_ts":"1615236440.117200","reply_count":23,"reply_users_count":5,"latest_reply":"1615237648.122200","reply_users":["B01J9QZ4SP8","UH24GRBLL","UH8A351DJ","U6Z8377N2","UGTUKUHLN"],"subscribed":false},{"type":"message","subtype":"bot_message","text":"Can we cross post this publicly to <https://discourse.julialang.org|Discourse> for further visibility? React with :bridge: on the message above to approve. <https://github.com/JuliaCommunity/SlackBridge/blob/main/README.md#faq|More info here>","ts":"1615236441.117300","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"e03fb8ba-3509-4f64-a815-ba7433eea849","type":"message","text":"have you put it in a project with an environment?","user":"UH24GRBLL","ts":"1615236524.117600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4yho","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"have you put it in a project with an environment?"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"6e28b801-4fe4-4439-be2a-5e241573a486","type":"message","text":"sounds about right, 300 workers each have to do disk IO with your `.julia/` most likely. Is this on Julia 1.6?","user":"UH8A351DJ","ts":"1615236556.117800","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615236585.000000"},"blocks":[{"type":"rich_text","block_id":"vOW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"sounds about right, 300 workers each have to do disk IO with your "},{"type":"text","text":".julia/","style":{"code":true}},{"type":"text","text":" most likely. Is this on Julia 1.6?"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2","reactions":[{"name":"floppy_disk","users":["UGU761DU2"],"count":1}]},{"client_msg_id":"336c22fa-b6ef-4689-8755-84439bbb3a06","type":"message","text":"Yes. It's got its own environment, and launch julia with `--project=.` flag.","user":"U6Z8377N2","ts":"1615236594.118200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"N/717","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes. It's got its own environment, and launch julia with "},{"type":"text","text":"--project=.","style":{"code":true}},{"type":"text","text":" flag."}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"cf79d941-5fdd-47cf-9b92-62f463b57e55","type":"message","text":"This is on 1.5.3","user":"U6Z8377N2","ts":"1615236598.118400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kAMzS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is on 1.5.3"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"aa589574-8928-4193-922d-470ca098805b","type":"message","text":"try 1.6, which has the improvement on invalidation","user":"UH8A351DJ","ts":"1615236642.118600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kawNU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"try 1.6, which has the improvement on invalidation"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"d345bbc1-f6dd-44e2-bd3a-f0097cc14d60","type":"message","text":"One way to possibly alleviate this is checking whether you really need all of DifferentialEquations.jl or just some subset","user":"UH24GRBLL","ts":"1615236645.118800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hjb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"One way to possibly alleviate this is checking whether you really need all of DifferentialEquations.jl or just some subset"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"0abb710e-48b3-4ae5-ac6d-74d0452a313d","type":"message","text":"Right, I just need OrdinaryDiffE","user":"U6Z8377N2","ts":"1615236668.119000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yV=x","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Right, I just need OrdinaryDiffE"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"762a93a2-96e1-4a36-8406-d0fe7652d61d","type":"message","text":"as far as I know, DifferentialEquations.jl has kind of moved to being a meta-package, similar to Makie.jl itself","user":"UH24GRBLL","ts":"1615236681.119200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dcl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"as far as I know, DifferentialEquations.jl has kind of moved to being a meta-package, similar to Makie.jl itself"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"91086052-6118-408e-9b02-badf34575872","type":"message","text":"Ah indeed, removing `DiffEq`, reduces it to\n```julia&gt; @time include(\"model.jl\")\n[ Info:   Gnuplot version: 5.2.0\n 14.692668 seconds (24.21 M allocations: 1.312 GiB, 3.92% gc time)```","user":"U6Z8377N2","ts":"1615236686.119400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"B+g","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah indeed, removing "},{"type":"text","text":"DiffEq","style":{"code":true}},{"type":"text","text":", reduces it to\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> @time include(\"model.jl\")\n[ Info:   Gnuplot version: 5.2.0\n 14.692668 seconds (24.21 M allocations: 1.312 GiB, 3.92% gc time)"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"7699f6bc-e498-4cb4-a11d-673bf93a9646","type":"message","text":"well there we go :)","user":"UH24GRBLL","ts":"1615236694.119600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Fdi7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"well there we go :)"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"b3f349b2-9482-4220-9c70-223f204d77e7","type":"message","text":"<@U69BL50BF>, would it be sufficient to simply replace `DifferentialEquations` with `OrdinaryDiffEq`? My model and solver is\n```     prob = ODEProblem(aModel!, u0, tspan, params)\n     sol = solve(prob, Rodas4(autodiff=false), dt=1, adaptive=false, callback=cbset)```\nwith a bunch of callbacks. Wonder if all the functionality is included in OrdinaryDiffEq","user":"U6Z8377N2","ts":"1615236778.119800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vZsG+","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U69BL50BF"},{"type":"text","text":", would it be sufficient to simply replace "},{"type":"text","text":"DifferentialEquations","style":{"code":true}},{"type":"text","text":" with "},{"type":"text","text":"OrdinaryDiffEq","style":{"code":true}},{"type":"text","text":"? My model and solver is\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"     prob = ODEProblem(aModel!, u0, tspan, params)\n     sol = solve(prob, Rodas4(autodiff=false), dt=1, adaptive=false, callback=cbset)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"with a bunch of callbacks. Wonder if all the functionality is included in OrdinaryDiffEq"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"58e0cbbb-5d73-4d9c-9093-40b557536b7a","type":"message","text":"<@UH8A351DJ> the timing show here is with precompiled packages. God forbid there is an invalidation and `DiffEq` has to precompile, now that takes a long time :slightly_smiling_face:","user":"U6Z8377N2","ts":"1615236835.120000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BuIG","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"UH8A351DJ"},{"type":"text","text":" the timing show here is with precompiled packages. God forbid there is an invalidation and "},{"type":"text","text":"DiffEq","style":{"code":true}},{"type":"text","text":" has to precompile, now that takes a long time "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"0e1a8b87-54a9-4170-b61d-ad57c46b0ad9","type":"message","text":"invalidation is not about `precompile...`","user":"UH8A351DJ","ts":"1615236863.120200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nab","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"invalidation is not about "},{"type":"text","text":"precompile...","style":{"code":true}}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2","reactions":[{"name":"point_up","users":["UH24GRBLL"],"count":1}]},{"client_msg_id":"d5687c16-ceaa-4712-a93c-b4128e562626","type":"message","text":"Oh, I see. I don't know much about invalidations. I will try on 1.6 later and see","user":"U6Z8377N2","ts":"1615236949.120500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DXZW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh, I see. I don't know much about invalidations. I will try on 1.6 later and see"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"0cedce9f-02fa-4205-8edf-f0e8a426694c","type":"message","text":"As I understand it, if you only need ODEProblem, you should be fine just loading `OrdinaryDiffEq`","user":"UH24GRBLL","ts":"1615237024.120700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JFI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"As I understand it, if you only need ODEProblem, you should be fine just loading "},{"type":"text","text":"OrdinaryDiffEq","style":{"code":true}}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"7edee589-df47-4a8b-9f38-72c50dee3222","type":"message","text":"the solvers usable for those kinds of differential equations are surely included with the package","user":"UH24GRBLL","ts":"1615237109.121000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Nye","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the solvers usable for those kinds of differential equations are surely included with the package"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"3bef1a41-d8fe-48a8-8f80-effac48ae10d","type":"message","text":"Why does it take so much time for multiprocessing workers?","user":"UGTUKUHLN","ts":"1615237116.121200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RkZ6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Why does it take so much time for multiprocessing workers?"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"3aebbc82-e8a1-4435-a9db-c0f933bd10df","type":"message","text":"otherwise, what's the point in segmenting it?","user":"UH24GRBLL","ts":"1615237116.121400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ml51p","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"otherwise, what's the point in segmenting it?"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"d6faa4dd-2659-440c-a3ed-a0442cd784af","type":"message","text":"So just including `OrdinaryDiffEq` reduces time by half. Not great, but better than nothing. I suppose theres not much to be done about this. Given that I use diffeq quite a bit, would it be \"instant\" if I bake it into a Julia system image?","user":"U6Z8377N2","ts":"1615237335.121600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"160t","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So just including "},{"type":"text","text":"OrdinaryDiffEq","style":{"code":true}},{"type":"text","text":" reduces time by half. Not great, but better than nothing. I suppose theres not much to be done about this. Given that I use diffeq quite a bit, would it be \"instant\" if I bake it into a Julia system image?"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"800d1b00-31c8-4ddc-84c5-30ad341fefaf","type":"message","text":"If that's an option, go for it","user":"UH24GRBLL","ts":"1615237608.121800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pyA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If that's an option, go for it"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"dcbf6ced-cde6-463e-8871-97f8a8033639","type":"message","text":"if it doesn't work out, you can always revert back","user":"UH24GRBLL","ts":"1615237626.122000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5G6k","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if it doesn't work out, you can always revert back"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"},{"client_msg_id":"ffe98033-b2e0-43ae-9be5-368a82c6a6ad","type":"message","text":"just keep in mind that updating versions of those packages requires rebuilding the system image (as far as I remember)","user":"UH24GRBLL","ts":"1615237648.122200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/yai","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"just keep in mind that updating versions of those packages requires rebuilding the system image (as far as I remember)"}]}]}],"thread_ts":"1615236440.117200","parent_user_id":"U6Z8377N2"}]