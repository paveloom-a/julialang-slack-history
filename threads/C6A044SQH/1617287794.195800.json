[{"client_msg_id":"d0d217ce-dfad-4888-badc-9840fdfe38ad","type":"message","text":"Hi a question regarding multiple dispatch. In the performance tips they warn against abusing multiple dispatch. I was wondering whether the following is best practice:\n\nI have a 2x2 block matrix type:\n```struct BlockMatrix{T, T11 &lt;: AbstractMatrix{T}, T12 &lt;: AbstractMatrix{T}, T21 &lt;: AbstractMatrix{T}, T22 &lt;: AbstractMatrix{T}} &lt;: AbstractMatrix{T}\n  A11::T11\n  A12::T12\n  A21::T21\n  A22::T22\n\n  # inner constructor etc. checks for consistency among dimensions...\nend```\nso routines that use `BlockMatrix` potentially dispatch on many different combinations depending on the arrays they get no? Would this be the best way to do it?","user":"U01L0RJC6FM","ts":"1617287794.195800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Sjgyl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi a question regarding multiple dispatch. In the performance tips they warn against abusing multiple dispatch. I was wondering whether the following is best practice:\n\nI have a 2x2 block matrix type:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"struct BlockMatrix{T, T11 <: AbstractMatrix{T}, T12 <: AbstractMatrix{T}, T21 <: AbstractMatrix{T}, T22 <: AbstractMatrix{T}} <: AbstractMatrix{T}\n  A11::T11\n  A12::T12\n  A21::T21\n  A22::T22\n\n  # inner constructor etc. checks for consistency among dimensions...\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"so routines that use "},{"type":"text","text":"BlockMatrix","style":{"code":true}},{"type":"text","text":" potentially dispatch on many different combinations depending on the arrays they get no? Would this be the best way to do it?"}]}]}],"thread_ts":"1617287794.195800","reply_count":21,"reply_users_count":5,"latest_reply":"1617519661.396200","reply_users":["USU9FRPEU","U01L0RJC6FM","U67SCG4HG","U0179G7FG4F","U01E7DK9HPA"],"is_locked":false,"subscribed":false},{"client_msg_id":"d21fa701-50f6-43b6-b013-d22a10735617","type":"message","text":"I'm confused. Do the individual blocks use different element types?","user":"USU9FRPEU","ts":"1617288063.195900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"T/e","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm confused. Do the individual blocks use different element types?"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"8b8390b7-f7b4-4a00-9e81-3abee12ba301","type":"message","text":"You also may be interested in <https://github.com/JuliaArrays/BlockArrays.jl>","user":"USU9FRPEU","ts":"1617288106.196100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"c0E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You also may be interested in "},{"type":"link","url":"https://github.com/JuliaArrays/BlockArrays.jl"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"bc1586ba-675e-442f-a683-f8159b215ca5","type":"message","text":"no this should allow for the same element type across blocks no?","user":"U01L0RJC6FM","ts":"1617288852.197400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"l8s","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"no this should allow for the same element type across blocks no?"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"8533c664-9f76-423e-b866-26570949a1a8","type":"message","text":"I specifically avoided BlockArrays.jl as I only need 2x2 blocks where individual blocks might be stored as different matrix types","user":"U01L0RJC6FM","ts":"1617288881.197600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rqs8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I specifically avoided BlockArrays.jl as I only need 2x2 blocks where individual blocks might be stored as different matrix types"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"bba79ec1-7776-48b9-a9f4-fa761df09bdb","type":"message","text":"for instance A11 is dense, A12 might be view of a sparse matric and A22 might be low-rank","user":"U01L0RJC6FM","ts":"1617288906.197800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"i45","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"for instance A11 is dense, A12 might be view of a sparse matric and A22 might be low-rank"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"2453a88f-a35e-47be-9237-4c317c7915e8","type":"message","text":"There is nothing wrong with your struct in the example, and I don't understand how that connects to \"abusing multiple dispatch\"","user":"U67SCG4HG","ts":"1617289630.200500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"m7yzT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"There is nothing wrong with your struct in the example, and I don't understand how that connects to \"abusing multiple dispatch\""}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"5bfe38c4-2c53-4bfe-8eaf-e316e4415506","type":"message","text":"I read the performance tips and it was warning against dispatching on too many types","user":"U01L0RJC6FM","ts":"1617289771.200700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"r9KqY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I read the performance tips and it was warning against dispatching on too many types"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"6e55931d-309d-4d10-9636-e5af5501e65b","type":"message","text":"for some reason i have an issue when i plug in `view(A, ind1, ind2)` into those Blockmatrices and it slows down my code considerably","user":"U01L0RJC6FM","ts":"1617289822.200900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M60","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"for some reason i have an issue when i plug in "},{"type":"text","text":"view(A, ind1, ind2)","style":{"code":true}},{"type":"text","text":" into those Blockmatrices and it slows down my code considerably"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"87156df4-b5b9-4e53-b57b-1f751be39f06","type":"message","text":"I have asked about it here: <https://julialang.slack.com/archives/C6A044SQH/p1617235102160200>\nand just can't fogure out what I am doing wrong","user":"U01L0RJC6FM","ts":"1617289878.201400","team":"T68168MUP","attachments":[{"from_url":"https://julialang.slack.com/archives/C6A044SQH/p1617235102160200","fallback":"[March 31st, 2021 4:58 PM] bonevbs: Hi, I have a struct `MyStryct(A11, A12, A21, A22)`that holds multiple `AbstractMatrix`  types. In particular, I often need it to store some subpart of a large, sparse matrix. The tricky part is, that there is also a permutation, so in fact what I need is my container to hold `A[idx,idx]` . While analyzing my code with `@profview` , I observe that a lot of time is spent on constructing `MyStruct(A[idx,idx], ...)`  which calls  `SparseArrays.getindex`  and `SparseArrays_getindex_I_sorted` , which in turn calls `zeros` for some reason.\n\nI though that I could circumvent all of this by using `@view` , but the code slows down considerably when I do this. Am I missing something here? Any advice on how to improve it?","ts":"1617235102.160200","author_id":"U01L0RJC6FM","author_subname":"Boris Bonev","channel_id":"C6A044SQH","channel_name":"helpdesk","is_msg_unfurl":true,"is_thread_root_unfurl":true,"text":"Hi, I have a struct `MyStryct(A11, A12, A21, A22)`that holds multiple `AbstractMatrix`  types. In particular, I often need it to store some subpart of a large, sparse matrix. The tricky part is, that there is also a permutation, so in fact what I need is my container to hold `A[idx,idx]` . While analyzing my code with `@profview` , I observe that a lot of time is spent on constructing `MyStruct(A[idx,idx], ...)`  which calls  `SparseArrays.getindex`  and `SparseArrays_getindex_I_sorted` , which in turn calls `zeros` for some reason.\n\nI though that I could circumvent all of this by using `@view` , but the code slows down considerably when I do this. Am I missing something here? Any advice on how to improve it?","author_name":"Boris Bonev","author_link":"https://julialang.slack.com/team/U01L0RJC6FM","author_icon":"https://secure.gravatar.com/avatar/53605d00fe178b7a09a5b0fa81c4cefc.jpg?s=48&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0000-48.png","mrkdwn_in":["text"],"id":1,"original_url":"https://julialang.slack.com/archives/C6A044SQH/p1617235102160200","footer":"Thread in #helpdesk"}],"blocks":[{"type":"rich_text","block_id":"/9ol","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have asked about it here: "},{"type":"link","url":"https://julialang.slack.com/archives/C6A044SQH/p1617235102160200"},{"type":"text","text":"\nand just can't fogure out what I am doing wrong"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"7b283049-d4ac-4fd0-b466-eb26925d450a","type":"message","text":"I see. I highly doubt the slowdown is due to the struct having these parameters. However, I believe `view`s of sparsematrices might be really slow (compared to actually extracting the part and then work with a sparse matrix directly).","user":"U67SCG4HG","ts":"1617290053.201700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"kP24","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I see. I highly doubt the slowdown is due to the struct having these parameters. However, I believe `view`s of sparsematrices might be really slow (compared to actually extracting the part and then work with a sparse matrix directly)."}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"3334bbd1-b232-42b6-8d04-be24578180ea","type":"message","text":"oh ok I didnt know that...","user":"U01L0RJC6FM","ts":"1617290094.201900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8h4D","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh ok I didnt know that..."}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"c2cfaeee-7c9d-4d81-a776-05890592779e","type":"message","text":"my profiler currently looks like this","user":"U01L0RJC6FM","ts":"1617290102.202100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vF=Y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"my profiler currently looks like this"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"type":"message","text":"","files":[{"id":"F01T2QCNBJN","created":1617290786,"timestamp":1617290786,"name":"Screenshot 2021-04-01 at 17.26.00.png","title":"Screenshot 2021-04-01 at 17.26.00.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"U01L0RJC6FM","editable":false,"size":297377,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01T2QCNBJN/screenshot_2021-04-01_at_17.26.00.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01T2QCNBJN/download/screenshot_2021-04-01_at_17.26.00.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01T2QCNBJN-b264edd50e/screenshot_2021-04-01_at_17.26.00_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01T2QCNBJN-b264edd50e/screenshot_2021-04-01_at_17.26.00_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01T2QCNBJN-b264edd50e/screenshot_2021-04-01_at_17.26.00_360.png","thumb_360_w":360,"thumb_360_h":114,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01T2QCNBJN-b264edd50e/screenshot_2021-04-01_at_17.26.00_480.png","thumb_480_w":480,"thumb_480_h":152,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01T2QCNBJN-b264edd50e/screenshot_2021-04-01_at_17.26.00_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01T2QCNBJN-b264edd50e/screenshot_2021-04-01_at_17.26.00_720.png","thumb_720_w":720,"thumb_720_h":228,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01T2QCNBJN-b264edd50e/screenshot_2021-04-01_at_17.26.00_800.png","thumb_800_w":800,"thumb_800_h":253,"thumb_960":"https://files.slack.com/files-tmb/T68168MUP-F01T2QCNBJN-b264edd50e/screenshot_2021-04-01_at_17.26.00_960.png","thumb_960_w":960,"thumb_960_h":304,"thumb_1024":"https://files.slack.com/files-tmb/T68168MUP-F01T2QCNBJN-b264edd50e/screenshot_2021-04-01_at_17.26.00_1024.png","thumb_1024_w":1024,"thumb_1024_h":324,"original_w":1882,"original_h":596,"thumb_tiny":"AwAPADDQP+sFKB1oIO8c0AHnmgBcilzTWHPWk59f0oAcTSZoHPf9KTn1oA//2Q==","permalink":"https://julialang.slack.com/files/U01L0RJC6FM/F01T2QCNBJN/screenshot_2021-04-01_at_17.26.00.png","permalink_public":"https://slack-files.com/T68168MUP-F01T2QCNBJN-898ccd66fc","is_starred":false,"has_rich_preview":false}],"upload":false,"user":"U01L0RJC6FM","display_as_bot":false,"ts":"1617290790.202400","thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"9fa504bb-ff58-4c6d-a91a-a92750674cff","type":"message","text":"basically _`assemble_blocks`  constructs a Block matrix with submatrices of the original matrix","user":"U01L0RJC6FM","ts":"1617290839.202600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+tc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"basically _"},{"type":"text","text":"assemble_blocks","style":{"code":true}},{"type":"text","text":"  constructs a Block matrix with submatrices of the original matrix"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"type":"message","text":"are views of sparse arrays really that much slower? just constructing the view seems faster at least...\nI would be thankful for any pointers towards when views are slower","files":[{"id":"F01T3BQP0P5","created":1617295722,"timestamp":1617295722,"name":"Screenshot 2021-04-01 at 18.48.37.png","title":"Screenshot 2021-04-01 at 18.48.37.png","mimetype":"image/png","filetype":"png","pretty_type":"PNG","user":"U01L0RJC6FM","editable":false,"size":157432,"mode":"hosted","is_external":false,"external_type":"","is_public":true,"public_url_shared":false,"display_as_bot":false,"username":"","url_private":"https://files.slack.com/files-pri/T68168MUP-F01T3BQP0P5/screenshot_2021-04-01_at_18.48.37.png","url_private_download":"https://files.slack.com/files-pri/T68168MUP-F01T3BQP0P5/download/screenshot_2021-04-01_at_18.48.37.png","thumb_64":"https://files.slack.com/files-tmb/T68168MUP-F01T3BQP0P5-586e11f7f1/screenshot_2021-04-01_at_18.48.37_64.png","thumb_80":"https://files.slack.com/files-tmb/T68168MUP-F01T3BQP0P5-586e11f7f1/screenshot_2021-04-01_at_18.48.37_80.png","thumb_360":"https://files.slack.com/files-tmb/T68168MUP-F01T3BQP0P5-586e11f7f1/screenshot_2021-04-01_at_18.48.37_360.png","thumb_360_w":285,"thumb_360_h":360,"thumb_480":"https://files.slack.com/files-tmb/T68168MUP-F01T3BQP0P5-586e11f7f1/screenshot_2021-04-01_at_18.48.37_480.png","thumb_480_w":379,"thumb_480_h":480,"thumb_160":"https://files.slack.com/files-tmb/T68168MUP-F01T3BQP0P5-586e11f7f1/screenshot_2021-04-01_at_18.48.37_160.png","thumb_720":"https://files.slack.com/files-tmb/T68168MUP-F01T3BQP0P5-586e11f7f1/screenshot_2021-04-01_at_18.48.37_720.png","thumb_720_w":569,"thumb_720_h":720,"thumb_800":"https://files.slack.com/files-tmb/T68168MUP-F01T3BQP0P5-586e11f7f1/screenshot_2021-04-01_at_18.48.37_800.png","thumb_800_w":800,"thumb_800_h":1012,"thumb_960":"https://files.slack.com/files-tmb/T68168MUP-F01T3BQP0P5-586e11f7f1/screenshot_2021-04-01_at_18.48.37_960.png","thumb_960_w":759,"thumb_960_h":960,"thumb_1024":"https://files.slack.com/files-tmb/T68168MUP-F01T3BQP0P5-586e11f7f1/screenshot_2021-04-01_at_18.48.37_1024.png","thumb_1024_w":809,"thumb_1024_h":1024,"original_w":1176,"original_h":1488,"thumb_tiny":"AwAwACW9z60vPrR+NFABk0uTSfjS0ABJz1FJlvUflSnrRQAmKKXaPU0uPc0ANxRzTse5paAGnrRTqKACijINFABRRRQAUUUUAf/Z","permalink":"https://julialang.slack.com/files/U01L0RJC6FM/F01T3BQP0P5/screenshot_2021-04-01_at_18.48.37.png","permalink_public":"https://slack-files.com/T68168MUP-F01T3BQP0P5-bf82d53aa4","is_starred":false,"has_rich_preview":false}],"upload":false,"blocks":[{"type":"rich_text","block_id":"hi78","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"are views of sparse arrays really that much slower? just constructing the view seems faster at least...\nI would be thankful for any pointers towards when views are slower"}]}]}],"user":"U01L0RJC6FM","display_as_bot":false,"ts":"1617295790.203600","thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"38adb6cf-7371-4a96-b230-c7edd0e5f7a8","type":"message","text":"The thing that will be slower is `getindex` and `setindex`","user":"U0179G7FG4F","ts":"1617296004.204600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/Sna","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The thing that will be slower is "},{"type":"text","text":"getindex","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"setindex","style":{"code":true}}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"7380f28b-efd1-48ab-a952-555ab0dbde5d","type":"message","text":"that makes sense but getindex shouldn't dramatically change complexity no?","user":"U01L0RJC6FM","ts":"1617296102.206700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"BfJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that makes sense but getindex shouldn't dramatically change complexity no?"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"60c33e97-969d-4788-923b-a202dda5502c","type":"message","text":"it just goes through `A[iidx[i], jidx[j]]` ?","user":"U01L0RJC6FM","ts":"1617296185.207900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QaL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it just goes through "},{"type":"text","text":"A[iidx[i], jidx[j]]","style":{"code":true}},{"type":"text","text":" ?"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"5d225273-b95a-4a40-a424-0add7070ee36","type":"message","text":"aha i realize that if i perform arithmetic on a view it will copy it anyway from the view, so if i use it for arithmetic later, if it is not in place it might be smarter to avoid the view?","user":"U01L0RJC6FM","ts":"1617296229.208100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"01ta","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"aha i realize that if i perform arithmetic on a view it will copy it anyway from the view, so if i use it for arithmetic later, if it is not in place it might be smarter to avoid the view?"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM","reactions":[{"name":"thumbsup_all","users":["U0179G7FG4F"],"count":1}]},{"client_msg_id":"fe4e1b21-7c3f-42dd-8c75-87b88eb132ef","type":"message","text":"What’s your profiler?","user":"U01E7DK9HPA","ts":"1617404998.302500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OlnGh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What’s your profiler?"}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"},{"client_msg_id":"0fb43d65-bc79-4be9-917f-bdd1f7926a5d","type":"message","text":"it's the VS code one. I realized that there is some inconsistencies among profilers.","user":"U01L0RJC6FM","ts":"1617519661.396200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LSuS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it's the VS code one. I realized that there is some inconsistencies among profilers."}]}]}],"thread_ts":"1617287794.195800","parent_user_id":"U01L0RJC6FM"}]