[{"client_msg_id":"83f10d9a-7651-4cdd-aa17-77e32ec1c146","type":"message","text":"Whats the scope of a variable declared inside a `@generated` function? I’ve used something similar to this minimal example to cache the results of a more complicated calculation:\n```@generated function f(i::Int)\n    cache = [cos(idx) for idx in 1:10]\n    :($cache[i])\nend```\nIt works and is much faster than redoing the calculation. But in which scope does the `cache`  actually live?","user":"U01BYANF42K","ts":"1615452823.322700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"d4k","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Whats the scope of a variable declared inside a "},{"type":"text","text":"@generated","style":{"code":true}},{"type":"text","text":" function? I’ve used something similar to this minimal example to cache the results of a more complicated calculation:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@generated function f(i::Int)\n    cache = [cos(idx) for idx in 1:10]\n    :($cache[i])\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"It works and is much faster than redoing the calculation. But in which scope does the "},{"type":"text","text":"cache","style":{"code":true}},{"type":"text","text":"  actually live?"}]}]}],"thread_ts":"1615452823.322700","reply_count":5,"reply_users_count":4,"latest_reply":"1615454064.323700","reply_users":["B01J9QZ4SP8","UM30MT6RF","U01BYANF42K","U7HAYKY9X"],"subscribed":false},{"type":"message","subtype":"bot_message","text":"Can we cross post this publicly to <https://discourse.julialang.org|Discourse> for further visibility? React with :bridge: on the message above to approve. <https://github.com/JuliaCommunity/SlackBridge/blob/main/README.md#faq|More info here>","ts":"1615452825.322800","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1615452823.322700","parent_user_id":"U01BYANF42K"},{"client_msg_id":"6eb1d3fd-19f5-4647-8940-c3a21868f838","type":"message","text":"`cache` is spliced directly into the AST, so there's not really a scope as such outside the body generating the expression. It's more like literal values such as `3` or `\"foobar\"`.","user":"UM30MT6RF","ts":"1615452956.323100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nb5g","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"cache","style":{"code":true}},{"type":"text","text":" is spliced directly into the AST, so there's not really a scope as such outside the body generating the expression. It's more like literal values such as "},{"type":"text","text":"3","style":{"code":true}},{"type":"text","text":" or "},{"type":"text","text":"\"foobar\"","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1615452823.322700","parent_user_id":"U01BYANF42K"},{"client_msg_id":"5836e538-a55d-40bd-b748-ae215807421d","type":"message","text":"so the compiler would see the function as\n```function f(i::Int)\n    [0.540, -0.41,...][i]\nend```\nHowever, this does not allocate on function call. So the compiler can somehow optimize away this array literal?","user":"U01BYANF42K","ts":"1615453577.323300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9yEx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so the compiler would see the function as\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function f(i::Int)\n    [0.540, -0.41,...][i]\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"However, this does not allocate on function call. So the compiler can somehow optimize away this array literal?"}]}]}],"thread_ts":"1615452823.322700","parent_user_id":"U01BYANF42K"},{"client_msg_id":"c7f0076e-7efb-4a2c-81a2-62d268fcb659","type":"message","text":"Yes, it can do that.","user":"U7HAYKY9X","ts":"1615453794.323500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jv6Mf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, it can do that."}]}]}],"thread_ts":"1615452823.322700","parent_user_id":"U01BYANF42K"},{"client_msg_id":"614980d7-52f7-4d6a-94c8-e1c673a87fc3","type":"message","text":"Hm if i define a function with an array literal like this it does allocate… so the AST seems to be a bit different. Is it possible to get the Expr object created by the generated function?","user":"U01BYANF42K","ts":"1615454064.323700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2d/a9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hm if i define a function with an array literal like this it does allocate… so the AST seems to be a bit different. Is it possible to get the Expr object created by the generated function?"}]}]}],"thread_ts":"1615452823.322700","parent_user_id":"U01BYANF42K"}]