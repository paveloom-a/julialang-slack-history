[{"client_msg_id":"bdcbb721-2e68-4eee-9ba5-e21c1f351670","type":"message","text":"I am trying to figure out how to improve the run time of the following code. I already tried changing the squares and quartics line to just be s.^2 and s.^4 and it doesn't make a big difference. Any ideas on what I can do to improve the speed here?\n```using Statistics, LinearAlgebra, Distributions\n\nfunction estimator(s, weights)\n    squares = mapslices(x -&gt; x .^ 2, s; dims=1)' .* weights\n    quartics = mapslices(x -&gt; x .^ 4, s; dims=1)' .* weights\n    return mean(quartics; dims=1) ./ mean(squares; dims=1)\nend\n\nfunction simulate(estimator, opt; P, Q, sample_sizes, num_replicates=1000)\n    errs = zeros(length(sample_sizes))\n    for (i, n) in enumerate(sample_sizes)\n        samples = [rand(P, n) for _ in 1:num_replicates]\n        err(s) = norm(estimator(s, (exp.(logpdf(Q, s) .- logpdf(P, s)))) - [opt])^2\n        IS_errors = err.(samples)\n        errs[i] = mean(IS_errors)\n    end\n    return errs\nend\n\n# short hand for profiling.\nd = 1\nsim(P) = simulate(estimator, 3, P=P,\n                  Q=MvNormal(d, 1),\n                  sample_sizes=round.(Int64,collect(range(100, stop=10000, length=10))),\n                  num_replicates=2000)```","user":"UT9SK8EF4","ts":"1611352862.161100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wNM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I am trying to figure out how to improve the run time of the following code. I already tried changing the squares and quartics line to just be s.^2 and s.^4 and it doesn't make a big difference. Any ideas on what I can do to improve the speed here?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using Statistics, LinearAlgebra, Distributions\n\nfunction estimator(s, weights)\n    squares = mapslices(x -> x .^ 2, s; dims=1)' .* weights\n    quartics = mapslices(x -> x .^ 4, s; dims=1)' .* weights\n    return mean(quartics; dims=1) ./ mean(squares; dims=1)\nend\n\nfunction simulate(estimator, opt; P, Q, sample_sizes, num_replicates=1000)\n    errs = zeros(length(sample_sizes))\n    for (i, n) in enumerate(sample_sizes)\n        samples = [rand(P, n) for _ in 1:num_replicates]\n        err(s) = norm(estimator(s, (exp.(logpdf(Q, s) .- logpdf(P, s)))) - [opt])^2\n        IS_errors = err.(samples)\n        errs[i] = mean(IS_errors)\n    end\n    return errs\nend\n\n# short hand for profiling.\nd = 1\nsim(P) = simulate(estimator, 3, P=P,\n                  Q=MvNormal(d, 1),\n                  sample_sizes=round.(Int64,collect(range(100, stop=10000, length=10))),\n                  num_replicates=2000)"}]}]}],"thread_ts":"1611352862.161100","reply_count":65,"reply_users_count":3,"latest_reply":"1611355471.174900","reply_users":["UT9SK8EF4","UD0NS8PDF","UH24GRBLL"],"subscribed":false},{"client_msg_id":"a63c2b07-b785-41a4-a796-9d5604d03cd3","type":"message","text":"When I invoke this (eg `sim(MvNormal(d, sqrt(0.7)))`, I get about 65 seconds","user":"UT9SK8EF4","ts":"1611352934.161600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"T9nPz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"When I invoke this (eg "},{"type":"text","text":"sim(MvNormal(d, sqrt(0.7)))","style":{"code":true}},{"type":"text","text":", I get about 65 seconds"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"c92a1318-bd7c-4b03-a6b1-998db5210844","type":"message","text":"Would love to bring it down if possible.","user":"UT9SK8EF4","ts":"1611352944.161800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EtJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Would love to bring it down if possible."}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"475b5255-149c-4f25-9746-a44391817350","type":"message","text":"One thing you can do is\n```function estimator(s, weights)\n    squares = (s').^2 .* weights\n    quartics = (s').^4 .* weights\n    return mean(quartics; dims=1) ./ mean(squares; dims=1)\nend```\nas mapslices is slow at the best of times, but here I think you don’t need it at all.","user":"UD0NS8PDF","ts":"1611353230.162000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pBI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"One thing you can do is\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function estimator(s, weights)\n    squares = (s').^2 .* weights\n    quartics = (s').^4 .* weights\n    return mean(quartics; dims=1) ./ mean(squares; dims=1)\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"as mapslices is slow at the best of times, but here I think you don’t need it at all."}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"047247a8-c4bc-45fc-8e75-675c0e79492e","type":"message","text":"Yeah I did that already","user":"UT9SK8EF4","ts":"1611353242.162200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Cvmso","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah I did that already"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"f9589689-2208-43f6-b2d7-42d03faeee79","type":"message","text":"It doesn't seem to make a huge difference","user":"UT9SK8EF4","ts":"1611353257.162400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xalyu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It doesn't seem to make a huge difference"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"82690290-af95-4c62-b569-224b92f51bb9","type":"message","text":"I get a total run time of 64 seoncds instead of 65","user":"UT9SK8EF4","ts":"1611353273.162600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"p39E8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I get a total run time of 64 seoncds instead of 65"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"52111a83-da5c-4601-bdfa-b56d4a7ad0d1","type":"message","text":"Well, I tried smaller cases, and it was a factor of 4","user":"UD0NS8PDF","ts":"1611353327.162800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8sugz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well, I tried smaller cases, and it was a factor of 4"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"d42bcef1-17a6-4cc3-92fa-a5305c7f5d30","type":"message","text":"65 seconds is a long time to wait to try things out! Is this still representative?\n```sim(P, d) = simulate(estimator, 3, P=P,\n                  Q=MvNormal(d, 1),\n                  sample_sizes=round.(Int64,collect(range(100, stop=1000, length=10))),\n                  num_replicates=200)\n@time sim(MvNormal(d, sqrt(0.7)), 1)```","user":"UD0NS8PDF","ts":"1611353371.163000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M3B/g","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"65 seconds is a long time to wait to try things out! Is this still representative?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"sim(P, d) = simulate(estimator, 3, P=P,\n                  Q=MvNormal(d, 1),\n                  sample_sizes=round.(Int64,collect(range(100, stop=1000, length=10))),\n                  num_replicates=200)\n@time sim(MvNormal(d, sqrt(0.7)), 1)"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"aad220a6-f866-4d5c-af06-6d04b6b28b56","type":"message","text":"yes, I'd assume so","user":"UT9SK8EF4","ts":"1611353401.163200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Po6z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yes, I'd assume so"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"f1dc492c-8af1-4d46-8acd-33d73f748837","type":"message","text":"basically you've dropped the  number of iterations down","user":"UT9SK8EF4","ts":"1611353414.163400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Hkk1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"basically you've dropped the  number of iterations down"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"b5f02061-2716-4957-9a97-ef8c3ffde14b","type":"message","text":"so if the main issue is not in the iteration, then yeah","user":"UT9SK8EF4","ts":"1611353426.163600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EEfa","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so if the main issue is not in the iteration, then yeah"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"c58fd84b-09ef-4136-ba6a-ad71d06e62f5","type":"message","text":"That went from 1.1 to 0.23 sec","user":"UD0NS8PDF","ts":"1611353436.163800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pSrar","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That went from 1.1 to 0.23 sec"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"40c5041b-a0af-4a7e-936c-b60b8954e4b4","type":"message","text":"hm","user":"UT9SK8EF4","ts":"1611353527.164000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"x=P","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hm"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"e8569caf-2bee-442a-aa77-29b1e3a89132","type":"message","text":"`estimator` is called a lot of times and would certainly benefit from preallocation of the intermediate vectors","user":"UH24GRBLL","ts":"1611353711.164200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0NV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"estimator","style":{"code":true}},{"type":"text","text":" is called a lot of times and would certainly benefit from preallocation of the intermediate vectors"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"5e2e04ac-f99e-45c3-af92-280dbf08db5b","type":"message","text":"what do you mean by preallocation?","user":"UT9SK8EF4","ts":"1611353731.164400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JpPt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what do you mean by preallocation?"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"1626bffa-f354-4854-9ae4-58e98bd6440d","type":"message","text":"like `estimator!(s, weights, squareBuffer, quartBuffer)`","user":"UH24GRBLL","ts":"1611353754.164600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fDE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"like "},{"type":"text","text":"estimator!(s, weights, squareBuffer, quartBuffer)","style":{"code":true}}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"44f10f42-45c2-43a1-8b87-0bcbdf3bee02","type":"message","text":"and then inside do `squareBuffer .= (s').^2 .* weights`","user":"UH24GRBLL","ts":"1611353784.164800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CWk3E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and then inside do "},{"type":"text","text":"squareBuffer .= (s').^2 .* weights","style":{"code":true}}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"12c3cc20-7552-4288-a2e3-83c9ff449757","type":"message","text":"that way, the right hand side will use the memory that's already available at `squareBuffer` instead of allocating more to hold the result","user":"UH24GRBLL","ts":"1611353809.165000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"76rW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that way, the right hand side will use the memory that's already available at "},{"type":"text","text":"squareBuffer","style":{"code":true}},{"type":"text","text":" instead of allocating more to hold the result"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"bf18524d-feb4-4382-a42d-d2da61046ff9","type":"message","text":"same goes for `quartBuffer`","user":"UH24GRBLL","ts":"1611353820.165200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QV7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"same goes for "},{"type":"text","text":"quartBuffer","style":{"code":true}}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"91cca990-8c71-417f-b32d-04e27ecd1dc0","type":"message","text":"Ah I see","user":"UT9SK8EF4","ts":"1611353838.165400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"m5=J","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah I see"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"9a64ba3d-dc81-446a-88bd-f0ad0610121b","type":"message","text":"Interestingly when I made the change that was suggested by <@UD0NS8PDF> I do not see the improvement for the larger values of parameter as I had put","user":"UT9SK8EF4","ts":"1611353860.165600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xXa8l","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Interestingly when I made the change that was suggested by "},{"type":"user","user_id":"UD0NS8PDF"},{"type":"text","text":" I do not see the improvement for the larger values of parameter as I had put"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"56c49f15-cea6-46dd-9af9-4d0e2168947e","type":"message","text":"also, do you have to manifest the generator for your samples during each loop in `simulate`?","user":"UH24GRBLL","ts":"1611353866.165800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Lg1u","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"also, do you have to manifest the generator for your samples during each loop in "},{"type":"text","text":"simulate","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"67da1d68-37d2-4934-bbb9-950ffbc6d12d","type":"message","text":"you can do `samples = (rand(P, n) for _ in 1:num_replicates)` and it won't allocate the whole vector, but a small structure that generates values on demand instead","user":"UH24GRBLL","ts":"1611353904.166000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KAfta","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can do "},{"type":"text","text":"samples = (rand(P, n) for _ in 1:num_replicates)","style":{"code":true}},{"type":"text","text":" and it won't allocate the whole vector, but a small structure that generates values on demand instead"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"71a485c1-b8b6-42ec-b35f-b6b74d487230","type":"message","text":"are you referring to the line `samples = [`","user":"UT9SK8EF4","ts":"1611353904.166200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Waj8","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"are you referring to the line "},{"type":"text","text":"samples = [","style":{"code":true}}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"26cf1927-f3f1-4bb2-8d9d-b2210f67ea38","type":"message","text":"Oh yeah","user":"UT9SK8EF4","ts":"1611353927.166400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sDExE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh yeah"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"36f7a8a7-b02b-477e-be49-d4a6e0e74378","type":"message","text":"that can work","user":"UT9SK8EF4","ts":"1611353929.166600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hvA=t","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that can work"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"2af086af-c05d-4d60-87fc-13b629162dcd","type":"message","text":"but actually.","user":"UT9SK8EF4","ts":"1611353934.166800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"heU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but actually."}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"ada01f75-ebcd-4e35-8dd1-aecb1057b95e","type":"message","text":"how does that work with the randomness","user":"UT9SK8EF4","ts":"1611353944.167000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JoP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"how does that work with the randomness"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"b982549b-2411-47d4-9e8d-2e3ad12bdb1b","type":"message","text":"will it use the same random seed when it does `next()` on the generator?","user":"UT9SK8EF4","ts":"1611353956.167200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"L+Vo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"will it use the same random seed when it does "},{"type":"text","text":"next()","style":{"code":true}},{"type":"text","text":" on the generator?"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"f96f1586-91b0-4b99-93b3-31bf77bd36d3","type":"message","text":"another thing - `mean` can take a function as first argument, so you can do `errs[i] = mean(err, samples)`","user":"UH24GRBLL","ts":"1611353957.167400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b73h","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"another thing - "},{"type":"text","text":"mean","style":{"code":true}},{"type":"text","text":" can take a function as first argument, so you can do "},{"type":"text","text":"errs[i] = mean(err, samples)","style":{"code":true}}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"a9004e28-1a7e-4cb9-b2f3-2c813518c47d","type":"message","text":"That’s a good idea, I was going to suggest\n```        samples = eachcol(rand(P, n, num_replicates))\n        errs[i] = mean(err, samples)```\nbut I suspect the generator may be better.","user":"UD0NS8PDF","ts":"1611353959.167600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QqC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That’s a good idea, I was going to suggest\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"        samples = eachcol(rand(P, n, num_replicates))\n        errs[i] = mean(err, samples)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"but I suspect the generator may be better."}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"cab61558-8ca4-48f5-a215-b46dd63a4e8f","type":"message","text":"no, the invocations are going to be independent","user":"UH24GRBLL","ts":"1611353978.167800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OjHwW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"no, the invocations are going to be independent"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"21c7ddb4-5b47-4486-8a33-dcbb74938046","type":"message","text":"the `[ x for x in y ]` syntax is the same as `( x for x in y )`, except the former also collects the result into an array instead of producing the values lazily as they're needed","user":"UH24GRBLL","ts":"1611354021.168000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"s1zl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the "},{"type":"text","text":"[ x for x in y ]","style":{"code":true}},{"type":"text","text":" syntax is the same as "},{"type":"text","text":"( x for x in y )","style":{"code":true}},{"type":"text","text":", except the former also collects the result into an array instead of producing the values lazily as they're needed"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"ef80ea7f-0177-4c7f-9f55-216ffd31b4e3","type":"message","text":"another thing that could create a bunch of overhead is that (I think) you create a new closure in each loop iteration in `err(s) = ...`","user":"UH24GRBLL","ts":"1611354176.168200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"h+27E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"another thing that could create a bunch of overhead is that (I think) you create a new closure in each loop iteration in "},{"type":"text","text":"err(s) = ...","style":{"code":true}}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"27e629ed-56ef-4082-9924-781451ef36a7","type":"message","text":"if you can reformulate that error estimate to be a regular function that takes `err(s, Q, P)` instead, it'll probably save you a bunch of other things as well - though this is one thing I'm least sure on","user":"UH24GRBLL","ts":"1611354219.168400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gh3t","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if you can reformulate that error estimate to be a regular function that takes "},{"type":"text","text":"err(s, Q, P)","style":{"code":true}},{"type":"text","text":" instead, it'll probably save you a bunch of other things as well - though this is one thing I'm least sure on"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"0a22ac96-03e8-4e1e-b9cc-7e5440ca7594","type":"message","text":"yes. let me try to make these changes and see","user":"UT9SK8EF4","ts":"1611354237.168600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GH5e","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yes. let me try to make these changes and see"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"44df9e34-acd5-46d2-9677-803522520b29","type":"message","text":"thank you","user":"UT9SK8EF4","ts":"1611354239.168800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pG0=+","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thank you"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"346e250a-e318-49d2-ab9a-08a5878704de","type":"message","text":"even just hoisting that outside and doing `err(s) = err(s, Q, P)` in the loop would probably save you stuff (but again, this one I'm only ~80% sure on)","user":"UH24GRBLL","ts":"1611354330.169000","team":"T68168MUP","edited":{"user":"UH24GRBLL","ts":"1611354338.000000"},"blocks":[{"type":"rich_text","block_id":"0/Hl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"even just hoisting that outside and doing "},{"type":"text","text":"err(s) = err(s, Q, P)","style":{"code":true}},{"type":"text","text":" in the loop would probably save you stuff (but again, this one I'm only ~80% sure on)"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"b2dbfc8b-ee5a-4a25-829c-363a4b83c9dd","type":"message","text":"oh I just realized I can't preallocate","user":"UT9SK8EF4","ts":"1611354700.169300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Jay64","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh I just realized I can't preallocate"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"92cf976f-1121-4127-ae97-2811615ab638","type":"message","text":"the sizes are different whenever the function estimator is called","user":"UT9SK8EF4","ts":"1611354714.169500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wnRo6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the sizes are different whenever the function estimator is called"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"4c6e1d60-cad6-403d-9dca-32a3d2ca797e","type":"message","text":"so I do not think I can have preallocation easily","user":"UT9SK8EF4","ts":"1611354723.169700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HBEl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so I do not think I can have preallocation easily"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"e3c865fe-6cc4-4cba-973c-5080ee688e2d","type":"message","text":"hmmm","user":"UH24GRBLL","ts":"1611355169.169900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zzc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hmmm"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"904080aa-649a-4fee-9e19-48b258c5cb2c","type":"message","text":"you can still do it if you know the maximum size","user":"UH24GRBLL","ts":"1611355178.170100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2TuED","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can still do it if you know the maximum size"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"50193853-a66a-4f33-8b29-01a099ac1e77","type":"message","text":"yeah, with  slicing I guess","user":"UT9SK8EF4","ts":"1611355194.170300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"olMg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, with  slicing I guess"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"13b1410f-19f3-4793-a3d2-1eafeafc7f72","type":"message","text":"you can allocate the maximum size and just `sizehint!`","user":"UH24GRBLL","ts":"1611355197.170500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6RnD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you can allocate the maximum size and just "},{"type":"text","text":"sizehint!","style":{"code":true}}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"b5d57407-d47f-4cb3-ad73-2141f68b50a9","type":"message","text":"or views, yes","user":"UH24GRBLL","ts":"1611355205.170800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3R1g","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"or views, yes"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"317a9eb3-50f9-4b38-8b0b-b9c220a30898","type":"message","text":"views would actually be better than `sizehint!`, since that doesn't shrink","user":"UH24GRBLL","ts":"1611355229.171000","team":"T68168MUP","edited":{"user":"UH24GRBLL","ts":"1611355238.000000"},"blocks":[{"type":"rich_text","block_id":"LrK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"views would actually be better than "},{"type":"text","text":"sizehint!","style":{"code":true}},{"type":"text","text":", since that doesn't shrink"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"d73329a8-1fd6-4d35-9022-dfdb4c3634a3","type":"message","text":"ok the changes you guys suggested already brought it down from 65 to 4 seconds per call","user":"UT9SK8EF4","ts":"1611355235.171200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"AMw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ok the changes you guys suggested already brought it down from 65 to 4 seconds per call"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"03c19161-4fa3-4750-a217-ea40130885c8","type":"message","text":"I call that a huge win","user":"UT9SK8EF4","ts":"1611355238.171500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"stn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I call that a huge win"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"304958e2-fb58-4530-bc45-ee34898f50c2","type":"message","text":"preallocation would probably improve even more","user":"UT9SK8EF4","ts":"1611355248.171700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QXM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"preallocation would probably improve even more"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"a06da000-f0be-445a-b329-8d8e78b74070","type":"message","text":"but I think this is nearly performant enough for my needs right now","user":"UT9SK8EF4","ts":"1611355258.171900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+D/hO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but I think this is nearly performant enough for my needs right now"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"6ba29e77-02d5-4db2-bcfd-08c65406c0a3","type":"message","text":"16x speedup? not bad","user":"UH24GRBLL","ts":"1611355264.172100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Pn4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"16x speedup? not bad"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"3edfa27c-7048-4850-b43a-20c197363234","type":"message","text":"then it's fine to stop","user":"UH24GRBLL","ts":"1611355271.172300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wSN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"then it's fine to stop"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"5b39dd9c-d875-4c75-bd58-c3ff52a67ddb","type":"message","text":"yeah. very nice. thanks so much","user":"UT9SK8EF4","ts":"1611355273.172500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"U=iD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah. very nice. thanks so much"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"3205cf06-e3a4-4b97-9adc-d945ab027d5e","type":"message","text":"you're welcome :)","user":"UH24GRBLL","ts":"1611355307.172700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xZ3nJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"you're welcome :)"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"11f274a5-d35f-40ca-abf9-c242fbaf4bff","type":"message","text":"that's the complete simulation, not just one call, right?","user":"UH24GRBLL","ts":"1611355336.172900","team":"T68168MUP","edited":{"user":"UH24GRBLL","ts":"1611355340.000000"},"blocks":[{"type":"rich_text","block_id":"5L5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's the complete simulation, not just one call, right?"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"99b4e3da-52c5-40a8-808c-6e01ddb3ee0e","type":"message","text":"that's for 1 invocation of `sim(...)`","user":"UT9SK8EF4","ts":"1611355367.173200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vzhj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's for 1 invocation of "},{"type":"text","text":"sim(...)","style":{"code":true}}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"e620a9f6-cc8d-4c88-8099-be562a565454","type":"message","text":"65 -&gt; 4 seconds","user":"UT9SK8EF4","ts":"1611355375.173400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+kZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"65 -> 4 seconds"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4","reactions":[{"name":"sonic","users":["UH24GRBLL"],"count":1}]},{"client_msg_id":"f1581fa0-ecba-4346-9580-d7017b22458d","type":"message","text":"yeah","user":"UH24GRBLL","ts":"1611355406.173600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zjA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"fc1917b6-72d5-4d53-8dcc-85bbc4e987c0","type":"message","text":"make sure the transformations didn't alter your results too much","user":"UH24GRBLL","ts":"1611355441.173900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0Uc","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"make sure the transformations didn't alter your results too much"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"dafaa01a-cd3c-41fb-ab28-cbeb2c27d357","type":"message","text":"yeah the results look the same!","user":"UT9SK8EF4","ts":"1611355450.174100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PC9Y7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah the results look the same!"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"9a087a5b-f2a3-4973-a03b-f5241f53f372","type":"message","text":"thanks","user":"UT9SK8EF4","ts":"1611355451.174300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nYP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"thanks"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"3267bb54-6848-41c1-b936-6cb4cc1bc086","type":"message","text":"there should, at most, be some small floating point differences","user":"UH24GRBLL","ts":"1611355452.174500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"InMB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"there should, at most, be some small floating point differences"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"440405f8-1976-4b09-9ac7-5a5df32be8da","type":"message","text":"yeah if there are any differences, they are so minor as to not be noticable haha","user":"UT9SK8EF4","ts":"1611355467.174700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"c57","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah if there are any differences, they are so minor as to not be noticable haha"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"},{"client_msg_id":"31f3c447-094f-412c-b71b-32fa77f50b03","type":"message","text":"nice","user":"UH24GRBLL","ts":"1611355471.174900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nY2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"nice"}]}]}],"thread_ts":"1611352862.161100","parent_user_id":"UT9SK8EF4"}]