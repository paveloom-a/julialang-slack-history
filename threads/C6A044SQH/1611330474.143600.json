[{"client_msg_id":"187f9606-b1e6-41fb-bbc2-357500ca652f","type":"message","text":"Do all PRNGs for floats in Julia work with the “logical or a random bitsequence to float(1) then subtract 1”-logic? I’m looking for a PRNG that draws from _all_ floats in [0,1) according to a uniform distribution in [0,1)","user":"UHZUXBR2P","ts":"1611330474.143600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6Av","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Do all PRNGs for floats in Julia work with the “logical or a random bitsequence to float(1) then subtract 1”-logic? I’m looking for a PRNG that draws from "},{"type":"text","text":"all","style":{"italic":true}},{"type":"text","text":" floats in [0,1) according to a uniform distribution in [0,1)"}]}]}],"thread_ts":"1611330474.143600","reply_count":20,"reply_users_count":2,"latest_reply":"1611335072.154000","reply_users":["U0179G7FG4F","UHZUXBR2P"],"subscribed":false},{"client_msg_id":"19075ce4-5ec7-49d1-b976-d212f61da585","type":"message","text":"This is a pretty common strategy since it decouples random bits from the float very effectively. That said, you could get a pretty good approximation by `my_rand(x::T) = rand(T)-eps(one(T))/2+eps(one(T))*rand(T)`","user":"U0179G7FG4F","ts":"1611331559.144100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6bnb","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This is a pretty common strategy since it decouples random bits from the float very effectively. That said, you could get a pretty good approximation by "},{"type":"text","text":"my_rand(x::T) = rand(T)-eps(one(T))/2+eps(one(T))*rand(T)","style":{"code":true}}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"c436597e-fdc4-4162-90fd-1b59ad08a870","type":"message","text":"Interesting, but this can also create negative numbers it seems:\n```julia&gt; my_rand(::Type{T},n::Int) where T = rand(T,n) .- eps(T)/2 .+ eps(T)*rand(T,n)\njulia&gt; minimum(my_rand(Float32,1000000))\n-1.4726609f-8```","user":"UHZUXBR2P","ts":"1611332845.146200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mMEe","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Interesting, but this can also create negative numbers it seems:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> my_rand(::Type{T},n::Int) where T = rand(T,n) .- eps(T)/2 .+ eps(T)*rand(T,n)\njulia> minimum(my_rand(Float32,1000000))\n-1.4726609f-8"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"734c5c44-64bf-4261-9023-51f78de335f3","type":"message","text":"wait, I think it should be `my_rand(x::T) = rand(T)+eps(one(T))*rand(T)` I was trying to correct for bias, but doing so was actually incorrect here","user":"U0179G7FG4F","ts":"1611332952.146400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"V8tpz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"wait, I think it should be "},{"type":"text","text":"my_rand(x::T) = rand(T)+eps(one(T))*rand(T)","style":{"code":true}},{"type":"text","text":" I was trying to correct for bias, but doing so was actually incorrect here"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"8dfdef8e-95d4-4ea2-b3b7-8781e540475b","type":"message","text":"This one can create `1f0` though, probably not an issue actually…\n```julia&gt; m = prevfloat(2f0)-1\n0.9999999f0\n\njulia&gt; m + eps(Float32)*m\n1.0f0```\n","user":"UHZUXBR2P","ts":"1611333182.147500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rNEB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This one can create "},{"type":"text","text":"1f0","style":{"code":true}},{"type":"text","text":" though, probably not an issue actually…\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> m = prevfloat(2f0)-1\n0.9999999f0\n\njulia> m + eps(Float32)*m\n1.0f0"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"4e737059-c0ef-4f69-b2fa-ea79719f86b6","type":"message","text":"And the smallest number that can be drawn is also not much lowered\n```julia&gt; m = nextfloat(1f0)-1\n1.1920929f-7\n\njulia&gt; m + eps(Float32)*m\n1.192093f-7```\n","user":"UHZUXBR2P","ts":"1611333308.148100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"N2TI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And the smallest number that can be drawn is also not much lowered\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> m = nextfloat(1f0)-1\n1.1920929f-7\n\njulia> m + eps(Float32)*m\n1.192093f-7"}]},{"type":"rich_text_section","elements":[]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"2f005af4-baf6-4167-8e40-ccd6c6ab0384","type":"message","text":"can't `rand` produce `0`? I think this can produce `eps(Float32)*m`","user":"U0179G7FG4F","ts":"1611333369.148300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7dh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"can't "},{"type":"text","text":"rand","style":{"code":true}},{"type":"text","text":" produce "},{"type":"text","text":"0","style":{"code":true}},{"type":"text","text":"? I think this can produce "},{"type":"text","text":"eps(Float32)*m","style":{"code":true}}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"17acc055-02a7-4409-b5ef-2dee4e5b5d34","type":"message","text":"Ah true!","user":"UHZUXBR2P","ts":"1611333402.148500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"76IK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah true!"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"352542f2-b81c-48d2-86b8-0b4f3d9f864e","type":"message","text":"Okay so doing this `my_rand` in Float64 and then for example converting to Float32 would actually do much better already","user":"UHZUXBR2P","ts":"1611333539.148800","team":"T68168MUP","edited":{"user":"UHZUXBR2P","ts":"1611333557.000000"},"blocks":[{"type":"rich_text","block_id":"g59","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Okay so doing this "},{"type":"text","text":"my_rand","style":{"code":true}},{"type":"text","text":" in Float64 and then for example converting to Float32 would actually do much better already"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P","reactions":[{"name":"+1","users":["U0179G7FG4F"],"count":1}]},{"client_msg_id":"851e680d-e181-4fa3-a506-73539e0a0297","type":"message","text":"One could play this game twice, right? As in `rand(T) + eps(T)**rand(T) + eps(eps(T))**rand(T)`","user":"UHZUXBR2P","ts":"1611333704.149200","team":"T68168MUP","edited":{"user":"UHZUXBR2P","ts":"1611333712.000000"},"blocks":[{"type":"rich_text","block_id":"I=2rP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"One could play this game twice, right? As in "},{"type":"text","text":"rand(T) + eps(T)*","style":{"code":true}},{"type":"text","text":"rand(T) + eps(eps(T))*","style":{"bold":true,"code":true}},{"type":"text","text":"rand(T)","style":{"code":true}}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"aef69590-8e61-4e8f-a9e0-507076c05921","type":"message","text":"I think you want `rand(T) + eps(T)*(*rand(T) + eps(T)**rand(T))` there will be some rounding differences","user":"U0179G7FG4F","ts":"1611333799.149500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XCLX9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think you want "},{"type":"text","text":"rand(T) + eps(T)*(","style":{"code":true}},{"type":"text","text":"rand(T) + eps(T)*","style":{"bold":true,"code":true}},{"type":"text","text":"rand(T))","style":{"code":true}},{"type":"text","text":" there will be some rounding differences"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"1bdef703-406a-4ce4-af9f-4c3d7a304d6e","type":"message","text":"if it's performance critical, this isn't optimal, but it's still reasonably fast.","user":"U0179G7FG4F","ts":"1611333950.149700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Hgz/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if it's performance critical, this isn't optimal, but it's still reasonably fast."}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"2d7b97fd-594a-4dd6-9b62-eb83ee4b14af","type":"message","text":"Nah, I just need to check in a weird application whether drawing from all possible floats in [0,1) makes a difference…","user":"UHZUXBR2P","ts":"1611333988.149900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hkI+B","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Nah, I just need to check in a weird application whether drawing from all possible floats in [0,1) makes a difference…"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"ee101190-533c-4c14-baf7-4c2bc56d411b","type":"message","text":"I initially thought there might be a way to just create the exponents at proper chances:\n```e=01111110 at 50.0% for [0.5,1.0)\ne=01111101 at 25.0% for [0.25,0.5)\ne=01111100 at 12.5% for [0.125,0.25)\ne=01111011 at 6.25% for [0.0625,0.125)\ne=01111010 at 3.125% for [0.03125,0.0625)\ne=01111001 at 1.5625% for [0.015625,0.03125)\ne=01111000 at 0.78125% for [0.0078125,0.015625)\ne=01110111 at 0.390625% for [0.00390625,0.0078125)\ne=01110110 at 0.1953125% for [0.001953125,0.00390625)\ne=01110101 at 0.09765625% for [0.0009765625,0.001953125)```\nand then or the mantissa to the exponent bits?","user":"UHZUXBR2P","ts":"1611334123.152100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=kO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I initially thought there might be a way to just create the exponents at proper chances:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"e=01111110 at 50.0% for [0.5,1.0)\ne=01111101 at 25.0% for [0.25,0.5)\ne=01111100 at 12.5% for [0.125,0.25)\ne=01111011 at 6.25% for [0.0625,0.125)\ne=01111010 at 3.125% for [0.03125,0.0625)\ne=01111001 at 1.5625% for [0.015625,0.03125)\ne=01111000 at 0.78125% for [0.0078125,0.015625)\ne=01110111 at 0.390625% for [0.00390625,0.0078125)\ne=01110110 at 0.1953125% for [0.001953125,0.00390625)\ne=01110101 at 0.09765625% for [0.0009765625,0.001953125)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"and then or the mantissa to the exponent bits?"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"53ded39c-7f02-43ec-989b-006c6061a33f","type":"message","text":"that strategy should work. I don't have a 1-liner for it off hand though","user":"U0179G7FG4F","ts":"1611334183.152700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LGTBJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that strategy should work. I don't have a 1-liner for it off hand though"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"c2b39c0f-bfd9-4e5d-8595-8316b4b75cab","type":"message","text":"Yeah, can’t get my head around how to transform some bitsequences into those 8bits at given chances…","user":"UHZUXBR2P","ts":"1611334236.152900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"q/kIh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, can’t get my head around how to transform some bitsequences into those 8bits at given chances…"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"98a53b9f-7dfc-4171-a374-d08650cf5f83","type":"message","text":"I think `myrand(::Type{T}) where T = exp2(-floor(randexp(T)))*(rand(T)/2+one(T)/2)` might work?","user":"U0179G7FG4F","ts":"1611334702.153200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Ckqw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think "},{"type":"text","text":"myrand(::Type{T}) where T = exp2(-floor(randexp(T)))*(rand(T)/2+one(T)/2)","style":{"code":true}},{"type":"text","text":" might work?"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"de194262-8a5a-4a45-9604-962a20d6be11","type":"message","text":"what’s `randexp`?","user":"UHZUXBR2P","ts":"1611334745.153400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7w1w1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"what’s "},{"type":"text","text":"randexp","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"a139008c-d496-4f5c-8f9e-1ee0a656c1d7","type":"message","text":"<https://docs.julialang.org/en/v1/stdlib/Random/#Random.randexp>","user":"U0179G7FG4F","ts":"1611334793.153600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cTBTS","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://docs.julialang.org/en/v1/stdlib/Random/#Random.randexp"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"0446b4fd-7f54-477e-a3b5-d45df6eba3d4","type":"message","text":"Yep, that could work, I’m still thinking in bits&amp;bytes","user":"UHZUXBR2P","ts":"1611334876.153800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"T7SEG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yep, that could work, I’m still thinking in bits&bytes"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"},{"client_msg_id":"84d568dd-c4a1-4f4c-b35d-79189e55e4cb","type":"message","text":"so this is basically doing that multiplying by `exp2(-floor(randexp(T)))` is the same as setting the exponent (since the second half only affects the manitisa)","user":"U0179G7FG4F","ts":"1611335072.154000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hLF5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so this is basically doing that multiplying by "},{"type":"text","text":"exp2(-floor(randexp(T)))","style":{"code":true}},{"type":"text","text":" is the same as setting the exponent (since the second half only affects the manitisa)"}]}]}],"thread_ts":"1611330474.143600","parent_user_id":"UHZUXBR2P"}]