[{"client_msg_id":"b7242130-116e-49a1-9417-04d0a9f0483c","type":"message","text":"Can someone tell me how to call `sched_getcpu` from glibc in Julia? (<https://man7.org/linux/man-pages/man3/sched_getcpu.3.html>)","user":"U881D0W2C","ts":"1617031908.441900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JbcT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Can someone tell me how to call "},{"type":"text","text":"sched_getcpu","style":{"code":true}},{"type":"text","text":" from glibc in Julia? ("},{"type":"link","url":"https://man7.org/linux/man-pages/man3/sched_getcpu.3.html"},{"type":"text","text":")"}]}]}],"thread_ts":"1617031908.441900","reply_count":17,"reply_users_count":3,"latest_reply":"1617038425.451800","reply_users":["UAUPJLBQX","U881D0W2C","UKVBDU6HF"],"is_locked":false,"subscribed":false},{"client_msg_id":"7c4ac019-627c-42e0-b4a0-b240ed76af4a","type":"message","text":"```julia&gt; ccall(:sched_getcpu, Cint, ())\n8```","user":"UAUPJLBQX","ts":"1617034835.442500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xl/n","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> ccall(:sched_getcpu, Cint, ())\n8"}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"775ee2d5-a2ec-4858-bb72-122a43400e94","type":"message","text":"Ah thanks so much, I naively tried something like `@ccall \"glibc\".sched_getcpu()::Cint` but that failed. How could I write that call using `@ccall` given that you don’t explicitly mention the library?","user":"U881D0W2C","ts":"1617036030.446300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yPhY","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah thanks so much, I naively tried something like "},{"type":"text","text":"@ccall \"glibc\".sched_getcpu()::Cint","style":{"code":true}},{"type":"text","text":" but that failed. How could I write that call using "},{"type":"text","text":"@ccall","style":{"code":true}},{"type":"text","text":" given that you don’t explicitly mention the library?"}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"dcba52c7-fa95-46a7-886d-42364d6526a8","type":"message","text":"`@ccall sched_getcpu()::Cint`","user":"U881D0W2C","ts":"1617036415.446500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"A7k0X","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"@ccall sched_getcpu()::Cint","style":{"code":true}}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C","reactions":[{"name":"100","users":["UAUPJLBQX"],"count":1}]},{"client_msg_id":"8e09a5de-1e84-457b-bd06-ed82d9a8c684","type":"message","text":"Beat me to it.","user":"UAUPJLBQX","ts":"1617036466.446800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8pR6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Beat me to it."}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"c03f99d4-1d7d-404e-8b6e-4a0cdc3afbb2","type":"message","text":"I'd suggest either not mentioning the library, or searching `Libdl.dllist()` for `libm.so`","user":"UAUPJLBQX","ts":"1617036692.447000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"2=J7W","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'd suggest either not mentioning the library, or searching "},{"type":"text","text":"Libdl.dllist()","style":{"code":true}},{"type":"text","text":" for "},{"type":"text","text":"libm.so","style":{"code":true}}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"b10e5db4-2009-4ba0-bbd5-2b8cb912bca1","type":"message","text":"```julia&gt; ccall((:sched_getcpu,\"/usr/lib64/haswell/avx512_1/libm.so.6\"), Cint, ())\n3\n\njulia&gt; @ccall \"/usr/lib64/haswell/avx512_1/libm.so.6\".sched_getcpu()::Cint\n4```\n^ This will vary by both OS and and by the specific CPU.","user":"UAUPJLBQX","ts":"1617036749.447200","team":"T68168MUP","edited":{"user":"UAUPJLBQX","ts":"1617036780.000000"},"blocks":[{"type":"rich_text","block_id":"qc/LY","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> ccall((:sched_getcpu,\"/usr/lib64/haswell/avx512_1/libm.so.6\"), Cint, ())\n3\n\njulia> @ccall \"/usr/lib64/haswell/avx512_1/libm.so.6\".sched_getcpu()::Cint\n4"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"^ This will vary by both OS and and by the specific CPU."}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"9783d0f8-c1e6-4677-8f29-9c35cd033887","type":"message","text":"I see!","user":"U881D0W2C","ts":"1617036767.447400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"xRO5o","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I see!"}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"2088ae37-b095-4774-8d3d-3b4ea7d3eb40","type":"message","text":"BTW, about pinning threads to specific cpus:\n```bauer3@jwlogin04: /p/scratch/chku27/hku273/pinning\n$ numactl --physcpubind=10-20 julia -t10 individual.jl\nRunning on thread 1 (cpu id: 19, htop id: 20)\nRunning on thread 2 (cpu id: 10, htop id: 11)\nRunning on thread 3 (cpu id: 12, htop id: 13)\nRunning on thread 4 (cpu id: 13, htop id: 14)\nRunning on thread 5 (cpu id: 14, htop id: 15)\nRunning on thread 6 (cpu id: 15, htop id: 16)\nRunning on thread 7 (cpu id: 16, htop id: 17)\nRunning on thread 8 (cpu id: 17, htop id: 18)\nRunning on thread 9 (cpu id: 18, htop id: 19)\nRunning on thread 10 (cpu id: 11, htop id: 12)\n\nbauer3@jwlogin04: /p/scratch/chku27/hku273/pinning\n$ numactl --physcpubind=10-20 julia -t10 individual.jl\nRunning on thread 1 (cpu id: 19, htop id: 20)\nRunning on thread 2 (cpu id: 10, htop id: 11)\nRunning on thread 3 (cpu id: 13, htop id: 14)\nRunning on thread 4 (cpu id: 14, htop id: 15)\nRunning on thread 5 (cpu id: 12, htop id: 13)\nRunning on thread 6 (cpu id: 15, htop id: 16)\nRunning on thread 7 (cpu id: 16, htop id: 17)\nRunning on thread 8 (cpu id: 17, htop id: 18)\nRunning on thread 9 (cpu id: 18, htop id: 19)```","user":"U881D0W2C","ts":"1617036794.447700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zKU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"BTW, about pinning threads to specific cpus:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"bauer3@jwlogin04: /p/scratch/chku27/hku273/pinning\n$ numactl --physcpubind=10-20 julia -t10 individual.jl\nRunning on thread 1 (cpu id: 19, htop id: 20)\nRunning on thread 2 (cpu id: 10, htop id: 11)\nRunning on thread 3 (cpu id: 12, htop id: 13)\nRunning on thread 4 (cpu id: 13, htop id: 14)\nRunning on thread 5 (cpu id: 14, htop id: 15)\nRunning on thread 6 (cpu id: 15, htop id: 16)\nRunning on thread 7 (cpu id: 16, htop id: 17)\nRunning on thread 8 (cpu id: 17, htop id: 18)\nRunning on thread 9 (cpu id: 18, htop id: 19)\nRunning on thread 10 (cpu id: 11, htop id: 12)\n\nbauer3@jwlogin04: /p/scratch/chku27/hku273/pinning\n$ numactl --physcpubind=10-20 julia -t10 individual.jl\nRunning on thread 1 (cpu id: 19, htop id: 20)\nRunning on thread 2 (cpu id: 10, htop id: 11)\nRunning on thread 3 (cpu id: 13, htop id: 14)\nRunning on thread 4 (cpu id: 14, htop id: 15)\nRunning on thread 5 (cpu id: 12, htop id: 13)\nRunning on thread 6 (cpu id: 15, htop id: 16)\nRunning on thread 7 (cpu id: 16, htop id: 17)\nRunning on thread 8 (cpu id: 17, htop id: 18)\nRunning on thread 9 (cpu id: 18, htop id: 19)"}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C","reactions":[{"name":"+1","users":["UAUPJLBQX"],"count":1}]},{"client_msg_id":"dfbbf7e0-02f4-4671-8d6f-291aa69f11d0","type":"message","text":"The thread - cpu mapping is random within the given list of cpu ids","user":"U881D0W2C","ts":"1617036853.448100","team":"T68168MUP","edited":{"user":"U881D0W2C","ts":"1617036899.000000"},"blocks":[{"type":"rich_text","block_id":"Uc6P","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The thread - cpu mapping is random within the given list of cpu ids"}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"41da7c06-df9d-41f8-907e-c2d763dca2f8","type":"message","text":"Hmm, would be nice if you could have threads 1-10 be one NUMA node, and 11:20 a second, for example.","user":"UAUPJLBQX","ts":"1617036932.449100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UEf0u","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm, would be nice if you could have threads 1-10 be one NUMA node, and 11:20 a second, for example."}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"56dd1273-6fc2-4b4e-885f-c006bb0286ac","type":"message","text":"Precisely.","user":"U881D0W2C","ts":"1617036978.449300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CoaDR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Precisely."}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"a863b698-de6d-45c7-8291-c38107b550ad","type":"message","text":"Btw, `JULIA_EXCLUSIVE=1` superseeds whatever `numactl` you do: it always uses the cpus 1:nthreads()","user":"U881D0W2C","ts":"1617037023.449500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0jxA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Btw, "},{"type":"text","text":"JULIA_EXCLUSIVE=1","style":{"code":true}},{"type":"text","text":" superseeds whatever "},{"type":"text","text":"numactl","style":{"code":true}},{"type":"text","text":" you do: it always uses the cpus 1:nthreads()"}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"bcc00fd3-ce4f-450d-9f29-2b5ffa7e50f9","type":"message","text":"Darn. Was going to ask if you tried it, hoping it would order them within that restricted subset.","user":"UAUPJLBQX","ts":"1617037054.449700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LN6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Darn. Was going to ask if you tried it, hoping it would order them within that restricted subset."}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"bfc80aa0-92ae-41df-a18f-ab5383637745","type":"message","text":"Unfortunately not :slightly_smiling_face:","user":"U881D0W2C","ts":"1617037068.449900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"APH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Unfortunately not "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"86333059-8c67-4d8b-87a6-bf38e2d484d6","type":"message","text":"Will try to post some of these findings in the discourse thread. Besides conserving, maybe we can get one of the multithreading people (jameson for example) to chime in at some point.","user":"U881D0W2C","ts":"1617037165.450200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"L4i","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Will try to post some of these findings in the discourse thread. Besides conserving, maybe we can get one of the multithreading people (jameson for example) to chime in at some point."}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"42d070f6-57ee-4195-834a-c2b1e16ef0e3","type":"message","text":"You might want to look at <https://github.com/analytech-solutions/System.jl|System.jl> as an option for exposing system resources in Julia...  It is a newborn package that should finish the package registration process later today.  It might save you some time so you can focus on writing a Julian interface rather than the bindings to OS.","user":"UKVBDU6HF","ts":"1617037655.451200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"l/H","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You might want to look at "},{"type":"link","url":"https://github.com/analytech-solutions/System.jl","text":"System.jl"},{"type":"text","text":" as an option for exposing system resources in Julia...  It is a newborn package that should finish the package registration process later today.  It might save you some time so you can focus on writing a Julian interface rather than the bindings to OS."}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"},{"client_msg_id":"99f9a407-ed80-42bf-a0c2-344762c4b158","type":"message","text":"FYI: <https://github.com/m-j-w/CpuId.jl/issues/46>","user":"U881D0W2C","ts":"1617038425.451800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LPMf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"FYI: "},{"type":"link","url":"https://github.com/m-j-w/CpuId.jl/issues/46"}]}]}],"thread_ts":"1617031908.441900","parent_user_id":"U881D0W2C"}]