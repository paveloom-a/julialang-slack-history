[{"client_msg_id":"a6430d79-8cfa-4d4c-b2f7-b9a82952de91","type":"message","text":"Is there a bug with type stability and splatting? For example,\n```@code_warntype vcat([rand(Float32, 5) for i in 1:3]...)```\nis not type stable.","user":"UQ93FBKL1","ts":"1615037418.473400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vl=Y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a bug with type stability and splatting? For example,\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"@code_warntype vcat([rand(Float32, 5) for i in 1:3]...)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"is not type stable."}]}]}],"thread_ts":"1615037418.473400","reply_count":19,"reply_users_count":3,"latest_reply":"1615128760.014300","reply_users":["B01J9QZ4SP8","U7HAYKY9X","UQ93FBKL1"],"subscribed":false},{"type":"message","subtype":"bot_message","text":"Can we cross post this publicly to <https://discourse.julialang.org|Discourse> for further visibility? React with :bridge: on the message above to approve. <https://github.com/JuliaCommunity/SlackBridge/blob/main/README.md#faq|More info here>","ts":"1615037421.473500","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"53c9ba12-fbd2-4b1c-8d9d-c6867de1c6d4","type":"message","text":"Not a bug, it's just that the length of an array (and therefore the number of elements of the splat) is not known at compile time","user":"U7HAYKY9X","ts":"1615037690.473700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MlK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Not a bug, it's just that the length of an array (and therefore the number of elements of the splat) is not known at compile time"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"ab9beeee-85f3-4f6b-be64-dae54a234097","type":"message","text":"If you splat e.g. a Tuple, it's no problem","user":"U7HAYKY9X","ts":"1615037745.473900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zNT","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you splat e.g. a Tuple, it's no problem"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"7dfa07d6-ed8e-49fd-a780-ba8881910445","type":"message","text":"You mean like `@code_warntype vcat((rand(Float32, 5) for i in 1:2)...)`?","user":"UQ93FBKL1","ts":"1615038044.474100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"oGI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You mean like "},{"type":"text","text":"@code_warntype vcat((rand(Float32, 5) for i in 1:2)...)","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"c6cbfe44-ef40-4687-a819-1a3e4ec4d444","type":"message","text":"because that would also be type unstable","user":"UQ93FBKL1","ts":"1615038052.474300","team":"T68168MUP","edited":{"user":"UQ93FBKL1","ts":"1615038061.000000"},"blocks":[{"type":"rich_text","block_id":"iyo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"because that would also be type unstable"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"117ef8ba-ec5d-4a33-b73b-bbe28ea06c10","type":"message","text":"Nope, the range also does not carry its length as a type param.\nBut something like vcat(ntuple (i -&gt; rand(Float32, 5), 2)...) should be","user":"U7HAYKY9X","ts":"1615039524.474800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"h/B","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Nope, the range also does not carry its length as a type param.\nBut something like vcat(ntuple (i -> rand(Float32, 5), 2)...) should be"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"0d2a6878-6e6a-49df-8f12-8fe627ab7c05","type":"message","text":"Thanks for your help. This brought me to a type instability when using `ntuple`. Maybe someone could explain why this would be type unstabel?\n```a = [0.0, 0.0]\nb = [1.0, 1.0]\n\nntuple(i -&gt; range(a[i], b[i], length = 500), Val(2))```\nI'm not sure why this is type unstable. I assume it has to do with indexing `a` and `b`?","user":"UQ93FBKL1","ts":"1615120377.007400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6/ujg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks for your help. This brought me to a type instability when using "},{"type":"text","text":"ntuple","style":{"code":true}},{"type":"text","text":". Maybe someone could explain why this would be type unstabel?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"a = [0.0, 0.0]\nb = [1.0, 1.0]\n\nntuple(i -> range(a[i], b[i], length = 500), Val(2))"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"I'm not sure why this is type unstable. I assume it has to do with indexing "},{"type":"text","text":"a","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"b","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"6016feac-aee9-402f-8786-6ad8e791d314","type":"message","text":"Yep, the values of a and b are not known at compile time","user":"U7HAYKY9X","ts":"1615120614.007600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eZn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yep, the values of a and b are not known at compile time"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"fe7c3b19-4f83-49eb-adb4-9b9c322a897e","type":"message","text":"Because they are globals","user":"U7HAYKY9X","ts":"1615120635.007800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"r08","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Because they are globals"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"1df1364d-800f-43b3-92cf-e1bd66772095","type":"message","text":"I really appreciate the help. Sorry for asking so many questions, but could you answer one last question? :slightly_smiling_face: I'm having trouble finding a satisfactory answer online.\nFor readability, I'll put `a` and `b` as function args so there is not need to sepcify `local` .\nLet's say I want to do something based on the dimensionality of one of these vectors. This MWE is type unstable due to using `N`.\n```function make_ntuple(a, b)\n    N = length(a)\n    ntuple(i -&gt; range(a[i], b[i], length = 500), Val(N))\nend```\nI'm confused why using `N` instead of e.g. `2` doesn't work. Is it only possible to explicitly use an `Integer` in `ntuple`?","user":"UQ93FBKL1","ts":"1615127996.012500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"k3t/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I really appreciate the help. Sorry for asking so many questions, but could you answer one last question? "},{"type":"emoji","name":"slightly_smiling_face"},{"type":"text","text":" I'm having trouble finding a satisfactory answer online.\nFor readability, I'll put "},{"type":"text","text":"a","style":{"code":true}},{"type":"text","text":" and "},{"type":"text","text":"b","style":{"code":true}},{"type":"text","text":" as function args so there is not need to sepcify "},{"type":"text","text":"local","style":{"code":true}},{"type":"text","text":" .\nLet's say I want to do something based on the dimensionality of one of these vectors. This MWE is type unstable due to using "},{"type":"text","text":"N","style":{"code":true}},{"type":"text","text":".\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function make_ntuple(a, b)\n    N = length(a)\n    ntuple(i -> range(a[i], b[i], length = 500), Val(N))\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"I'm confused why using "},{"type":"text","text":"N","style":{"code":true}},{"type":"text","text":" instead of e.g. "},{"type":"text","text":"2","style":{"code":true}},{"type":"text","text":" doesn't work. Is it only possible to explicitly use an "},{"type":"text","text":"Integer","style":{"code":true}},{"type":"text","text":" in "},{"type":"text","text":"ntuple","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"3c62fdd2-46fc-4865-8bd7-9a460279be34","type":"message","text":"Hm, I'm not unsure what you mean. It does work on my computer. Do you mean, why it's not type stable?","user":"U7HAYKY9X","ts":"1615128159.012700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UWNZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hm, I'm not unsure what you mean. It does work on my computer. Do you mean, why it's not type stable?"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"9b5e17a4-3ae9-4dcc-9116-57e1d58faa4c","type":"message","text":"yes exactly, sorry for not being more specific","user":"UQ93FBKL1","ts":"1615128175.012900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fEFh6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yes exactly, sorry for not being more specific"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"dd7401f5-ed7d-4b8b-86b0-4d93b2bd6dd5","type":"message","text":"So, in order for something to be type stable, the output type needs to depend only on the input types, not on anything else","user":"U7HAYKY9X","ts":"1615128255.013100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"6QMJ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So, in order for something to be type stable, the output type needs to depend only on the input types, not on anything else"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"720fc7a3-2e38-440f-b54a-20864d9f090e","type":"message","text":"So here, N is not part of the type of a, e.g. a is a Vector{Int}, and it's still the same type no matter the length","user":"U7HAYKY9X","ts":"1615128295.013300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DM9N","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So here, N is not part of the type of a, e.g. a is a Vector{Int}, and it's still the same type no matter the length"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"22850104-809e-47ec-a0f8-dee514270b80","type":"message","text":"So imagine you are looking at the source code, and only can see the types of the inputs: `Vector{Int}, Vector{Int}` . What type is the output then? It's impossible to tell","user":"U7HAYKY9X","ts":"1615128335.013500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"50/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So imagine you are looking at the source code, and only can see the types of the inputs: "},{"type":"text","text":"Vector{Int}, Vector{Int}","style":{"code":true}},{"type":"text","text":" . What type is the output then? It's impossible to tell"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"21d0abe7-8446-44b7-9eeb-b45b6b16cb05","type":"message","text":"ok I will think about this more, because if\n```function make_ntuple(a, b)\n    N = 2\n    ntuple(i -&gt; range(a[i], b[i], length = 500), Val(N))\nend```\nis type stable, I would assume a function like `length` , which is type stable, shouldn't change the type stability","user":"UQ93FBKL1","ts":"1615128487.013700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Frj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ok I will think about this more, because if\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"function make_ntuple(a, b)\n    N = 2\n    ntuple(i -> range(a[i], b[i], length = 500), Val(N))\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"is type stable, I would assume a function like "},{"type":"text","text":"length","style":{"code":true}},{"type":"text","text":" , which is type stable, shouldn't change the type stability"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"d35a4fd9-c1db-4d49-8c88-ebba4b1a0444","type":"message","text":"No see, in the latter example you can deduce the output types from only the input types.","user":"U7HAYKY9X","ts":"1615128652.013900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wqz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"No see, in the latter example you can deduce the output types from only the input types."}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"3a61322d-6410-49e7-8dcb-e575d4b36292","type":"message","text":"If we assume both are `Vector{Int}` , then the output MUST be `NTuple{2, T}` (for some T)","user":"U7HAYKY9X","ts":"1615128726.014100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"G047y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If we assume both are "},{"type":"text","text":"Vector{Int}","style":{"code":true}},{"type":"text","text":" , then the output MUST be "},{"type":"text","text":"NTuple{2, T}","style":{"code":true}},{"type":"text","text":" (for some T)"}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"},{"client_msg_id":"89018b98-2862-4f66-a05d-6be1694f246b","type":"message","text":"The issue is that the length, that is, the value of N, cannot be known until you actually see the specific vectors.","user":"U7HAYKY9X","ts":"1615128760.014300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UHje","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The issue is that the length, that is, the value of N, cannot be known until you actually see the specific vectors."}]}]}],"thread_ts":"1615037418.473400","parent_user_id":"UQ93FBKL1"}]