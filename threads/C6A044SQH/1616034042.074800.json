[{"client_msg_id":"f220971d-74d6-4beb-b4b6-3bcea54c5448","type":"message","text":"Is it possible to do a `mapreduce` with multiple arrays while broadcasting over some dimensions? Something like this\n```U = rand(5, 5, 5)\nΔ = rand(1, 1, 5)\nmapreduce((u, Δx) -&gt; u / Δx, max, U, Δ)```\nwhere I really want to find the maximum of `U[i, j, k] / Δ[k]`.","user":"UEP056STX","ts":"1616034042.074800","team":"T68168MUP","edited":{"user":"UEP056STX","ts":"1616036186.000000"},"blocks":[{"type":"rich_text","block_id":"Hhyiq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is it possible to do a "},{"type":"text","text":"mapreduce","style":{"code":true}},{"type":"text","text":" with multiple arrays while broadcasting over some dimensions? Something like this\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"U = rand(5, 5, 5)\nΔ = rand(1, 1, 5)\nmapreduce((u, Δx) -> u / Δx, max, U, Δ)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"where I really want to find the maximum of "},{"type":"text","text":"U[i, j, k] / Δ[k]","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1616034042.074800","reply_count":21,"reply_users_count":3,"latest_reply":"1616048660.081300","reply_users":["B01J9QZ4SP8","U8D9768Q6","UEP056STX"],"is_locked":false,"subscribed":false,"reactions":[{"name":"bridge","users":["UEP056STX"],"count":1}]},{"type":"message","subtype":"bot_message","text":"Can we cross post this publicly to <https://discourse.julialang.org|Discourse> for further visibility? React with :bridge: on the message above to approve. <https://github.com/JuliaCommunity/SlackBridge/blob/main/README.md#faq|More info here>","ts":"1616034044.074900","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"type":"message","subtype":"bot_message","text":"Success, it has been cross posted <https://discourse.julialang.org/t/57433| to Discourse>. Keep and eye out on Discourse for responses and please add an answer there once you are satisfied with the solution so others can benefit as well. Happy debugging!","ts":"1616037857.075600","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"f59e9dfb-21fd-4c89-ae92-4eb7df95ba48","type":"message","text":"Tullio.jl is a wonderful library for this:\n```julia&gt; using Tullio, LoopVectorization \n\njulia&gt; let U = rand(3, 3, 3), Δ = rand(3)\n           @tullio (max) out[i, j] := U[i, j, k] / Δ[k]\n       end\n3×3 Matrix{Float64}:\n 1.08494   1.00153  1.19581\n 1.37849   1.10813  1.16516\n 0.640023  1.06599  0.652909```","user":"U8D9768Q6","ts":"1616038221.076200","team":"T68168MUP","edited":{"user":"U8D9768Q6","ts":"1616038392.000000"},"blocks":[{"type":"rich_text","block_id":"7r0=","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Tullio.jl is a wonderful library for this:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> using Tullio, LoopVectorization \n\njulia> let U = rand(3, 3, 3), Δ = rand(3)\n           @tullio (max) out[i, j] := U[i, j, k] / Δ[k]\n       end\n3×3 Matrix{Float64}:\n 1.08494   1.00153  1.19581\n 1.37849   1.10813  1.16516\n 0.640023  1.06599  0.652909"}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"0b991478-a713-46fd-acbe-8d281cf70bb4","type":"message","text":"Oh that's beautiful, thanks <@U8D9768Q6>! Good excuse to start using Tullio.jl","user":"UEP056STX","ts":"1616038330.076500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HlEks","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh that's beautiful, thanks "},{"type":"user","user_id":"U8D9768Q6"},{"type":"text","text":"! Good excuse to start using Tullio.jl"}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"ad2ec5c3-82da-48c4-8710-ab9c470bdc64","type":"message","text":"I was gonna post my double `mapreduce` on Discourse lol\n```mapreduce(i -&gt; mapreduce((x, y) -&gt; x / y, max, A[i, :], B), max, 1:5)```","user":"UEP056STX","ts":"1616038345.076700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"64NJw","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I was gonna post my double "},{"type":"text","text":"mapreduce","style":{"code":true}},{"type":"text","text":" on Discourse lol\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"mapreduce(i -> mapreduce((x, y) -> x / y, max, A[i, :], B), max, 1:5)"}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"150161e4-7f77-441a-a472-3828c1489e96","type":"message","text":"If you leave out the reduction function `max` here, it'll use `+` as the default.","user":"U8D9768Q6","ts":"1616038367.076900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WIgL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you leave out the reduction function "},{"type":"text","text":"max","style":{"code":true}},{"type":"text","text":" here, it'll use "},{"type":"text","text":"+","style":{"code":true}},{"type":"text","text":" as the default."}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX","reactions":[{"name":"+1","users":["UEP056STX"],"count":1}]},{"client_msg_id":"e29ea50e-6807-4435-a9ea-c9c42bc3a917","type":"message","text":"I assume it's easy to just get the max without allocating memory for `out` but will read the Tullio docs","user":"UEP056STX","ts":"1616038399.077300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"H2a+3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I assume it's easy to just get the max without allocating memory for "},{"type":"text","text":"out","style":{"code":true}},{"type":"text","text":" but will read the Tullio docs"}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"d9010f9b-8f08-40b6-9309-01349ecb7a06","type":"message","text":"Oh, you want the total maximum?","user":"U8D9768Q6","ts":"1616038433.077500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ixAMg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh, you want the total maximum?"}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"0a2de041-6948-4c2e-b45c-1d4c0b6f3573","type":"message","text":"```julia&gt; let U = rand(3, 3, 3), Δ = rand(3)\n           @tullio (max) out := U[i, j, k] / Δ[k]\n       end\n4.490419859484241```","user":"U8D9768Q6","ts":"1616038445.077700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7Rff","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> let U = rand(3, 3, 3), Δ = rand(3)\n           @tullio (max) out := U[i, j, k] / Δ[k]\n       end\n4.490419859484241"}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX","reactions":[{"name":"italian-chef-kiss","users":["UEP056STX"],"count":1}]},{"client_msg_id":"35421e41-7a21-4ed8-bd84-0043d78ce24f","type":"message","text":"Ah yes, sorry if I wasn't clear.","user":"UEP056STX","ts":"1616038449.077900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"1Cn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah yes, sorry if I wasn't clear."}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"c77150d4-b2ec-4a71-a4fe-895e51561bf6","type":"message","text":"Tullio will reduce over all indices that appear on the rhs but not the lhs.","user":"U8D9768Q6","ts":"1616038463.078200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fmD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Tullio will reduce over all indices that appear on the rhs but not the lhs."}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"66cffd55-92a7-440a-9854-b2cc60151508","type":"message","text":"It'll also do automatic multithreading","user":"U8D9768Q6","ts":"1616038476.078400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"/lpg","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It'll also do automatic multithreading"}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"b802e1f9-b1de-4779-a260-1577665c705f","type":"message","text":"And if you load `LoopVectorization`, it'll use that when appropriate for generating absolutely killer microkernels. It can be quite competitive with OpenBLAS and MKL for matrix multiplication","user":"U8D9768Q6","ts":"1616038528.078600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aIE/E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And if you load "},{"type":"text","text":"LoopVectorization","style":{"code":true}},{"type":"text","text":", it'll use that when appropriate for generating absolutely killer microkernels. It can be quite competitive with OpenBLAS and MKL for matrix multiplication"}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"7c644efb-2c3e-4297-bc8e-7428481a76d4","type":"message","text":"And it'll work on the GPU if you load `KernelAbstractions`","user":"U8D9768Q6","ts":"1616038549.078800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"=LD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And it'll work on the GPU if you load "},{"type":"text","text":"KernelAbstractions","style":{"code":true}}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"0263bde0-2128-451a-94ef-d81a8e584460","type":"message","text":"Definitely a beautiful package. I'm a little worried about adding even more dependencies to Oceananigans.jl but sounds like we could benefit from it in a few places so maybe it's a worthwhile dependency.","user":"UEP056STX","ts":"1616038586.079000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"K2DBy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Definitely a beautiful package. I'm a little worried about adding even more dependencies to Oceananigans.jl but sounds like we could benefit from it in a few places so maybe it's a worthwhile dependency."}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX","reactions":[{"name":"+1","users":["U8D9768Q6"],"count":1}]},{"client_msg_id":"fa8d9aaa-c6a2-4a9c-bb90-0858b3260a05","type":"message","text":"It works quite well on it's own, and I think the conceptual clarity and flexibility it brings is well worth the dependency.","user":"U8D9768Q6","ts":"1616038649.079300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ffEvm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It works quite well on it's own, and I think the conceptual clarity and flexibility it brings is well worth the dependency."}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"d41f7e5b-4176-494b-9eff-8b848cc7528e","type":"message","text":"Yeah for sure. Will definitely play around with it tomorrow!","user":"UEP056STX","ts":"1616038719.079500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nbDrU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah for sure. Will definitely play around with it tomorrow!"}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"a26903a0-ce6d-40a9-a6ed-463d48096230","type":"message","text":"Is it okay if I copy paste your solution on Discourse? (Unless of course you want to do it)","user":"UEP056STX","ts":"1616038816.079700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"i24","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is it okay if I copy paste your solution on Discourse? (Unless of course you want to do it)"}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"},{"client_msg_id":"6e1171e4-806d-464b-9d97-4991c91b5aab","type":"message","text":"Ah wait the Tullio.jl deps are very lightweight (it just has lots of extra deps for testing). Seems like a no-brainer.","user":"UEP056STX","ts":"1616039107.079900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ljE=7","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah wait the Tullio.jl deps are very lightweight (it just has lots of extra deps for testing). Seems like a no-brainer."}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX","reactions":[{"name":"+1","users":["U8D9768Q6"],"count":1}]},{"client_msg_id":"41703f8c-9e5b-4ba3-92fa-915d341bfafe","type":"message","text":"Yes, feel free to copy paste the code wherever you desire","user":"U8D9768Q6","ts":"1616039197.080200","team":"T68168MUP","edited":{"user":"U8D9768Q6","ts":"1616039208.000000"},"blocks":[{"type":"rich_text","block_id":"/Xo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yes, feel free to copy paste the code wherever you desire"}]}]}],"thread_ts":"1616034042.074800","parent_user_id":"UEP056STX","reactions":[{"name":"+1","users":["UEP056STX"],"count":1}]},{"type":"message","subtype":"bot_message","text":"Hey <@UEP056STX>, if you were able to find an answer here on Slack, please cross post it to Discourse via the link above. Thank you! ","ts":"1616048660.081300","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1616034042.074800","parent_user_id":"UEP056STX"}]