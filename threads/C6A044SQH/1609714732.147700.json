[{"client_msg_id":"0ae5e431-488e-4908-ab74-11f4cb768caa","type":"message","text":"I start Julia with --track-allocation=user and run a file containing following code:\n```using Profile\nfunction f(x)\n    b = copy(x)\n    s = 0\n    for v in x\n        s += v\n    end\n    return s\nend\n\n\nfunction wrapper()\n    x = rand(100)\n    println(\"f(x) = $(f(x))\")\n\n    Profile.clear_malloc_data()\n    y = rand(100)\n    s=f(y)\n    println(\"s = $s\")\nend\n\nwrapper()```\nThe generated .mem file is:\n```        - using Profile\n        - function f(x)\n        -     b = copy(x)\n        -     s = 0\n        -     for v in x\n        -         s += v\n        -     end\n        -     return s\n        - end\n        - \n        - \n        - function wrapper()\n        0     x = rand(100)\n        0     println(\"f(x) = $(f(x))\")\n        - \n        0     Profile.clear_malloc_data()\n        0     y = rand(100)\n      896     s=f(y)\n     1104     println(\"s = $s\")\n        - end\n        - \n        - wrapper()```\n1. Why are the allocations within f(x) not shown? What do the \"-\" mean?\n2. Is y relly not on heap?","user":"URPFQPSEQ","ts":"1609714732.147700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yP+E","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I start Julia with --track-allocation=user and run a file containing following code:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using Profile\nfunction f(x)\n    b = copy(x)\n    s = 0\n    for v in x\n        s += v\n    end\n    return s\nend\n\n\nfunction wrapper()\n    x = rand(100)\n    println(\"f(x) = $(f(x))\")\n\n    Profile.clear_malloc_data()\n    y = rand(100)\n    s=f(y)\n    println(\"s = $s\")\nend\n\nwrapper()"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nThe generated .mem file is:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"        - using Profile\n        - function f(x)\n        -     b = copy(x)\n        -     s = 0\n        -     for v in x\n        -         s += v\n        -     end\n        -     return s\n        - end\n        - \n        - \n        - function wrapper()\n        0     x = rand(100)\n        0     println(\"f(x) = $(f(x))\")\n        - \n        0     Profile.clear_malloc_data()\n        0     y = rand(100)\n      896     s=f(y)\n     1104     println(\"s = $s\")\n        - end\n        - \n        - wrapper()"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\n"}]},{"type":"rich_text_list","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Why are the allocations within f(x) not shown? What do the \"-\" mean?"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Is y relly not on heap?"}]}],"style":"ordered","indent":0}]}],"thread_ts":"1609714732.147700","reply_count":5,"reply_users_count":3,"latest_reply":"1609751209.158300","reply_users":["U01HD5VFXJM","URPFQPSEQ","UH24GRBLL"],"subscribed":false},{"client_msg_id":"5d14dda4-56e9-4086-b82a-ccc73b4a9daf","type":"message","text":"Did you intend to have `for v in b` in your `f(x)`?","user":"U01HD5VFXJM","ts":"1609727296.148500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"tj8Vf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Did you intend to have "},{"type":"text","text":"for v in b","style":{"code":true}},{"type":"text","text":" in your "},{"type":"text","text":"f(x)","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1609714732.147700","parent_user_id":"URPFQPSEQ"},{"client_msg_id":"6835ed77-be08-41a0-b5fe-1fe5a66c378c","type":"message","text":"No, just hoped to create additional allocations for b. If I change to `for v in b` the .mem is identical:\n```        - using Profile\n        - function f(x)\n        -     b = copy(x)\n        -     s = 0\n        -     for v in b\n        -         s += v\n        -     end\n        -     return s\n        - end\n        - \n        - \n        - function wrapper()\n        0     x = rand(100)\n        0     println(\"f(x) = $(f(x))\")\n        - \n        0     Profile.clear_malloc_data()\n        0     y = rand(100)\n      896     s = f(y) \n     1104     println(\"s = $s\")\n        - end\n        - \n        - wrapper()```","user":"URPFQPSEQ","ts":"1609727763.148700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gx9Q","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"No, just hoped to create additional allocations for b. If I change to "},{"type":"text","text":"for v in b","style":{"code":true}},{"type":"text","text":" the .mem is identical:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"        - using Profile\n        - function f(x)\n        -     b = copy(x)\n        -     s = 0\n        -     for v in b\n        -         s += v\n        -     end\n        -     return s\n        - end\n        - \n        - \n        - function wrapper()\n        0     x = rand(100)\n        0     println(\"f(x) = $(f(x))\")\n        - \n        0     Profile.clear_malloc_data()\n        0     y = rand(100)\n      896     s = f(y) \n     1104     println(\"s = $s\")\n        - end\n        - \n        - wrapper()"}]}]}],"thread_ts":"1609714732.147700","parent_user_id":"URPFQPSEQ"},{"client_msg_id":"cb44cfc7-6548-4ed2-b4ef-5f868830f41f","type":"message","text":"Okay! I was curious if it was optimized out :slightly_smiling_face:.","user":"U01HD5VFXJM","ts":"1609727853.148900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"J3o","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Okay! I was curious if it was optimized out "},{"type":"emoji","name":"slightly_smiling_face"},{"type":"text","text":"."}]}]}],"thread_ts":"1609714732.147700","parent_user_id":"URPFQPSEQ"},{"client_msg_id":"4f41cea4-42e3-4857-a5d9-f829329c4630","type":"message","text":"I suspect `f` is inlined, it's noticed that `x` is not used after the call to `f` and thus the copy is elided.","user":"UH24GRBLL","ts":"1609751153.158100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QdpPe","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I suspect "},{"type":"text","text":"f","style":{"code":true}},{"type":"text","text":" is inlined, it's noticed that "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" is not used after the call to "},{"type":"text","text":"f","style":{"code":true}},{"type":"text","text":" and thus the copy is elided."}]}]}],"thread_ts":"1609714732.147700","parent_user_id":"URPFQPSEQ"},{"client_msg_id":"69a98c84-5a61-424c-bb7d-dc508bfb3cad","type":"message","text":"or rather, `x` is only written once at the beginning and only read from afterwards, even in copies. So `copy` is probably optimized away because there's no observable difference","user":"UH24GRBLL","ts":"1609751209.158300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"CP+Y","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"or rather, "},{"type":"text","text":"x","style":{"code":true}},{"type":"text","text":" is only written once at the beginning and only read from afterwards, even in copies. So "},{"type":"text","text":"copy","style":{"code":true}},{"type":"text","text":" is probably optimized away because there's no observable difference"}]}]}],"thread_ts":"1609714732.147700","parent_user_id":"URPFQPSEQ"}]