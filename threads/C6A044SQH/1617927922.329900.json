[{"client_msg_id":"b7eba6b0-54fb-44dd-bd8d-000f70b20476","type":"message","text":"OK.  I'm writing a macro.   My macro receives a `Symbol` which refers to a local variable.  At macro expansion time, is there a way to access the contents of that variable?","user":"ULTB7E6UW","ts":"1617927922.329900","team":"T68168MUP","edited":{"user":"ULTB7E6UW","ts":"1617928401.000000"},"blocks":[{"type":"rich_text","block_id":"4lkT9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"OK.  I'm writing a macro.   My macro receives a "},{"type":"text","text":"Symbol","style":{"code":true}},{"type":"text","text":" which refers to a local variable.  At macro expansion time, is there a way to access the contents of that variable?"}]}]}],"thread_ts":"1617927922.329900","reply_count":13,"reply_users_count":2,"latest_reply":"1617935215.342400","reply_users":["U66M57AN4","ULTB7E6UW"],"is_locked":false,"subscribed":false},{"client_msg_id":"39772A83-B692-41AC-AC8E-BE51E8A5393E","type":"message","text":"Nope","user":"U66M57AN4","ts":"1617928890.332600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cnJD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Nope"}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"13B1965F-575C-4536-AC0B-722DF0192A10","type":"message","text":"That is the nature of the macro ","user":"U66M57AN4","ts":"1617928911.333000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0dL1K","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That is the nature of the macro "}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"104b641f-f241-4465-a123-796b8ff0293b","type":"message","text":"Yea, \"macro expansion occurs before evaluation\"","user":"ULTB7E6UW","ts":"1617928926.333200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ZK6d","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yea, \"macro expansion occurs before evaluation\""}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"9c1de93d-51fa-4b29-9a49-d91fbc46515c","type":"message","text":"The macro is generating a closure.  But the closure depends upon the template provided by the variable.","user":"ULTB7E6UW","ts":"1617928980.333400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"er5v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The macro is generating a closure.  But the closure depends upon the template provided by the variable."}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"d5d3de87-a028-46ea-b4a0-21a21fe7adba","type":"message","text":"Perhaps a generated function using `Var`?","user":"ULTB7E6UW","ts":"1617929031.333600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LP48X","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Perhaps a generated function using "},{"type":"text","text":"Var","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"7c02a557-4b80-4c08-870b-de947f494055","type":"message","text":"I don't want to recreate the closure on each call, that'd be brutal.","user":"ULTB7E6UW","ts":"1617929071.333800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ZgLu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't want to recreate the closure on each call, that'd be brutal."}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"fd4f77aa-7486-4728-b76b-a8950da78f29","type":"message","text":"`eval(:(f(x) = @my_macro $local_variable))`","user":"ULTB7E6UW","ts":"1617929722.339600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aAVV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"eval(:(f(x) = @my_macro $local_variable))","style":{"code":true}}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"F146EEAE-6EBE-4E32-B9B4-CC25FB6AA3B6","type":"message","text":"I think if you're using eval then the macro is pretty superfluous ","user":"U66M57AN4","ts":"1617929780.340200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"I3dx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think if you're using eval then the macro is pretty superfluous "}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"f3728afd-e833-46ff-8250-f5802dbe791a","type":"message","text":"I think it depends upon the context.  However, this lets me execute the macro using a local variable for input.  The macro generates a closure, which becomes the function body.","user":"ULTB7E6UW","ts":"1617930067.340400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wapW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think it depends upon the context.  However, this lets me execute the macro using a local variable for input.  The macro generates a closure, which becomes the function body."}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"2516C49E-09BC-4C57-BCF4-AB13B1AEDCB9","type":"message","text":"If you're eval-ing the macro just write a function that generates the expr and eval that, yeah?","user":"U66M57AN4","ts":"1617930108.341300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Y7qW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you're eval-ing the macro just write a function that generates the expr and eval that, yeah?"}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"a599a13b-1386-47ab-ac0e-ff2aaae8dec9","type":"message","text":"The macro already works.  Normally it just accepts a constant value.  In this case, my input isn't constant, it's determined computed values (that are constant at startup).  The eval in this case works fine, since my function can be built once the startup values are known.  No need to rewrite the macro.  Having a closure is important, the generated code is in a critical section and shouldn't be dynamically dispatched when it's used in the hard loop.  In this case, my generated function `f(x)` can be pre-computed by Julia without having dispatches during execution.","user":"ULTB7E6UW","ts":"1617931273.341500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zXdzN","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The macro already works.  Normally it just accepts a constant value.  In this case, my input isn't constant, it's determined computed values (that are constant at startup).  The eval in this case works fine, since my function can be built once the startup values are known.  No need to rewrite the macro.  Having a closure is important, the generated code is in a critical section and shouldn't be dynamically dispatched when it's used in the hard loop.  In this case, my generated function "},{"type":"text","text":"f(x)","style":{"code":true}},{"type":"text","text":" can be pre-computed by Julia without having dispatches during execution."}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"4b05f755-44ed-40ab-a029-bb9e0dcf41fb","type":"message","text":"Thanks <@U66M57AN4>","user":"ULTB7E6UW","ts":"1617931952.341700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mHC/","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Thanks "},{"type":"user","user_id":"U66M57AN4"}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"},{"client_msg_id":"32144F92-9E99-4F54-AFA4-D6CB3139B183","type":"message","text":"Ah yeah I see, then eval might make sense w the macro. Still has a smell though ","user":"U66M57AN4","ts":"1617935215.342400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JcxI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ah yeah I see, then eval might make sense w the macro. Still has a smell though "}]}]}],"thread_ts":"1617927922.329900","parent_user_id":"ULTB7E6UW"}]