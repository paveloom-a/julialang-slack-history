[{"client_msg_id":"fbdd5d17-6c13-41c5-bcb2-7477179273aa","type":"message","text":"Hi! I faced some problems with PkgTemplates. I created my own plugins for PkgTemplate, e.g:\n`struct Dependencies &lt;: Plugin`\n    `deps::Vector{AbstractString}`\n`end`\n\n`dependencies(d::Dependencies) = d.deps`\n`function posthook(d::Dependencies, t::Template, pkg_dir::AbstractString)`\n    `Pkg.activate(pkg_dir)`\n    `Pkg.add(dependencies(d))`\n    `Pkg.activate()`\n`end`\n\nI have code for tesing it (I tried manually too)\n\n`using TemplatePlugins: Dependencies, DefaultETLService`\n`using Test`\n\n`using Test`\n`using Pkg: Pkg, PackageSpec, TOML`\n`using PkgTemplates`\n`using Suppressor: @suppress`\n`using Random: Random, randstring`\n\n`const USER = \"tester\"`\n\n`Random.seed!(872)`\n\n`# Creata a template that won't error because of a missing username.`\n`tpl(; kwargs...) = Template(; user=USER, kwargs...)`\n`pkgname() = titlecase(randstring('A':'Z', 16))`\n\n`# Create a randomly named package with a template, and delete it afterwards.`\n`function with_pkg(f::Function, t::Template, pkg::AbstractString=pkgname())`\n    `@suppress t(pkg)`\n    `try`\n        `f(pkg)`\n    `finally`\n        `PkgTemplates.version_of(pkg) === nothing || try @suppress Pkg.rm(pkg) catch; end`\n        `rm(joinpath(t.dir, pkg); recursive=true, force=true)`\n    `end`\n`end`\n\n`@testset \"Dependencies plugin test\" begin`\n    `t = tpl(; plugins=[Dependencies([\"PkgTemplates\", \"GitlabAPI\"])])`\n    `with_pkg(t) do pkg`\n        `pkg_dir = joinpath(t.dir, pkg)`\n        `new = String(read(joinpath(pkg_dir, \"new.txt\")))`\n        `println(new)`\n        `toml = String(read(joinpath(pkg_dir, \"Project.toml\")))`\n        `println(toml)`\n\n        `@test contains(toml, \"PkgTemplates\")`\n        `@test contains(toml, \"GitlabAPI\")`\n    `end`\n\n    `t = tpl(; plugins=[Dependencies([])])`\n    `with_pkg(t) do pkg`\n        `pkg_dir = joinpath(t.dir, pkg)`\n        `toml = String(read(joinpath(pkg_dir, \"Project.toml\")))`\n        `@test !contains(toml, \"deps\")`\n    `end`\n`end`\n\nBut It seems like plugin is not executed at all, just usual pkg as result. Can somebody help with that?","user":"U01U176EVG9","ts":"1617880090.259500","team":"T68168MUP","edited":{"user":"U01U176EVG9","ts":"1617880130.000000"},"blocks":[{"type":"rich_text","block_id":"A5gh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hi! I faced some problems with PkgTemplates. I created my own plugins for PkgTemplate, e.g:\n"},{"type":"text","text":"struct Dependencies <: Plugin","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    deps::Vector{AbstractString}","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"end","style":{"code":true}},{"type":"text","text":"\n\n"},{"type":"text","text":"dependencies(d::Dependencies) = d.deps","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"function posthook(d::Dependencies, t::Template, pkg_dir::AbstractString)","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    Pkg.activate(pkg_dir)","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    Pkg.add(dependencies(d))","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    Pkg.activate()","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"end","style":{"code":true}},{"type":"text","text":"\n\nI have code for tesing it (I tried manually too)\n\n"},{"type":"text","text":"using TemplatePlugins: Dependencies, DefaultETLService","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"using Test","style":{"code":true}},{"type":"text","text":"\n\n"},{"type":"text","text":"using Test","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"using Pkg: Pkg, PackageSpec, TOML","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"using PkgTemplates","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"using Suppressor: @suppress","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"using Random: Random, randstring","style":{"code":true}},{"type":"text","text":"\n\n"},{"type":"text","text":"const USER = \"tester\"","style":{"code":true}},{"type":"text","text":"\n\n"},{"type":"text","text":"Random.seed!(872)","style":{"code":true}},{"type":"text","text":"\n\n"},{"type":"text","text":"# Creata a template that won't error because of a missing username.","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"tpl(; kwargs...) = Template(; user=USER, kwargs...)","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"pkgname() = titlecase(randstring('A':'Z', 16))","style":{"code":true}},{"type":"text","text":"\n\n"},{"type":"text","text":"# Create a randomly named package with a template, and delete it afterwards.","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"function with_pkg(f::Function, t::Template, pkg::AbstractString=pkgname())","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    @suppress t(pkg)","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    try","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        f(pkg)","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    finally","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        PkgTemplates.version_of(pkg) === nothing || try @suppress Pkg.rm(pkg) catch; end","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        rm(joinpath(t.dir, pkg); recursive=true, force=true)","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    end","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"end","style":{"code":true}},{"type":"text","text":"\n\n"},{"type":"text","text":"@testset \"Dependencies plugin test\" begin","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    t = tpl(; plugins=[Dependencies([\"PkgTemplates\", \"GitlabAPI\"])])","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    with_pkg(t) do pkg","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        pkg_dir = joinpath(t.dir, pkg)","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        new = String(read(joinpath(pkg_dir, \"new.txt\")))","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        println(new)","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        toml = String(read(joinpath(pkg_dir, \"Project.toml\")))","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        println(toml)","style":{"code":true}},{"type":"text","text":"\n\n"},{"type":"text","text":"        @test contains(toml, \"PkgTemplates\")","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        @test contains(toml, \"GitlabAPI\")","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    end","style":{"code":true}},{"type":"text","text":"\n\n"},{"type":"text","text":"    t = tpl(; plugins=[Dependencies([])])","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    with_pkg(t) do pkg","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        pkg_dir = joinpath(t.dir, pkg)","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        toml = String(read(joinpath(pkg_dir, \"Project.toml\")))","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"        @test !contains(toml, \"deps\")","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"    end","style":{"code":true}},{"type":"text","text":"\n"},{"type":"text","text":"end","style":{"code":true}},{"type":"text","text":"\n\nBut It seems like plugin is not executed at all, just usual pkg as result. Can somebody help with that?"}]}]}],"thread_ts":"1617880090.259500","reply_count":2,"reply_users_count":1,"latest_reply":"1617894345.266300","reply_users":["U6NFPDBV1"],"is_locked":false,"subscribed":false,"reactions":[{"name":"slack","users":["U7QLM6E2E"],"count":1}]},{"client_msg_id":"e54c0bd1-b4a4-4d16-aba1-5f2a2b4e1be5","type":"message","text":"Are you sure you are implementing `PkgTemplates.posthook`, or are you creating a separate function with the name `posthook`? The difference is whether you've done `import PkgTemplates: posthook` or `using PkgTemplates: posthook`","user":"U6NFPDBV1","ts":"1617894258.266100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zNy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Are you sure you are implementing "},{"type":"text","text":"PkgTemplates.posthook","style":{"code":true}},{"type":"text","text":", or are you creating a separate function with the name "},{"type":"text","text":"posthook","style":{"code":true}},{"type":"text","text":"? The difference is whether you've done "},{"type":"text","text":"import PkgTemplates: posthook","style":{"code":true}},{"type":"text","text":" or "},{"type":"text","text":"using PkgTemplates: posthook","style":{"code":true}}]}]}],"thread_ts":"1617880090.259500","parent_user_id":"U01U176EVG9"},{"client_msg_id":"4a493873-7312-4083-801c-a4d43ba15dae","type":"message","text":"I usually do `function PkgTemplates.posthook(...)` and avoid `import`, personally","user":"U6NFPDBV1","ts":"1617894345.266300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"h2Z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I usually do "},{"type":"text","text":"function PkgTemplates.posthook(...)","style":{"code":true}},{"type":"text","text":" and avoid "},{"type":"text","text":"import","style":{"code":true}},{"type":"text","text":", personally"}]}]}],"thread_ts":"1617880090.259500","parent_user_id":"U01U176EVG9"}]