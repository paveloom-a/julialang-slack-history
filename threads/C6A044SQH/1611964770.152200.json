[{"client_msg_id":"0a0eba61-e0a6-4cad-a68a-25860d44acec","type":"message","text":"Will I run into performance issues if I use a matrix of  different distributions? My understanding is that this will be an abstract typed matrix which will be slow. What is a better way to do this?","user":"U011V2YN59N","ts":"1611964770.152200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"8CZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Will I run into performance issues if I use a matrix of  different distributions? My understanding is that this will be an abstract typed matrix which will be slow. What is a better way to do this?"}]}]}],"thread_ts":"1611964770.152200","reply_count":24,"reply_users_count":5,"latest_reply":"1612061138.218100","reply_users":["B01J9QZ4SP8","U8D9768Q6","U011V2YN59N","U01GRS159T8","UPNRULT51"],"subscribed":false,"reactions":[{"name":"bridge","users":["U011V2YN59N"],"count":1}]},{"type":"message","subtype":"bot_message","text":"Hey <@U011V2YN59N>, Thanks for asking this question. Is it okay if we cross post this to Discourse for further visibility and in case someone has the same question in the future? If so, please react with :bridge: on the original message you sent above above ^ (not this threaded reply). Note that only reactions from the posts author will trigger a re-post. Thank you for being here!","ts":"1611964772.152300","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"type":"message","subtype":"bot_message","text":"Hey <@U011V2YN59N>! Thanks for asking this question. It has been cross posted to discourse here: <https://discourse.julialang.org/t/will-i-run-into-performance-issues-if-i-use-a-matrix-of-different-distributions>. Please add an answer there once you are satisfied with the solution so others can benefit as well.\n\nNote that if someone answers on Discourse, you will *not* be notified directly, so it may be worth keeping the page open until a solution is found. Happy debugging!","ts":"1611964788.152600","username":"HelpDeskBot","bot_id":"B01J9QZ4SP8","thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N","reactions":[{"name":"bowtie","users":["UGR3910CQ"],"count":1}]},{"client_msg_id":"5520687d-5a41-4b47-98f1-4e608b838adb","type":"message","text":"Can you elaborate on what you're doing with this matrix and what you mean specifically by distributions here?","user":"U8D9768Q6","ts":"1611965101.152800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"g//","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Can you elaborate on what you're doing with this matrix and what you mean specifically by distributions here?"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"502c178b-32bd-4ec5-9983-6107754b8f76","type":"message","text":"by distributions I mean specifically instances of `Poisson` ,`Geometric`  from Distributions.jl. I use the matrix to represent transition rates between compartments of my ABM model.","user":"U011V2YN59N","ts":"1611969200.153100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"waj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"by distributions I mean specifically instances of "},{"type":"text","text":"Poisson","style":{"code":true}},{"type":"text","text":" ,"},{"type":"text","text":"Geometric","style":{"code":true}},{"type":"text","text":"  from Distributions.jl. I use the matrix to represent transition rates between compartments of my ABM model."}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"03c301d6-5e65-4be1-b11e-17828edaf31f","type":"message","text":"how big is the matrix?","user":"U01GRS159T8","ts":"1611980289.155700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uyMry","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"how big is the matrix?"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"b0f4100b-4636-44bc-bac8-3e3fca663f6b","type":"message","text":"smaller than 10x10, square","user":"U011V2YN59N","ts":"1611980785.155900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"eA/lU","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"smaller than 10x10, square"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"521186ac-c551-4573-a4fe-f073f7d3eeb0","type":"message","text":"ahh,  are you going over it in a tight loop?  Where the abstract typing hurts you is in accessing the elements","user":"U01GRS159T8","ts":"1611981882.156100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"RCEdx","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ahh,  are you going over it in a tight loop?  Where the abstract typing hurts you is in accessing the elements"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"b6a53786-cc9a-475c-8bbe-bd8ebd09c3f2","type":"message","text":"yep I am..","user":"U011V2YN59N","ts":"1611983696.156400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HXI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yep I am.."}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"36dbca0d-524e-4c1b-b86b-a66ed2657671","type":"message","text":"is there a better way to represent such a structure?","user":"U011V2YN59N","ts":"1611983721.156600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"alDmp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"is there a better way to represent such a structure?"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"02304089-3c6a-426d-956c-71eeadb80c22","type":"message","text":"Id try it the naive way and see if it is actually a problem.  If you're doing a lot of work per access it won't matter.  Then if that is slow I'd break it into two separate arrays with concrete types","user":"U01GRS159T8","ts":"1611984233.156800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FE1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Id try it the naive way and see if it is actually a problem.  If you're doing a lot of work per access it won't matter.  Then if that is slow I'd break it into two separate arrays with concrete types"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N","reactions":[{"name":"+1","users":["U011V2YN59N"],"count":1}]},{"client_msg_id":"95901c9d-533e-4a51-bf54-50068ae6e8a7","type":"message","text":"and choose between the two based on a masking array or something like that","user":"U01GRS159T8","ts":"1611984263.157000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XeGp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"and choose between the two based on a masking array or something like that"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"3e45add2-b1f8-4093-ae8f-2f9497032c34","type":"message","text":"If you only have 2 possible types in the matrix, I would suggest using a Union type. That should be fast and convenient.","user":"UPNRULT51","ts":"1612041223.201000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lqNk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"If you only have 2 possible types in the matrix, I would suggest using a Union type. That should be fast and convenient."}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"219fe9b6-1526-4ca7-b617-19a05cc16fe6","type":"message","text":"if the compiler manages to do union splitting on it","user":"U01GRS159T8","ts":"1612043739.201300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Iqg2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"if the compiler manages to do union splitting on it"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"82149bf0-242a-442d-9395-acddb4975484","type":"message","text":"its hard to rely on","user":"U01GRS159T8","ts":"1612043749.201500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zr/YF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"its hard to rely on"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"05c0aae2-ecb1-4379-92e4-ca1fbe81a7f2","type":"message","text":"Union splitting almost always happens for two element unions from what I understand.","user":"U8D9768Q6","ts":"1612044170.201700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KAmp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Union splitting almost always happens for two element unions from what I understand."}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"4a49a4d9-8a6d-4f38-b425-57c82535a2d0","type":"message","text":"I assumed he was already doing that","user":"U01GRS159T8","ts":"1612045957.201900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aMPbn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I assumed he was already doing that"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"487b1574-d748-40da-9d73-2888edd9c038","type":"message","text":"```julia&gt; [Poisson(), Geometric()] |&gt; eltype\nDistribution{Univariate, Discrete} (alias for Distribution{Univariate, Discrete})```\nThat's not the default array type you get if you build it naively, so maybe not a safe assumption.","user":"U8D9768Q6","ts":"1612046229.202100","team":"T68168MUP","edited":{"user":"U8D9768Q6","ts":"1612046241.000000"},"blocks":[{"type":"rich_text","block_id":"68o","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> [Poisson(), Geometric()] |> eltype\nDistribution{Univariate, Discrete} (alias for Distribution{Univariate, Discrete})"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"That's not the default array type you get if you build it naively, so maybe not a safe assumption."}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"067cd310-4908-4299-958d-57bff9177ce7","type":"message","text":"It's actually four types. I am currently trying an tuple of tuples, which appears to be faster. I posted in performance helpdesk about it","user":"U011V2YN59N","ts":"1612052545.211900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4oiI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It's actually four types. I am currently trying an tuple of tuples, which appears to be faster. I posted in performance helpdesk about it"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"90f76f0e-5f6c-42e6-8033-bd0d0b198c85","type":"message","text":"<https://julialang.org/blog/2018/08/union-splitting/> says that union splitting is supported for any size of union? I'm not sure how to make it happen though.","user":"U011V2YN59N","ts":"1612060187.216800","team":"T68168MUP","attachments":[{"title":"Union-splitting: what it is, and why you should care","title_link":"https://julialang.org/blog/2018/08/union-splitting/","text":"Union-splitting: what it is, and why you should care | Among those who follow Julia's development closely, one of the (many) new features causing great excitement is something called","fallback":"Union-splitting: what it is, and why you should care","image_url":"https://julialang.org/assets/images/julia-open-graph.png","from_url":"https://julialang.org/blog/2018/08/union-splitting/","image_width":500,"image_height":250,"image_bytes":742374,"service_name":"julialang.org","id":1,"original_url":"https://julialang.org/blog/2018/08/union-splitting/"}],"blocks":[{"type":"rich_text","block_id":"Kfm","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://julialang.org/blog/2018/08/union-splitting/"},{"type":"text","text":" says that union splitting is supported for any size of union? I'm not sure how to make it happen though."}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"36b34488-aa4d-410a-b278-e3f3b9b6e9de","type":"message","text":"```julia&gt; convert(Array{Union{Poisson{Float64},Geometric{Float64},Normal{Float64}}},[Poisson(),Geometric(),Normal()])\n3-element Vector{Union{Geometric{Float64}, Normal{Float64}, Poisson{Float64}}}:\n Poisson{Float64}(λ=1.0)\n Geometric{Float64}(p=0.5)\n Normal{Float64}(μ=0.0, σ=1.0)```\nthis seems to work!","user":"U011V2YN59N","ts":"1612060400.217300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"EmUw","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> convert(Array{Union{Poisson{Float64},Geometric{Float64},Normal{Float64}}},[Poisson(),Geometric(),Normal()])\n3-element Vector{Union{Geometric{Float64}, Normal{Float64}, Poisson{Float64}}}:\n Poisson{Float64}(λ=1.0)\n Geometric{Float64}(p=0.5)\n Normal{Float64}(μ=0.0, σ=1.0)"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"this seems to work!"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"b84c3f88-6fa0-4cb2-9a96-1faccb12c772","type":"message","text":"haven't checked if it actually makes access faster though","user":"U011V2YN59N","ts":"1612060444.217500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nQh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"haven't checked if it actually makes access faster though"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"f7e31d2c-bb13-4f00-ab33-55d28c2ccad1","type":"message","text":"it is faster!\n```julia&gt; l = repeat([Poisson(),Geometric(),Normal()],1000);\n\njulia&gt; l2 = convert(Array{Union{Poisson{Float64},Geometric{Float64},Normal{Float64}}},l);\n\njulia&gt; @btime rand.(l);\n  357.629 μs (4506 allocations: 117.66 KiB)\n\njulia&gt; @btime rand.(l2);\n  239.719 μs (1016 allocations: 63.06 KiB)```","user":"U011V2YN59N","ts":"1612060712.217700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"pFml","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it is faster!\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> l = repeat([Poisson(),Geometric(),Normal()],1000);\n\njulia> l2 = convert(Array{Union{Poisson{Float64},Geometric{Float64},Normal{Float64}}},l);\n\njulia> @btime rand.(l);\n  357.629 μs (4506 allocations: 117.66 KiB)\n\njulia> @btime rand.(l2);\n  239.719 μs (1016 allocations: 63.06 KiB)"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"a2a585d2-b09b-4a5b-b8a9-b382953e0b01","type":"message","text":"as <@U01GRS159T8> predicted, this sped up my code by maybe 10% lol","user":"U011V2YN59N","ts":"1612061134.217900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WCSCX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"as "},{"type":"user","user_id":"U01GRS159T8"},{"type":"text","text":" predicted, this sped up my code by maybe 10% lol"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"},{"client_msg_id":"db366750-25a8-4c97-8e36-968fdf3f4e29","type":"message","text":"but I did learn things","user":"U011V2YN59N","ts":"1612061138.218100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WUNu","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"but I did learn things"}]}]}],"thread_ts":"1611964770.152200","parent_user_id":"U011V2YN59N"}]