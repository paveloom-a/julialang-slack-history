[{"client_msg_id":"e7b35ca1-6297-49f3-8801-4f6d6800d68c","type":"message","text":"I'm having some trouble with mixing expression and string interpolation. How would we do expression interpolation inside of a string literal? e.g. `:(\"$var\")` where `var` is an expression defined previously in a macro or quote block. As written, Julia interprets the `$` as a string interpolator and it doesn't work.","user":"U01H36BUDJB","ts":"1611663409.370500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HL=E9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I'm having some trouble with mixing expression and string interpolation. How would we do expression interpolation inside of a string literal? e.g. "},{"type":"text","text":":(\"$var\")","style":{"code":true}},{"type":"text","text":" where "},{"type":"text","text":"var","style":{"code":true}},{"type":"text","text":" is an expression defined previously in a macro or quote block. As written, Julia interprets the "},{"type":"text","text":"$","style":{"code":true}},{"type":"text","text":" as a string interpolator and it doesn't work."}]}]}],"thread_ts":"1611663409.370500","reply_count":29,"reply_users_count":4,"latest_reply":"1611671172.385600","reply_users":["UH24GRBLL","UAQLHMSN7","UD0NS8PDF","U01H36BUDJB"],"subscribed":false},{"client_msg_id":"761d6522-b2de-490c-a13d-9c9db3c1057c","type":"message","text":"`:(string($var))`?","user":"UH24GRBLL","ts":"1611663478.370600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+9S","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":":(string($var))","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"38dacfa1-0650-44df-8c4a-f28dd1d2a6e8","type":"message","text":"`:(\"$($var)\")`?","user":"UAQLHMSN7","ts":"1611663579.371300","team":"T68168MUP","edited":{"user":"UAQLHMSN7","ts":"1611663591.000000"},"blocks":[{"type":"rich_text","block_id":"B=C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":":(\"$($var)\")","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"98631a67-b7ac-4859-8cc5-ed90b0bd8f8d","type":"message","text":"I normally do `str = \"var = $var\"`, and then `ex = :(@assert 1==1 $str)`","user":"UD0NS8PDF","ts":"1611663586.371500","team":"T68168MUP","edited":{"user":"UD0NS8PDF","ts":"1611663748.000000"},"blocks":[{"type":"rich_text","block_id":"GBy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I normally do "},{"type":"text","text":"str = \"var = $var\"","style":{"code":true}},{"type":"text","text":", and then "},{"type":"text","text":"ex = :(@assert 1==1 $str)","style":{"code":true}}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"1253d289-4822-434d-9188-7a1c14d00ca9","type":"message","text":"These options all give different things:\n```julia&gt; :(string($var))\n:(string(3))\n\njulia&gt; :(\"$($var)\")\n:(\"$(3)\")\n\njulia&gt; :(@assert 1==1 $str)\n:(#= REPL[184]:1 =# @assert 1 == 1 \"var = 3\")```","user":"UD0NS8PDF","ts":"1611663736.371800","team":"T68168MUP","edited":{"user":"UD0NS8PDF","ts":"1611663780.000000"},"blocks":[{"type":"rich_text","block_id":"2iG","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"These options all give different things:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> :(string($var))\n:(string(3))\n\njulia> :(\"$($var)\")\n:(\"$(3)\")\n\njulia> :(@assert 1==1 $str)\n:(#= REPL[184]:1 =# @assert 1 == 1 \"var = 3\")"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"9c3052d5-77a0-4a42-99ed-5c878c95a5cf","type":"message","text":"Doesn't `str=\"var=$var\"` get interpreted as string interpolation?","user":"U01H36BUDJB","ts":"1611663823.372200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"nWLd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Doesn't "},{"type":"text","text":"str=\"var=$var\"","style":{"code":true}},{"type":"text","text":" get interpreted as string interpolation?"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"2372ca94-2aa3-4f55-bcde-c9380532673b","type":"message","text":"Yeah the first two don't work <@UH24GRBLL> <@UAQLHMSN7>","user":"U01H36BUDJB","ts":"1611663852.372400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ljswk","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah the first two don't work "},{"type":"user","user_id":"UH24GRBLL"},{"type":"text","text":" "},{"type":"user","user_id":"UAQLHMSN7"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"159201fc-a370-439e-bfa6-553b96a91ae7","type":"message","text":"Can you clarify what answer you do want?","user":"UD0NS8PDF","ts":"1611663946.372600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"3e6e","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Can you clarify what answer you do want?"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"1f18d69e-b513-448a-b93a-6161ae9dfea2","type":"message","text":"I think `string($var)` would work if the expression in `var` was something accepted by the `string` constructor, but not if it's an arbitrary symbol or expression.","user":"U01H36BUDJB","ts":"1611663961.372800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hqms","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think "},{"type":"text","text":"string($var)","style":{"code":true}},{"type":"text","text":" would work if the expression in "},{"type":"text","text":"var","style":{"code":true}},{"type":"text","text":" was something accepted by the "},{"type":"text","text":"string","style":{"code":true}},{"type":"text","text":" constructor, but not if it's an arbitrary symbol or expression."}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"e9a35081-1588-4110-b6c7-b63f6c8163ff","type":"message","text":"Yeah here's a stripped down case:\n```macro example(args)\n  a, b = args.args # args::Expr\n  :(\"$a\")\nend```\nThis is a stupid and useless example, but the idea is that the macro should produce a string with the value of `a` .","user":"U01H36BUDJB","ts":"1611664084.373000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0pL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah here's a stripped down case:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"macro example(args)\n  a, b = args.args # args::Expr\n  :(\"$a\")\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"This is a stupid and useless example, but the idea is that the macro should produce a string with the value of "},{"type":"text","text":"a","style":{"code":true}},{"type":"text","text":" ."}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"17a466b9-14d2-4872-a43e-620d79adb585","type":"message","text":"so if args was 2+2, the evaluated result should be a string \"2\"","user":"U01H36BUDJB","ts":"1611664133.373200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"JbTCd","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"so if args was 2+2, the evaluated result should be a string \"2\""}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"78024804-0754-45a1-8508-4711cde79cf1","type":"message","text":"But a isn’t 2? If you just return `\"$a\"` from the macro, you will get `\"+\"`","user":"UD0NS8PDF","ts":"1611664176.373400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QVas","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But a isn’t 2? If you just return "},{"type":"text","text":"\"$a\"","style":{"code":true}},{"type":"text","text":" from the macro, you will get "},{"type":"text","text":"\"+\"","style":{"code":true}}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"cc3d57fc-87fd-4b68-b4fc-1764314c442c","type":"message","text":"oh right my bad","user":"U01H36BUDJB","ts":"1611664208.373600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hzaM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"oh right my bad"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"4eb9f4de-1cb7-4c74-9a0f-3959f9d374c2","type":"message","text":"```macro example(args)\n  a, b, c = args.args # args::Expr\n  :(\"$b\")\nend```","user":"U01H36BUDJB","ts":"1611664225.373800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"7vqC=","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"macro example(args)\n  a, b, c = args.args # args::Expr\n  :(\"$b\")\nend"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"8c65d04a-17ca-412d-a1f6-a9846880f74f","type":"message","text":"But why are you quoting this?","user":"UD0NS8PDF","ts":"1611664244.374000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"LkFaK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But why are you quoting this?"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"e4764b90-3d8a-4124-868e-d07c99458063","type":"message","text":"Well the point is that I want the symbol to be interpolated into the string.","user":"U01H36BUDJB","ts":"1611664322.374200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dXtW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Well the point is that I want the symbol to be interpolated into the string."}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"2df5f64d-9eb9-41a0-8633-c78bd8cccc3b","type":"message","text":"The result:\n```julia&gt; macro example(args)\n         a,b,c = args.args\n         :(\"$b\")\n       end\n@example (macro with 1 method)\n\njulia&gt; @example 2+2\nERROR: UndefVarError: b not defined```","user":"U01H36BUDJB","ts":"1611664338.374400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Lwegh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The result:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> macro example(args)\n         a,b,c = args.args\n         :(\"$b\")\n       end\n@example (macro with 1 method)\n\njulia> @example 2+2\nERROR: UndefVarError: b not defined"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"6937e696-0af6-41c3-9c6a-9c7159324868","type":"message","text":"Because it gets parsed as string interpolation","user":"U01H36BUDJB","ts":"1611664345.374600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Mpcz","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Because it gets parsed as string interpolation"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"e5e37feb-5316-4712-938a-56d831028d07","type":"message","text":"&gt; If you just return “$a” from the macro, you will get “+”\nOr return `\"$b\"`.","user":"UD0NS8PDF","ts":"1611664360.374800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ikE","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":"If you just return “$a” from the macro, you will get “+”"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nOr return "},{"type":"text","text":"\"$b\"","style":{"code":true}},{"type":"text","text":"."}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"5577fdb7-599b-46d1-819d-c64f8171d05c","type":"message","text":"yeah ok, so in my actual use case, the result has to go into another quoted expression","user":"U01H36BUDJB","ts":"1611664438.375000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"b+O","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah ok, so in my actual use case, the result has to go into another quoted expression"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"62827da3-375f-44e9-ad8a-8238260aa48c","type":"message","text":"```macro statevars(arraytype, axis, variables...)\n    ex = Expr(:block)\n    for var in variables\n        name, unit = var.args\n        varexpr = :(:($$name) = StateVar(Symbol(\"$name\"),$axis,$arraytype))\n        push!(ex.args,varexpr)\n    end\n    ex\nend```\nso the point is that I need to create a `Symbol` with the value represented by `name`","user":"U01H36BUDJB","ts":"1611664535.375200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OMi+j","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"macro statevars(arraytype, axis, variables...)\n    ex = Expr(:block)\n    for var in variables\n        name, unit = var.args\n        varexpr = :(:($$name) = StateVar(Symbol(\"$name\"),$axis,$arraytype))\n        push!(ex.args,varexpr)\n    end\n    ex\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"so the point is that I need to create a "},{"type":"text","text":"Symbol","style":{"code":true}},{"type":"text","text":" with the value represented by "},{"type":"text","text":"name","style":{"code":true}}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"a6297ffe-51f5-408e-82ca-e7c364fb77e8","type":"message","text":"yea that’s why my first answer constructed a nontrivial expression, because I was trying to guess what the trivial one really meant…","user":"UD0NS8PDF","ts":"1611664537.375400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"D2U","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yea that’s why my first answer constructed a nontrivial expression, because I was trying to guess what the trivial one really meant…"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"fd2e5b85-ff53-4c41-8a3f-8bf3ae677b4d","type":"message","text":"But now it looks like you don’t want a string at all, you want a Symbol?","user":"UD0NS8PDF","ts":"1611664608.375600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"V4n","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"But now it looks like you don’t want a string at all, you want a Symbol?"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"3c590185-f69e-4921-801b-a1942edc11ef","type":"message","text":"yeah, that's right. but I couldn't figure out how to escape `:` so I figured I would create `Symbol(\"$name\")`","user":"U01H36BUDJB","ts":"1611664717.376400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"54C","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah, that's right. but I couldn't figure out how to escape "},{"type":"text","text":":","style":{"code":true}},{"type":"text","text":" so I figured I would create "},{"type":"text","text":"Symbol(\"$name\")","style":{"code":true}}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"6551edf5-8e09-4429-b051-4044e673cac2","type":"message","text":"Then you want\n```julia&gt; QuoteNode(:a)\n:(:a)\n\njulia&gt; :(sy = $ans)\n:(sy = :a)```","user":"UD0NS8PDF","ts":"1611664888.376700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dOq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Then you want\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> QuoteNode(:a)\n:(:a)\n\njulia> :(sy = $ans)\n:(sy = :a)"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"9cafadec-677a-40c1-a340-ffa902d37bec","type":"message","text":"hmm, not quite, the symbol in that last expression would need to evaluate to the expression represented by `a`","user":"U01H36BUDJB","ts":"1611666264.381700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MpTW9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"hmm, not quite, the symbol in that last expression would need to evaluate to the expression represented by "},{"type":"text","text":"a","style":{"code":true}}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"ce6c2f8b-61f3-4144-bf29-a7903764bee6","type":"message","text":"i.e. `:(sy = :+)` if `a`  was `+`  like before","user":"U01H36BUDJB","ts":"1611666326.381900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"9xzr1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"i.e. "},{"type":"text","text":":(sy = :+)","style":{"code":true}},{"type":"text","text":" if "},{"type":"text","text":"a","style":{"code":true}},{"type":"text","text":"  was "},{"type":"text","text":"+","style":{"code":true}},{"type":"text","text":"  like before"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"fa04ee2b-11b5-46d7-b5eb-f53ad5a03d4a","type":"message","text":"ok let me distill this to a simple example, suppose I want to make the macro `@example` take the expression 2+2 and evaluate to the symbol `:+` , i.e. return a nested expression.\nHow would that work?\n```macro example(args)\n  a,b,c = args.args\n  :(:($a))\nend```\nafter evaluation produces\n```a```\nand adding a second `$` produces\n```+```\nneither of which are quite right.","user":"U01H36BUDJB","ts":"1611667576.382100","team":"T68168MUP","edited":{"user":"U01H36BUDJB","ts":"1611667602.000000"},"blocks":[{"type":"rich_text","block_id":"gtaHy","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"ok let me distill this to a simple example, suppose I want to make the macro "},{"type":"text","text":"@example","style":{"code":true}},{"type":"text","text":" take the expression 2+2 and evaluate to the symbol "},{"type":"text","text":":+","style":{"code":true}},{"type":"text","text":" , i.e. return a nested expression.\nHow would that work?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"macro example(args)\n  a,b,c = args.args\n  :(:($a))\nend"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"after evaluation produces\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"a"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"and adding a second "},{"type":"text","text":"$","style":{"code":true}},{"type":"text","text":" produces\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"+"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"neither of which are quite right."}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"1dd94d00-7803-43a7-a33c-2a459a0f06bc","type":"message","text":"You still need QuoteNode, it takes a symbol and gives you a quoted symbol.\n```julia&gt; macro example(args)\n         a,b,c = args.args\n         @assert a isa Symbol\n         QuoteNode(a)\n       end;\n\njulia&gt; @example 2+2\n:+```\nMy advice it to give up thinking about multiple stages of quoting on one line. Make the pieces you need. Then make the expression out of them.","user":"UD0NS8PDF","ts":"1611668078.382800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"j+r","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You still need QuoteNode, it takes a symbol and gives you a quoted symbol.\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> macro example(args)\n         a,b,c = args.args\n         @assert a isa Symbol\n         QuoteNode(a)\n       end;\n\njulia> @example 2+2\n:+"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"My advice it to give up thinking about multiple stages of quoting on one line. Make the pieces you need. Then make the expression out of them."}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"},{"client_msg_id":"7dcd34b7-8f40-4611-8af0-e92e3b41304c","type":"message","text":"Yep. you're right, separating things made it clearer... this works:\n```macro statevars(arraytype, axis, variables...)\n    ex = Expr(:block)\n    for var in variables\n        name, unit = var.args\n        sym = QuoteNode(:($name))\n        varexpr = :(:($$name) = StateVar($sym,$axis,$unit,$arraytype))\n        push!(ex.args,varexpr)\n    end\n    ex\nend```","user":"U01H36BUDJB","ts":"1611671172.385600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MHPgR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yep. you're right, separating things made it clearer... this works:\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"macro statevars(arraytype, axis, variables...)\n    ex = Expr(:block)\n    for var in variables\n        name, unit = var.args\n        sym = QuoteNode(:($name))\n        varexpr = :(:($$name) = StateVar($sym,$axis,$unit,$arraytype))\n        push!(ex.args,varexpr)\n    end\n    ex\nend"}]}]}],"thread_ts":"1611663409.370500","parent_user_id":"U01H36BUDJB"}]