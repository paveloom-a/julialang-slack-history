[{"client_msg_id":"b4c8c87d-2b2a-4126-9b72-3f9000485b9f","type":"message","text":"The online documentation has been frustrating to look at  so here I am again.\n\nLets say you have a script like this\n```using ArgParse\n\ns = ArgParseSettings()\n\n@add_arg_table s begin\n    \"arg1\"\n    arg_type = Int\n\thelp = \"Arg1\"\n\trequired = true\nend\n\nparsed_args = parse_args(s)\nx = parsed_args[\"arg1\"]\nprint(sum([x, x]))```\nDoing `julia myscript.jl 3` takes 3 seconds to execute on my computer everytime.\n\nWhats the best way to precompile this script so that\n1. It runs close to instantly upon execution from the command line\n2. There are no required intermediate files that are 100MBs in size\n3. The goal is to ultimately put a script like this in a docker image, so hopefully it follows the best practices associated with precompilation and docker (a bit vague i know)","user":"U01FAHWCMFF","ts":"1608430372.031800","team":"T68168MUP","edited":{"user":"U01FAHWCMFF","ts":"1608430471.000000"},"blocks":[{"type":"rich_text","block_id":"a/uK3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The online documentation has been frustrating to look at  so here I am again.\n\nLets say you have a script like this\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"using ArgParse\n\ns = ArgParseSettings()\n\n@add_arg_table s begin\n    \"arg1\"\n    arg_type = Int\n\thelp = \"Arg1\"\n\trequired = true\nend\n\nparsed_args = parse_args(s)\nx = parsed_args[\"arg1\"]\nprint(sum([x, x]))"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"\nDoing "},{"type":"text","text":"julia myscript.jl 3","style":{"code":true}},{"type":"text","text":" takes 3 seconds to execute on my computer everytime.\n\nWhats the best way to precompile this script so that\n"}]},{"type":"rich_text_list","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It runs close to instantly upon execution from the command line"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"There are no required intermediate files that are 100MBs in size"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"The goal is to ultimately put a script like this in a docker image, so hopefully it follows the best practices associated with precompilation and docker (a bit vague i know)"}]}],"style":"ordered","indent":0}]}],"thread_ts":"1608430372.031800","reply_count":34,"reply_users_count":5,"latest_reply":"1608560521.157100","reply_users":["U0179G7FG4F","U01FAHWCMFF","U8T0YV7QC","UDGT4PM41","U6A0PD8CR"],"subscribed":false},{"client_msg_id":"81890ae1-b9e5-4ae0-b94c-e74d95e4613f","type":"message","text":"The short answer is that this isn't currently possible.","user":"U0179G7FG4F","ts":"1608430523.032100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"fwp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The short answer is that this isn't currently possible."}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"6190a023-3e09-43f0-8f52-43200c2d286c","type":"message","text":"Wow really :disappointed: . I was thinking of putting some julia code in production eventually in the future. Thats a real dealbreaker if its impossible to do.","user":"U01FAHWCMFF","ts":"1608430690.032300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"WWi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Wow really "},{"type":"emoji","name":"disappointed"},{"type":"text","text":" . I was thinking of putting some julia code in production eventually in the future. Thats a real dealbreaker if its impossible to do."}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"3476a954-212f-4522-a9fa-cc0e9d3dd978","type":"message","text":"One thing that would help a lot is if `ArgParse` had precompilation. If it did, I think this would probably take closer to .5 seconds.","user":"U0179G7FG4F","ts":"1608430808.032500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"uPBq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"One thing that would help a lot is if "},{"type":"text","text":"ArgParse","style":{"code":true}},{"type":"text","text":" had precompilation. If it did, I think this would probably take closer to .5 seconds."}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"01047AE6-A190-4670-96CF-54F14059FA84","type":"message","text":"Does it improve if you use this command line argument? \n`--compiled-modules=no`","user":"U8T0YV7QC","ts":"1608431133.033300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lk91v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Does it improve if you use this command line argument? \n"},{"type":"text","text":"--compiled-modules=no","style":{"code":true}}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"000CEFE5-9536-4DC5-B795-30EEABF0E0F7","type":"message","text":"--compiled-modules={yes|no}","user":"U8T0YV7QC","ts":"1608431150.033600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"sJt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"--compiled-modules={yes|no}"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"0b20d38f-01b5-43b1-ab6a-b08b60fa64fd","type":"message","text":"then it goes to 5 seconds (for me at least)","user":"U0179G7FG4F","ts":"1608431193.033800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YiL","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"then it goes to 5 seconds (for me at least)"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"5c719709-4d19-4b86-8123-29297ccb5cd5","type":"message","text":"<@U01FAHWCMFF> actually with a tiny tweak, I can get it down to .5 seconds already. `time julia --compile=min myscript.jl`","user":"U0179G7FG4F","ts":"1608431261.034000","team":"T68168MUP","edited":{"user":"U0179G7FG4F","ts":"1608431275.000000"},"blocks":[{"type":"rich_text","block_id":"oXN","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U01FAHWCMFF"},{"type":"text","text":" actually with a tiny tweak, I can get it down to .5 seconds already. "},{"type":"text","text":"time julia --compile=min myscript.jl","style":{"code":true}}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"f8b93097-b61f-463b-a3d0-0c63bb844d2c","type":"message","text":"That seems to speed it up for me","user":"U01FAHWCMFF","ts":"1608431306.034400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"4x1H6","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That seems to speed it up for me"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"C4D4FBA7-CF2A-4D1E-931F-17B3B15E218A","type":"message","text":"How about —optimize={0,1,2,3}","user":"U8T0YV7QC","ts":"1608431319.034700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"K5GTH","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How about —optimize={0,1,2,3}"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"6b0b6b26-a8d5-4bb0-97d5-0a430a6b93d1","type":"message","text":"The idea isnt to speed up that script that i had","user":"U01FAHWCMFF","ts":"1608431342.034900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"H5gh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The idea isnt to speed up that script that i had"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"868473f7-02fa-404a-8073-6e4124a8c07c","type":"message","text":"The idea is that in production I might be running a 300 line script","user":"U01FAHWCMFF","ts":"1608431355.035100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"iru","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The idea is that in production I might be running a 300 line script"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"2657CD98-88A7-4532-B567-5D9126C77E69","type":"message","text":"How many lines does not really matter","user":"U8T0YV7QC","ts":"1608431369.035400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hJoC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How many lines does not really matter"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"db257a24-856f-465d-bbcd-a19ceec54aa8","type":"message","text":"Is there a way to precompile EVERYTHING so that I can run it at lightning speed?","user":"U01FAHWCMFF","ts":"1608431372.035600","team":"T68168MUP","edited":{"user":"U01FAHWCMFF","ts":"1608431381.000000"},"blocks":[{"type":"rich_text","block_id":"nmPi","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Is there a way to precompile EVERYTHING so that I can run it at lightning speed?"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"FE25F70C-FD88-4955-8C70-AAECD94260AE","type":"message","text":"See PackageCompiler.jl ","user":"U8T0YV7QC","ts":"1608431395.036300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Vrr","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"See PackageCompiler.jl "}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"eac3b751-f6a3-4e95-9568-9134f24273db","type":"message","text":"Doesn’t that create intermediate files that are really large?","user":"U01FAHWCMFF","ts":"1608431414.036600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rBm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Doesn’t that create intermediate files that are really large?"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"b31c68b0-0ab9-4fe2-88db-ce994823eb9d","type":"message","text":"Or am i mistaken","user":"U01FAHWCMFF","ts":"1608431421.036800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"U+a","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Or am i mistaken"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"f5f01eb0-ddac-44f6-9be7-ce824b14c571","type":"message","text":"yeah. one file that's about 300mb","user":"U0179G7FG4F","ts":"1608431428.037100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"lahzR","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"yeah. one file that's about 300mb"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"445E6E99-F880-4CB2-A044-9A899539DA5E","type":"message","text":"So you will be able to compile a system image","user":"U8T0YV7QC","ts":"1608431428.037300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5g+xS","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So "},{"type":"text","text":"you will be"},{"type":"text","text":" able to compile "},{"type":"text","text":"a system image"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"e4e67f44-24dd-4306-ac44-335016e22c1a","type":"message","text":"So suppose I want to upload those files to github","user":"U01FAHWCMFF","ts":"1608431443.037500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dnTGm","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"So suppose I want to upload those files to github"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"45f54261-4ccf-414f-8f05-950e844e1091","type":"message","text":"would best practices be to omit those intermediate files and precompile everytime?","user":"U01FAHWCMFF","ts":"1608431456.037700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Jm1","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"would best practices be to omit those intermediate files and precompile everytime?"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"8efe85a5-d7f3-4670-a347-ff18b05ab30f","type":"message","text":"You could try making a custom sysimage that doesn't have the standard libraries you aren't using. Depending on how many libraries you have, that might get you smaller than the Github size limit. Otherwise, precompile every time is probably the best you can do currently.","user":"U0179G7FG4F","ts":"1608432531.037900","team":"T68168MUP","edited":{"user":"U0179G7FG4F","ts":"1608432538.000000"},"blocks":[{"type":"rich_text","block_id":"3cwgp","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You could try making a custom sysimage that doesn't have the standard libraries you aren't using. Depending on how many libraries you have, that might get you smaller than the Github size limit. Otherwise, precompile every time is probably the best you can do currently."}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"8D948220-F71B-4C1C-A687-806F75E2F205","type":"message","text":"The tradeoff is flexibility vs startup performance. \n\nMost people don’t really have problem with the extra seconds in the beginning if the script takes much longer to run. \n\nI don’t know about your use case, but if you find yourself calling the julia programs repeatedly from a shell script, then you may want to consider migrating the shell script itself into julia as well so you only take the compilation hit once only. Just a thought. ","user":"U8T0YV7QC","ts":"1608437329.049200","team":"T68168MUP","edited":{"user":"U8T0YV7QC","ts":"1608438787.000000"},"blocks":[{"type":"rich_text","block_id":"HzF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The tradeoff is flexibility vs startup performance. \n\nMost people don’t really have problem with the extra seconds in the beginning if the script takes much longer to run. \n\nI don’t know about your use case, but if you find yourself calling the julia programs repeatedly from a shell script, then you may want to consider migrating the shell script itself into julia as well so you only take the compilation hit once only. Just a thought. "}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"b7e50df6-2dd0-40a0-952d-67f452ce4237","type":"message","text":"Of course, that logic makes sense. I was thinking of applications in the realm of webdev where every second matters to the user experience, thats why compilation is so important :slightly_smiling_face:","user":"U01FAHWCMFF","ts":"1608437727.049400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"T3mO","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Of course, that logic makes sense. I was thinking of applications in the realm of webdev where every second matters to the user experience, thats why compilation is so important "},{"type":"emoji","name":"slightly_smiling_face"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"9F532627-E4B0-4391-999B-61852B853E49","type":"message","text":"Yeah. For more real-time experience, you can also build a service that responds to requests quickly. ","user":"U8T0YV7QC","ts":"1608439033.052100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"wEfI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah. For more real-time experience, you can also build a service that responds to requests quickly. "}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"C56E8199-2891-4F36-86FF-F3597038B942","type":"message","text":"This project also looks interesting <https://github.com/dmolina/DaemonMode.jl|https://github.com/dmolina/DaemonMode.jl>","user":"U8T0YV7QC","ts":"1608439062.052700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"IIJD9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This project also looks interesting "},{"type":"link","url":"https://github.com/dmolina/DaemonMode.jl","text":"https://github.com/dmolina/DaemonMode.jl"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"f241765e-52f4-4c6e-824a-458e8bdcc0b9","type":"message","text":"that's probably the right answer","user":"U0179G7FG4F","ts":"1608439188.052900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"GdREq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"that's probably the right answer"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"e5f65966-3f60-4118-845f-eb914241f6fd","type":"message","text":"Interesting will look into that library as PackageCompiler is giving me a headache with all these error messages, thanks!","user":"U01FAHWCMFF","ts":"1608439429.053100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"ZKB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Interesting will look into that library as PackageCompiler is giving me a headache with all these error messages, thanks!"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"44c236ed-8061-4ddb-85e1-312cf4a023ac","type":"message","text":"What you initially wanted, compilation of small binaries, is currently a WIP and won't be around for another 6 months ish, according to reports from someone working on it","user":"UDGT4PM41","ts":"1608464840.080400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MTh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"What you initially wanted, compilation of small binaries, is currently a WIP and won't be around for another 6 months ish, according to reports from someone working on it"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"bd7cb7a9-25be-4031-b089-5f1b9dc3e232","type":"message","text":"Can you link the repo?","user":"U01FAHWCMFF","ts":"1608494996.128700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"HiObo","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Can you link the repo?"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"cb3386fa-dd62-42ac-8a0d-ae829d9ffdc7","type":"message","text":"<@U6A0PD8CR> would know better where to look, but I think a bunch of the work is in GPUCompiler.jl","user":"UDGT4PM41","ts":"1608495598.128900","team":"T68168MUP","edited":{"user":"UDGT4PM41","ts":"1608495962.000000"},"blocks":[{"type":"rich_text","block_id":"HZlfQ","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"U6A0PD8CR"},{"type":"text","text":" would know better where to look, but I think a bunch of the work is in GPUCompiler.jl"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"03fa35e3-5e07-46be-8bb0-4967f1715141","type":"message","text":"PackageCompiler is where this work will eventually go I would hope","user":"U6A0PD8CR","ts":"1608560408.156500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"KB1gn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"PackageCompiler is where this work will eventually go I would hope"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"e2c38aa2-7061-45cd-af9f-a2fc6364a37e","type":"message","text":"A bunch probably will need to happen in Base also","user":"U0179G7FG4F","ts":"1608560451.156700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"cAQ3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"A bunch probably will need to happen in Base also"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"d2e12fa7-300c-4f24-8609-11f0061ba15f","type":"message","text":"Yeah, I have a Julia branch for splitting out the Julia runtime from libjulia","user":"U6A0PD8CR","ts":"1608560484.156900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Io28","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Yeah, I have a Julia branch for splitting out the Julia runtime from libjulia"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"},{"client_msg_id":"f184201a-ce30-4397-9031-31e90db2eb7b","type":"message","text":"And a PR up for exposing `imaging_mode` to `jl_create_native`, which is important for making emitted code independent of the Julia session that generated it","user":"U6A0PD8CR","ts":"1608560521.157100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"M3vI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And a PR up for exposing "},{"type":"text","text":"imaging_mode","style":{"code":true}},{"type":"text","text":" to "},{"type":"text","text":"jl_create_native","style":{"code":true}},{"type":"text","text":", which is important for making emitted code independent of the Julia session that generated it"}]}]}],"thread_ts":"1608430372.031800","parent_user_id":"U01FAHWCMFF"}]