[{"client_msg_id":"420B344C-2CB0-4BF5-8552-D4075AF2F2CC","type":"message","text":"I have a dictionary of moving particles from which I want to delete any that collide, which they do whenever one particle wants to move into the coordinates occupied by another one in a volume represented by a 3D integer array.  Empty coordinates are 0, and particles check this value before ‘entering’ them by changing it to their integer key in the dictionary.\n\nMy problem is that the number of particle collisions when I run my simulation with 1000 initial particles is too high—around 700 rather than 500.  I wonder if I’m not reliably deleting particles or something.  Here’s my deleting code:\n\n```for (p, particle in particles)\n    ...\n    x, y, z = new_coordinates\n    if volume[x,y,z] != 0\n        delete!(particles, key)\n        delete!(particles, volume[x,y,z])\n    else\n        ...\n    end\n...\nend```","user":"U01GC3N3ZJT","ts":"1609197358.242700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Moj2v","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have a dictionary of moving particles from which I want to delete any that collide, which they do whenever one particle wants to move into the coordinates occupied by another one in a volume represented by a 3D integer array.  Empty coordinates are 0, and particles check this value before ‘entering’ them by changing it to their integer key in the dictionary.\n"},{"type":"text","text":"\n"},{"type":"text","text":"My problem is that the number of particle collisions when I run my simulation with 1000 initial particles is too high—around 700 rather than 500.  I wonder if I’m not reliably deleting particles or something.  Here’s my deleting code:\n"},{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"for (p, particle in particles)\n"},{"type":"text","text":"    ...\n"},{"type":"text","text":"    x, y, z = new_coordinates\n"},{"type":"text","text":"    if volume[x,y,z] != 0\n"},{"type":"text","text":"        delete!(particles, key)\n"},{"type":"text","text":"        delete!(particles, volume[x,y,z])\n"},{"type":"text","text":"    else\n"},{"type":"text","text":"        ...\n"},{"type":"text","text":"    end\n"},{"type":"text","text":"...\n"},{"type":"text","text":"end"}]}]}],"thread_ts":"1609197358.242700","reply_count":13,"reply_users_count":2,"latest_reply":"1609347177.364900","reply_users":["USU9FRPEU","U01GC3N3ZJT"],"subscribed":false},{"client_msg_id":"03f1f44a-16a5-4798-abe7-200dd2b7f48e","type":"message","text":"Why do you have two `delete!` statements? How is your dictionary `particles` defined? The second argument of `delete!` should only be the dictionary key. Isn't `volume[x,y,z]` a binary value?","user":"USU9FRPEU","ts":"1609223282.245100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rhl","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Why do you have two "},{"type":"text","text":"delete!","style":{"code":true}},{"type":"text","text":" statements? How is your dictionary "},{"type":"text","text":"particles","style":{"code":true}},{"type":"text","text":" defined? The second argument of "},{"type":"text","text":"delete!","style":{"code":true}},{"type":"text","text":" should only be the dictionary key. Isn't "},{"type":"text","text":"volume[x,y,z]","style":{"code":true}},{"type":"text","text":" a binary value?"}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"},{"client_msg_id":"1EE512E6-65E9-4970-8A92-0A86FF9F9BF8","type":"message","text":"<@USU9FRPEU> Glad to hear from you!  My simulation moves the particles in three steps for each particle.  First, it generates new_coordinates by taking a one-step random walk.  Then, if those coordinates are inside a wall and, it resets them to the current coordinates of the particle. Last, it checks the value of volume at the coordinates; if the value is zero, it changes that value to the key of the particle; else, it deletes the particle with key p and the particle with the key equal to the value of volume at x,y,z.\n\nThe dictionary of particles is defined as a number of random walkers with keys from 1 to the number of walkers.  Volume is a 3D array of integers, so volume[x,y,z] shouldn’t be binary, right?","user":"U01GC3N3ZJT","ts":"1609252281.268100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"vuu","elements":[{"type":"rich_text_section","elements":[{"type":"user","user_id":"USU9FRPEU"},{"type":"text","text":" Glad to hear from you!  My simulation moves the particles in three steps for each particle.  First, it generates new_coordinates by taking a one-step random walk.  Then, if those coordinates are inside a wall and, it resets them to the current coordinates of the particle. Last, it checks the value of volume at the coordinates; if the value is zero, it changes that value to the key of the particle; else, it deletes the particle with key p and the particle with the key equal to the value of volume at x,y,z.\n\n"},{"type":"text","text":"The dictionary of particles is defined as a number of random walkers with keys from 1 to the number of walkers.  Volume is a 3D array of integers, so volume[x,y,z] shouldn’t be binary, right?"}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"},{"client_msg_id":"b684525d-eec5-4daf-bf9b-bf62eac1e5a0","type":"message","text":"OK, I see. You are deleting two particles. The one currently being considered and the one it collided with.","user":"USU9FRPEU","ts":"1609252511.268300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Dx+w","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"OK, I see. You are deleting two particles. The one currently being considered and the one it collided with."}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"},{"client_msg_id":"84f0e022-c9f5-4980-a7e4-fb9e7d1a0dff","type":"message","text":"The value of `volume[x,y,z]` is the the particle label?","user":"USU9FRPEU","ts":"1609252563.268500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hBuM","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The value of "},{"type":"text","text":"volume[x,y,z]","style":{"code":true}},{"type":"text","text":" is the the particle label?"}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"},{"client_msg_id":"2f156cc8-62f0-49f0-b51c-e8e8241d1ec8","type":"message","text":"Hmm.. but you are manipulating the dictionary while you are iterating over it.","user":"USU9FRPEU","ts":"1609252659.268700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"22nBK","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Hmm.. but you are manipulating the dictionary while you are iterating over it."}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT","reactions":[{"name":"point_up","users":["UN45LV5K6","U01GC3N3ZJT"],"count":2}]},{"client_msg_id":"e057366f-0b0f-4932-ab5d-c8d228a4a16a","type":"message","text":"I don't think that's a good idea.","user":"USU9FRPEU","ts":"1609252720.268900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"XLrQ3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don't think that's a good idea."}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"},{"client_msg_id":"81644978-5e93-490a-8c16-9ea0b60f37b6","type":"message","text":"```julia&gt; d = Dict(i =&gt; i for i in 1:5)\nDict{Int64,Int64} with 5 entries:\n  4 =&gt; 4\n  2 =&gt; 2\n  3 =&gt; 3\n  5 =&gt; 5\n  1 =&gt; 1\n\njulia&gt; for (k,v) in d\n           delete!(d, v+1)\n           println(v)\n       end\n4\n2\n1```","user":"USU9FRPEU","ts":"1609252877.269100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"O7/N","elements":[{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> d = Dict(i => i for i in 1:5)\nDict{Int64,Int64} with 5 entries:\n  4 => 4\n  2 => 2\n  3 => 3\n  5 => 5\n  1 => 1\n\njulia> for (k,v) in d\n           delete!(d, v+1)\n           println(v)\n       end\n4\n2\n1"}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"},{"client_msg_id":"0B5122A8-2638-45A4-B3C8-F5A27DDEDA09","type":"message","text":"I was worried about this and have tried a different version of your example:\n\n```letters = [“a”, “b”, “c”, “d”, “e”]\nnumbers = [i for i in 1:10]\ndictionary = Dict(number =&gt; letter for (number, letter) in zip(numbers, letters)]\n\nDict(Int64,String) with 5 entries: \n  4 =&gt; “d”\n  2 =&gt; “b”\n  3 =&gt; “c”\n  5 =&gt; “e”\n  1 =&gt; “a”\n\nfor (key, value) in dictionary\n    delete!(dictionary, key+1)\n    println(value)\nend\n\nd\nb\na\n```","user":"U01GC3N3ZJT","ts":"1609273279.306100","team":"T68168MUP","edited":{"user":"U01GC3N3ZJT","ts":"1609273284.000000"},"blocks":[{"type":"rich_text","block_id":"f8pDA","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I was worried about this and have tried a different version of your example:\n\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"letters = [“a”, “b”, “c”, “d”, “e”]\nnumbers = [i for i in 1:10]\ndictionary = Dict(number => letter for (number, letter) in zip(numbers, letters)]\n\nDict(Int64,String) with 5 entries: \n  4 => “d”\n  2 => “b”\n  3 => “c”\n  5 => “e”\n  1 => “a”\n\nfor (key, value) in dictionary\n    delete!(dictionary, key+1)\n    println(value)\nend\n\nd\nb\na"},{"type":"text","text":"\n"}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"},{"client_msg_id":"57497F7D-1AAC-4C39-88D7-5985B075D68D","type":"message","text":"Maybe I should instead push the keys of the colliding particles to an array and delete them all later.","user":"U01GC3N3ZJT","ts":"1609273551.308500","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"MTV","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Maybe I should instead push the keys of the colliding particles to an array and delete them all later."}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"},{"client_msg_id":"25392cce-f13e-49af-ae6e-f348ed15c7a1","type":"message","text":"Or you could copy the keys of the dictionary before iterating over them","user":"USU9FRPEU","ts":"1609274666.309300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"5D2c","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Or you could copy the keys of the dictionary before iterating over them"}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"},{"client_msg_id":"DCF2DA16-3CD5-4438-BD78-BFCDB75F4710","type":"message","text":"That works, too!  If I did it the first way, would this loop delete all the colliding particles from the dictionary?\n\n```for key in colliding_particles\n    delete!(particle_dictionary, key)\nend```","user":"U01GC3N3ZJT","ts":"1609275142.315900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"zEeP","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"That works, too!  If I did it the first way, would this loop delete all the colliding particles from the dictionary?\n"},{"type":"text","text":"\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"for key in colliding_particles\n"},{"type":"text","text":"    delete!(particle_dictionary, key)\n"},{"type":"text","text":"end"}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"},{"client_msg_id":"1f8a7f6d-0edb-4d6d-8b93-556d484a3516","type":"message","text":"I think so","user":"USU9FRPEU","ts":"1609275282.316400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"yQ4","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I think so"}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"},{"client_msg_id":"3A925488-CD8D-447C-A781-C5FE227EFE6B","type":"message","text":"The plot thickens... \n\nI tried deleting the particles in one pass and saw the same result, so I returned to my previous implementation, added some inline error logging, and discovered something bizarre.  The environment value was the same as the key of the reagent I wanted to delete!","user":"U01GC3N3ZJT","ts":"1609347177.364900","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"DCxj","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The plot thickens... \n"},{"type":"text","text":"\n"},{"type":"text","text":"I tried deleting the particles in one pass and saw the same result, so I returned to my previous implementation, added some inline error logging, and discovered something bizarre.  The environment value was the same as the key of the reagent I wanted to delete!"}]}]}],"thread_ts":"1609197358.242700","parent_user_id":"U01GC3N3ZJT"}]