[{"client_msg_id":"cea42725-25f4-4d1e-8632-780126de33f0","type":"message","text":"Does anyone know how `Statistics.quantile` treats `NaN` and why?\n```julia&gt; using StatsBase\njulia&gt; b = rand(20,20)\njulia&gt; b[3,3] = NaN\njulia&gt; quantile(vec(b), 0.5)\n0.5152183269708394\n\njulia&gt; quantile(b[isfinite.(b)], 0.5)\n0.5118644684150617```\nThe numbers differ - not really sure why?\n\nThe docs <https://docs.julialang.org/en/v1/stdlib/Statistics/#Statistics.quantile> mysteriously say “An ArgumentError is thrown if v contains NaN or missing values.”","user":"U73KENNG4","ts":"1613114642.082600","team":"T68168MUP","edited":{"user":"U73KENNG4","ts":"1613115819.000000"},"blocks":[{"type":"rich_text","block_id":"C5/K","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Does anyone know how "},{"type":"text","text":"Statistics.quantile","style":{"code":true}},{"type":"text","text":" treats "},{"type":"text","text":"NaN","style":{"code":true}},{"type":"text","text":" and why?\n"}]},{"type":"rich_text_preformatted","elements":[{"type":"text","text":"julia> using StatsBase\njulia> b = rand(20,20)\njulia> b[3,3] = NaN\njulia> quantile(vec(b), 0.5)\n0.5152183269708394\n\njulia> quantile(b[isfinite.(b)], 0.5)\n0.5118644684150617"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"The numbers differ - not really sure why?\n\nThe docs "},{"type":"link","url":"https://docs.julialang.org/en/v1/stdlib/Statistics/#Statistics.quantile"},{"type":"text","text":" mysteriously say “An ArgumentError is thrown if v contains NaN or missing values.”"}]}]}],"thread_ts":"1613114642.082600","reply_count":7,"reply_users_count":3,"latest_reply":"1613236875.084400","reply_users":["UHDQQ4GN6","U73KENNG4","U67431ELR"],"subscribed":false},{"client_msg_id":"2a41e666-4a7a-4398-9556-4d8cd81de9c1","type":"message","text":"Not certain, but it appears to assume that its partial sort has moved all `NaN`s to the end, which is definitely not happening.","user":"UHDQQ4GN6","ts":"1613117481.083200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"beq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Not certain, but it appears to assume that its partial sort has moved all "},{"type":"text","text":"NaN","style":{"code":true}},{"type":"text","text":"s to the end, which is definitely not happening."}]}]}],"thread_ts":"1613114642.082600","parent_user_id":"U73KENNG4"},{"client_msg_id":"71f4f05a-07c7-4fad-babd-2e1d3661d1a2","type":"message","text":"<https://github.com/JuliaLang/Statistics.jl/blob/master/src/Statistics.jl#L971-L972>","user":"UHDQQ4GN6","ts":"1613117486.083400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"FDwI","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/JuliaLang/Statistics.jl/blob/master/src/Statistics.jl#L971-L972"}]}]}],"thread_ts":"1613114642.082600","parent_user_id":"U73KENNG4"},{"client_msg_id":"dd432ee4-89ff-4b2a-a300-85f73eb3fe8f","type":"message","text":"very interesting - though sorting the NaNs to the end would explain why the quantile value gets higher in the presences of NaN","user":"U73KENNG4","ts":"1613117608.083600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"aV3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"very interesting - though sorting the NaNs to the end would explain why the quantile value gets higher in the presences of NaN"}]}]}],"thread_ts":"1613114642.082600","parent_user_id":"U73KENNG4"},{"client_msg_id":"87c923de-75da-4213-b314-11f517185165","type":"message","text":"Ugh. We assume the input has been sorted, but actually we only perform a partial sort. We should just use `any(isnan, v)`. Can you file an issue?","user":"U67431ELR","ts":"1613136534.083800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"u2S","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Ugh. We assume the input has been sorted, but actually we only perform a partial sort. We should just use "},{"type":"text","text":"any(isnan, v)","style":{"code":true}},{"type":"text","text":". Can you file an issue?"}]}]}],"thread_ts":"1613114642.082600","parent_user_id":"U73KENNG4"},{"client_msg_id":"2253f6ed-b6a4-421f-95fc-58fbea954af4","type":"message","text":"This seems to date back to 2015: <https://github.com/JuliaLang/Statistics.jl/commit/972adc312acd2c08acffbece84346a54e0cbd5b8>","user":"U67431ELR","ts":"1613136614.084000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"mxfWf","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"This seems to date back to 2015: "},{"type":"link","url":"https://github.com/JuliaLang/Statistics.jl/commit/972adc312acd2c08acffbece84346a54e0cbd5b8"}]}]}],"thread_ts":"1613114642.082600","parent_user_id":"U73KENNG4"},{"client_msg_id":"36337948-bd9e-4eef-a6f7-b74052fab73a","type":"message","text":"sure I will","user":"U73KENNG4","ts":"1613146635.084200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"TzAyn","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"sure I will"}]}]}],"thread_ts":"1613114642.082600","parent_user_id":"U73KENNG4"},{"client_msg_id":"2d0919ca-0af4-4394-9507-84a579a77769","type":"message","text":"Actually I've made a PR: <https://github.com/JuliaLang/Statistics.jl/pull/72>","user":"U67431ELR","ts":"1613236875.084400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"UWt","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Actually I've made a PR: "},{"type":"link","url":"https://github.com/JuliaLang/Statistics.jl/pull/72"}]}]}],"thread_ts":"1613114642.082600","parent_user_id":"U73KENNG4"}]