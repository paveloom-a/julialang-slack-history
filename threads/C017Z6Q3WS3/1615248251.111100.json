[{"client_msg_id":"06b59267-d472-40ce-90a0-ff295c2a487d","type":"message","text":"Pluto doesn't respect the JULIA_NUM_THREADAS environment variable for some reason?","user":"UH8A351DJ","ts":"1615248251.111100","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615248336.000000"},"blocks":[{"type":"rich_text","block_id":"Qrsq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Pluto doesn't respect the JULIA_NUM_THREADAS environment variable for some reason?"}]}]}],"thread_ts":"1615248251.111100","reply_count":27,"reply_users_count":4,"latest_reply":"1615418509.121900","reply_users":["U017JTQFNEQ","UH8A351DJ","UEGRU91B2","U01B75VG3GR"],"subscribed":false},{"client_msg_id":"49036618-8201-4afe-851f-2c063f0a6834","type":"message","text":"there is some discussion of Pluto and distributed. <https://github.com/fonsp/Pluto.jl/issues/300>","user":"U017JTQFNEQ","ts":"1615255673.111400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"YoC","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"there is some discussion of Pluto and distributed. "},{"type":"link","url":"https://github.com/fonsp/Pluto.jl/issues/300"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"cf036333-d48d-461c-867e-767191c4efd4","type":"message","text":"nope, that's not it, I'm using threads not processes","user":"UH8A351DJ","ts":"1615255826.111600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"l+a3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"nope, that's not it, I'm using threads not processes"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ","reactions":[{"name":"shrug","users":["U017JTQFNEQ"],"count":1}]},{"client_msg_id":"bfcf7c7e-3fa0-4b2d-a3a8-cb566c060552","type":"message","text":"I don’t know if you copied and pasted but there is a typo in your env variable, it has an extra “A” `JULIA_NUM_THREADAS` should read `JULIA_NUM_THREADS`","user":"UEGRU91B2","ts":"1615268438.111900","team":"T68168MUP","edited":{"user":"UEGRU91B2","ts":"1615268695.000000"},"blocks":[{"type":"rich_text","block_id":"B/IE","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I don’t know if you copied and pasted but there is a typo in your env variable, it has an extra “A” "},{"type":"text","text":"JULIA_NUM_THREADAS","style":{"code":true}},{"type":"text","text":" should read "},{"type":"text","text":"JULIA_NUM_THREADS","style":{"code":true}}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"090c7375-c23a-4d34-9164-0f37cc1fee86","type":"message","text":"sorry that typo only exists here. In my case I tested in Julia REPL which works just fine, reporting the specified number of threads","user":"UH8A351DJ","ts":"1615305181.112200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"AcB","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"sorry that typo only exists here. In my case I tested in Julia REPL which works just fine, reporting the specified number of threads"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"77611425-c71c-42a4-9896-3e74a7de8175","type":"message","text":"Oh, it was a long shot but that has happened to me before","user":"UEGRU91B2","ts":"1615312818.112400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"0V9","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Oh, it was a long shot but that has happened to me before"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"5cae169c-f89d-4e64-ace5-3bec8afd823c","type":"message","text":"It does, but child processes don’t :stuck_out_tongue:","user":"U01B75VG3GR","ts":"1615412122.114800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"A9hks","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"It does, but child processes don’t "},{"type":"emoji","name":"stuck_out_tongue"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"e06f6181-c2ab-4519-a9a8-365578fba26c","type":"message","text":"You can use `Pluto.run(threads=\"3\")`","user":"U01B75VG3GR","ts":"1615412238.115000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"PdrF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"You can use "},{"type":"text","text":"Pluto.run(threads=\"3\")","style":{"code":true}}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"bb93a3e6-4a2a-42f0-87d0-82061d47261c","type":"message","text":"By default we try to give you half of your cpu cores, with a minimal of 2, except when you just have one core… then it’s 1 :grin:","user":"U01B75VG3GR","ts":"1615412277.115200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"+3o","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"By default we try to give you half of your cpu cores, with a minimal of 2, except when you just have one core… then it’s 1 "},{"type":"emoji","name":"grin"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"type":"message","subtype":"thread_broadcast","text":"well, the half of cpu cores is actually half of 2x cpu cores (because hyper threading) so you end up giving threads ~= # cpu cores. (which I believed is by design, according to the code comments)\n\nwhen on a shared node environment, often the motherboard have 2+ cpu(s) so you end up giving me all cpu cores across *four* cpus which is not very efficient in terms of memory sharing to begin with.\n\nthere is a reason user sets `JULIA_NUM_THREADS` . Opened a <https://github.com/fonsp/Pluto.jl/pull/990|PR> for further discussion.","user":"UH8A351DJ","ts":"1615417149.116700","thread_ts":"1615248251.111100","root":{"client_msg_id":"06b59267-d472-40ce-90a0-ff295c2a487d","type":"message","text":"Pluto doesn't respect the JULIA_NUM_THREADAS environment variable for some reason?","user":"UH8A351DJ","ts":"1615248251.111100","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615248336.000000"},"blocks":[{"type":"rich_text","block_id":"Qrsq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Pluto doesn't respect the JULIA_NUM_THREADAS environment variable for some reason?"}]}]}],"thread_ts":"1615248251.111100","reply_count":27,"reply_users_count":4,"latest_reply":"1615418509.121900","reply_users":["U017JTQFNEQ","UH8A351DJ","UEGRU91B2","U01B75VG3GR"],"subscribed":false},"blocks":[{"type":"rich_text","block_id":"jXq78","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"well, the half of cpu cores is actually half of 2x cpu cores (because hyper threading) so you end up giving threads ~= # cpu cores. (which I believed is by design, according to the code comments)\n\nwhen on a shared node environment, often the motherboard have 2+ cpu(s) so you end up giving me all cpu cores across "},{"type":"text","text":"four","style":{"bold":true}},{"type":"text","text":" cpus which is not very efficient in terms of memory sharing to begin with.\n\nthere is a reason user sets "},{"type":"text","text":"JULIA_NUM_THREADS","style":{"code":true}},{"type":"text","text":" . Opened a "},{"type":"link","url":"https://github.com/fonsp/Pluto.jl/pull/990","text":"PR"},{"type":"text","text":" for further discussion."}]}]}],"client_msg_id":"04d2008f-e194-4dfe-8f2c-aa48576fd1cd","edited":{"user":"UH8A351DJ","ts":"1615418728.000000"}},{"client_msg_id":"61ab5365-dfbe-45c9-ae79-fffe40f2bb57","type":"message","text":"How do we give you four cpu cores?","user":"U01B75VG3GR","ts":"1615417624.117800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"I8Q/5","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"How do we give you four cpu cores?"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"b80b54b6-69d5-4c61-a0e4-ec0e76ae5d92","type":"message","text":"Main pluto runs on one core","user":"U01B75VG3GR","ts":"1615417631.118000","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"hiI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Main pluto runs on one core"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"0e98b16a-20d1-4fca-917b-cd2d2f6fbde0","type":"message","text":"4 cpu x 8 cores","user":"UH8A351DJ","ts":"1615417655.118200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jPzNF","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"4 cpu x 8 cores"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"5251ddcc-b9cb-4c6c-a415-6484082685ab","type":"message","text":"the server I'm on have 4 cpu sillicons, each have 8 cores capable of 2 threads","user":"UH8A351DJ","ts":"1615417672.118400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"gSq3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"the server I'm on have 4 cpu sillicons, each have 8 cores capable of 2 threads"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"8b0ebe93-83e9-468f-97f5-1bf535e45cbe","type":"message","text":"The hard thing about JULIA_NUM_THREADS is that is applies to the main pluto process and the runner process","user":"U01B75VG3GR","ts":"1615417673.118600","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"OL2","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"The hard thing about JULIA_NUM_THREADS is that is applies to the main pluto process and the runner process"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"0a47d962-cb22-4048-97c3-f7a10bc900e5","type":"message","text":"Pluto by default gave me 28 threads, that is unreasonable to say the least.","user":"UH8A351DJ","ts":"1615417760.118800","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615417801.000000"},"blocks":[{"type":"rich_text","block_id":"fMOAW","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Pluto by default gave me 28 threads, that is unreasonable to say the least."}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"c7e4e96a-5cb4-4c4f-8651-34c2cf2bdfa7","type":"message","text":"Having 112 (virtual) cores is :stuck_out_tongue:","user":"U01B75VG3GR","ts":"1615417809.119100","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"QS3F3","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Having 112 (virtual) cores is "},{"type":"emoji","name":"stuck_out_tongue"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"c7157c88-baee-44c3-bbf4-ece454c98ef3","type":"message","text":"And we have a documented option for it!!","user":"U01B75VG3GR","ts":"1615417819.119300","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"dYZ","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"And we have a documented option for it!!"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"85644a25-7b7e-49d8-a6f4-cbec71d565be","type":"message","text":"why not making it the default? user explicitly set an environment variable just so when they use Julia/Julia in VSCode/Julia in Jupyter notebook they don't have to individually adjust settings.","user":"UH8A351DJ","ts":"1615417862.119500","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615417875.000000"},"blocks":[{"type":"rich_text","block_id":"qe1l","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"why not making it the default? user explicitly set an environment variable just so when they use Julia/Julia in VSCode/Julia in Jupyter notebook they don't have to individually adjust settings."}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"56be413a-c6e1-4730-b85c-b28b759db6b7","type":"message","text":"&gt;  The hard thing about JULIA_NUM_THREADS is that is applies to the main pluto process and the runner process","user":"U01B75VG3GR","ts":"1615417946.119800","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"Gr7U","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":" The hard thing about JULIA_NUM_THREADS is that is applies to the main pluto process and the runner process"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"df2529b8-6287-43ad-a441-54009b1b1052","type":"message","text":"julia itself even have an `-t auto` option, why re-invent the wheel AND ignore user's preference","user":"UH8A351DJ","ts":"1615417954.120000","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615418211.000000"},"blocks":[{"type":"rich_text","block_id":"zRiCD","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"julia itself even have an "},{"type":"text","text":"-t auto","style":{"code":true}},{"type":"text","text":" option, why re-invent the wheel AND ignore user's preference"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"53515950-5b68-4511-a939-9fb82f01e198","type":"message","text":"<https://github.com/fonsp/Pluto.jl/pull/990>","user":"UH8A351DJ","ts":"1615417980.120200","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"VEkj","elements":[{"type":"rich_text_section","elements":[{"type":"link","url":"https://github.com/fonsp/Pluto.jl/pull/990"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"63870a61-2361-4662-950e-97d638615c93","type":"message","text":"not sure what do you mean, it seems to be a simple fix to me, maybe I'm overlooking something?","user":"UH8A351DJ","ts":"1615417992.120400","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615418008.000000"},"blocks":[{"type":"rich_text","block_id":"YcyX","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"not sure what do you mean, it seems to be a simple fix to me, maybe I'm overlooking something?"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"f18627a4-14a6-4bc7-8460-df84c2e9e7c7","type":"message","text":"&gt;  why re-inventing the wheel AND disregard user’s preference\nShould be Pluto’s slogan","user":"U01B75VG3GR","ts":"1615418029.120700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"NXDH","elements":[{"type":"rich_text_quote","elements":[{"type":"text","text":" why re-inventing the wheel AND disregard user’s preference"}]},{"type":"rich_text_section","elements":[{"type":"text","text":"Should be Pluto’s slogan"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ","reactions":[{"name":"grin","users":["U01BU7WSP4Z"],"count":1}]},{"type":"message","subtype":"thread_broadcast","text":"I have no problem with re-inventing the wheel for more flexibility / customization. But when user deliberately limits the resource, Pluto should have no reason to not respect it.","user":"UH8A351DJ","ts":"1615418114.120900","thread_ts":"1615248251.111100","root":{"client_msg_id":"06b59267-d472-40ce-90a0-ff295c2a487d","type":"message","text":"Pluto doesn't respect the JULIA_NUM_THREADAS environment variable for some reason?","user":"UH8A351DJ","ts":"1615248251.111100","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615248336.000000"},"blocks":[{"type":"rich_text","block_id":"Qrsq","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Pluto doesn't respect the JULIA_NUM_THREADAS environment variable for some reason?"}]}]}],"thread_ts":"1615248251.111100","reply_count":27,"reply_users_count":4,"latest_reply":"1615418509.121900","reply_users":["U017JTQFNEQ","UH8A351DJ","UEGRU91B2","U01B75VG3GR"],"subscribed":false},"blocks":[{"type":"rich_text","block_id":"PRhv","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"I have no problem with re-inventing the wheel for more flexibility / customization. But when user deliberately limits the resource, Pluto should have no reason to not respect it."}]}]}],"client_msg_id":"78bfc1b2-b6cc-4ec4-8046-431d39dabe53","edited":{"user":"UH8A351DJ","ts":"1615418127.000000"}},{"client_msg_id":"a92cbd01-93dd-46f9-95d3-a3fa6cfd4347","type":"message","text":"Do you have any documentation on `-t auto`?","user":"U01B75VG3GR","ts":"1615418205.121400","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"rKcNI","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"Do you have any documentation on "},{"type":"text","text":"-t auto","style":{"code":true}},{"type":"text","text":"?"}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"346ebbbd-157a-4330-8e17-dc300152338f","type":"message","text":"it is documented in the manual, <https://github.com/JuliaLang/julia/blob/c760957469febf952b8bd5c66b1c2a005e6f5dad/doc/src/manual/command-line-options.md>\n\nas far as I can tell it's doing what Pluto is trying to do in `Pluto.Configuration.roughly_the_number_of_physical_cpu_cores()`","user":"UH8A351DJ","ts":"1615418281.121700","team":"T68168MUP","blocks":[{"type":"rich_text","block_id":"jl/z","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"it is documented in the manual, "},{"type":"link","url":"https://github.com/JuliaLang/julia/blob/c760957469febf952b8bd5c66b1c2a005e6f5dad/doc/src/manual/command-line-options.md"},{"type":"text","text":"\n\nas far as I can tell it's doing what Pluto is trying to do in "},{"type":"text","text":"Pluto.Configuration.roughly_the_number_of_physical_cpu_cores()","style":{"code":true}}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"},{"client_msg_id":"6650d0aa-36f6-4ee8-a92d-a9ba8e623a85","type":"message","text":"(sorry, except it didn't divide by 2). I have no problem with our own `Pluto.Configuration.roughly_the_number_of_physical_cpu_cores`, as long as it doesn't ignore user's clear preference with `JULIA_NUM_THREADS`","user":"UH8A351DJ","ts":"1615418509.121900","team":"T68168MUP","edited":{"user":"UH8A351DJ","ts":"1615418588.000000"},"blocks":[{"type":"rich_text","block_id":"zzEh","elements":[{"type":"rich_text_section","elements":[{"type":"text","text":"(sorry, except it didn't divide by 2). I have no problem with our own "},{"type":"text","text":"Pluto.Configuration.roughly_the_number_of_physical_cpu_cores","style":{"code":true}},{"type":"text","text":", as long as it doesn't ignore user's clear preference with "},{"type":"text","text":"JULIA_NUM_THREADS","style":{"code":true}}]}]}],"thread_ts":"1615248251.111100","parent_user_id":"UH8A351DJ"}]